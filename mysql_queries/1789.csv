(SELECT DISTINCT employee_id, department_id FROM Employee WHERE primary_flag = 'Y') UNION (SELECT DISTINCT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1) ORDER BY employee_id
(SELECT DISTINCT employee_id, department_id FROM Employee WHERE primary_flag = 'Y') UNION ALL (SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'N' AND employee_id IN(SELECT employee_id FROM Employee GROUP BY 1 HAVING COUNT(*) = 1))
(SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(DISTINCT department_id) = 1) UNION (SELECT employee_id, department_id FROM Employee WHERE primary_flag="Y")
(SELECT employee_id, department_id FROM Employee WHERE primary_flag = "Y" ) UNION ( SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1 )
(SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' GROUP BY employee_id) UNION (SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1)
(SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y') UNION (SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1)
(SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y') union (select employee_id, department_id from Employee group by employee_id having count(*) = 1 )
(SELECT employee_id, department_id FROM Employee WHERE primary_flag ='Y') UNION (SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id)=1)
(SELECT employee_id, department_id FROM Employee WHERE primary_flag='Y') UNION (SELECT employee_id,department_id FROM Employee GROUP BY employee_id HAVING count(department_id)=1)
(SELECT employee_id, department_id from employee group by employee_id HAVING count(distinct department_id) = 1) UNION (SELECT employee_id, department_id from employee WHERE primary_flag ='Y')
(Select employee_id, department_id From Employee where primary_flag = "Y" ) UNION (Select employee_id, department_id From Employee Group by employee_id Having count(department_id) = 1)
(select a.employee_id, b.department_id from (select employee_id from Employee group by employee_id having count(*)=1) a left join Employee b on a.employee_id=b.employee_id) union (select employee_id,department_id from Employee where primary_flag='Y')
(select employee_id ,department_id from Employee group by employee_id having count( department_id) =1 ) union (select employee_id ,department_id from Employee where primary_flag ="Y" group by employee_id)
(select employee_id ,department_id from Employee group by employee_id having count(distinct department_id) =1 ) union (select employee_id ,department_id from Employee where primary_flag ="Y" group by employee_id)
(select employee_id, department_id from Employee group by employee_id having count(department_id) = 1) union (select employee_id, department_id from Employee where primary_flag = 'Y')
(select employee_id, department_id from Employee where primary_flag = 'Y') union (select employee_id, department_id from Employee group by 1 having count(distinct department_id) = 1)
(select employee_id, department_id from Employee where primary_flag = 'Y') union (select employee_id, department_id from Employee group by employee_id having count(*) = 1)
(select employee_id, department_id from Employee where primary_flag = 'Y') union (select employee_id, department_id from Employee group by employee_id having count(department_id) = 1)
(select employee_id, department_id from Employee where primary_flag = 'Y') union (select employee_id, department_id from Employee where employee_id not in (select employee_id from Employee where primary_flag = 'Y'))
(select employee_id, department_id from employee group by 1 having count(department_id) = 1) union (select employee_id, department_id from employee where primary_flag = 'Y')
(select employee_id, department_id from employee group by employee_id having count(department_id) = 1) union (select employee_id, department_id from employee where primary_flag = 'Y' )
(select employee_id, department_id from employee where primary_flag = 'Y') union (select employee_id, department_id from employee group by employee_id having count(department_id) = 1)
(select employee_id, department_id from employee where primary_flag='Y') union (select employee_id, department_id from employee group by 1 having count(*)=1)
SELECT DISTINCT A.employee_id, A.department_id FROM (SELECT employee_id, department_id FROM Employee WHERE employee_id IN (SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(employee_id) = 1) UNION ALL SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y') A
SELECT DISTINCT employee_id, department_id FROM ( SELECT employee_id, department_id FROM Employee WHERE primary_flag = "Y" UNION ALL SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING count(*) = 1 ) as a
SELECT EMPLOYEE_ID, DEPARTMENT_ID FROM EMPLOYEE E1 WHERE PRIMARY_FLAG = 'Y' UNION ALL SELECT EMPLOYEE_ID, DEPARTMENT_ID FROM EMPLOYEE E WHERE PRIMARY_FLAG = 'N' AND NOT EXISTS (SELECT 1 FROM EMPLOYEE E2 WHERE E.EMPLOYEE_ID = E2.EMPLOYEE_ID AND E2.PRIMARY_FLAG = 'Y' )
SELECT EMPLOYEE_ID, DEPARTMENT_ID FROM EMPLOYEE WHERE PRIMARY_FLAG = 'Y' UNION SELECT EMPLOYEE_ID, DEPARTMENT_ID FROM EMPLOYEE GROUP BY 1 HAVING COUNT(*) = 1
SELECT EMPLOYEE_ID, DEPARTMENT_ID FROM EMPLOYEE WHERE PRIMARY_FLAG='Y' OR EMPLOYEE_ID IN (SELECT EMPLOYEE_ID FROM EMPLOYEE GROUP BY EMPLOYEE_ID HAVING COUNT(*)=1)
SELECT EMPLOYEE_ID,DEPARTMENT_ID FROM ( SELECT *,COUNT(EMPLOYEE_ID) OVER(PARTITION BY EMPLOYEE_ID) C FROM EMPLOYEE )T WHERE C=1 OR PRIMARY_FLAG='Y'
SELECT distinct employee_id, department_id from( SELECT *, count(department_id) over(partition by employee_id) as d_count from Employee)p1 where (d_count>1 and primary_flag='Y') or (d_count=1)
SELECT employee_id , department_id FROM ( SELECT employee_id, department_id, DENSE_RANK() OVER(PARTITION BY employee_id ORDER BY primary_flag) AS rnk FROM employee) r WHERE rnk = 1
SELECT employee_id , department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id , department_id FROM Employee group by employee_id HAVING COUNT(employee_id) = 1
SELECT employee_id , department_id FROM employee WHERE primary_flag = 'Y' UNION SELECT employee_id , department_id FROM employee GROUP BY 1 HAVING COUNT(department_id) = 1
SELECT employee_id, COALESCE(MAX(CASE WHEN primary_flag = 'Y' THEN department_id ELSE NULL END),department_id) AS department_id FROM Employee GROUP BY employee_id
SELECT employee_id, MAX(CASE WHEN primary_flag = "Y" THEN department_id END) AS department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) > 1 UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) = 1
SELECT employee_id, department_id FROM ( SELECT employee_id, department_id, primary_flag, COUNT(department_id) OVER (PARTITION BY employee_id) AS count_dept FROM Employee ) AS t1 WHERE count_dept = 1 OR primary_flag = 'Y'
SELECT employee_id, department_id FROM (SELECT *, COUNT(employee_id) OVER (PARTITION BY employee_id) C FROM Employee) T WHERE C = 1 OR primary_flag = 'Y'
SELECT employee_id, department_id FROM (SELECT employee_id, department_id, CASE WHEN COUNT(department_id) OVER(PARTITION BY employee_id) = 1 THEN 'Y' ELSE primary_flag END AS primary_flag FROM Employee )t WHERE primary_flag = 'Y'
SELECT employee_id, department_id FROM (SELECT employee_id, department_id, DENSE_RANK() OVER(partition by employee_id order by primary_flag ) as rk FROM Employee e )AS temp WHERE rk =1
SELECT employee_id, department_id FROM (SELECT employee_id, department_id, primary_flag, COUNT(department_id) OVER(PARTITION BY employee_id) cn FROM Employee) temp WHERE (CASE WHEN cn = 1 THEN primary_flag = "N" OR primary_flag = "Y" WHEN cn > 1 THEN primary_flag = "Y" END)
SELECT employee_id, department_id FROM (select employee_id, department_id, DENSE_RANK() OVER(partition by employee_id order by primary_flag) AS myrank from employee )t WHERE myrank=1
SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) = 1 UNION SELECT employee_id, department_id FROM Employee WHERE primary_flag = "Y"
SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) < 2 UNION SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y'
SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1 UNION SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y'
SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING(COUNT(department_id) = 1) UNION SELECT employee_id, department_id FROM Employee WHERE primary_flag="Y" GROUP BY employee_id
SELECT employee_id, department_id FROM Employee WHERE (primary_flag='Y') UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id)=1 ORDER BY employee_id
SELECT employee_id, department_id FROM Employee WHERE employee_id IN ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT( employee_id ) = 1 ) || primary_flag = 'Y'
SELECT employee_id, department_id FROM Employee WHERE employee_id IN ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(employee_id) = 1 ) OR primary_flag = 'Y' ORDER BY employee_id
SELECT employee_id, department_id FROM Employee WHERE primary_flag = "Y" OR employee_id IN (SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1)
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id IN ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(employee_id) = 1 )
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id IN (SELECT employee_id FROM (SELECT employee_id, COUNT(*) AS cnt FROM Employee GROUP BY employee_id) AS t1 WHERE cnt = 1)
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id IN (SELECT employee_id FROM (SELECT employee_id, COUNT(department_id) AS "dpt_count" FROM Employee GROUP BY employee_id) AS DptCount WHERE dpt_count = 1)
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id IN (SELECT employee_id FROM Employee GROUP BY 1 HAVING COUNT(*) = 1 )
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id NOT IN (SELECT employee_id FROM Employee WHERE primary_flag = 'Y')
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' OR employee_id in( SELECT employee_id FROM Employee GROUP BY employee_id HAVING count(department_id) = 1)
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT DISTINCT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(employee_id) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY 1 HAVING COUNT(department_id) =1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY Employee_id HAVING COUNT(*) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) = 1 ORDER BY employee_id, department_id
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(DISTINCT department_id) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(employee_id) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING count(employee_id) = 1
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT employee_id, department_id FROM Employee WHERE employee_id in ( SELECT employee_id FROM Employee GROUP BY 1 HAVING COUNT(*) = 1)
SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' or employee_id in ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING count(department_id) = 1 )
SELECT employee_id, department_id FROM Employee WHERE primary_flag='Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*)=1
SELECT employee_id, department_id FROM Employee WHERE primary_flag='Y' UNION SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id)=1
SELECT employee_id, department_id FROM Employee e WHERE primary_flag = 'Y' or employee_id in ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING count(department_id) = 1 )
SELECT employee_id, department_id FROM Employee where primary_flag = 'Y' group by 1 union SELECT a.employee_id, a.department_id FROM (SELECT employee_id, department_id, count(department_id) from Employee group by 1 having count(department_id) = 1) a
SELECT employee_id, department_id FROM employee GROUP BY employee_id HAVING count(*) = 1 UNION SELECT employee_id, department_id FROM employee WHERE primary_flag = "Y" AND employee_id NOT IN (SELECT employee_id FROM employee GROUP BY employee_id HAVING count(*) = 1)
SELECT employee_id, department_id FROM employee GROUP BY employee_id HAVING count(department_id) = 1 UNION SELECT employee_id, department_id FROM employee WHERE primary_flag = 'Y'
SELECT employee_id, department_id FROM employee WHERE primary_flag = 'Y' OR employee_id IN ( SELECT employee_id FROM employee GROUP BY employee_id HAVING COUNT(department_id) = 1 )
SELECT employee_id, department_id FROM employee group by 1 having count(department_id) = 1 union SELECT employee_id, department_id FROM employee WHERE primary_flag = 'Y'
SELECT employee_id, department_id FROM( SELECT employee_id, department_id, primary_flag, COUNT(department_id) OVER(PARTITION BY employee_id) as num_depts FROM employee )a WHERE primary_flag='Y' or num_depts=1
SELECT employee_id, department_id FROM( SELECT employee_id, department_id,primary_flag, COUNT(department_id) OVER(PARTITION BY employee_id) as num_dept FROM Employee )a WHERE primary_flag='Y' or num_dept=1
SELECT employee_id, if(count(department_id)=1, department_id, sum(if(primary_flag='Y',1,0)*department_id)) as department_id FROM Employee GROUP BY employee_id
SELECT employee_id,department_id FROM Employee GROUP BY 1 HAVING COUNT(department_id)=1 UNION SELECT employee_id,department_id FROM Employee WHERE primary_flag = "Y" GROUP BY 1
SELECT employee_id,department_id FROM Employee WHERE primary_flag='Y' or employee_id in (SELECT employee_id from Employee group by 1 having count(distinct department_id)=1) ORDER BY 1
SELECT employee_id,department_id FROM Employee wHERE primary_flag='Y' UNION SELECT employee_id,department_id FROM Employee WHERE employee_id IN (SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id)=1)
SELECT employee_id,department_id FROM employee WHERE primary_flag = "Y" UNION SELECT employee_id, department_id FROM employee GROUP BY employee_id having count(*) = 1 ORDER BY employee_id
Select employee_id, department_id From (Select *, count(department_id) over (partition by employee_id) as num From Employee Order by employee_id) a Where num = 1 OR primary_flag = 'Y'
Select employee_id, department_id from Employee where primary_flag = 'Y' UNION ALL Select employee_id, department_id from Employee where primary_flag = 'N' AND employee_id not in (Select employee_id from Employee where primary_flag = 'Y')
Select employee_id, department_id from Employee where primary_flag = 'Y' union Select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1
Select employee_id, department_id from Employee where primary_flag= 'Y' union Select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1
Select employee_id, department_id from employee where primary_flag = 'Y' UNION Select employee_id, department_id from employee Group by employee_id Having count(employee_id)=1
Select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in (Select employee_id from employee Group by employee_id having count(department_id) = 1)
Select employee_id,department_id from Employee where primary_flag = 'Y' or employee_id in ( Select employee_id from Employee group by employee_id having count(department_id) = 1 )
Select employee_id,department_id from Employee where primary_flag='Y' UNION Select employee_id,department_id from Employee group by employee_id having count(employee_id)=1
WITH CTE AS ( SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION ALL SELECT employee_id, department_id FROM Employee GROUP BY employee_id HAVING COUNT(*) = 1 ) SELECT DISTINCT employee_id, department_id FROM CTE
WITH CTE AS (SELECT employee_id, department_id FROM employee GROUP BY 1 HAVING COUNT(department_id) = 1 UNION ALL SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' ) SELECT DISTINCT employee_id, department_id from CTE
WITH ETC AS( SELECT *, COUNT(department_id) OVER(PARTITION BY employee_id) cnt FROM Employee ) SELECT employee_id, department_id FROM ETC WHERE cnt = 1 OR primary_flag = 'Y'
WITH EmployeeWithOneDepartment AS ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING COUNT(department_id) = 1 ), firstTable AS ( SELECT E.employee_id, E.department_id FROM Employee E INNER JOIN EmployeeWithOneDepartment E1 ON E.employee_id = E1.employee_id ), secondTable AS ( SELECT E.employee_id, E.department_id FROM Employee E WHERE E.primary_flag = 'Y' ) SELECT * FROM firstTable UNION SELECT * FROM secondTable
WITH Temp1 as (SELECT employee_id, department_id FROM employee WHERE primary_flag="Y" ), Temp2 as (SELECT employee_id, department_id, count(department_id) as c FROM employee group by 1 having c = 1) SELECT employee_id, department_id FROM Temp2 UNION select employee_id, department_id from Temp1
WITH cte AS ( SELECT employee_id, (CASE WHEN count(department_id) over (partition by employee_id) = 1 THEN department_id WHEN count(department_id) over (partition by employee_id) > 1 AND primary_flag = 'Y' THEN department_id ELSE 0 END) as department_id FROM employee ) SELECT employee_id, max(department_id) as department_id FROM cte GROUP BY 1
WITH dep_count as ( SELECT employee_id, COUNT(DISTINCT department_id) FROM Employee GROUP BY 1 HAVING COUNT(DISTINCT department_id) = 1 ) ,multiple_department AS ( SELECT employee_id, department_id FROM Employee WHERE primary_flag ='Y' ), single_department AS ( SELECT employee_id, department_id FROM Employee WHERE employee_id in (SELECT employee_id FROM dep_count) ) SELECT employee_id, department_id from multiple_department UNION SELECT employee_id, department_id from single_department
WITH deps AS ( SELECT employee_id, COUNT(DISTINCT department_id) AS deps_num FROM Employee e GROUP BY employee_id ) SELECT e.employee_id, SUM(IF(deps_num = 1, department_id, IF(primary_flag='Y', department_id, 0))) AS department_id FROM Employee e LEFT JOIN deps d ON e.employee_id = d.employee_id GROUP BY e.employee_id
WITH lookup AS ( SELECT employee_id, department_id, COUNT(department_id) AS flag FROM Employee GROUP BY employee_id ) SELECT Employee.employee_id, Employee.department_id FROM Employee LEFT JOIN lookup ON Employee.employee_id = lookup.employee_id WHERE primary_flag = 'Y' OR flag = 1
WITH main AS ( SELECT *, COUNT(*) OVER(PARTITION BY employee_id) AS dep_count FROM Employee ) SELECT employee_id, department_id FROM main WHERE primary_flag = 'Y' OR dep_count = 1
WITH new_employee AS ( SELECT employee_id, department_id, RANK() OVER(PARTITION BY employee_id ORDER BY primary_flag) AS row_rk FROM Employee ) SELECT employee_id, department_id FROM new_employee WHERE row_rk=1
WITH primaries as ( SELECT * FROM Employee WHERE primary_flag = 'Y' ) SELECT Employee.employee_id, CASE WHEN primaries.department_id IS NULL THEN Employee.department_id ELSE primaries.department_id END AS "department_id" FROM Employee LEFT JOIN primaries ON Employee.employee_id = primaries.employee_id GROUP BY Employee.employee_id ORDER BY Employee.employee_id ASC
WITH single AS ( SELECT employee_id, count(employee_id) AS count FROM Employee GROUP BY employee_id HAVING count = 1), multi AS ( SELECT employee_id, count(employee_id) AS count FROM Employee GROUP BY employee_id HAVING count > 1) SELECT E.employee_id, E.department_id FROM single INNER JOIN Employee E ON single.employee_id = E.employee_id UNION SELECT E.employee_id, E.department_id FROM multi INNER JOIN Employee E ON multi.employee_id = E.employee_id WHERE E.primary_flag = 'Y'
WITH single AS(SELECT employee_id as employee_id, department_id as department_id FROM Employee GROUP BY employee_id HAVING count(employee_id)=1), multi AS( SELECT employee_id as employee_id, department_id as department_id FROM Employee WHERE primary_flag = 'Y' ) SELECT employee_id, department_id FROM single UNION SELECT employee_id, department_id FROM multi
WITH single_dept AS ( SELECT employee_id, department_id FROM employee GROUP BY employee_id HAVING COUNT(*) = 1 ) SELECT employee_id, department_id FROM Employee WHERE primary_flag = 'Y' UNION SELECT * FROM single_dept
WITH t1 AS ( SELECT *, ( SELECT IF( COUNT(DISTINCT department_id) = 1 ,1,0) FROM Employee e2 WHERE e2.employee_id = e1.employee_id ) AS only_in_one_department FROM Employee e1 ), t2 AS ( SELECT employee_id, department_id FROM t1 WHERE primary_flag = 'Y' OR only_in_one_department ) SELECT * FROM t2
WITH temp AS ( SELECT *, COUNT(*) OVER(PARTITION BY employee_id ORDER BY employee_id) cnt FROM Employee ) SELECT employee_id, SUM(CASE WHEN cnt=1 OR primary_flag ='Y' THEN department_id ELSE 0 END) department_id FROM temp GROUP BY employee_id
WITH temp AS ( SELECT employee_id, department_id, ROW_NUMBER() OVER (PARTITION BY employee_id ORDER BY primary_flag ASC) AS rk FROM Employee ) SELECT employee_id, department_id FROM temp WHERE rk = 1
WITH temp AS ( SELECT employee_id, department_id, primary_flag, DENSE_RANK() OVER (PARTITION BY employee_id ORDER BY primary_flag) AS my_rank FROM Employee ) SELECT employee_id, department_id FROM temp WHERE my_rank = 1
select * from ( select distinct ct.employee_id,case when ct.ct_dept = 1 then department_id when ct.ct_dept > 1 and primary_flag = 'Y' then department_id else NULL end as department_id from Employee left join (select employee_id,count(department_id) as ct_dept from Employee group by employee_id) as ct on Employee.employee_id = ct.employee_id ) as a where department_id is not null
select DISTINCT E1.employee_id , COALESCE(E2.department_id,E1.department_id) AS department_id from Employee E1 LEFT JOIN Employee E2 ON E1.employee_id=E2.employee_id AND E1.primary_flag='N' AND E2.primary_flag='Y'
select E1.employee_id , COALESCE(E2.department_id,E1.department_id) AS department_id from Employee E1 LEFT JOIN Employee E2 ON E1.employee_id=E2.employee_id and E1.primary_flag='N' and E2.primary_flag='Y' group by e1.employee_id
select T.employee_id, T.department_id from ( select *, count(employee_id) over (partition by employee_id) c from Employee ) T where T.c=1 OR T.primary_flag='Y'
select a.employee_id, MAX(CASE WHEN cnt = 1 THEN a.department_id WHEN cnt > 1 and a.primary_flag = 'Y' THEN a.department_id END) 'department_id' from employee a inner join (select employee_id, count(*) 'cnt' from employee group by 1) b on a.employee_id = b.employee_id group by 1
select a.employee_id, a.department_id from (select e1.employee_id, e1.department_id, case when e2.primary_flag is null then 'null' else e2.primary_flag end as primary_flag_v1 from Employee e1 left join Employee e2 on e1.employee_id = e2.employee_id and e1.department_id != e2.department_id and e1.primary_flag !='Y') a where a.primary_flag_v1 = 'null'
select a.employee_id, a.department_id from (select e1.employee_id, e1.department_id, e2.primary_flag from Employee e1 left join Employee e2 on e1.employee_id = e2.employee_id and e1.department_id != e2.department_id and e1.primary_flag !='Y') a where a.primary_flag is null
select a.employee_id, a.department_id from employee a inner join (select employee_id, count(distinct primary_flag) as cn from employee group by employee_id) as b on a.employee_id = b.employee_id where (b.cn = 1) or (b.cn > 1 and primary_flag = 'Y')
select b.employee_id,b.department_id from (select a.*, row_number() over (partition by employee_id order by primary_flag asc) as row_num from Employee as a) as b where row_num=1
select b.employee_id,b.department_id from Employee b where b.primary_flag='Y' or( b.primary_flag='N' and b.employee_id in (select a.employee_id from Employee a group by a.employee_id having count(*)=1) ) group by b.employee_id
select distinct E1.employee_id, coalesce(E2.department_id, E1.department_id ) as department_id from Employee E1 LEFT JOIN Employee E2 ON E1.employee_id=E2.employee_id AND E1.primary_flag='N' AND E2.primary_flag='Y'
select distinct a.employee_id, a.department_id from ( select employee_id, department_id from Employee where employee_id in (select employee_id from Employee group by employee_id having count(*) = 1) union all select employee_id, department_id from Employee where primary_flag = 'Y' ) a
select distinct e.employee_id, COALESCE(E1.department_id,E.department_id) AS department_id from Employee e left join Employee e1 on e.employee_id = e1.employee_id and e.primary_flag = 'N' and e1.primary_flag = 'Y'
select distinct e1.employee_id, coalesce(e2.department_id, e1.department_id) as department_id from Employee e1 left join Employee e2 on e1.employee_id = e2.employee_id and e1.primary_flag = 'N' and e2.primary_flag = 'Y'
select distinct employee_id, department_id from ( select employee_id, department_id, primary_flag, count(*) over (partition by employee_id) as total_count from Employee ) a where a.primary_flag='Y' or total_count=1
select distinct employee_id, department_id from (select employee_id, department_id from Employee group by employee_id having count(*) = 1 UNION ALL select employee_id, department_id from Employee where primary_flag = 'Y') b
select distinct employee_id, department_id from employee where primary_flag='Y' union all select distinct employee_id, department_id from employee where primary_flag='N' and employee_id not in (select distinct employee_id from employee where primary_flag='Y')
select distinct employee_id,department_id from Employee where primary_flag='Y' union select distinct employee_id, department_id from Employee where employee_id not in ( select distinct employee_id from (select distinct employee_id,department_id from Employee where primary_flag='Y')a )
select e.employee_id, case when f.c>1 and e.primary_flag='Y' then e.department_id when f.c=1 then e.department_id end as department_id from employee e left join (select employee_id, department_id, count(primary_flag) as c from employee group by employee_id) f on e.employee_id = f.employee_id having department_id is not null
select e.employee_id, e.department_id from employee e where primary_flag = 'Y' OR (select count(*) from employee where employee_id = e.employee_id) = 1
select e1.employee_id, e1.department_id from Employee e1 left join (select employee_id, department_id, primary_flag, count(employee_id) as cnt from Employee group by employee_id) as e2 on e1.employee_id = e2.employee_id where e1.primary_flag = 'Y' or e2.cnt = 1
select employee_id , department_id from Employee group by employee_id having count(*)=1 union select employee_id , department_id from Employee where primary_flag ='Y'
select employee_id , department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count(employee_id) = 1)
select employee_id , department_id from employee where employee_id in ( select employee_id from employee group by 1 having count(distinct department_id) = 1 ) union select employee_id , department_id from employee where primary_flag = 'Y'
select employee_id , department_id from employee where primary_flag = 'Y' union select employee_id , department_id from employee group by employee_id having count(department_id)=1
select employee_id , department_id from employee where primary_flag='Y' union select employee_id , department_id from employee group by employee_id having count(*) =1
select employee_id , max(department_id ) as department_id from employee group by 1 having count(*) = 1 union select employee_id , max(case when primary_flag = 'Y' then department_id end ) as department_id from employee group by 1 having count(*) > 1
select employee_id , max(department_id) as department_id from Employee group by employee_id having count(1) = 1 union select employee_id , department_id from Employee where primary_flag = 'Y'
select employee_id ,department_id from Employee where primary_flag = "Y" union select employee_id ,department_id from Employee group by employee_id having count(department_id) = 1
select employee_id ,department_id from Employee where primary_flag = 'Y' union select a.employee_id ,a.department_id from employee a inner join (select employee_id from employee group by employee_id having sum(1) = 1) b on a.employee_id = b.employee_id
select employee_id ,department_id from Employee where primary_flag='Y' union Select employee_id , department_id from Employee group by employee_id having count(*)=1
select employee_id, case when (count(department_id)> 1 ) then sum( IF( primary_flag = "Y",department_id , NULL)) when (count(department_id))= 1 then department_id end department_id from employee group by employee_id
select employee_id, case when count(*) = 1 then department_id else sum(if(primary_flag="Y",department_id,0)) end as department_id from Employee group by employee_id
select employee_id, department_id from ( select *, count(*) over(partition by employee_id) as num_department from employee ) as e1 where (num_department>1 and primary_flag='Y') or (num_department=1)
select employee_id, department_id from ( select employee_id, count(department_id) ct from employee group by employee_id ) r1 natural join employee where primary_flag='Y' or (ct=1 and primary_flag='N')
select employee_id, department_id from ( select employee_id, department_id, max(primary_flag) over (partition by employee_id ) as last_flag, primary_flag from Employee order by 1 ) temp where (primary_flag = 'Y') or (last_flag = 'N') order by 1
select employee_id, department_id from ( select employee_id, department_id, primary_flag, rank() over (partition by employee_id order by primary_flag) as is_primary from employee ) as a where a.is_primary = 1
select employee_id, department_id from ( select employee_id, department_id, primary_flag, sum(1) over(partition by employee_id) as dept_cnt from employee ) x where primary_flag = 'Y' or dept_cnt = 1 order by 1
select employee_id, department_id from ( select employee_id, department_id, rank() over(partition by employee_id order by primary_flag ASC) '_rank' from Employee ) tbl where tbl._rank = 1
select employee_id, department_id from ( select employee_id, department_id, row_number() over (partition by employee_id order by case when primary_flag = 'Y' then 1 else 2 end asc) as rn from Employee ) t where rn = 1
select employee_id, department_id from ( select employee_id,department_id,primary_flag,count(employee_id) over (partition by employee_id) as c from employee ) A where c = 1 or primary_flag ='Y'
select employee_id, department_id from (select * , count(department_id) over(partition by employee_id) as num_dep from Employee) as a where primary_flag = 'Y' or num_dep = 1
select employee_id, department_id from (select *, count(1) over (partition by employee_id order by primary_flag) as cnt from Employee) tab where cnt = 1 or (cnt > 1 and primary_flag = 'Y')
select employee_id, department_id from (select *, count(employee_id) over(partition by employee_id) c from Employee) t where c = 1 or primary_flag = 'Y'
select employee_id, department_id from (select *, count(employee_id)over(partition by employee_id) as cnt from employee) t where cnt=1 or primary_flag='Y'
select employee_id, department_id from (select employee_id, department_id, primary_flag, count(1) over(partition by employee_id) as cnt from Employee) t where cnt = 1 or (cnt>1 and primary_flag = 'Y')
select employee_id, department_id from (select employee_id, department_id, primary_flag, count(department_id) over(partition by employee_id) as cn from Employee) temp where (case when cn=1 then primary_flag='Y' or primary_flag='N' when cn>1 then primary_flag='Y' end)
select employee_id, department_id from (select employee_id, department_id, primary_flag, count(department_id) over(partition by employee_id) cn from Employee) temp where (cn = 1 and (primary_flag = "N" or primary_flag = "Y")) or (cn > 1 and primary_flag = "Y")
select employee_id, department_id from (select employee_id, department_id, rank() over(partition by employee_id order by primary_flag asc) as rank_ from Employee) tmp1 where rank_=1 order by employee_id
select employee_id, department_id from (select employee_id, department_id, rank()over(partition by employee_id order by primary_flag ) as flag_rank from employee)t where flag_rank = 1
select employee_id, department_id from Employee Where primary_flag = 'Y' OR employee_id in (Select employee_id from Employee Group by employee_id HAVING COUNT(employee_id) = 1)
select employee_id, department_id from Employee as e1 where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count(department_id) = 1)
select employee_id, department_id from Employee e where primary_flag = 'Y' or (primary_flag = 'N' and employee_id in (select distinct employee_id from Employee group by employee_id having count(department_id) =1))
select employee_id, department_id from Employee group by 1 having count(distinct department_id) = 1 union select employee_id, department_id from Employee where primary_flag ='Y'
select employee_id, department_id from Employee group by employee_id having count(*) = 1 UNION select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee group by employee_id having count(*) = 1 union select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee group by employee_id having count(distinct department_id) = 1 union select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1 union select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee join (select employee_id, count(*) as cnt from Employee group by employee_id) t using(employee_id) where cnt = 1 or primary_flag = 'Y'
select employee_id, department_id from Employee where employee_id in ( select employee_id from Employee group by employee_id having count(department_id) < 2 ) union select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee where employee_id in (select employee_id from Employee group by employee_id having count(*)=1 ) union select employee_id, department_id from Employee where primary_flag = 'Y'
select employee_id, department_id from Employee where employee_id in (select employee_id from Employee group by employee_id having count(employee_id)>1) and primary_flag='Y' union all select employee_id, department_id from Employee where employee_id in (select employee_id from Employee group by employee_id having count(employee_id) = 1)
select employee_id, department_id from Employee where employee_id not in (select employee_id from Employee where primary_flag = 'Y') union (select employee_id, department_id from Employee where primary_flag = 'Y')
select employee_id, department_id from Employee where primary_flag = "Y" or employee_id in (select employee_id from Employee group by employee_id having count(department_id) = 1 order by employee_id)
select employee_id, department_id from Employee where primary_flag = "Y" union select employee_id, department_id from Employee group by employee_id having count(employee_id)=1
select employee_id, department_id from Employee where primary_flag = 'Y' OR employee_id in (select employee_id from Employee group by 1 having count(primary_flag)=1)
select employee_id, department_id from Employee where primary_flag = 'Y' OR employee_id in (select employee_id from Employee group by employee_id having count(*) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' UNION select employee_id, department_id from Employee group by employee_id having count(primary_flag) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' group by employee_id union select employee_id, department_id from Employee group by employee_id having count(department_id) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' group by employee_id union select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in ( SELECT employee_id FROM Employee GROUP BY employee_id HAVING count(department_id) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in ( select employee_id from Employee group by employee_id having count(employee_id)=1 )
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by 1 having count(primary_flag)=1)
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count( distinct primary_flag)=1 )
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count(*) = 1) order by employee_id
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count(distinct department_id) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from Employee group by employee_id having count(employee_id) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by employee_id having count(*) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' union all select employee_id, department_id from Employee where primary_flag = 'N' and employee_id in ( select employee_id from Employee group by 1 having count(*) = 1 )
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id, department_id from Employee group by employee_id having (count(department_id)=1)
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id, department_id from Employee group by employee_id having count(department_id) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id, department_id from Employee where employee_id in (select employee_id from Employee group by employee_id having count(*) = 1)
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(employee_id) = 1
select employee_id, department_id from Employee where primary_flag = 'Y' union select employee_id,department_id from employee group by employee_id having count(employee_id ) = 1
select employee_id, department_id from Employee where primary_flag="Y" or employee_id in (select employee_id from Employee group by employee_id having count(*)=1)
select employee_id, department_id from Employee where primary_flag="Y" or employee_id in (select employee_id from Employee group by employee_id having count(department_id)=1)
select employee_id, department_id from Employee where primary_flag="Y" union select employee_id, department_id from Employee where primary_flag="N" and employee_id not in (select employee_id from Employee where primary_flag="Y")
select employee_id, department_id from Employee where primary_flag='Y' Union select employee_id, department_id from Employee group by 1 having count(department_id)=1
select employee_id, department_id from Employee where primary_flag='Y' group by employee_id union select employee_id, department_id from Employee group by employee_id having count(employee_id)=1
select employee_id, department_id from Employee where primary_flag='Y' or employee_id in (select employee_id from Employee group by employee_id having count(Department_id)=1)
select employee_id, department_id from Employee where primary_flag='Y' union select employee_id, department_id from Employee group by employee_id having count(*) = 1
select employee_id, department_id from Employee where primary_flag='Y' union select employee_id, department_id from Employee group by employee_id having count(employee_id)=1
select employee_id, department_id from Employee where primary_flag='Y' union select employee_id, department_id from Employee group by employee_id having sum(primary_flag='Y') = 0
select employee_id, department_id from Employee where primary_flag='Y' union select employee_id, department_id from Employee where employee_id not in (select employee_id from Employee where primary_flag='Y')
select employee_id, department_id from employee group by employee_id having count(department_id) = 1 union select employee_id, department_id from employee where primary_flag = 'Y'
select employee_id, department_id from employee group by employee_id having count(department_id)=1 union select employee_id, department_id from employee where primary_flag='Y'
select employee_id, department_id from employee group by employee_id having count(distinct department_id) = 1 union select employee_id, department_id from employee where primary_flag = 'Y'
select employee_id, department_id from employee group by employee_id having count(employee_id)=1 union select employee_id, department_id from employee where primary_Flag='Y'
select employee_id, department_id from employee where employee_id in ( select employee_id from employee group by 1 having count(department_id) = 1 ) union select employee_id, department_id from employee where primary_flag = 'Y'
select employee_id, department_id from employee where primary_flag = "Y" union select employee_id, department_id from employee group by employee_id having count(employee_id) = 1
select employee_id, department_id from employee where primary_flag = 'Y' and employee_id in ( select employee_id from Employee group by employee_id having count(*) > 1) union (select employee_id, department_id from Employee group by employee_id having count(*) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' or (primary_flag = 'N' and employee_id not in (select employee_id from employee where primary_flag = 'Y' ) )
select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in ( select employee_id from( select employee_id, count(department_id) as count from employee group by employee_id having count(department_id) = 1 ) d)
select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by 1 having count(department_id) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by employee_id having count(*) =1)
select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by employee_id having count(department_id) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by employee_id having count(employee_id) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(*) = 1
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(1) = 1
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(department_id) = 1
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(employee_id) = 1
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee group by employee_id having count(primary_flag) = 1
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee where employee_id in ( select employee_id from employee group by employee_id having count(*) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee where employee_id in ( select employee_id from employee group by employee_id having count(department_id) = 1)
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee where primary_flag = 'N' and employee_id not in (select employee_id from employee where primary_flag = 'Y' )
select employee_id, department_id from employee where primary_flag = 'Y' union select employee_id, department_id from employee where primary_flag = 'N' and employee_id not in (select employee_id from employee where primary_flag = 'Y') group by 1 having count(*) = 1
select employee_id, department_id from employee where primary_flag ="Y" union select employee_id, department_id from employee group by employee_id having count(department_id)=1
select employee_id, department_id from employee where primary_flag ='Y' or employee_id in (select employee_id from employee group by employee_id having count(employee_id)=1)
select employee_id, department_id from employee where primary_flag ='Y' union select employee_id, department_id from employee e where primary_flag ='N' and not exists (select 1 from employee e1 where e.employee_id = e1.employee_id and e1.primary_flag ='Y' )
select employee_id, department_id from employee where primary_flag="Y" union select employee_id, department_id from employee group by employee_id having count(department_id)=1
select employee_id, department_id from employee where primary_flag='Y' or employee_id in ( select employee_id from employee group by employee_id having count(department_id)=1 )
select employee_id, department_id from employee where primary_flag='Y' or employee_id in( select employee_id from employee group by employee_id having count(department_id)=1)
select employee_id, department_id from employee where primary_flag='Y' union select employee_id, department_id from employee group by employee_id having count(employee_id)=1
select employee_id, department_id from employee where primary_flag='Y' union select employee_id, department_id from employee where employee_id in (select employee_id from employee group by employee_id having count(department_id)=1)
select employee_id, department_id from( select employee_id, department_id, primary_flag, count(department_id) over (partition by employee_id) as c from Employee) as TMP where primary_flag = 'Y' or c = 1
select employee_id,department_id from Employee group by employee_id having count(employee_id)=1 union select employee_id,department_id from Employee where primary_flag="Y" group by employee_id
select employee_id,department_id from Employee where primary_flag = 'Y' group by employee_id, primary_flag union select employee_id, department_id from Employee group by employee_id having count(department_id) = 1
select employee_id,department_id from Employee where primary_flag = 'Y' or (employee_id in (select employee_id from Employee group by employee_id having count(department_id)=1))
select employee_id,department_id from Employee where primary_flag = 'Y' or employee_id in ( select employee_id from Employee group by employee_id having count(department_id) = 1 )
select employee_id,department_id from Employee where primary_flag='Y' UNION ALL select employee_id,department_id from Employee where employee_id not in (select employee_id from Employee where primary_flag='Y')
select employee_id,department_id from Employee where primary_flag='Y' Union select employee_id, department_id from Employee group by employee_id having count(department_id)=1
select employee_id,department_id from Employee where primary_flag='Y' or employee_id in (select employee_id from Employee group by 1 having count(*)=1)
select employee_id,department_id from Employee where primary_flag='Y' or employee_id in (select employee_id from Employee group by employee_id having count(employee_id)=1)
select employee_id,department_id from Employee where primary_flag='Y' union select employee_id,department_id from Employee group by 1 having count(*)=1
select employee_id,department_id from employee group by 1 having count(*)=1 union select employee_id,department_id from employee where primary_flag='Y'
select employee_id,department_id from employee where primary_flag = 'Y' OR employee_id in (select employee_id from employee group by employee_id having count(*)=1)
select employee_id,department_id from employee where primary_flag = 'Y' or employee_id in (select employee_id from employee group by employee_id having count(department_id) = 1)
select employee_id,department_id from employee where primary_flag='Y' or employee_id in (select employee_id from employee group by employee_id having count(department_id)=1)
select employee_id,department_id from employee where primary_flag='Y' union select employee_id,department_id from employee group by employee_id having count(department_id)=1
select employee_id,department_id from employee where primary_flag='Y' union select employee_id,department_id from employee where employee_id not in (select employee_id from employee where primary_flag='Y') group by employee_id,department_id having count(*)=1
select t1.employee_id, case when t1.department_id is null then t2.department_id else t1.department_id end department_id from (select e.employee_id, case when count(*) = 1 then e.department_id else null end department_id from employee e group by employee_id) t1 left join (select e.employee_id, department_id from employee e where e.primary_flag = 'Y') t2 on t1.employee_id = t2.employee_id
select t2.employee_id, t2.department_id from ( select t1.*, (select count(distinct t3.department_id) from employee t3 where t1.employee_id = t3.employee_id) as num_dept from employee t1 ) t2 where num_dept = 1 or (num_dept > 1 and primary_flag = 'Y')
with E1 as ( select employee_id, department_id from Employee where primary_flag='Y' ), E2 as ( select employee_id, department_id from Employee where employee_id not in (select employee_id from E1) ) select employee_id, department_id from E1 union all select employee_id, department_id from E2
with a as (select employee_id, department_id, primary_flag from Employee group by employee_id having count(department_id) =1), b as (select employee_id, department_id, primary_flag, count(department_id) from Employee where primary_flag ='Y' group by employee_id) select a.employee_id, a.department_id from a union select b.employee_id, b.department_id from b
with base as (select employee_id, count(distinct department_id) as nd from employee group by 1) select e.employee_id, e.department_id from employee e left join base b on e.employee_id = b.employee_id where b.nd = 1 union select employee_id, department_id from employee where primary_flag = 'Y'
with cnt as( select distinct employee_id, department_id, count(employee_id) as cnt from employee group by employee_id) select distinct employee_id, department_id from cnt where cnt = 1 union select distinct employee_id, department_id from employee where primary_flag = 'Y'
with cte as ( select *, row_number() over (partition by employee_id order by primary_flag asc) as rownum from Employee ) select employee_id, department_id from cte where rownum = 1
with cte as ( select e.employee_id, count(*) as 'employcount' from Employee e group by 1 ) select e.employee_id, e.department_id from Employee e left join cte on e.employee_id = cte.employee_id where cte.employcount = 1 or (cte.employcount > 1 and e.primary_flag = 'Y')
with cte as ( select employee_id from employee group by 1 having(count(distinct department_id))=1 ) select employee_id,department_id from employee where primary_flag='Y' union select e.employee_id,e.department_id from cte join employee e on cte.employee_id=e.employee_id
with cte as ( select employee_id, count(*) ct, max(primary_flag) pf from Employee group by employee_id) , cte1 as ( select * from employee where primary_flag='Y') select distinct c.employee_id, case when ct>1 and pf='Y' then c1.department_id else e.department_id end department_id from cte c inner join employee e on c.employee_id=e.employee_id left join cte1 c1 on c1.employee_id=c.employee_id
with cte as ( select employee_id, department_id from Employee group by employee_id having count(employee_id) = 1) select distinct employee_id, department_id from Employee where primary_flag = 'Y' UNION select * from cte
with cte as ( select employee_id, department_id, count(distinct department_id) as count from employee group by employee_id ) select employee_id, department_id from( select e.employee_id, e.department_id, primary_flag, count from employee e join cte c on e.employee_id = c.employee_id ) sub where (count > 1 and primary_flag = "Y") or (count = 1)
with cte as (select *, count(department_id) over(partition by employee_id) as ct from Employee) select distinct employee_id, if(ct=1,department_id,if(primary_flag='Y',department_id,null)) as department_id from cte where (ct = 1) or (ct>1 and primary_flag='Y')
with cte as (select *, row_number() over (partition by employee_id order by primary_flag) as r from employee) select employee_id, department_id from cte where r = 1
with cte as (select employee_id, department_id from employee group by employee_id having count(department_id)=1) select employee_id, department_id from cte union all select employee_id, department_id from employee where employee_id not in (select employee_id from cte) and primary_flag = 'Y'
with cte as (select employee_id, department_id, primary_flag, count(employee_id) over (partition by employee_id) as counter from Employee) select employee_id, department_id from cte where counter = 1 union select employee_id, department_id from cte where counter > 1 and primary_flag = 'Y'
with cte as( select *, rank() over(partition by employee_id order by primary_flag asc) 'rnk' from employee) select employee_id, department_id from cte where rnk = 1
with cte as( select employee_id, department_id from employee where primary_flag = 'Y') select employee_id, department_id from employee where employee_id not in (select employee_id from cte) union select * from cte
with cte as( select employee_id, department_id, rank() over (partition by employee_id order by primary_flag asc) as rnk from employee ) select employee_id, department_id from cte where rnk = 1 group by employee_id
with cte_final as ( select employee_id, case when count(*) = 1 then any_value(department_id) else sum( if(primary_flag = 'Y', department_id, 0)) end as department_id from Employee group by 1 ) select * from cte_final
with dept as( select employee_id from employee group by employee_id having count(*)=1 ) select dept.employee_id, e1.department_id from employee e1 join dept on e1.employee_id=dept.employee_id union select employee_id, department_id from employee where primary_flag='Y'
with emp as ( select employee_id, department_id, primary_flag, count(*) over(partition by employee_id) cnt from employee ) select employee_id, department_id from emp where (primary_flag='Y' and cnt>1) or cnt=1
with mult as ( select employee_id from employee group by employee_id having count(*) > 1 ) select employee_id, department_id from employee group by employee_id having count(*) = 1 union all select e.employee_id, e.department_id from mult as m inner join employee as e on m.employee_id = e.employee_id where primary_flag = 'Y'
with new as (select employee_id, department_id from employee where primary_flag ='Y') select distinct e.employee_id, ifnull(n.department_id,e.department_id) as department_id from employee e left join new n on e.employee_id=n.employee_id
with no_primary as ( select employee_id, department_id, primary_flag from employee group by employee_id having count(employee_id) = 1 and primary_flag = 'N'), yes_primary as ( select distinct employee_id, department_id from Employee where primary_flag = 'Y') select employee_id, department_id from yes_primary union all select employee_id, department_id from no_primary
with t as ( select employee_id , sum(case when primary_flag = 'Y' then department_id else 0 end ) department_id from employee group by employee_id having count(*) > 1 ) select employee_id, department_id from employee group by employee_id having count(*) = 1 union select * from t
with t as ( select employee_id,department_id,primary_flag, count(department_id) over(partition by employee_id) as num_dep from employee ) select employee_id,department_id from t where primary_flag = 'Y' or num_dep = 1
with t as (select employee_id, department_id from Employee where primary_flag="Y" group by 1,2), t2 as (select employee_id, department_id, count(department_id) c from Employee group by 1 having c=1) select employee_id, department_id from t2 union select employee_id, department_id from t
with t as( select employee_id, department_id from Employee group by employee_id having count(department_id)=1 ), tt as ( select employee_id, department_id from Employee where primary_flag='Y' ) select * from t union select * from tt
with t as(select employee_id,department_id,row_number()over(partition by employee_id order by primary_flag)rk from Employee) select employee_id, department_id from t where rk = 1
with t1 as (select employee_id, department_id from employee where primary_flag = 'Y' ) select employee_id, department_id from employee where primary_flag = 'N' and employee_id not in (select employee_id from t1) union all select * from t1 order by employee_id
with temp as ( select employee_id, count(department_id) from Employee group by employee_id having count(department_id) =1 ) select employee_id, department_id from Employee where primary_flag = 'Y' or employee_id in (select employee_id from temp)
with temp as ( select employee_id, count(employee_id) as dep from Employee group by employee_id ) select A.employee_id, A.department_id from Employee A left join temp B on A.employee_id = B.employee_id where A.primary_flag = "Y" or B.dep = 1.00
with temp as ( select employee_id, department_id from Employee where primary_flag = 'Y' ) select * from temp union select employee_id, department_id from Employee where employee_id not in (select employee_id from temp)
with temp as( select *, count(department_id) as cnt from employee group by employee_id), temp1 as(select employee_id, department_id from temp where cnt=1), temp2 as(select employee_id, department_id from Employee where primary_flag="Y") select * from temp1 union select * from temp2
with temp1 as ( select employee_id, department_id, count(employee_id) cnt from Employee group by 1 ), temp2 as ( select * from employee where employee_id not in (select employee_id from temp1 where cnt=1 ) and primary_flag ="Y" ) (select employee_id, department_id from temp1 where cnt =1) union (select employee_id, department_id from temp2)
with tmp as (select employee_id, department_id from employee group by employee_id having count(department_id) = 1) select * from tmp union select employee_id, department_id from employee where primary_flag = 'Y'
with y as ( select employee_id, department_id from employee where primary_flag = 'Y' ), n as ( select employee_id, department_id from employee where employee_id not in (select employee_id from y) ) select distinct employee_id, department_id from y union select distinct employee_id, department_id from n
