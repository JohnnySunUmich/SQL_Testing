SELECT DAY, CAST((CNCLD_CNT/TOTAL_CNT) AS DECIMAL(3,2)) "CANCELLATION RATE" FROM ( SELECT REQUEST_AT AS DAY, COUNT(1) AS TOTAL_CNT, SUM( CASE WHEN STATUS != 'completed' THEN 1 ELSE 0 END ) AS CNCLD_CNT FROM TRIPS WHERE CLIENT_ID IN ( SELECT USERS_ID FROM USERS WHERE ROLE IN ('client') AND BANNED = 'No' ) AND DRIVER_ID IN ( SELECT USERS_ID FROM USERS WHERE ROLE IN ('driver') AND BANNED = 'No' ) AND REQUEST_AT BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY REQUEST_AT ) A
SELECT DISTINCT Request_at Day, ROUND(COUNT(CASE WHEN LOWER(Status) LIKE '%cancel%' THEN 1 ELSE NULL END) / COUNT(Status),2) `Cancellation Rate` FROM trips LEFT JOIN users ON Client_Id=Users_Id AND Role='client' LEFT JOIN users u2 ON Driver_Id=u2.Users_Id AND u2.Role='driver' WHERE users.Banned='No' AND u2.Banned='No' AND request_at between "2013-10-01" and "2013-10-03" GROUP BY Request_at
SELECT Day, ROUND(COUNT(CASE WHEN status LIKE 'cancelled%' THEN 1 END) / COUNT(*), 2) AS 'Cancellation Rate' FROM ( SELECT t.id, t.request_at AS Day, t.status FROM Users c INNER JOIN Trips t INNER JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03') AS dataset GROUP BY DAY ORDER BY DAY
SELECT Day, ROUND(count_of_cancel / count_of_total, 2) AS 'Cancellation Rate' FROM (SELECT t.Request_at AS Day, COUNT(CASE WHEN t.Status = 'cancelled_by_driver' OR t.Status = 'cancelled_by_client' THEN 1 END) AS count_of_cancel, COUNT(CASE WHEN t.Status = 'cancelled_by_driver' OR t.Status = 'cancelled_by_client' OR t.Status = 'completed' THEN 1 END) AS count_of_total FROM Trips t, Users uc, Users ud WHERE t.Client_Id = uc.Users_Id AND t.Driver_Id = ud.Users_Id AND uc.Banned = 'No' AND ud.Banned = 'No' AND uc.Role = 'client' AND ud.Role = 'driver' GROUP BY 1) sub WHERE Day IN ("2013-10-01", "2013-10-02", "2013-10-03")
SELECT FT.R AS Day, ROUND(SUM(FT.CS)/COUNT(FT.R),2) AS 'Cancellation Rate' FROM ( SELECT T.Request_at AS R, CASE WHEN T.Status LIKE 'cancelled%' THEN 1 ELSE 0 END AS CS FROM Trips AS T JOIN Users AS U ON T.Client_Id= U.Users_Id JOIN Users AS U2 ON T.Client_Id = U2.Users_Id WHERE U.Banned != 'Yes' OR U2.Banned !='Yes') AS FT WHERE FT.R BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY FT.R
SELECT REQUEST_AT AS DAY, ROUND(COUNT(CASE WHEN STATUS <> 'completed' THEN 1 END)/COUNT(*),2) AS 'CANCELLATION RATE' FROM TRIPS INNER JOIN (SELECT USERS_ID, BANNED FROM USERS WHERE BANNED = 'NO' AND ROLE = 'CLIENT') AS C ON TRIPS.CLIENT_ID = C.USERS_ID INNER JOIN (SELECT USERS_ID, BANNED FROM USERS WHERE BANNED = 'NO' AND ROLE = 'DRIVER') AS D ON TRIPS.DRIVER_ID = D.USERS_ID GROUP BY DAY HAVING DAY BETWEEN '2013-10-01' AND '2013-10-03'
SELECT REQUEST_AT AS DAY, ROUND(COUNT(CASE WHEN STATUS LIKE 'CANCELLED%' THEN 1 END) / COUNT(*), 2) AS 'CANCELLATION RATE' FROM TRIPS JOIN USERS C ON TRIPS.CLIENT_ID = C.USERS_ID JOIN USERS AS D ON TRIPS.DRIVER_ID = D.USERS_ID WHERE C.BANNED = 'No' AND D.BANNED = 'No' AND REQUEST_AT BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY REQUEST_AT
SELECT REQUEST_AT AS DAY, round(COUNT(IF(Status!='Completed',True,Null))/count(*),2) as 'cancellation rate' from Trips where client_id in (select users_id from users where Banned='No') and driver_id in (select users_id from users where Banned='No') and request_at between'2013-10-01' and '2013-10-03' group by request_at
SELECT Request_at 'Day', ROUND(COUNT(IF(Status != 'completed', TRUE, NULL)) / COUNT(*), 2) 'Cancellation Rate' FROM Trips WHERE Client_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') AND (Request_at BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY Request_at
SELECT Request_at AS "Day" , ROUND(SUM(CASE WHEN Status <> 'completed' THEN 1 ELSE 0 END) / COUNT(1), 2) AS "Cancellation Rate" FROM Trips t INNER JOIN Users u1 ON u1.Users_Id = t.Client_Id AND u1.Role = 'client' AND u1.Banned <> 'Yes' INNER JOIN Users u2 ON u2.Users_Id = t.Driver_Id AND u2.Role = 'driver' AND u2.Banned <> 'Yes' WHERE Request_at BETWEEN '2013-10-01' and '2013-10-03' GROUP BY Request_at
SELECT Request_at AS "Day", ROUND(SUM(IF(Status != "completed", 1, 0))/COUNT(*),2) AS "Cancellation Rate" FROM Trips WHERE Client_Id NOT IN (SELECT Users_ID FROM Users WHERE Banned = "Yes") AND Driver_Id NOT IN (SELECT Users_ID FROM Users WHERE Banned = "Yes") AND Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Request_at
SELECT Request_at AS DAY, ROUND(COUNT(IF (status <> 'completed', 1, NULL))/COUNT(*),2) AS 'Cancellation Rate' FROM TRIPS WHERE CLIENT_ID IN (SELECT USERS_ID FROM USERS WHERE UPPER(Banned) <>'YES') AND Driver_Id IN (SELECT USERS_ID FROM USERS WHERE UPPER(Banned) <>'YES') AND Request_at BETWEEN CAST("2013-10-01" AS DATE) and CAST("2013-10-03" AS DATE) GROUP BY 1
SELECT Request_at AS Day , ROUND(1-(SUM(IF(Status = 'completed',1,0))/COUNT(Id)),2) AS 'Cancellation Rate' FROM Trips t LEFT JOIN (SELECT Users_Id AS c_id FROM Users WHERE Role = 'client' AND Banned = 'No') c ON t.Client_Id = c.c_id LEFT JOIN (SELECT Users_Id AS d_id FROM Users WHERE Role = 'driver' AND Banned = 'No') d ON t.Driver_Id = d.d_id WHERE c_id IS NOT NULL AND d_id IS NOT NULL AND Request_at BETWEEN "2013-10-01" and "2013-10-03" GROUP BY Request_at
SELECT Request_at AS Day ,ROUND(SUM(Status != "completed") / COUNT(*), 2) AS 'Cancellation Rate' FROM Trips WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') AND Client_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') GROUP BY Request_at
SELECT Request_at AS Day, IFNULL(ROUND(SUM(CASE WHEN Status = 'completed' THEN 0 ELSE 1 END) / COUNT(*), 2), 0) AS 'Cancellation Rate' FROM Trips t JOIN Users u1 ON t.Client_Id = u1.Users_Id JOIN Users u2 ON t.Driver_Id = u2.Users_Id WHERE u1.Banned = 'No' AND u2.Banned = 'No' AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at ORDER BY Request_at
SELECT Request_at AS Day, ROUND(AVG(CASE WHEN Status != 'completed' THEN 1 ElSE 0 END), 2) AS 'Cancellation Rate' FROM Trips WHERE Client_Id IN (SELECT Users_ID FROM Users WHERE Banned = 'NO') AND Driver_Id IN (SELECT Users_ID FROM Users WHERE Banned = 'NO') AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at AS Day, ROUND(AVG(CASE WHEN Status != 'completed' THEN 1 ElSE 0 END), 2) AS 'Cancellation Rate' FROM Trips WHERE Client_Id NOT IN (SELECT Users_ID FROM Users WHERE Banned = "Yes") AND Driver_Id NOT IN (SELECT Users_ID FROM Users WHERE Banned = "Yes") AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at AS Day, ROUND(SUM(CASE WHEN Status != "completed" THEN 1 ELSE 0 END)/COUNT(DISTINCT Id),2) AS "Cancellation Rate" FROM Trips d1 INNER JOIN Users d2 ON d1.Client_Id = d2.Users_Id WHERE Banned != "Yes" AND Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Request_at ORDER BY Request_at
SELECT Request_at AS Day, ROUND(SUM(CASE WHEN Status != 'completed' THEN 1 ELSE 0 END) / COUNT(Id), 2) AS 'Cancellation Rate' FROM Trips WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" AND Client_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned = 'No') GROUP BY Request_at
SELECT Request_at AS Day, ROUND(SUM(CASE WHEN Status IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(DISTINCT id),2) AS "Cancellation Rate" FROM Trips as d1 JOIN Users as d2 ON d1.client_id = d2.Users_id AND d2.Role = 'client' JOIN Users as d3 ON d1.Driver_id = d3.Users_id AND d3.Role = 'driver' WHERE d2.Banned = 'No' AND d3.Banned = 'No' AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at AS Day, ROUND(SUM(CASE WHEN t.Status != 'completed' THEN 1 ELSE 0 END) / COUNT(*),2) "Cancellation Rate" FROM Trips AS t WHERE t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' AND t.Client_ID NOT IN (SELECT Users_ID FROM Users WHERE Banned='Yes') GROUP BY 1
SELECT Request_at AS Day, ROUND(SUM(CASE WHEN t1.Status!='completed' THEN 1 ELSE 0 END)/COUNT(*),2) AS 'Cancellation Rate' FROM Trips t1 LEFT JOIN Users u ON t1.Client_Id = u.Users_Id WHERE u.Banned = 'No' AND t1.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at AS Day, ROUND(SUM(IF(Status LIKE 'cancelled%', 1, 0)) / COUNT(1), 2) AS "Cancellation Rate" FROM Trips t INNER JOIN Users u ON t.Client_Id = u.Users_Id INNER JOIN Users d ON t.Driver_Id = d.Users_Id WHERE u.Banned = 'No' AND d.Banned = 'No' AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at AS Day, ROUND(SUM(Status != "completed")/COUNT(*), 2) AS "Cancellation Rate" FROM Trips WHERE (Request_at BETWEEN "2013-10-01" AND "2013-10-03") AND Client_Id IN (SELECT Users_Id FROM Users WHERE Banned = "NO" AND Role = 'client') AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned = "NO" AND Role = 'driver') GROUP BY Request_at
SELECT Request_at AS Day, ROUND(cancel,2) AS 'Cancellation Rate' FROM (SELECT t.Status, t.Request_at, u1.Banned as b1, u2.Banned as b2, AVG(CASE WHEN t.Status!='completed' THEN 1 ELSE 0 END) AS cancel FROM Trips t left join Users u1 ON u1.Users_Id= t.Client_Id left join Users u2 ON u2.Users_Id= t.Driver_Id WHERE u1.Banned = "No" and u2.Banned = "No" and t.Request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at) AS t1
SELECT Request_at AS Day,ROUND(COUNT(CASE WHEN t.Status != 'completed' THEN t.Id END )/COUNT(*),2) AS 'Cancellation Rate' FROM Trips t JOIN Users u1 ON t.Client_Id = u1.Users_Id JOIN Users u2 ON t.Driver_Id = u2.Users_Id WHERE (Request_at BETWEEN '2013-10-01' AND '2013-10-03' ) AND (u1.Banned = 'No' AND u2.Banned = 'No') GROUP BY Request_at ORDER BY Day
SELECT Request_at AS Day,ROUND(SUM(CASE WHEN t1.Status!='completed' THEN 1 ELSE 0 END)/COUNT(*),2) AS "Cancellation Rate" FROM Trips t1 LEFT JOIN Users u ON t1.Client_Id=u.Users_Id WHERE u.Banned="NO" AND (t1.Request_at BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY t1.Request_at
SELECT Request_at AS `Day`, ROUND(SUM(CASE WHEN LOWER(status) LIKE 'can%' THEN 1.00 ELSE 0 END) / COUNT(*), 2) AS `Cancellation Rate` FROM Trips t JOIN Users u ON t.Client_Id = u.Users_Id AND u.Banned = 'No' JOIN Users d ON t.Driver_Id = d.Users_Id and d.Banned = 'No' WHERE Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at
SELECT Request_at As Day, round(coalesce((SUM(Case when Status = 'completed' then 0 else 1 end)/count(*)),0),2) as 'Cancellation Rate' FROM trips a left join users b on a.client_id = b.users_id left join users c on a.driver_id = c.users_id where b.banned != 'Yes' and c.banned != 'Yes' AND Request_at BETWEEN date'2013-10-01' and date'2013-10-03' GROUP BY 1 ORDER BY 1
SELECT Request_at Day, ROUND((COUNT(IF(Status <> 'completed', true, null))/COUNT(*)), 2) `Cancellation Rate` FROM Trips WHERE Request_at >= '2013-10-01' AND Request_at <= '2013-10-03' AND Client_Id IN (SELECT Users_Id FROM Users WHERE Role = 'client' AND Banned = 'No') AND Driver_Id IN (SELECT Driver_Id FROM Users WHERE Role = 'driver' AND Banned = 'No') GROUP BY Day
SELECT Request_at Day, ROUND(SUM(Cancelled) / COUNT(*), 2) `Cancellation Rate` FROM ( SELECT t.*, CASE WHEN t.Status != 'completed' THEN 1 ELSE 0 END Cancelled FROM Trips t JOIN Users u1 ON t.Client_Id = u1.Users_Id JOIN Users u2 ON t.Driver_Id = u2.Users_Id WHERE u1.Banned = 'No' AND u2.Banned = 'No' AND t.Request_at IN ('2013-10-01', '2013-10-02', '2013-10-03') ) unbanned_trips GROUP BY Day
SELECT Request_at Day, ROUND(SUM(IF(t.Status <> 'completed', 1, 0))/COUNT(*),2) AS 'Cancellation Rate' FROM Trips t, Users u WHERE t.Client_Id = u.Users_Id AND u.Banned = 'No' AND (t.Request_at BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY t.Request_at ORDER BY t.Request_at ASC
SELECT Request_at as 'Day', round(sum(case when t.status ="completed" then 0 else 1 end)/ count(*),2) as "Cancellation Rate" FROM Trips t, Users u1, Users u2 WHERE t.Client_Id=u1.Users_id and t.Driver_Id=u2.Users_id and u1.Banned='No' and u2.Banned='No' and Request_at BETWEEN "2013-10-01" and "2013-10-03" GROUP BY Request_at ORDER BY Request_at
SELECT Request_at as DAY, ROUND(SUM(IF(Status != "completed", 1, 0))/COUNT(Status),2) AS "Cancellation Rate" FROM Trips WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" AND Client_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = "Yes") AND Driver_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = "Yes") GROUP BY Request_at
SELECT Request_at as Day, ROUND(COUNT(CASE WHEN STATUS != "completed" THEN 1 END)/count(*),2) AS 'Cancellation Rate' FROM Trips JOIN Users u1 ON (Client_Id = u1.Users_Id) JOIN Users u2 ON (Driver_Id = u2.Users_Id) WHERE u1.Banned = "No" AND u2.Banned="No" GROUP BY 1 HAVING Request_at BETWEEN "2013-10-01" AND "2013-10-03"
SELECT Request_at as Day, ROUND(COUNT(IF(Status != 'completed', TRUE, NULL)) / COUNT(*), 2) AS 'Cancellation Rate' FROM Trips WHERE (Request_at BETWEEN '2013-10-01' AND '2013-10-03') AND Client_id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') GROUP BY Request_at
SELECT Request_at as Day, ROUND(COUNT(IF(T.status != 'completed',TRUE,NULL))/COUNT(*), 2) as 'Cancellation Rate' FROM Trips as T WHERE T.Client_ID in (SELECT Users_ID FROM Users WHERE Banned = 'No') AND T.Driver_Id in (SELECT Users_ID FROM Users WHERE Banned = 'No') AND T.Request_at between '2013-10-01' AND '2013-10-03' GROUP BY T.Request_at
SELECT Request_at as Day, ROUND(SUM(CASE WHEN Status LIKE 'CANCELLED%' THEN 1 ELSE 0 END)/COUNT(*),2) AS 'Cancellation Rate' FROM( SELECT * FROM Trips t WHERE t.Client_Id not in (select Users_Id from Users where Banned = 'Yes') AND t.Driver_Id not in (select Users_Id from Users where Banned = 'Yes') AND t.Request_at between '2013-10-01' and '2013-10-03' ) AS newT GROUP BY Request_at
SELECT Request_at as Day, ROUND(SUM(t.Status != "completed") / COUNT(*), 2) as "Cancellation Rate" FROM Trips t JOIN Users c ON t.Client_ID = c.Users_ID AND c.Banned = "No" JOIN Users d ON t.Driver_ID = d.Users_ID AND d.Banned = "No" WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Request_at
SELECT Request_at as Day, ROUND(sum(CASE WHEN Status like "cancelled%" THEN 1 ELSE 0 END)/count(*), 2) as `Cancellation Rate` FROM Trips WHERE Client_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND Driver_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND Request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at
SELECT Request_at as Day, ROUND(sum(CASE WHEN Status like "cancelled%" THEN 1 ELSE 0 END)/count(*), 2) as `Cancellation Rate` FROM Trips as a LEFT JOIN Users as b on a.Client_Id = b.Users_Id AND b.role = "Client" LEFT JOIN Users as c on a.Driver_Id = c.Users_Id AND c.role = "Driver" WHERE b.banned = 'No' and c.banned = 'No' AND Request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at
SELECT Request_at as day, ROUND(COUNT(DISTINCT CASE WHEN LEFT(Status, 6) = 'cancel' THEN Id END)/COUNT(DISTINCT id), 2) as 'Cancellation Rate' FROM Trips WHERE Client_Id NOT IN (SELECT Users_id FROM Users WHERE Banned = 'Yes') AND Driver_Id NOT IN (SELECT Users_id FROM Users WHERE Banned = 'Yes') AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1
SELECT T.Request_at AS Day, ROUND(T.Canceled_Count / T.Trip_Count, 2) AS 'Cancellation Rate' FROM (SELECT COUNT(CASE t.Status WHEN 'completed' THEN null ELSE 1 END) AS Canceled_Count, COUNT(*) AS Trip_Count, t.Request_at FROM Trips AS t JOIN Users AS u1 ON (t.Client_Id = u1.Users_Id) AND (u1.Banned = 'No') JOIN Users AS u2 ON (t.Driver_Id = u2.Users_Id) AND (u2.Banned = 'No') GROUP BY t.Request_at HAVING t.Request_at <= '2013-10-03' AND t.Request_at >= '2013-10-01' ) AS T
SELECT T.Request_at AS Day, ROUND(T.Canceled_Count / T.Trip_Count, 2) AS 'Cancellation Rate' FROM (SELECT sum(CASE t.Status WHEN 'completed' THEN 0 ELSE 1 END) AS Canceled_Count, COUNT(*) AS Trip_Count, t.Request_at FROM Trips AS t JOIN Users AS u1 ON (t.Client_Id = u1.Users_Id) AND (u1.Banned = 'No') JOIN Users AS u2 ON (t.Driver_Id = u2.Users_Id) AND (u2.Banned = 'No') GROUP BY t.Request_at HAVING t.Request_at <= '2013-10-03' AND t.Request_at >= '2013-10-01' ) AS T
SELECT T.Request_at AS Day, Round(T.cancelled_count / T.total_count, 2) AS 'Cancellation Rate' FROM ( SELECT COUNT(CASE t.Status WHEN 'completed' THEN null ELSE 1 END) AS cancelled_count, COUNT(*) AS total_count, t.Request_at FROM Trips AS t JOIN Users AS u1 ON (t.Client_Id = u1.Users_Id) AND (u1.Banned = 'No') JOIN Users As u2 ON (t.Driver_Id = u2.Users_Id) AND (u2.Banned = 'No') GROUP BY t.Request_at HAVING t.Request_at >= '2013-10-01' AND t.Request_at <= '2013-10-03' ) AS T
SELECT T.Request_at As Day, (round(sum(case when T.Status = 'completed' then 0 else 1 end) / count(*), 2)) As 'Cancellation Rate' FROM Trips T JOIN Users U ON (T.Client_Id = U.Users_Id) WHERE T.Request_at >= "2013-10-01" AND T.Request_at <= "2013-10-03" AND U.Banned = 'No' Group By T.Request_at
SELECT T.Request_at Day, ROUND(SUM(CASE WHEN T.Status LIKE 'cancelled_%' THEN 1 ELSE 0 END)/COUNT(*),2) AS "Cancellation Rate" FROM Trips T JOIN (SELECT * FROM Users WHERE Role = 'client' AND Banned = "No") C ON T.Client_Id = C.Users_Id JOIN (SELECT * FROM Users WHERE Role = 'driver' AND Banned = "No") D ON T.Driver_Id = D.Users_Id WHERE T.Request_at <= '2013-10-03' AND T.Request_at >= '2013-10-01' GROUP BY T.Request_at
SELECT T.request_at aS Day, COALESCE(ROUND(COUNT(CASE WHEN t.status LIKE 'cancelled%' THEN 1 END)/COUNT(*),2),0.00) AS 'Cancellation Rate' FROM trips t JOIN users u ON t.client_id = u.users_id JOIN users u1 ON t.driver_id = u1.users_id WHERE u.banned = 'No' AND u1.banned = 'No' GROUP BY request_at HAVING request_at BETWEEN '2013-10-01' AND '2013-10-03'
SELECT T2.Request_at AS 'Day', ROUND(COUNT(T1.Id) / COUNT(T2.Id), 2) AS 'Cancellation Rate' FROM (SELECT * FROM Users INNER JOIN Trips ON Users.Users_Id = Trips.Client_Id WHERE Banned = 'No' AND Status LIKE 'cancelled%' AND Request_at >= '2013-10-01' AND Request_at <= '2013-10-03') AS T1 RIGHT JOIN (SELECT * FROM Users INNER JOIN Trips ON Users.Users_Id = Trips.Client_Id WHERE Banned = 'No' AND Request_at >= '2013-10-01' AND Request_at <= '2013-10-03') AS T2 ON T1.Id = T2.Id GROUP BY T2.Request_at
SELECT T_tot.Day AS Day, ROUND(IFNULL(T_can.cancel_num,0)/T_tot.tot,2) AS "Cancellation Rate" FROM (SELECT Day, COUNT(*) AS tot FROM (SELECT Request_at AS Day, T1.banned AS ban_1, T2.banned as ban_2 FROM Trips, Users AS T1, Users AS T2 WHERE Trips.Client_Id = T1.Users_Id AND Trips.Driver_Id = T2.Users_Id) AS T WHERE ban_1 = "No" AND ban_2 = "No" GROUP BY Day) AS T_tot LEFT JOIN (SELECT Day, COUNT(Id) AS cancel_num FROM (SELECT Trips.Id AS Id, T1.banned AS ban_1, T2.banned as ban_2, Request_at AS Day FROM Trips, Users AS T1, Users AS T2 WHERE Trips.Client_Id = T1.Users_Id AND Trips.Driver_Id = T2.Users_Id AND Trips.Status LIKE "cancelled%") AS T WHERE ban_1 = "No" AND ban_2 = "No" GROUP BY Day) AS T_can ON T_tot.DAY = T_can.DAY WHERE DATEDIFF("2013-10-03", T_tot.Day)<3 AND DATEDIFF(T_tot.Day, "2013-10-01")<3
SELECT Trips.Request_at as 'Day', IF(cancellation_count IS NULL, 0.00, ROUND(cancellation_count/COUNT(*), 2)) as 'Cancellation Rate' FROM Trips INNER JOIN Users u3 ON Trips.Driver_Id = u3.Users_Id AND u3.Role = 'driver' AND u3.Banned = "No" INNER JOIN Users u4 ON Trips.Client_Id = u4.Users_Id AND u4.Role = 'client' AND u4.Banned = "No" LEFT JOIN (SELECT Trips.Request_at, COUNT(*) as "cancellation_count" FROM Trips INNER JOIN Users u1 ON Trips.Driver_Id = u1.Users_Id AND u1.Role = 'driver' AND u1.Banned = "No" INNER JOIN Users u2 ON Trips.Client_Id = u2.Users_Id AND u2.Role = 'client' AND u2.Banned = "No" WHERE Status IN ("cancelled_by_driver", "cancelled_by_client") GROUP BY Trips.Request_at) cancelled_requests ON Trips.Request_at = cancelled_requests.Request_at WHERE Trips.Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Trips.Request_at
SELECT Trips_table.Request_at AS "Day", COALESCE( ROUND (cancel_table.cancel_tl / COUNT(Trips_table.Id),2),0) AS "Cancellation Rate" From ( SELECT Trips.Id, Trips.Request_at FROM Trips JOIN Users ON Trips.Client_Id = Users.Users_Id WHERE Users.Banned = "No") Trips_table LEFT JOIN ( SELECT Trips.Request_at, COUNT(Trips.Id) AS cancel_tl FROM Trips JOIN Users ON Trips.Client_Id = Users.Users_Id WHERE Trips.Status != "completed" AND Users.Banned = "No" GROUP BY Trips.Request_at) cancel_table ON Trips_table.Request_at = cancel_table.Request_at WHERE Trips_table.Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Trips_table.Request_at
SELECT `Request_at` AS `Day`, CAST((SUM(IF(`Status` != 'completed', 1, 0))/COUNT(*)) AS DECIMAL(10, 2)) AS `Cancellation Rate` FROM Trips WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" AND Client_Id NOT IN (SELECT Users_Id FROM Users WHERE banned = 'Yes') AND Driver_Id NOT IN (SELECT Users_Id FROM Users WHERE banned = 'Yes') GROUP BY Request_at
SELECT date(Request_at) as Day, ROUND(COUNT(CASE WHEN Status in ('cancelled_by_driver','cancelled_by_client') THEN Id ELSE NULL END) / COUNT(Id),2) as 'Cancellation Rate' FROM ( SELECT t.Id, t.Client_Id, t.Driver_Id, t.Status, t.Request_at, u1.Banned as Client_Banned, u2.Banned as Driver_Banned FROM Trips t LEFT JOIN Users u1 ON u1.Users_Id = t.Client_Id LEFT JOIN Users u2 ON u2.Users_Id = Driver_Id WHERE u1.Banned = 'No' AND u2.Banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' ) tripData GROUP BY 1 ORDER BY 1
SELECT date(t.Request_at) as Day, ROUND(COUNT(CASE WHEN t.Status in ('cancelled_by_driver','cancelled_by_client') THEN t.Id ELSE NULL END) / COUNT(t.Id),2) as 'Cancellation Rate' FROM Trips t LEFT JOIN Users u1 ON u1.Users_Id = t.Client_Id LEFT JOIN Users u2 ON u2.Users_Id = Driver_Id WHERE u1.Banned = 'No' AND u2.Banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1
SELECT ina.Request_at AS Day, ROUND(AVG(CASE WHEN Status="completed" THEN 0 ELSE 1 END), 2) as "Cancellation Rate" FROM Trips AS ina LEFT JOIN Users AS inb on ina.Client_Id = inb.Users_Id LEFT JOIN Users AS inc on ina.Driver_ID = inc.Users_id WHERE inb.Banned = 'No' and inc.Banned = 'No' and ina.Request_at >= "2013-10-01" and ina.Request_at <= "2013-10-03" GROUP BY request_at
SELECT p.Request_at as Day, round(sum( IF( p.Status = 'completed', 0, 1) ) / sum(1), 2) as 'Cancellation Rate' FROM Trips as p LEFT JOIN Users as u ON p.Client_Id = u.Users_Id LEFT JOIN Users as d on p.Driver_Id = d.Users_id WHERE u.Banned = 'No' and d.Banned = 'No' and p.Request_at between '2013-10-01' and '2013-10-03' group by p.Request_at
SELECT request_at AS "Day", ROUND(((SUM(CASE WHEN LOWER(Status) LIKE "cancelled%" THEN 1.000 ELSE 0 END)) / COUNT(id)), 2) AS "Cancellation Rate" FROM trips AS t JOIN users AS u ON t.client_id = u.users_id AND u.banned ='No' WHERE request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY request_at
SELECT request_at AS Day ,round(sum(status <> 'completed') / count(id), 2) AS 'Cancellation Rate' FROM trips WHERE client_id NOT IN( SELECT users_id FROM users WHERE banned = 'Yes' ) AND driver_id NOT IN( SELECT users_id FROM users WHERE banned = 'Yes' ) AND request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY day ORDER BY day
SELECT request_at AS Day, CAST(SUM(no_of_cancelled_trips)/SUM(no_of_non_cancelled_trips) AS DECIMAL(10,2)) AS `Cancellation Rate` FROM ( SELECT CASE WHEN trips.status IN ('cancelled_by_client', 'cancelled_by_driver') THEN COUNT(trips.status) ELSE 0 END AS no_of_cancelled_trips, COUNT(status) AS no_of_non_cancelled_trips, trips.request_at FROM trips JOIN users u_c ON trips.client_id = u_c.users_id JOIN users u_d ON trips.driver_id = u_d.users_id WHERE u_c.banned = 'no' AND u_d.banned = 'no' AND trips.request_at >= '2013-10-01' AND trips.request_at <= '2013-10-03' GROUP BY status, request_at ORDER BY trips.request_at )AS SubQuery1 GROUP BY SubQuery1.request_at
SELECT request_at AS Day, ROUND(SUM(status != 'completed')/COUNT(*),2) AS 'Cancellation Rate' FROM trips WHERE (request_at BETWEEN "2013-10-01" AND "2013-10-03") AND client_id NOT IN (SELECT users_id FROM users WHERE banned = 'Yes') AND driver_id NOT IN(SELECT users_id FROM users WHERE banned = 'Yes') GROUP BY request_at
SELECT request_at AS Day, ROUND(SUM(status != 'completed')/count(Id), 2) as 'Cancellation Rate' FROM Trips WHERE Client_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND Driver_id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT request_at AS `Day`, ROUND(COUNT(DISTINCT CASE WHEN status IN ('cancelled_by_driver', 'cancelled_by_client') THEN id ELSE NULL END) / COUNT(DISTINCT id), 2) AS `Cancellation Rate` FROM trips LEFT JOIN ( SELECT users_id AS client_id, banned AS client_banned FROM users WHERE role = 'client' ) AS client USING (client_id) LEFT JOIN ( SELECT users_id AS driver_id, banned AS driver_banned FROM users WHERE role = 'driver' ) AS driver USING (driver_id) WHERE client_banned = 'No' AND driver_banned = 'No' AND request_at >= DATE('2013-10-01') AND request_at <= DATE('2013-10-03') GROUP BY 1 ORDER BY 1
SELECT request_at Day, ROUND(SUM(status<>'completed')/COUNT(*),2) 'Cancellation Rate' FROM trips WHERE client_id IN (SELECT users_id FROM users WHERE banned='No') AND driver_id IN (SELECT users_id FROM users WHERE banned='No') AND request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY request_at
SELECT request_at as Day, ROUND(COUNT(CASE WHEN status = 'cancelled_by_driver' OR status = 'cancelled_by_client' THEN 1 ELSE NULL END)/COUNT(*),2) as 'Cancellation Rate' FROM Trips T JOIN Users C ON T.client_id = C.Users_Id JOIN Users D ON T.driver_id = D.Users_Id WHERE C.Banned != 'Yes' and D.Banned != 'Yes' and T.Request_at between '2013-10-01' and '2013-10-03' GROUP BY request_at ORDER BY request_at
SELECT request_at as Day, ROUND(SUM(cancelled) / COUNT(id),2) as `Cancellation Rate` FROM ( SELECT (CASE WHEN status = 'completed' THEN 0 ELSE 1 END) as cancelled, id, request_at FROM trips t JOIN users u1 ON t.client_id = u1.users_id JOIN users u2 ON t.driver_id = u2.users_id WHERE u1.banned = 'No' AND u2.banned = 'No' AND request_at BETWEEN '2013-10-01' AND '2013-10-03' ) t0 GROUP BY Day ORDER BY Day
SELECT request_at day, ROUND(SUM(CASE WHEN status IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END)/COUNT(id),2) 'cancellation rate' FROM(SELECT id, client_id, driver_id, status, request_at FROM trips t JOIN users u ON t.client_id = u.users_id WHERE u.banned LIKE 'No' AND request_at BETWEEN '2013-10-01' AND '2013-10-03') ts GROUP BY 1
SELECT sub.Request_at as Day, ROUND(SUM(CASE when sub.Status='cancelled_by_driver' or Status = 'cancelled_by_client' then 1 else 0 END) / count(Request_at),2) as 'Cancellation Rate' FROM (SELECT * FROM Trips WHERE Client_Id NOT IN (Select Users_Id from Users WHERE Banned='Yes') And Driver_Id NOT IN (Select Users_Id from Users WHERE Banned='Yes'))sub WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY 1
SELECT t.Request_at "Day", ROUND(SUM(t.Status != 'completed')/COUNT(*), 2) "Cancellation Rate" FROM Trips t JOIN Users u1 ON u1.Users_Id = t.Client_Id AND u1.Banned = 'No' JOIN Users u2 ON u2.Users_Id = t.Driver_Id AND u2.Banned = 'No' WHERE t.Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY (t.Request_at)
SELECT t.Request_at AS "Day", ROUND( COUNT( CASE WHEN t.Status != 'completed' THEN 1 ELSE NULL END) / COUNT(*), 2) AS 'Cancellation Rate' FROM Trips AS t JOIN Users AS client ON client.Users_id = t.Client_id AND client.banned = "No" JOIN Users AS driver ON driver.Users_id = t.Driver_id AND driver.banned = "No" WHERE t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at AS 'Day', round( sum(case t.Status when 'cancelled_by_driver' then 1 when 'cancelled_by_client' then 1 else 0 end) / count(*), 2) AS 'Cancellation Rate' FROM Trips t WHERE '2013-10-01' <= t.Request_at and t.Request_at <= '2013-10-03' and t.Client_Id in (SELECT Users_Id FROM Users u WHERE Banned = 'No') and t.Driver_Id in (SELECT Users_Id FROM Users u WHERE Banned = 'No') GROUP BY T.Request_at
SELECT t.Request_at AS Day, ROUND(1-(SUM(t.Status = 'completed')/COUNT(t.Status)),2) AS 'Cancellation Rate' FROM Trips t JOIN Users u1 ON t.Client_Id = u1.Users_Id JOIN Users u2 ON t.Driver_Id = u2.Users_Id WHERE u1.Banned = 'No' AND u2.Banned = 'No' AND t.Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY t.Request_at
SELECT t.Request_at AS Day, ROUND(AVG(CASE WHEN Status = 'cancelled_by_driver' OR Status = 'cancelled_by_client' THEN 1 ELSE 0 END), 2) AS 'Cancellation Rate' FROM Trips AS t LEFT JOIN Users AS a ON t.Client_Id = a.Users_Id LEFT JOIN Users AS b ON t.Driver_Id = b.Users_Id WHERE a.Banned = 'No' AND b.Banned = 'No' AND Request_at >= '2013-10-01' AND Request_at <= '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at AS Day, ROUND(SUM(CASE WHEN t.Status = 'completed' THEN 0 ELSE 1 END) / COUNT(t.Status), 2) AS 'Cancellation Rate' FROM Trips t LEFT JOIN Users u1 ON t.Client_Id = u1.Users_Id LEFT JOIN Users u2 ON t.Client_Id = u2.Users_Id WHERE t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' AND u1.Banned = 'No' AND u2.Banned = 'No' GROUP BY 1
SELECT t.Request_at AS Day, ROUND(SUM(CASE WHEN t.Status='completed' THEN 0 ELSE 1 END)/COUNT(*), 2) AS 'Cancellation Rate' FROM Trips t LEFT JOIN Users u1 ON t.Client_Id=u1.Users_Id LEFT JOIN Users u2 ON t.Driver_Id=u2.Users_Id WHERE u1.Banned='No' AND u2.Banned='No' AND t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at AS Day, ROUND(SUM(IF(t.Status!='completed',1,0))/COUNT(t.Status),2) AS 'Cancellation Rate' FROM (SELECT * FROM Trips WHERE Client_Id IN (SELECT Users_Id FROM Users WHERE Banned='No' AND Role='client') AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned='No' AND Role='driver') AND request_at BETWEEN '2013-10-01' AND '2013-10-03') AS t GROUP BY Day
SELECT t.Request_at AS Day, Round(COUNT(CASE WHEN t.Status LIKE "cancelled%" THEN 1 END)/COUNT(*),2) AS 'Cancellation Rate' FROM Trips t JOIN Users u ON t.Client_Id=u.Users_Id JOIN Users s ON t.Driver_Id=s.Users_Id WHERE u.Banned = 'NO'and s.Banned ='NO' GROUP BY 1 HAVING Day BETWEEN '2013-10-01' AND '2013-10-03' ORDER BY 1 ASC
SELECT t.Request_at Day, ROUND(SUM(CASE WHEN t.Status LIKE 'cancelled%' THEN 1 ELSE 0 END)/COUNT(*), 2) 'Cancellation Rate' FROM Trips t JOIN Users u ON t.Client_Id = u.Users_Id AND u.Banned = 'No' WHERE t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at Day, Round(sum(Case when t.Status like 'cancelled%' then 1 else 0 end)/count(*),2) 'Cancellation Rate' FROM Trips t JOIN Users u ON t.Client_Id = u.Users_Id AND u.Banned = 'No' WHERE t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at `Day`, ROUND((COUNT(IF(t.Status <> 'completed', true, null))/COUNT(*)), 2) `Cancellation Rate` FROM Trips t JOIN Users client ON t.Client_Id = client.Users_Id AND client.Role = 'client' AND client.Banned = 'No' JOIN Users driver ON t.Driver_Id = driver.Users_Id AND driver.Role = 'driver' AND driver.Banned = 'No' AND t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at as Day, ROUND( ( Sum(CASE WHEN t.Status in ('cancelled_by_driver', 'cancelled_by_client') THEN 1 ELSE 0 END) / count(*) ), 2 ) as `Cancellation Rate` FROM ( SELECT t1.Client_Id, t1.Status, t1.Request_at, u1.Banned FROM Trips t1 INNER JOIN Users u1 ON u1.Users_Id = t1.Client_Id ) t WHERE t.banned != 'Yes' and t.Request_at between '2013-10-01' and '2013-10-03' GROUP BY t.Request_at
SELECT t.Request_at as Day, ROUND(COUNT(CASE WHEN t.status in ('cancelled_by_driver', 'cancelled_by_client') THEN t.id END)/COUNT(*), 2) as "Cancellation Rate" FROM Trips as t LEFT JOIN Users as c on t.client_id = c.users_id LEFT JOIN Users as d on t.driver_id = d.users_id WHERE c.Banned = 'No' and d.Banned = 'No' and t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY 1 ORDER BY 1
SELECT t.Request_at as Day, ROUND(SUM(CASE WHEN Status = 'cancelled_by_driver' or Status = 'cancelled_by_client' THEN 1 ELSE 0 END)/count(*),2) as 'Cancellation Rate' from Trips t left join Users u1 On t.Driver_Id = u1.Users_Id left join Users u2 On t.Client_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' AND (Request_at BETWEEN '2013-10-01' AND '2013-10-03') group by Request_at order by Request_at
SELECT t.request_at AS "Day", ROUND( COUNT(CASE WHEN t.status != 'completed' THEN 1 ELSE NULL END) / COUNT(id) , 2) AS "Cancellation Rate" FROM trips AS t JOIN users AS client ON t.client_id = client.users_id AND client.banned = 'No' JOIN users AS driver ON driver.users_id = t.driver_id AND driver.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.request_at
SELECT t.request_at AS "Day", ROUND( SUM(CASE WHEN t.status != 'completed' THEN 1 ELSE 0 END) / COUNT(id) , 2) AS "Cancellation Rate" FROM trips AS t JOIN users AS client ON t.client_id = client.users_id AND client.banned = 'No' JOIN users AS driver ON driver.users_id = t.driver_id AND driver.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.request_at order by 1
SELECT t.request_at AS Day, ROUND(COUNT(CASE WHEN t.status IN ('cancelled_by_driver', 'cancelled_by_client') THEN 1 END) / COUNT(*), 2) AS 'Cancellation Rate' FROM Users c INNER JOIN Trips t INNER JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT t.request_at AS Day, ROUND(COUNT(CASE WHEN t.status LIKE 'cancelled%' THEN 1 END) / COUNT(*), 2) AS 'Cancellation Rate' FROM Users c INNER JOIN Trips t INNER JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT t.request_at AS Day, ROUND(COUNT(CASE WHEN t.status LIKE 'cancelled%' THEN 1 END) / COUNT(*), 2) AS 'Cancellation Rate' FROM Users c JOIN Trips t JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT t.request_at AS Day, ROUND(COUNT(if(t.status LIKE 'cancelled%',1,NULL)) / COUNT(*), 2) AS 'Cancellation Rate' FROM Users c INNER JOIN Trips t INNER JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT t.request_at AS Day, ROUND(SUM(CASE WHEN t.status LIKE 'cancelled%' THEN 1 ELSE 0 END) / COUNT(*), 2) AS 'Cancellation Rate' FROM Users c INNER JOIN Trips t INNER JOIN Users d ON c.users_id = t.client_id AND t.driver_id = d.users_id WHERE c.banned = 'No' AND d.banned = 'No' AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY DAY ORDER BY DAY
SELECT t.request_at Day, ROUND(SUM(CASE WHEN t.status = 'completed' THEN 0 ELSE 1 END)/COUNT(*),2) as 'Cancellation Rate' FROM trips t JOIN users u1 ON (u1.users_id = t.client_id AND u1.role = 'client' AND u1.banned = 'No') JOIN users u2 On (u2.users_id = t.driver_id AND u2.role = 'driver' AND u2.banned = 'No') GROUP BY 1 HAVING t.Request_at <= '2013-10-03' AND t.Request_at >= '2013-10-01'
SELECT t.request_at as Day, ROUND( COUNT( CASE WHEN t.status LIKE 'cancelled%' THEN 1 END) / COUNT(*), 2) AS "Cancellation Rate" FROM Users u INNER JOIN Trips t INNER JOIN Users u1 ON t.Client_Id = u.Users_id AND t.Driver_Id = u1.Users_id WHERE u.Banned = 'No' AND u1.Banned = 'No' AND t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Day ORDER BY Day
SELECT t1.Request_at Day, Round(ifnull((t2.canceled/t1.total),0),2) as "Cancellation Rate" FROM (Select Request_at, Count(*) total FROM Trips t join Users d on d.Users_Id = t.Driver_Id join Users c on c.Users_Id = t.Client_Id where d.Banned = 'No' and c.Banned = 'No' and request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at) t1 left join (Select Request_at, Count(*) canceled FROM Trips t join Users d on d.Users_Id = t.Driver_Id join Users c on c.Users_Id = t.Client_Id where d.Banned = 'No' and c.Banned = 'No' and Status != 'completed' and request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at) t2 on t1.Request_at = t2.Request_at
SELECT t1.Request_at as Day, ROUND(SUM(CASE WHEN t1.Status !='completed' THEN 1 ELSE 0 END)/count(*),2) "Cancellation Rate" FROM Trips t1 LEFT JOIN Users u ON t1.Client_id=u.Users_Id WHERE u.Banned='No' AND (t1.Request_at BETWEEN '2013-10-01' AND '2013-10-03') GROUP BY t1.Request_at
SELECT tb1.Request_at AS Day, ROUND(SUM(CASE WHEN tb1.Status = "completed" THEN 0 ELSE 1 END)/ COUNT(*),2) AS "Cancellation Rate" FROM Trips AS tb1 INNER JOIN Users AS tb2 ON tb1.Client_Id = tb2.Users_Id AND tb2.Banned = "No" INNER JOIN Users AS tb3 ON tb1.Driver_Id = tb3.Users_Id AND tb3.Banned = "No" WHERE tb1.Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY tb1.Request_at ORDER BY Day
SELECT trips.request_at AS 'Day', ROUND(AVG(IF(trips.status LIKE 'cancelled%', 1, 0)), 2) AS 'Cancellation Rate' FROM trips JOIN users driver_table ON trips.driver_id = driver_table.users_id JOIN users client_table ON trips.client_id = client_table.users_id WHERE driver_table.banned = 'No' AND client_table.banned = 'No' AND trips.request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY trips.request_at
SELECT tt.Request_at as 'Day', IFNULL(ROUND((cx.cancelled / tt.total), 2), 0) as "Cancellation Rate" FROM ( SELECT COUNT(t.Id) as 'total', t.Request_at FROM Trips t LEFT JOIN Users u ON t.Driver_Id = u.Users_id LEFT JOIN Users u2 ON t.Client_Id = u2.Users_id WHERE u.Banned != "Yes" AND u2.Banned != "Yes" AND t.Request_at >= '2013-10-01' AND t.Request_at <= '2013-10-03' GROUP BY t.Request_at ) tt LEFT JOIN ( SELECT COUNT(t.Id) as "cancelled", t.Request_at FROM Trips t LEFT JOIN Users u ON t.Driver_Id = u.Users_id LEFT JOIN Users u2 ON t.Client_Id = u2.Users_id WHERE ( u.Banned != "Yes" AND u2.Banned != "Yes" ) AND ( t.Status = "cancelled_by_driver" OR t.Status = "cancelled_by_client" ) AND t.Request_at >= '2013-10-01' AND t.Request_at <= '2013-10-03' GROUP BY t.Request_at ) cx ON tt.Request_at = cx.Request_at
Select Day, ROUND((cancelled_trips/total_trips), 2) as `Cancellation Rate` FROM (Select request_at as Day, count(t.status) as total_trips, SUM(IF(t.status <> 'completed', 1, 0)) as cancelled_trips from trips t JOIN users u ON t.client_id = u.users_id AND u.role = 'client' And u.banned <> "Yes" JOIN users u2 ON t.driver_id = u2.users_id AND u2.role = 'driver' AND u2.banned <> "Yes" WHERE t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.request_at ORDER BY t.request_at asc) tmp
Select Request_at as 'Day', round(sum(isCanceled) / count(isCanceled),2) as 'Cancellation Rate' From (Select *, case when Status like 'cancelled_%' then 1 else 0 end as 'isCanceled' from Trips where Client_Id not in (Select Users_Id from Users where Banned = 'Yes') AND Driver_Id not in (Select Users_Id from Users where Banned = 'Yes') AND Request_at between "2013-10-01" and "2013-10-03") T1 Group By Request_at
Select Request_at as Day, cast(round(sum(case when Status = 'cancelled_by_driver' then 1 when Status = 'cancelled_by_client' then 1 else 0 end) * 1.0 / count(Status),2) as float) as 'cancellation rate' from Trips t where Request_at between '2013-10-01' and '2013-10-03' and client_id not in (Select users_id from users where Banned = 'Yes') and driver_id not in (Select users_id from users where Banned = 'Yes') group by Request_at order by Request_at
Select Request_at as Day, round(count(case when Status != "completed" then 1 end)/count(*), 2) as "Cancellation Rate" FROM (SELECT * from Trips WHERE Client_Id NOT IN (select Users_Id from Users where Banned = "Yes") and Driver_Id NOT IN (select Users_Id from Users where Banned = "Yes")) as t2 WHERE Request_at BETWEEN "2013-10-01" and "2013-10-03" GROUP BY Request_at
Select T.Request_at as Day, round(sum(case when T.Status='cancelled_by_driver' or T.Status='cancelled_by_client' then 1 else 0 end) / count(T.Status),2) as 'Cancellation Rate' from Trips T join Users as C on T.Client_Id = C.Users_Id join Users as D on T.Driver_ID = D.Users_Id where C.Banned ='No' and D.Banned='No' and T.Request_at between '2013-10-01' and '2013-10-03' group by 1 order by 1
Select Trips.Request_at AS 'Day', ROUND(AVG(CASE WHEN Trips.Status IN ('cancelled_by_driver','cancelled_by_client') THEN 1 ELSE 0 END),2) AS 'Cancellation Rate' FROM Trips Where Trips.Client_Id NOT IN (Select Users.Users_Id From Users Where Banned = 'Yes') AND Trips.Driver_Id NOT IN (Select Users.Users_Id From Users Where Banned = 'Yes') AND Trips.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Trips.Request_at
Select request_at as Day, Round(Sum(case when status like 'cancelled%' then 1 else 0 end) / count(*), 2) as "Cancellation Rate" from (SELECT * FROM Trips as t where t.client_id not in (select users_id from users where Banned = 'Yes' and Role = 'client') and t.Driver_Id not in (select users_id from users where Banned = 'Yes' and Role = 'driver') and t.Request_at between '2013-10-01' and '2013-10-03') as newT group by request_at
Select request_at as day , ROUND((SUM(CASE WHEN LEFT(Status,9) = 'cancelled' THEN 1 ELSE 0 END) / COUNT(*)),2) as 'Cancellation Rate' From Trips t Join Users client On client.users_id = t.Client_id AND client.banned = 'No' Join Users driver ON driver.users_id = t.driver_id AND driver.banned = 'No' WHERE request_at BETWEEN '2013-10-01' and '2013-10-03' GROUP BY request_at ORDER BY request_at ASC
Select t.Request_at as 'Day', round(count(case when t.status != 'Completed' then 1 else null end) / count(t.id), 2) as 'Cancellation Rate' From trips t, users u where t.client_id = u.Users_id and u.banned = 'No' group by t.Request_at Having t.Request_at between "2013-10-01" and "2013-10-03"
Select t.Request_at as Day, ROUND(SUM(IF(t.Status!='completed', 1, 0))/COUNT(*),2) as 'Cancellation Rate' from Trips t inner join Users c on c.Users_Id=t.Client_Id and c.Banned='No' inner join Users d on d.Users_Id=t.Driver_Id and d.Banned='No' where Request_at between'2013-10-01' and '2013-10-03' group by Day
Select t.Request_at as Day, Round(sum(t.status !='completed')/count(*),2) as 'Cancellation Rate' from Trips t join Users c on t.Client_id = c.Users_Id and c.Banned = 'No' join Users d on t.Client_id = d.Users_Id and d.Banned = 'No' Where t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Request_at Order by t.Request_at
Select t.request_at as Day, round(sum(t.status != 'completed')/count(*),2) as 'Cancellation Rate' From trips t Join Users u on t.client_id = u.users_id and u.banned = 'No' join users u1 on t.driver_id = u1.users_id and u1.banned = 'No' where t.request_at between "2013-10-01" AND "2013-10-03" Group by t.request_at
Select t1.Request_at as Day,round(count(distinct case when t1.Status != "completed" then t1.Id else null end) / count(distinct t1.Id) , 2) as "Cancellation Rate" from Trips t1 inner join (select * from Users where Banned= "No" AND role ="client") t2 on t1.client_id = t2.Users_Id inner join (select * from Users where Banned= "No" AND role ="driver") t3 on t1.driver_id = t3.Users_Id AND t1.Request_at >= "2013-10-01" AND t1.Request_at <= "2013-10-03" group by 1 order by 1
WITH A AS(Select request_at as Day, count(t.status) as total_trips, SUM(IF(t.status <> 'completed', 1, 0)) as cancelled_trips from trips t JOIN users u ON t.client_id = u.users_id And u.banned <> "Yes" WHERE t.request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.request_at ORDER BY t.request_at asc) SELECT Day, ROUND((cancelled_trips/total_trips), 2) as `Cancellation Rate` FROM A
WITH ACTIVE_USERS AS ( SELECT USERS_ID FROM USERS WHERE BANNED = 'No' ), ACTIVE_TRIPS AS ( SELECT STATUS, REQUEST_AT FROM TRIPS WHERE CLIENT_ID IN (SELECT USERS_ID FROM ACTIVE_USERS) AND DRIVER_ID IN (SELECT USERS_ID FROM ACTIVE_USERS) AND REQUEST_AT BETWEEN '2013-10-01' AND '2013-10-03' ) SELECT REQUEST_AT AS DAY, ROUND(SUM(1-CASE WHEN STATUS = 'completed' THEN 1 ELSE 0 END)/COUNT(*),2) AS "Cancellation Rate" FROM ACTIVE_TRIPS GROUP BY 1 ORDER BY 1 ASC
WITH CTE AS (SELECT * FROM Users WHERE Banned='No') select t.Request_at Day, ROUND((count(IF(t.status!='completed',TRUE,null))/count(*)),2) as 'Cancellation Rate' from Trips t JOIN CTE on t.Client_Id = CTE.Users_Id JOIN (SELECT * FROM Users WHERE Banned='No') u2 on t.Driver_Id = u2.Users_Id where t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
WITH CTE1 AS ( SELECT CLIENT_ID, DRIVER_ID, (CASE WHEN STATUS LIKE '%cancelled%' THEN 1 ELSE 0 END) STATUS, REQUEST_AT FROM TRIPS WHERE CLIENT_ID NOT IN (SELECT USERS_ID FROM USERS WHERE BANNED = 'Yes' AND ROLE = 'client') AND DRIVER_ID NOT IN (SELECT USERS_ID FROM USERS WHERE BANNED = 'Yes' AND ROLE = 'role') AND REQUEST_AT BETWEEN '2013-10-01' AND '2013-10-03' ) SELECT REQUEST_AT AS DAY, ROUND(SUM(STATUS) / COUNT(STATUS),2) AS `CANCELLATION RATE` FROM CTE1 GROUP BY DAY
WITH CTE_unbanned_users AS( SELECT * FROM USERS WHERE BANNED LIKE 'NO'), CTE_CANCELLED_client AS ( SELECT * FROM TRIPS WHERE STATUS LIKE '%cancelled%' ) SELECT t1.Request_at AS Day, ROUND(COUNT(CAST(T4.STATUS AS DECIMAL(9,2)))/COUNT(cast(T1.STATUS AS DECIMAL(9,2))) ,2)AS 'Cancellation Rate' FROM TRIPS T1 LEFT JOIN CTE_UNBANNED_USERS t2 on t1.client_id = t2.users_id LEFT JOIN CTE_UNBANNED_USERS T3 ON T1.DRIVER_ID = T3.users_id left JOIN CTE_CANCELLED_client t4 ON t4.Id = t1.ID WHERE T2.BANNED LIKE 'NO' AND T1.REQUEST_AT >= '2013-10-01' AND t1.request_at <='2013-10-03' and t3.banned LIKE 'NO' group by t1.request_at
WITH Sub AS ( SELECT * FROM Trips WHERE Client_id IN (SELECT Users_id FROM Users WHERE Banned = 'No') AND Driver_id IN (SELECT Users_id FROM Users WHERE Banned = 'No') AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' ) SELECT Sub.Request_at AS 'Day', ROUND(SUM(CASE WHEN Sub.Status like '%cancelled%' THEN 1.0 ELSE 0.0 END) / COUNT(*), 2) AS "Cancellation Rate" FROM Sub GROUP BY Sub.Request_at
WITH T1 AS( SELECT * FROM Trips t JOIN Users u ON t.Client_Id = u.Users_Id WHERE Banned = 'No' AND Request_at >= "2013-10-01" AND Request_at <= "2013-10-03" ), T2 AS( SELECT * FROM Trips t JOIN Users u ON t.Driver_Id = u.Users_Id WHERE Banned = 'No' AND Request_at >= "2013-10-01" AND Request_at <= "2013-10-03" ) SELECT a.Request_at AS Day, IFNULL(ROUND((total_count- completed_count)/total_count, 2), 0.00) AS 'Cancellation Rate' FROM (SELECT T1.Request_at, COUNT(T1.Id) AS total_count, SUM(CASE WHEN T1.Status = 'completed' THEN 1 ELSE 0 END) AS completed_count FROM T1 INNER JOIN T2 ON T1.Id = T2.Id GROUP BY T1.Request_at) a
WITH a AS ( SELECT client_id, driver_id, status, request_at, banned AS banned_driver FROM Trips LEFT JOIN Users ON Trips.driver_id = Users.users_id), b AS ( SELECT client_id, driver_id, status, request_at, banned AS banned_client, banned_driver FROM a LEFT JOIN Users ON a.client_id = Users.users_id), c AS ( SELECT * FROM b WHERE banned_client = 'No' AND banned_driver = 'No' AND DATEDIFF(request_at, '2013-10-01')>=0 AND DATEDIFF(request_at, '2013-10-03')<=0), d AS ( SELECT request_at, COUNT(*) AS ct FROM c WHERE status IN ('cancelled_by_driver', 'cancelled_by_client') GROUP BY request_at), e AS ( SELECT request_at, COUNT(*) AS ct FROM c GROUP BY request_at) SELECT e.request_at AS day, ROUND(IFNULL(d.ct, 0)/e.ct, 2) AS `Cancellation Rate` FROM e LEFT JOIN d ON e.request_at = d.request_at
WITH active_users AS ( SELECT Users_Id, Role FROM Users WHERE Banned = 'NO' ), active_clients AS ( SELECT Users_Id FROM active_users WHERE Role = 'client' ), active_drivers AS ( SELECT Users_id FROM active_users WHERE Role = 'driver' ) SELECT Request_at as "Day", round(sum(case when Status<>'completed' then 1 else 0 end) / count(Id), 2) "Cancellation Rate" FROM Trips t INNER JOIN active_clients ac ON t.Client_Id = ac.Users_Id INNER JOIN active_drivers ad ON t.Driver_Id = ad.Users_Id WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" GROUP BY Request_at
WITH all_trips_no_banned_users AS ( SELECT t.* FROM Trips t LEFT JOIN Users u ON t.Client_Id = u.Users_Id LEFT JOIN Users u2 ON t.Driver_Id = u2.Users_Id WHERE u.Banned = 'No' AND u2.Banned = 'No' ) SELECT Request_at AS Day, round(SUM(IF(Status IN ('cancelled_by_driver', 'cancelled_by_client'),1,0)) / count(Id) ,2) as "Cancellation Rate" FROM all_trips_no_banned_users WHERE Request_at <='2013-10-03' GROUP BY 1 ORDER BY 1
WITH ban_status_cte AS (SELECT T.id, T.Status, T.Request_at, C.Banned AS Client_Banned, D.Banned AS Driver_Banned FROM Trips AS T JOIN Users AS C ON T.Client_Id = C.Users_Id JOIN Users AS D ON T.Driver_Id = D.Users_Id WHERE C.Banned = 'No' AND C.Banned = 'No') SELECT Request_at AS Day, ROUND(IFNULL(SUM(CASE WHEN Status = 'cancelled_by_driver' THEN 1 WHEN Status = 'cancelled_by_client' THEN 1 ELSE 0 END)/COUNT(Status), 0), 2) AS "Cancellation Rate" FROM ban_status_cte WHERE Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at ORDER BY Request_at
WITH banned_users AS (SELECT users_id FROM users WHERE banned = 'Yes') SELECT request_at as `Day`, Round(SUM(IF(status != 'completed', 1, 0)) / Count(1), 2) as `Cancellation Rate` FROM trips WHERE client_id NOT IN (SELECT users_id FROM banned_users) AND driver_id NOT IN (SELECT users_id FROM banned_users) AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY request_at
WITH base AS (SELECT * FROM Trips WHERE Client_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND Driver_Id NOT IN (SELECT Users_Id FROM Users WHERE Banned = 'Yes') AND Request_at BETWEEN '2013-10-01' AND '2013-10-03') SELECT Request_at AS Day, ROUND((SUM(CASE WHEN Status LIKE '%cancelled%' THEN 1 ELSE 0 END)/SUM(1)),2) as "Cancellation Rate" FROM base GROUP BY 1
WITH cte AS ( SELECT * FROM Trips WHERE Client_id IN (SELECT Users_id FROM Users WHERE Banned = "No" AND Role ="client") AND Driver_Id in (SELECT Users_id FROM Users WHERE Banned = "No" AND Role ="driver") AND Request_at BETWEEN "2013-10-01" AND "2013-10-03" ) SELECT Request_at AS "day", ROUND(1 - (SUM(CASE WHEN Status = "completed" THEN 1 ELSE 0 END)/COUNT(Status)),2) AS "Cancellation Rate" FROM cte GROUP BY Request_at
WITH cte AS ( SELECT Status, Request_at Day, COUNT(Status) OVER (PARTITION BY Request_at) no_of_order, SUM(IF(Status = 'completed', 0 ,1 )) OVER (PARTITION BY Request_at) no_of_cancel FROM Trips, Users WHERE Client_Id = Users_Id And Banned = 'No') SELECT DISTINCT Day, ROUND(no_of_cancel/no_of_order, 2) "Cancellation Rate" FROM cte WHERE Day BETWEEN '2013-10-01' AND '2013-10-03'
WITH cte as (SELECT *, DENSE_RANK() OVER(PARTITION BY t.Request_at, t.status ORDER BY t.Request_at) as rank_num FROM Trips t JOIN Users u On t.Client_id = u.Users_id WHERE t.Request_at >= '2013-10-01' AND t.Request_at <= '2013-10-03' AND u.Banned = 'No' ) SELECT c1.Request_at as Day, round((SELECT COUNT(*) FROM cte c2 WHERE c2.Status<>"completed" AND c1.Request_at=c2.Request_at)/count(*),2) as "Cancellation Rate" from cte c1 group by c1.Request_at
WITH cte1 AS( SELECT t.Client_Id, t.Driver_Id, u1.Banned AS BannedClient, u2.Banned AS BannedDriver, t.Status,t.Request_at AS Day FROM Trips t LEFT JOIN Users AS u1 ON t.Client_Id = u1.Users_Id LEFT JOIN Users AS u2 ON t.Driver_ID = u2.Users_Id ) SELECT Day, ROUND(COUNT(IF(Status LIKE 'cancelled%',1,NULL)) / COUNT(Status),2) 'Cancellation Rate' FROM cte1 WHERE (BannedClient = 'No'AND BannedDriver = 'No') AND (Day BETWEEN CAST('2013-10-01' AS DATE) AND CAST('2013-10-03' AS DATE)) GROUP BY Day
WITH cte1 as ( SELECT Id, Client_Id, Driver_Id, Status , Request_at FROM Trips t LEFT JOIN Users u ON t.Client_Id = u.Users_Id LEFT JOIN Users v ON t.Driver_Id = v.Users_Id WHERE u.Banned != 'Yes' AND v.Banned != 'Yes' ) SELECT Day, ROUND(cancel/total_ride,2) AS 'Cancellation Rate' FROM ( SELECT Request_at as Day , SUM(IF(Status != 'completed',1,0)) as cancel, COUNT(Id) as total_ride FROM cte1 GROUP BY Day ) v WHERE Day BETWEEN "2013-10-01" and "2013-10-03" ORDER BY Day
WITH filtered as ( SELECT Status,Request_at FROM Trips WHERE Client_Id IN (SELECT Users_Id FROM Users WHERE Banned != 'Yes') AND Driver_Id IN (SELECT Users_Id FROM Users WHERE Banned != 'Yes') AND Request_at >= '2013-10-01' AND Request_at <= '2013-10-03' ), orders as ( SELECT COUNT(*) as sum, Request_at FROM filtered GROUP BY Request_at ), canceled as ( SELECT COUNT(*) as sum, Request_at FROM filtered WHERE Status != 'completed' GROUP BY Request_at ) SELECT orders.Request_at as Day, COALESCE(ROUND(canceled.sum/orders.sum,2), 0.00) as 'Cancellation Rate' FROM orders LEFT JOIN canceled ON orders.Request_at = canceled.Request_at
WITH t1 AS ( SELECT * FROM Trips WHERE Client_Id in (SELECT Users_Id FROM Users WHERE Banned = 'No') AND Driver_Id in (SELECT Users_Id FROM Users WHERE Banned = 'No') ), t2 AS ( SELECT Request_at AS Day, SUM(IF(Status != 'completed',1,0)) AS canceled_request_unban, COUNT(*) AS total_request_unban FROM t1 WHERE Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY Request_at ) SELECT Day, ROUND( (canceled_request_unban/total_request_unban), 2) AS "Cancellation Rate" FROM t2
WITH temp AS ( SELECT a.* , b.Banned as driver_banned FROM (SELECT t.*, u.Banned as user_banned FROM Trips t INNER JOIN Users u ON t.Client_Id = u.Users_id) as a INNER JOIN Users b ON a.Driver_ID = b.Users_ID ), filtered AS (SELECT ID , Client_id , Driver_Id , City_Id , Status , Request_at AS Day, user_banned, driver_banned FROM temp WHERE user_banned = 'No' AND driver_banned = 'No' AND Request_at BETWEEN '2013-10-01' AND '2013-10-03') SELECT Day, ROUND(SUM(CASE WHEN Status = 'completed' THEN 0 ELSE 1 END)/ COUNT(*), 2) AS "Cancellation Rate" FROM filtered GROUP BY Day
WITH tipcte as (select T.* from Trips T left join Users U1 on T.Client_Id=U1.Users_id left join Users U2 on T.Client_Id=U2.Users_id where U1.Banned='No' and u2.Banned='No') select Request_at as 'Day',Round(count(case when status <> 'completed'then id end)/count(*) ,2)as 'Cancellation Rate' from tipcte group by request_at having Request_at between '2013-10-01' and '2013-10-03'
WITH total AS ( SELECT count(*) as cnt, Request_at as Day FROM Trips t JOIN Users uc ON uc.Users_id = t.Client_id JOIN Users ud ON ud.Users_id = t.Driver_Id WHERE uc.Banned = 'No' and ud.Banned = 'No' and Request_at < '2013-10-04' and Request_at >= '2013-10-01' GROUP BY Request_at ), canceled AS ( SELECT Request_at as Day, count(*) as cnt FROM Trips t JOIN Users uc ON uc.Users_id = t.Client_id JOIN Users ud ON ud.Users_id = t.Driver_Id WHERE uc.Banned = 'No' and ud.Banned = 'No' and t.Status like 'cancelled_by_%' and Request_at < '2013-10-04' and Request_at >= '2013-10-01' GROUP BY Request_at ) SELECT t.Day, round(coalesce(c.cnt, 0) / t.cnt, 2) as "Cancellation Rate" FROM total t LEFT JOIN canceled c ON t.Day = c.Day
WITH unbanned AS ( SELECT * FROM Users WHERE Banned = 'No' ), spes_date AS ( SELECT * FROM Trips WHERE Request_at BETWEEN "2013-10-01" AND "2013-10-03" ), unbanned_status AS ( SELECT Status, Request_at FROM spes_date WHERE Driver_Id IN (SELECT Users_Id FROM unbanned WHERE Role = 'driver') AND Client_Id IN (SELECT Users_Id FROM unbanned WHERE Role = 'client') ) SELECT Request_at AS Day, ROUND(Canceled / Total, 2) AS "Cancellation Rate" FROM (SELECT Request_at, COUNT(Status) AS Total, (SELECT COUNT(Status) FROM unbanned_status p2 WHERE p2.Request_at = p1.Request_at AND Status LIKE "%cancelled%") AS Canceled FROM unbanned_status p1 GROUP BY Request_at) AS sub
WITH unbanned AS ( SELECT * FROM Users WHERE Banned = 'No' ), unbanned_status AS ( SELECT Status, Request_at FROM Trips WHERE Driver_Id IN (SELECT Users_Id FROM unbanned WHERE Role = 'driver') AND Client_Id IN (SELECT Users_Id FROM unbanned WHERE Role = 'client') AND (Request_at BETWEEN "2013-10-01" AND "2013-10-03") ) SELECT Request_at AS Day, ROUND(Canceled / Total, 2) AS "Cancellation Rate" FROM (SELECT Request_at, COUNT(Status) AS Total, (SELECT COUNT(Status) FROM unbanned_status p2 WHERE p2.Request_at = p1.Request_at AND Status LIKE "%cancelled%") AS Canceled FROM unbanned_status p1 GROUP BY Request_at) AS sub
WITH unbanned AS ( SELECT DISTINcT Users_Id FROM Users WHERE Banned = 'No' ) SELECT Request_at as `Day`, ROUND( COUNT( DISTINCT CASE WHEN Status <> 'completed' THEN ID ELSE NULL END) / COUNT(DISTINCT ID),2) as `cancellation rate` FROM TRIPS WHERE Request_at BETWEEN '2013-10-01' AND '2013-10-03' AND Driver_ID IN (SELECT Users_id from unbanned) AND Client_ID IN (SELECT USERS_ID FROM unbanned) GROUP BY Request_At
WITH unbanned AS ( SELECT Users_id, Role FROM Users WHERE Banned ="No" ) SELECT Request_at as Day, ROUND(SUM(CASE WHEN Status Like 'cancelled%' THEN 1 ELSE 0 END) / COUNT(1),2) AS `Cancellation Rate` FROM Trips t WHERE Request_at BETWEEN '2013-10-01' AND '2013-10-03'AND EXISTS (select TRUE FROM unbanned u WHERE t.Client_Id = u.Users_Id) AND EXISTS (select True FROM unbanned u WHERE t.Driver_Id = u.Users_ID) GROUP BY Request_at
WITH unbanned_users AS ( SELECT a.* FROM Trips as a LEFT JOIN Users as b on a.Client_Id = b.Users_Id AND b.role = "Client" LEFT JOIN Users as c on a.Driver_Id = c.Users_Id AND c.role = "Driver" WHERE b.banned = 'No' and c.banned = 'No' ) SELECT Request_at as Day, ROUND(sum(CASE WHEN Status like "cancelled%" THEN 1 ELSE 0 END)/count(*), 2) as `Cancellation Rate` FROM unbanned_users WHERE Request_at between '2013-10-01' and '2013-10-03' GROUP BY Request_at
WITH valid_trips AS ( SELECT status = 'completed' as completed, request_at as Day FROM trips INNER JOIN users AS clients ON (trips.client_id = clients.users_id) INNER JOIN users AS drivers ON (trips.driver_id = drivers.users_id) WHERE ( clients.banned = 'No' AND drivers.banned = 'No' AND trips.request_at >= '2013-10-01' AND trips.request_at <= '2013-10-03' ) ) SELECT Day, ROUND(1 - AVG(completed), 2) as 'Cancellation Rate' from valid_trips GROUP BY Day
With A as (select users_id from users where banned="No" ) , B as ( select * from trips where client_id in ( select * from A)and driver_id in ( select * from A)) , C as (select request_at as request_at1, count(request_at) as cnt1 from B where status="cancelled_by_driver" or status="cancelled_by_client" group by request_at) , D as (select request_at , count(*)as cnt from B group by request_at ) Select D.request_at as Day ,round(ifnull(C.cnt1/D.cnt,0),2) as "cancellation rate" from D left join C on D.request_at=C.request_at1 where D.request_at between "2013-10-01" and "2013-10-03"
With CTE AS ( Select A.* , Case When A. Status <> "completed" then 1 else 0 End AS IS_Cancelled From Trips A Join Users B On A.Client_Id = B.Users_Id Join Users C On A.Driver_Id = C.Users_Id Where B.Banned <>"Yes" AND C.Banned <>"Yes" AND Request_at BETWEEN '2013-10-01' and '2013-10-03' ) Select Cancelled_Trips.Request_at AS Day, ROUND(Cancelled_Trips.CancelledTrips /Cancelled_Trips.TT ,2) AS 'Cancellation Rate' From (Select Request_at,SUM(IS_Cancelled) AS CancelledTrips,Count(*) AS TT From CTE Group BY Request_at) AS Cancelled_Trips Order by Cancelled_Trips.Request_at
With Unbanned AS( SELECT Trips.* FROM Trips JOIN Users u1 ON Trips.Client_id = u1.Users_Id JOIN Users u2 ON Trips.Client_id = u2.Users_Id WHERE u1.Banned = "No" AND u2.Banned = "No" AND Trips.Request_at between '2013-10-01' and '2013-10-03' ) SELECT Request_at AS Day, ROUND(1.0 * COUNT(CASE WHEN Status !='completed' THEN 1 END)/COUNT(*) , 2) AS 'Cancellation Rate' FROM Unbanned GROUP BY Request_at
With ct1 AS ( SELECT Request_at,CASE WHEN status = 'completed' then 0 else 1 end can,count(1) over(partition by Request_at) tot from Trips t INNER JOIN Users U1 ON t.Client_id = U1.users_id and U1.banned ='No' INNER JOIN Users U2 ON t.Driver_Id = U2.users_id and U2.banned ='No' ) Select Request_at Day,round(sum(can)/avg(tot ),2) "Cancellation Rate" from ct1 group by Request_at having Request_at between "2013-10-01" and "2013-10-03"
With cte1 as ( select Request_at as Day, Count(*) as day_count from Trips t join Users c on t.Client_Id=c.Users_id and c.Role='Client' and c.Banned='No' join Users d on t.Driver_Id=d.Users_id and d.Role='Driver' and d.Banned='No' where Request_at between '2013-10-01' and '2013-10-03' Group by 1 ) , cte2 as ( select Request_at as Day, Count(*) as day_count from Trips t join Users c on t.Client_Id=c.Users_id and c.Role='Client' and c.Banned='No' join Users d on t.Driver_Id=d.Users_id and d.Role='Driver' and d.Banned='No' where Request_at between '2013-10-01' and '2013-10-03' and t.Status in ('cancelled_by_driver','cancelled_by_client') Group by 1 ) select t.Request_at as Day, ifnull(round(cte2.day_count/cte1.day_count,2),0) as `Cancellation Rate` from Trips t left join cte1 on t.Request_at=cte1.Day left join cte2 on t.Request_at=cte2.Day where Request_at between '2013-10-01' and '2013-10-03' group by 1
With filter as (Select * From Trips Where Client_Id In (Select Users_Id From Users Where Banned = "No") and Driver_Id In (Select Users_Id From Users Where Banned = "No") and Request_at between "2013-10-01" and "2013-10-03") Select f.Request_at as Day, round(ifnull(cancel_count,0)/count(*),2) as "Cancellation Rate" From filter f left join (Select Request_at, count(*) as cancel_count From filter Where Status = "cancelled_by_driver" or Status = "cancelled_by_client" Group by Request_at) t On f.Request_at = t.Request_at Group by f.Request_at
With stg1 as ( select t.*, u1.banned as client_banned, u2.banned as driver_banned from trips t left join users u1 on (t.client_id = u1.users_id and u1.role = 'client') left join users u2 on (t.driver_id = u2.users_id and u2.role = 'driver') where u1.banned = 'No' and u2.banned = 'No' and t.request_at between '2013-10-01' and '2013-10-03' ) select request_at as Day, round(cast(sum(case when status != 'completed' then 1 else 0 end) as float)/count(*), 2) as "Cancellation Rate" from stg1 group by request_at order by request_at
With temp as (select t.* from Trips t inner join (select * from Users where Role = 'client') c on c.Users_Id = t.Client_ID inner join (select * from Users where Role='driver') d on t.Driver_Id = d.Users_id where c.Banned = 'NO' and d.Banned = 'No'), temp2 as (select t.*, case when Status in('cancelled_by_driver','cancelled_by_client') then 1 when Status in('completed') then 0 end as is_cancelled from temp t) select Request_at as day, round(sum(is_cancelled)/count(is_cancelled),2) `Cancellation Rate` from temp2 where Request_at >=date('2013-10-01') and Request_at<=date('2013-10-03')group by Request_at
With users as (select distinct Users_id from Users where Banned = 'Yes'), sai as (select Request_at, count(case when (Client_Id not in (select Users_id from Users)) and (driver_id not in (select Users_id from Users)) then 1 end) as count_unbanned_rides, count(case when (Client_Id not in (select Users_id from Users)) and (driver_id not in (select Users_id from Users)) and (Trips.Status like "%cancelled%") then 1 end) as cancelled_trips from Trips where request_at between "2013-10-01" and "2013-10-03" group by Request_at) select Request_at as Day, round(cancelled_trips/count_unbanned_rides,2) as "Cancellation Rate" from sai
select A.Day, round(A.canceled_number / A.total_number, 2) as 'Cancellation Rate' from (select count(case when (Users.Banned = 'No') then Users.Users_Id else null end) as total_number, count(case when (Trips.Status in ('cancelled_by_driver', 'cancelled_by_client')) and (Users.Banned = 'No') then Trips.Client_Id else null end) as canceled_number, Trips.Request_at as Day from Trips join Users on Trips.Client_Id = Users.Users_Id where Trips.Request_at between date('2013-10-01') and date('2013-10-03') group by Trips.Request_at ) as A
select BIGN.request_at as 'Day', case when n/bign is NULL then 0.00 else round(n/bign,2) end as 'Cancellation Rate' from (select count(distinct id) as n , request_at from (select cl.* from (select a.* from trips a join users b on a.client_id=b.users_id where b.banned = 'No' and b.role='client') as cl join users d on cl.driver_id=d.users_id where d.banned = 'No' and d.role='driver') as allr where Status != 'completed' group by request_at ) as cancel right join (select count(distinct id) as bign , request_at from (select cl.* from (select a.* from trips a join users b on a.client_id=b.users_id where b.banned = 'No' and b.role='client') as cl join users d on cl.driver_id=d.users_id where d.banned = 'No' and d.role='driver' and cl.request_at in ('2013-10-01','2013-10-02','2013-10-03')) as allr group by request_at) as bign on cancel.request_at=bign.request_at
select DISTINCT a.request_at as day, ROUND(SUM(a.canc) over(partition by a.request_at) / COUNT(*) over(partition by a.request_at),2) as "cancellation rate" from ( select request_at,CASE WHEN status like 'cancelled%' THEN 1 else 0 end as canc from trips t join users u on t.client_id = u.users_id and u.banned!= 'Yes' and t.request_at between "2013-10-01" and "2013-10-03" join users d on t.driver_id = d.users_id and d.banned!='Yes' and t.request_at between "2013-10-01" and "2013-10-03" ) a order by 1
select Day, cast(FORMAT(canceled_count * 1.0 / total , 2) as decimal(10, 2)) as 'Cancellation Rate' from ( select a.Request_at as Day, sum(1) as total, sum(case when a.Status='completed' then 0 else 1 end) as canceled_count from Trips a left join Users b on a.Client_Id = b.Users_Id left join Users c on a.Driver_Id=c.Users_id where b.Banned='No' and c.Banned='No' and a.Request_at >= '2013-10-01' and a.Request_at <= '2013-10-03' group by a.Request_at) tmp
select Day, cast(round(sum(is_cancelled)*1.0/count(is_cancelled), 2) as float) as 'Cancellation Rate' From ( select Client_Id, Driver_Id, status, Request_at as Day, case when status like '%cancelled%' then 1 else 0 end as is_cancelled from Trips t where Request_at between '2013-10-01'and'2013-10-03' And Client_Id not in (select Users_Id from Users where Banned ='Yes') And Driver_Id not in (select Users_Id from Users where Banned = "Yes") ) sub group by Day order by Day
select Day, round(s,2) as "Cancellation Rate" from (select request_at as Day, count(case when Status in ("cancelled_by_driver","cancelled_by_client")then 1 end) over(partition by request_at)/count(*) over(partition by request_at)as s from trips as t join users u on t.client_id=u.users_id and u.banned="No" join users s on t.driver_id=s.users_id and s.banned='No' where request_at<= "2013-10-03") a group by 1
select Day, round(sum(is_cancelled)/count(is_cancelled), 2) as 'Cancellation Rate' From ( select Client_Id, Driver_Id, status, Request_at as Day, case when status like '%cancelled%' then 1 else 0 end as is_cancelled from Trips t where Request_at between '2013-10-01'and'2013-10-03' And Client_Id not in (select Users_Id from Users where Banned ='Yes') And Driver_Id not in (select Users_Id from Users where Banned = "Yes") ) sub group by Day order by Day
select RequestSum.Request_at as Day, round((RequestSum.Request - CompleteSum.Complete)/RequestSum.Request,2) as "Cancellation Rate" from ( select Trips.Request_at, count(*) as Request from Trips, Users as Client, Users as Driver where Trips.Client_Id = Client.Users_Id and Trips.Client_Id = Driver.Users_Id and Client.Banned = 'No' and Driver.Banned = 'No' group by Trips.Request_at ) as RequestSum, ( select Days.Request_at,coalesce(Complete,0) as Complete from ( select Request_at from Trips group by Request_at ) as Days left join ( select Trips.Request_at, count(*) as Complete from Trips, Users as Client, Users as Driver where Trips.Client_Id = Client.Users_Id and Trips.Client_Id = Driver.Users_Id and Client.Banned = 'No' and Driver.Banned = 'No' and Trips.Status = 'completed' group by Trips.Request_at ) as CompCnt on Days.Request_at = CompCnt.Request_at ) as CompleteSum where RequestSum.Request_at = CompleteSum.Request_at and RequestSum.Request_at between '2013-10-01' and '2013-10-03'
select Request_at Day, round(avg(case when Status = 'completed' then 0 else 1 end), 2) as 'Cancellation Rate' from Trips where Client_Id not in (select Users_id from Users where Banned = 'Yes') and Driver_Id not in (select Users_id from Users where Banned = 'Yes') and Request_at between '2013-10-01' and '2013-10-03' group by 1 order by 1
select Request_at as "Day", round(sum( case when Status = 'completed' then 0 else 1 end ) /count(Id), 2) as "Cancellation Rate" from TRIPS where Client_Id in (select Users_Id from USERS where Banned = 'No') and Driver_Id in (select Users_Id from USERS where Banned = 'No') and Request_at between '2013-10-01' and '2013-10-03' group by Request_at
select Request_at as 'Day', ROUND(COUNT(CASE WHEN status LIKE 'cancelled%' THEN 1 END) / COUNT(*), 2) AS 'Cancellation Rate' from Trips left join Users U1 on Trips.Client_Id = U1.Users_Id left join Users U2 on Trips.Driver_Id = U2.Users_Id where U1.Banned = 'No' and U2.Banned = 'No' and Request_at BETWEEN '2013-10-01' AND '2013-10-03' group by Request_at order by Request_at asc
select Request_at as 'Day', round(sum(case when Status != 'completed' then 1 else 0 end)/count(*), 2) as 'Cancellation Rate' from Trips left join Users U1 on Trips.Client_Id = U1.Users_Id left join Users U2 on Trips.Driver_Id = U2.Users_Id where U1.Banned = 'No' and U2.Banned = 'No' and Request_at BETWEEN '2013-10-01' AND '2013-10-03' group by Request_at order by Request_at asc
select Request_at as 'Day', round(sum(count_can)/count(distinct Id),2) as 'Cancellation Rate' from ( select distinct Id ,Trips.Request_at, case when Trips.Status in('cancelled_by_driver','cancelled_by_client') then 1 else 0 end as count_can from Trips inner join Users on Trips.Client_Id= Users.Users_Id inner join Users as u2 on Trips.Driver_Id = u2.Users_Id where Users.Banned='No' and u2.Banned = 'No' and Trips.Request_at between "2013-10-01" and "2013-10-03" )as total group by Request_at
select Request_at as Day ,round( ((select count(Id) from Trips t1 inner join Users u1 on (t1.Client_Id = u1.Users_Id) inner join Users u2 on (t1.Driver_Id = u2.Users_Id) where ( (t1.Status <> 'completed') and (u1.Banned = 'No') and (u2.Banned = 'No') and (t1.Request_at = t2.Request_at) ) ) / count(Id) ) ,2) as "Cancellation Rate" from Trips as t2 inner join Users u3 on (t2.Client_Id = u3.Users_Id) inner join Users u4 on (t2.Driver_Id = u4.Users_Id) where ( (t2.Request_at >= "2013-10-01") and (t2.Request_at <= "2013-10-03") and (u3.Banned = 'No') and (u4.Banned = 'No') ) group by t2.Request_at order by t2.Request_at asc
select Request_at as Day, ROUND(SUM(CASE WHEN Status <> 'completed' THEN 1 ELSE 0 END)/count(*), 2) as 'Cancellation Rate' from Trips where Request_at >= '2013-10-01' and Request_at <= '2013-10-03' and Client_Id not in (select Users_Id from Users where Banned = 'Yes') and Driver_Id not in (select Users_Id from Users where Banned = 'Yes') group by Request_at
select Request_at as Day, round ( sum(if(status <> 'completed',case when ID is Null then 0 else 1 end,0))/count(ID),2 ) as 'Cancellation Rate' from Trips left join Users on Client_ID = Users_Id and request_at between "2013-10-01" and "2013-10-03" where Banned = 'No' group by 1
select Request_at as Day, round( case count(Id) when 0 then 0 else sum(Status != 'completed') / count(Id) end, 2) as 'Cancellation Rate' from Trips as t inner join Users as u1 on t.Client_Id = u1.Users_Id inner join Users as u2 on t.Driver_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' and Request_at >= '2013-10-01' and Request_at <= '2013-10-03' group by Request_at
select Request_at as Day, round(SUM(case when t.Status LIKE "cancelled_%" then 1 else 0 end)/count(Id),2) as "Cancellation Rate" from Trips as t inner join users as cu on t.Client_id = cu.Users_id and t.Request_at BETWEEN '2013-10-01' and '2013-10-03' and cu.Banned = 'No' inner join users as du on t.Driver_id = du.Users_id and du.Banned = 'No' group by Request_at ORDER BY Request_at
select Request_at as Day, round(count(Status != 'completed' OR NULL) / count(*),2) as 'Cancellation Rate' from trips t join users u on Client_Id=u.Users_Id where banned='No'and Request_at between "2013-10-01" and "2013-10-03" group by Request_at
select Request_at as Day, round(count(if(Status<>'completed',1,null)) / count(*), 2) as 'Cancellation Rate' from Trips where Request_at between "2013-10-01" and "2013-10-03" and Client_Id in (select Users_Id from Users where Banned='No') and Driver_Id in (select Users_Id from Users where Banned='No') group by Request_at
select Request_at as Day, round(count(if(status != 'completed', True, null))/count(Id), 2) as "Cancellation Rate" from Trips Where Client_id not in (select Users_id from Users where Banned = 'Yes') And Driver_id not in (select Users_id from Users where Banned = 'Yes') And Request_at >= "2013-10-01" And Request_at <= "2013-10-03" group by Request_at
select Request_at as Day, round(sum( case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 when Status in ('completed') then 0 end)/count(case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 when Status in ('completed') then 0 end),2) as "Cancellation Rate" from Trips t where t.Client_ID in (select Users_ID from Users where Banned='No') and t.Driver_ID in (select Users_ID from Users where Banned='No') and Request_at <'2013-10-04' group by Request_at
select Request_at as Day, round(sum( case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 when Status in ('completed') then 0 end)/count(case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 when Status in ('completed') then 0 end),2) as "Cancellation Rate" from Trips t where t.Client_ID in (select Users_ID from Users where Banned='No') and t.Driver_ID in (select Users_ID from Users where Banned='No') and Request_at<'2013-10-04' group by Request_at
select Request_at as Day, round(sum(cancellation_flag) / count(cancellation_flag), 2) as "Cancellation Rate" from( select Client_Id, Driver_Id, t.Request_at, case when t.Status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end as cancellation_flag from Trips t left join Users u1 on u1.Users_Id = t.Client_Id left join Users u2 on u2.Users_Id = t.Driver_Id where u1.Banned = 'No' and u2.Banned = 'No' and u1.Role in ('client', 'driver')) a where Request_at between '2013-10-01' and '2013-10-03' group by Request_at
select Request_at as Day, round(sum(cancelled)/count(Request_at),2) as `Cancellation Rate` from ( select t.Request_at, case when t.status != 'completed' then 1 else 0 end as cancelled from trips t inner join users c on c.users_id = t.client_id and c.banned ='No' inner join users d on d.users_id = t.driver_id and d.banned='No' where Request_at BETWEEN '2013-10-01' AND '2013-10-03') a group by Request_at
select Request_at as Day, round(sum(case status when 'completed' then 0 else 1 end)/count(*), 2) as "Cancellation Rate" from Trips left join Users u1 on Trips.Client_Id = u1.Users_Id left join Users u2 on Trips.Driver_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' and Request_at between "2013-10-01" and "2013-10-03" group by Day order by Day
select Request_at as Day, round(sum(case when Status != 'completed' then 1 else 0 end)/count(Id), 2) as 'Cancellation Rate' from Trips a join Users b on a.Client_Id = b.Users_id and b.Banned='No' where Request_at between "2013-10-01" and "2013-10-03" group by 1
select Request_at as Day, round(sum(case when Status <> 'completed' then 1 else 0 end) / count(*), 2) as `Cancellation Rate` from (select t.* from Users u1 right join Trips t on t.Client_Id = u1.Users_Id left join Users u2 on t.Driver_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' and Request_at >= '2013-10-01' and Request_at <= '2013-10-03')unbanned_t group by Request_at
select Request_at as Day, round(sum(case when Status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end)/count(*), 2) as "Cancellation Rate" from (select *, (case when Driver_Id in (select distinct(Users_Id) from Users where Banned='Yes') then 1 when Client_Id in (select distinct(Users_Id) from Users where Banned='Yes') then 1 else 0 end) as i_exclude from Trips where Request_at between "2013-10-01" and "2013-10-03") as main_table where i_exclude = 0 group by 1 order by 1
select Request_at as Day, round(sum(case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 else 0 end)/count(*),2) as "Cancellation Rate" from Trips a inner join Users b on a.Client_Id =b.Users_Id and b.Banned ='No' inner join Users c on a.Driver_Id =c.Users_Id and c.Banned ='No' where Request_at between "2013-10-01" and "2013-10-03" group by Request_at
select Request_at as Day, round(sum(case when Status in ('cancelled_by_driver','cancelled_by_client') then 1 else 0 end)/count(Id),2) as "Cancellation Rate" from Trips where Client_id not in (select Users_Id from Users where Banned in ("Yes")) and Driver_id not in (select Users_id from Users where Banned in ("Yes")) and Request_at between "2013-10-01" and "2013-10-03" group by 1
select Request_at as Day, round(sum(case when Trips.Status IN ('cancelled_by_driver','cancelled_by_client') then 1 else 0 end )/count(Id),2) as 'Cancellation Rate' from Trips inner join users cust on (cust.Users_Id=Trips.Client_Id) inner join users driver on (driver.Users_Id=Trips.Driver_Id) where cust.Banned='No' and driver.Banned='No' and Request_at between '2013-10-01' and '2013-10-03' group by Request_at
select Request_at as Day, round(sum(case when status ='completed' then 0 else 1 end)/count(id),2) as `Cancellation Rate` from trips where Request_at between '2013-10-01' and '2013-10-03' and client_id in (select users_id from users where banned = 'No') and driver_id in (select users_id from users where banned = 'No') group by Request_at
select Request_at as Day, round(sum(case when status="cancelled_by_driver" or status="cancelled_by_client" then 1 else 0 end)/count(*),2) as "Cancellation Rate" from Trips where request_at between "2013-10-01" and "2013-10-03" and client_id in (select users_id from users where banned="No") and driver_id in (select users_id from users where banned="No") group by 1
select Request_at as Day, round(sum(if(Status != 'completed', 1, 0)) / count(*), 2) as 'Cancellation Rate' from Trips where (Request_at between '2013-10-01' and '2013-10-03') and Client_Id not in (select Users_Id from Users where Banned = 'Yes') and Driver_Id not in (select Users_Id from Users where Banned = 'Yes') group by Request_at
select Request_at as Day, round(sum(if(status <> 'completed',case when ID is Null then 0 else 1 end,0)) / sum(case when ID is Null then 0 else 1 end),2) as 'Cancellation Rate' from Trips left join Users on Client_ID = Users_Id where Banned = 'No' and request_at between "2013-10-01" and "2013-10-03" group by 1
select Request_at as Day, round(sum(if(status like 'cancel%', 1, 0)) / sum(1), 2) as "Cancellation Rate" from Trips left join Users client on Trips.Client_Id = client.Users_Id left join Users driver on Trips.Driver_Id = driver.Users_Id where Request_at between '2013-10-01' and '2013-10-03' and client.Banned = 'No' and driver.Banned = 'No' group by 1 order by 1
select Request_at as day, round(sum(case when T.Status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end) / count(T.id), 2) as "Cancellation Rate" from Trips as T inner join Users as U1 on T.Client_Id = U1.Users_Id inner join Users as U2 on T.Driver_Id = U2.Users_Id where U1.Banned = 'No' and U2.Banned = 'No' and Request_at between "2013-10-01" and "2013-10-03" group by Request_at
select Request_at as day, round(sum(case when status in ('cancelled_by_driver','cancelled_by_client') then 1 else 0 end)/count(*),2) as 'Cancellation Rate' from Trips where Client_Id not in (select Users_Id from Users where Banned='Yes') and Driver_Id not in (select Users_Id from Users where Banned='Yes') and Request_at between "2013-10-01" and "2013-10-03" group by Request_at
select Request_at as day, round(sum(case when t.Status="completed" then 0 else 1 end) / count(t.Status), 2) as "Cancellation Rate" from Trips as t inner join users as u1 on u1.Users_Id=t.Client_Id and u1.Banned = "No" and t.Request_at BETWEEN '2013-10-01'AND '2013-10-03' inner join users as u2 on u2.Users_Id=t.Driver_Id and u2.Banned = "No" and t.Request_at BETWEEN '2013-10-01'AND '2013-10-03' group by Request_at
select T.Request_at AS Day, ROUND(SUM(T.Status != "completed")/count(*), 2) AS "Cancellation Rate" from Trips as T JOIN Users AS U1 ON T.Client_Id = U1.Users_Id and U1.Banned = "No" JOIN Users AS U2 ON T.Driver_Id = U2.Users_Id and U2.Banned = "No" where T.Request_at between "2013-10-01" and "2013-10-03" group by T.Request_at
select T.Request_at Day, Round(T.can_count / T.tot_count, 2) as 'Cancellation Rate' from (select count(case t.Status when 'completed' then null else 1 end) as can_count, count(*) as tot_count, t.Request_at from Trips t join Users u1 on (t.Client_Id = u1.Users_Id) and (u1.Banned = 'No') join Users u2 on (t.Driver_Id = u2.Users_Id) and (u2.Banned = 'No') group by t.Request_at having t.Request_at between '2013-10-01' AND '2013-10-03') T
select T.Request_at as Day, ROUND(SUM( CASE WHEN T.Status Like 'Cancelled%' THEN 1 ELSE 0 END)/COUNT(T.Status),2) as "Cancellation Rate" from Trips T , Users U where (T.Request_at between "2013-10-01" and "2013-10-03") and T.Client_Id = U.Users_Id and U.Banned = 'No' group by T.Request_at
select a.Request_at as Day, round(count(case when a.status!='completed' then a.id end) / count(*),2) as "Cancellation Rate" from Trips a join Users b on a.Client_Id=b.Users_Id join Users c on a.Driver_id=c.Users_id where a.Request_at between "2013-10-01" and "2013-10-03" and b.Banned='No' and c.Banned='No' group by a.Request_at
select a.Request_at as Day, round(sum(IF(a.Status='completed',0,1)) / count(a.Id),2) as `Cancellation Rate` from Trips a join Users b on a.Client_Id = b.Users_Id and b.Banned = 'No' join Users c on a.Driver_Id = c.Users_Id and c.Banned = 'No' where a.Request_at between '2013-10-01' and '2013-10-03' group by a.Request_at
select a.request_at as Day , round(count(distinct(case when a.Status != 'completed' then a.id else null end)) / count(distinct a.id), 2) as 'Cancellation Rate' from trips a inner join (select * from users where banned = 'No' and Role in ('client')) b on a.client_id = b.users_id inner join (select * from users where banned = 'No' and Role in ('driver')) c on a.driver_id = c.users_id where a.request_at between '2013-10-01' and '2013-10-03' group by request_at
select a.request_at as Day, round(ifnull(b.cancelled_trips,0)/a.all_trips,2) as "Cancellation Rate" from (select request_at, count(*) as all_trips from trips where client_id in (select users_id from users where banned='No') and driver_id in (select users_id from users where banned='No') and request_at >= '2013-10-01' and request_at <= '2013-10-03' group by request_at) a left join (select request_at, count(*) as cancelled_trips from trips where client_id in (select users_id from users where banned='No') and driver_id in (select users_id from users where banned='No') and status in ('cancelled_by_driver','cancelled_by_client') group by request_at) b on a.request_at = b.request_at
select a.request_at as Day, round(sum(case when a.status='cancelled_by_client' or a.status='cancelled_by_driver' then 1 else 0 end)/count(distinct a.id),2) as 'Cancellation Rate' from Trips a inner join Users b on a.Client_Id=b.Users_id and b.Role='client' and b.Banned='No' inner join Users c on a.Driver_Id=c.Users_Id and c.Role='driver' and c.Banned='No' where a.request_at between '2013-10-01' and '2013-10-03' group by 1
select a.request_at as Day,round(a.zozo/b.total,2) as 'Cancellation Rate' from (select request_at,sum(case when status like 'cancelled%' then 1 else 0 end) as zozo from trips t join users u on t.client_id=u.users_id join users us on t.driver_id=us.users_id where u.banned='NO' and us.banned='NO' and request_at between '2013-10-01' and '2013-10-03' group by request_at) a join (select request_at,count(request_at) as total from trips t join users u on t.client_id=u.users_id join users us on t.driver_id=us.users_id where u.banned='NO' and us.banned='NO' and request_at between '2013-10-01' and '2013-10-03' group by request_at) b on a.request_at=b.request_at
select anon_3.request_at as 'Day', round((sum(case when anon_3.status = 'completed' then 0 else anon_3.trip_cnt end)/sum(anon_3.trip_cnt)), 2) as 'Cancellation Rate' from ( select anon_2.status, anon_2.request_at, count(*) as trip_cnt from ( select anon_1.status, anon_1.request_at from ( select t.id, t.status, t.request_at from trips t join users u on t.client_id = u.users_id where t.request_at between cast('2013-10-01' as date) and cast('2013-10-03' as date) and u.banned = 'No' union all select t.id, t.status, t.request_at from trips t join users u on t.driver_id = u.users_id where t.request_at between cast('2013-10-01' as date) and cast('2013-10-03' as date) and u.banned = 'No' ) anon_1 group by anon_1.id, anon_1.status, anon_1.request_at having count(*) > 1 ) anon_2 group by anon_2.status, anon_2.request_at ) anon_3 group by anon_3.request_at
select b.request_at Day, round(sum(case when status like 'cancelled%' then 1 else 0 end)/count(*), 2) 'Cancellation Rate' from users a , trips b where a.banned = 'No' and a.users_id = b.client_id and b.request_at >= '2013-10-01' and b.request_at <= '2013-10-03' group by b.request_at
select cast(Request_at as date) as Day ,round(cast(count(case when t.status != 'Completed' then id else NULL end) as decimal(2))/ count(ID),2) as 'Cancellation Rate' FROM trips t INNER JOIN users d ON t.driver_id = d.Users_Id and d.banned = 'No' INNER JOIN users u ON t.Client_Id = u.Users_Id and u.banned = 'No' WHERE CAST(Request_at as date) between '2013-10-01' and '2013-10-03' GROUP BY cast(request_at as date)
select distinct t.request_at as Day,cast(cast(sum(case when status like 'cancelled%' then 1 else 0 end) over (partition by request_at) as decimal(10,2))/ cast(count(request_at) over (partition by request_at) as decimal(10,2)) as decimal(10,2)) as "Cancellation Rate" from Trips t left outer join Users c on t.client_id=c.users_id left outer join users d on t.driver_id=d.users_id where (c.Banned = 'No' and d.banned ='No') and request_at between '2013-10-01' and '2013-10-03'
select distinct t.request_at as Day,cast(count(case when status like 'cancelled%' then status else null end) over (partition by request_at)/ cast(count(request_at) over (partition by request_at) as decimal(10,2)) as decimal(10,2)) as "Cancellation Rate" from Trips t left outer join Users c on t.client_id=c.users_id left outer join users d on t.driver_id=d.users_id where (c.Banned = 'No' and d.banned ='No') and request_at between '2013-10-01' and '2013-10-03'
select distinct t.request_at as Day,cast(sum(case when status like 'cancelled%' then 1 else 0 end) over (partition by request_at)/ cast(count(request_at) over (partition by request_at) as decimal(10,2)) as decimal(10,2)) as "Cancellation Rate" from Trips t left outer join Users c on t.client_id=c.users_id left outer join users d on t.driver_id=d.users_id where (c.Banned = 'No' and d.banned ='No') and request_at between '2013-10-01' and '2013-10-03'
select request_at "Day", round(sum(case when status like '%cancelled%' then 1 else 0 end)/(count(*)*1.0),2) "Cancellation Rate" from trips tr left join users u on tr.client_id = u.users_id where banned = 'No' and request_at >= '2013-10-01' and request_at <= '2013-10-03' group by request_at
select request_at as "Day", round(sum(case when status like 'cancelled%' then 1 else 0 end)/ count(*),2) as "Cancellation Rate" from trips where id in ( select t.id from trips t join users c on t.client_id = c.users_id join users d on t.driver_id = d.users_id where request_at between '2013-10-01' and '2013-10-03' and c.banned = 'No' and d.banned = 'No') group by 1
select request_at as 'Day', Round((sum(case when status <> 'completed' then 1 else 0 end)/count(*) ), 2) as 'Cancellation Rate' from trips where client_id not in (select users_id from Users where Banned = 'Yes') and request_at >= "2013-10-01" and request_at <="2013-10-03" group by request_at
select request_at as 'Day', round(cancel/total,2) as 'Cancellation Rate' from( select request_at, count(*) as total, sum(case when status ='completed' then 0 else 1 end) as cancel from trips inner join users u1 on client_id = u1.users_id inner join users u2 on driver_id = u2.users_id where u1.banned = 'No' and u2.banned = 'No' group by request_at ) sub where request_at between '2013-10-01' and '2013-10-03'
select request_at as 'day', round(sum(case when status like 'cancel%' then 1 else 0 end)/count(*),2) as 'cancellation rate' from( select id, status, request_at from trips t left join users a on t.client_id = a.users_id left join users b on t.driver_id = b.users_id where a.banned = 'No' and b.banned = 'No' and request_at between '2013-10-01' and '2013-10-03')sub1 group by 1
select request_at as Day , round(sum(case when status != 'completed' then 1 else 0 end) *1.0 / sum(1), 2) as "Cancellation Rate" from trips as t where request_at between '2013-10-01' and "2013-10-03" and t.client_id not in (select users_id from users where banned = 'Yes' and role = 'client') and t.driver_id not in (select users_id from users where banned = 'Yes' and role = 'driver') group by request_at
select request_at as Day , round(sum(case when status like "cancelled%" then 1 else 0 end) / count(*), 2) as `Cancellation Rate` from trips t where client_id in (select users_id from Users where banned = "No" and role = "client" group by 1) and Driver_Id in (select users_id from Users where banned = "No" and role = "driver" group by 1) and request_at between "2013-10-01" and "2013-10-03" group by 1
select request_at as Day, cast(cast(canceled as decimal(9,2))/cast(total as decimal(9.2)) as decimal(9,2)) as "Cancellation Rate" from ( select request_at, sum(case when status = 'completed' then 0 else 1 end) as canceled, count(*) as total from trips inner join users client on trips.client_id = client.users_id inner join users driver on trips.driver_id = driver.users_id where client.banned = 'No' and driver.banned = 'No' and request_at between '2013-10-01' and '2013-10-03' group by 1) a
select request_at as Day, round ( sum(case when status='cancelled_by_driver' then 1 when status='cancelled_by_client' then 1 else 0 end)/ ( count(*) ),2) as 'Cancellation Rate' from Trips t join users u1 on t.client_id= u1.users_id and u1.banned='No' join users u2 on u2.users_id=t.driver_id and u2.banned='No' where request_at between "2013-10-01" and "2013-10-03" group by request_at order by request_at
select request_at as Day, round (( sum(case when status='cancelled_by_driver' and u2.banned='No' and u1.banned='No' then 1 when status='cancelled_by_client' and u1.banned='No' and u2.banned='No' then 1 else 0 end)/ ( sum(case when u1.banned = 'Yes' or u2.banned = 'Yes' then 0 else 1 end) ) ),2) as 'Cancellation Rate' from Trips t join users u1 on t.client_id= u1.users_id join users u2 on u2.users_id=t.driver_id where request_at between "2013-10-01" and "2013-10-03" group by request_at order by request_at
select request_at as Day, round(1 - sum(if(status = "completed", 1, 0)) / count(*), 2) as "Cancellation Rate" from trips t1 where t1.client_id in ( select users_id from users where role = "client" and banned = "No" ) and t1.driver_id in ( select users_id from users where role = "driver" and banned = "No" ) and request_at between date("2013-10-01") and date("2013-10-03") group by request_at order by date(request_at) asc
select request_at as Day, round(1-count(if(status='completed', 1, null))/count(*),2) as `Cancellation Rate` from trips where client_id not in (select users_id from users where banned='yes') and driver_id not in (select users_id from users where banned='yes') and request_at between '2013-10-01' and '2013-10-03' group by request_at
select request_at as Day, round(count(case when status like 'cancelled%' then 1 end)/count(*),2) as "Cancellation Rate" from trips a, Users b, users c where a.client_id=b.users_id and a.driver_id=c.users_id AND b.banned='NO' AND C.banned='NO' AND request_at between '2013-10-01' AND '2013-10-03' group by request_at
select request_at as Day, round(sum(cancelled) / count(*), 2) as 'Cancellation Rate' from (select request_at, case when c.banned = 'No'and d.banned = 'No' then 1 else 0 end as valid_row, case when t.status != 'completed' then 1 else 0 end as cancelled from Trips t join Users c on t.client_id = c.users_id join Users d on t.driver_id = d.users_id) as temp where valid_row = 1 and request_at >= '2013-10-01' and request_at <= '2013-10-03' group by request_at order by request_at
select request_at as Day, round(sum(case when status like 'cancelled%' then 1 else 0 end)/count(*),2) as 'Cancellation Rate' from Trips where Client_Id not in ( select Users_Id from Users where Banned ='Yes') and Driver_Id not in (select Users_Id from Users where Banned ='Yes') and Request_at BETWEEN '2013-10-01' AND '2013-10-03' group by request_at order by request_at
select request_at as Day, round(sum(case when trips.status <> 'completed' then 1 else 0 end)/count(trips.id), 2) as "Cancellation Rate" from trips, users driver, users client where driver.users_id=trips.driver_id and client.users_id=trips.client_id and driver.banned='No' and client.banned='No' and request_at between "2013-10-01" and "2013-10-03" group by request_at
select request_at as Day, round(sum(if(status = 'completed', 0, 1)) / count(id), 2) as 'Cancellation Rate' from trips where client_id in (select users_id from users where role = 'client' and banned = 'No') and driver_id in (select users_id from users where role = 'driver' and banned = 'No') and request_at between '2013-10-01' and '2013-10-03' group by request_at
select request_at as day , round(sum(status like '%cancelled%') / count(*),2) as 'cancellation rate' from trips t where request_at between '2013-10-01' and '2013-10-03' and client_id in (select users_id from users where banned='No') and driver_id in (select users_id from users where banned='No') group by 1 order by 1
select request_at as day, round( sum( case when status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end) / count(id),2) as 'Cancellation Rate' from trips where request_at between '2013-10-01 'and '2013-10-03' and client_id in (select users_id from users where banned='No') and driver_id in (select users_id from users where banned='No') group by 1
select request_at as day, round((sum(if(status = 'completed', 0, 1)) / count(status)), 2) as `cancellation rate` from trips join users a on client_id = a.users_id and a.banned = 'No' join users b on driver_id = b.users_id and b.banned = 'No' where request_at between date('2013-10-01') and date('2013-10-03') group by request_at
select request_at as day, round(count(if(status != 'completed', true, null)) / count(*), 2) as 'cancellation rate' from trips where (request_at between '2013-10-01' and '2013-10-03') and client_id in (select users_id from users where banned = 'no') group by request_at
select request_at as day, round(count(if(status != 'completed', true, null)) / count(*), 2) as 'cancellation rate' from trips where (request_at between '2013-10-01' and '2013-10-03') and client_id not in (select users_id from users where banned = 'yes') group by request_at
select request_at as day, round(sum(case when status != "completed" then 1 else 0 end)/count(Status),2) as "cancellation rate" from trips where client_id not in (select users_id from users where banned = "Yes") and driver_id not in (select users_id from users where banned = "Yes") and request_at between "2013-10-01" and "2013-10-03" group by 1
select request_at as day, round(sum(case when status like 'cancelled%' then 1 else 0 end)/count(id),2) as 'Cancellation Rate' from trips where request_at between cast('2013-10-01' as date) and cast('2013-10-03' as date) and client_id in (select users_id from users where banned='No' and role='client') and driver_id in (select users_id from users where banned='No' and role='driver') group by 1
select t.Request_at 'Day', round( sum(case when t.Status like 'cancelled%' then 1 else 0 end) / count(*),2) 'Cancellation Rate' from Trips t join Users u on t.Client_Id = u.Users_Id and u.Banned = 'No' and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at AS Day, round(sum(case when t.Status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end) / count(Id), 2) as 'Cancellation Rate' from Trips t where t.Client_Id in (select u.Users_Id from Users u where u.Banned = 'No') and t.Driver_id in (select u.Users_Id from Users u where u.Banned = 'No') and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at Day, ROUND((count(IF(t.status!='completed',TRUE,null))/count(*)),2) as 'Cancellation Rate' from Trips t where t.Client_Id in (Select Users_Id from Users where Banned='No') and t.Driver_Id in (Select Users_Id from Users where Banned='No') and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at Day, ROUND(count(if(t.Status != 'completed',TRUE,NULL))/count(*),2) as 'Cancellation Rate' from Trips t where t.Client_Id in (select Users_id from Users where Banned = 'No') and t.Driver_Id in (select Users_id from Users where Banned = 'No') and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at Day, round(1- sum(if(t.Status='completed',1,0))/count(*),2) 'Cancellation Rate' from (select * from Trips where Request_at between '2013-10-01' and '2013-10-03') t join (select * from Users where Banned='No') u on t.Client_Id=u.Users_Id group by t.Request_at order by t.Request_at
select t.Request_at Day, round(sum(case when t.Status != 'completed' then 1 else 0 end) / count(*), 2) 'Cancellation Rate' from Trips t join Users u1 on t.Client_Id = u1.Users_Id join Users u2 on t.Driver_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at Day, round(sum(case when t.Status <> 'completed' then 1 else 0 end) / count(*), 2) `Cancellation Rate` from Trips t inner join Users u on t.Client_Id = u.Users_Id and u.Banned = 'No' where t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at Day, round(sum(case when t.Status = 'completed' then 0 else 1 end) / count(*), 2) `Cancellation Rate` from Trips t inner join Users u on t.Client_Id = u.Users_Id and u.Banned = 'No' where t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at as "Day", round(sum(case when t.Status = 'completed' then 0 else 1 end) / count(*), 2) as "Cancellation Rate" from Trips t join Users u on t.Client_Id = u.Users_Id and u.Banned = 'No' where t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at as 'Day' , Round( Sum( If(Status like'%cancelled%',1,0)) /count(*), 2) as 'Cancellation Rate' from Trips t left join Users u on u.Users_Id =t.Client_Id and u.Role ='client' left join Users s on s.Users_Id=t.Driver_Id and s.role='driver' where t.Request_at between '2013-10-01' and '2013-10-03' and u.Banned='No' and s.Banned='No' group by 1 order by 1 asc
select t.Request_at as 'Day' , Round(Sum(If(Status like'%cancelled%',1,0))/count(*), 2) as 'Cancellation Rate' from Trips t left join Users u on u.Users_Id =t.Client_Id and u.Role ='client' left join Users s on s.Users_Id=t.Driver_Id and s.role='driver' where t.Request_at between '2013-10-01' and '2013-10-03' and u.Banned='No' and s.Banned='No' group by 1 order by 1 asc
select t.Request_at as 'Day', coalesce (round(sum(case when status like "Cancel%" then 1 else 0 end)/count(ID),2)) as 'Cancellation Rate' from trips t left join users c on t.client_iD = c.users_id and c.role ='client' left join users d on t.driver_id = d.users_id and d.role ='driver' where t.request_at between "2013-10-01" and "2013-10-03" and c.banned = 'No' and d.banned = 'No' group by t.request_at order by t.request_at
select t.Request_at as Day ,round(t.cancel/t.total,2) as "Cancellation Rate" from( select Request_at ,count(*) as total ,sum(case when Status <> "completed" then 1 else 0 end) as cancel from Trips where Client_Id not in (select Users_Id from Users where Banned = 'Yes') and Driver_Id not in (select Users_Id from Users where Banned = 'Yes') and Request_at between "2013-10-01" and "2013-10-03" group by Request_at ) as t
select t.Request_at as Day, ROUND(count(CASE WHEN t.status LIKE 'cancelled%' THEN 1 END)/count(*), 2) as 'Cancellation Rate' from Trips as t join Users as u_client on t.Client_Id = u_client.Users_Id AND u_client.Banned = 'No' join Users as u_driver on t.Driver_Id = u_driver.Users_Id AND u_client.Banned = 'No' where t.Request_at between '2013-10-01' AND '2013-10-03' group by(t.Request_at) order by Day asc
select t.Request_at as Day, ROUND(sum(case when Status like ('cancelled%') then 1 else 0 end)/count(t.Id), 2) as "Cancellation Rate" from Trips t left join Users u_c on t.Client_Id = u_c.Users_Id left join Users u_d on t.Driver_Id = u_d.Users_Id where u_c.Banned = "No" and u_d.Banned = "No" and t.Request_at between "2013-10-01" and "2013-10-03" group by t.Request_at
select t.Request_at as Day, round( sum( case when Status!='completed' then 1 else 0 end) / count(*) ,2) as 'Cancellation Rate' from trips t join users u on (t.Client_Id= u.Users_Id and u.banned='No') join users x on (t.Driver_Id = x.Users_Id and x.banned='No') where t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at as Day, round( sum( case when Status!='completed' then 1 else 0 end) / count(*) ,2) as 'Cancellation Rate' from trips t join users u on t.Client_Id= u.Users_Id join users x on t.Driver_Id = x.Users_Id where t.Request_at between '2013-10-01' and '2013-10-03' and u.banned='No' and x.banned='No' group by t.Request_at
select t.Request_at as Day, round((SUM(CASE WHEN Status='cancelled_by_driver' THEN 1 ELSE 0 end)+ SUM(CASE WHEN Status='cancelled_by_client' THEN 1 ELSE 0 end)) / count(id),2) as 'Cancellation Rate' FROM Trips t JOIN Users c ON t.Client_Id = c.Users_Id JOIN Users d ON t.Driver_Id = d.Users_Id WHERE c.Banned = 'No' and d.Banned = 'No' and date(Request_at)>=date '2013-10-01' and date(Request_at)<=date '2013-10-03' group by t.Request_at
select t.Request_at as Day, round(avg(case when t.Status like 'cancelled%' then 1 else 0 end ),2) as 'Cancellation Rate' from trips t where t.Request_at between '2013-10-01' and '2013-10-03' and t.Client_Id in (select Users_Id from Users where Banned='No') and t.Driver_Id in (select Users_Id from Users where Banned='No') group by 1
select t.Request_at as Day, round(count(if(t.Status != 'completed',TRUE,NULL))/count(*),2) as 'Cancellation Rate' from Trips t where t.Client_Id in (select Users_id from Users where Banned = 'No') and t.Driver_Id in (Select Users_id from Users where Banned = 'No') and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at as Day, round(sum((case when t.status regexp 'cancelled' then 1 else 0 end)) / sum(1),2) as `Cancellation Rate` from Trips t where t.Client_Id not in (select u.Users_Id from Users u where u.Banned='Yes') and t.Driver_Id not in (select u.Users_Id from Users u where u.Banned='Yes') and t.request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.Request_at as Day, round(sum(case when Status != "completed" then 1 else 0 end)/count(*), 2) as 'Cancellation Rate' from Trips t where t.Client_Id in (Select Users_Id from Users where Banned = 'No') and t.Driver_Id in (Select Users_Id from Users where Banned = 'No') and t.Request_at between '2013-10-01' and '2013-10-03' group by t.Request_at
select t.request_at as 'Day', round ((sum(case when status!='completed' then 1 else 0 end)/count(*)),2) as 'Cancellation Rate' from trips t where t.request_at between '2013-10-01' and '2013-10-03' and client_Id not in (select users_id from Users where Banned = 'Yes') group by request_at order by request_at
select t.request_at as Day, cast(sum(case when t.status !='completed' then 1 else 0 end)/count(*) as DECIMAL(6, 2)) as 'Cancellation Rate' from trips t where request_at between '2013-10-01' and '2013-10-03' and exists(select 1 from users where users_id = client_id and banned = 'No') and exists(select 1 from users where users_id = driver_id and banned = 'No') group by t.request_at
select t.request_at as Day, round(ifnull(sum(if(t.status like 'cancelled%',1, 0))/count(t.id),0),2) as 'Cancellation Rate' from trips t left join users u1 on t.client_id = u1.users_id left join users u2 on t.driver_id = u2.users_id where u1.banned = 'No' and u2.banned = 'No' and t.request_at between '2013-10-01' and '2013-10-03' group by t.request_at
select t.request_at as Day, round(sum( case when t.status = 'cancelled_by_driver' or t.status = 'cancelled_by_client' then 1 else 0 end ) /count(1),2) as "Cancellation Rate" from trips as t left join users as u on u.users_id = t.client_id left join users as uu on uu.users_id = t.driver_id where u.Banned != 'Yes' and uu.Banned != 'Yes' and t.request_at between '2013-09-30 23:59:59' and '2013-10-03 23:59:59' group by t.request_at
select t.request_at as Day, round(sum(case when t.status!='completed' then 1 else 0 end)/ count(t.status),2) as "Cancellation Rate" from Trips t join Users u1 on t.client_id=u1.users_id join Users u2 on t.driver_id=u2.users_id where u1.Banned='No' and u2.Banned='No' and (t.request_at between '2013-10-01' and '2013-10-03') group by 1
select t.request_at as day, round(tmp.cancel_ct / tmp.total_ct, 2) as "Cancellation Rate" from (select t.Status, t.Request_at, count(*) as total_ct, count(case t.status when "completed" then NULL else 1 end) as cancel_ct from trips t join users u1 on t.client_id = u1.users_id and u1.role = "client" and u1.banned = "No" join users u2 on t.driver_id = u2.users_id and u2.role = "driver" and u2.banned = "No" where t.Request_at >= "2013-10-01" and t.Request_at <= "2013-10-03" group by t.request_at ) tmp join trips t on t.request_at = tmp.request_at group by t.request_at
select t1.Request_at as Day, Round(sum(case when t1.Status != 'completed' then 1 else 0 End)/ count(*),2) as 'Cancellation Rate' from Trips as t1 left join Users as u on t1.client_Id = u.Users_Id where u.Banned='No' and (t1.Request_at between '2013-10-01' and '2013-10-03') Group by t1.Request_at
select t1.Request_at as Day, round ( count(case when Status in ('cancelled_by_driver','cancelled_by_client') then Id end) * 1.0 / count(Id), 2 ) as "Cancellation Rate" from Trips as t1 join Users as t2 on t1.Client_Id = t2.Users_Id and t2.Banned = 'No' join Users as t3 on t1.Driver_Id = t3.Users_Id and t3.Banned = 'No' where t1.Request_at between '2013-10-01' and '2013-10-03' group by t1.Request_at
select t1.Request_at as Day, round(count(if(t1.Status like 'cancelled%', 1, NULL)) / count(*), 2) as `Cancellation Rate` from Trips t1 join Users u1 on u1.Users_Id = t1.Client_Id join Users u2 on u2.Users_Id = t1.Driver_Id where u1.Banned = "No" and u2.Banned = "No" and t1.Request_at between "2013-10-01" and "2013-10-03" group by t1.Request_at
select t1.Request_at as Day, round(sum(case when status not like 'completed' then 1 else 0 end)*1.0/count(t1.id), 2) as 'Cancellation Rate' from trips t1, users t2 where t1.client_id = t2.users_id and banned like 'No' and t1.Request_at between '2013-10-01' and '2013-10-03' group by 1 order by 1
select t1.request_at as Day, round(coalesce(t2.c2, 0)/t1.c1, 2) as `Cancellation Rate` from (select request_at, count(*) as c1 from trips where client_id not in (select users_id from users where banned="Yes") and driver_id not in (select users_id from users where banned="Yes") and request_at >= "2013-10-01" and request_at <= "2013-10-03" group by request_at) t1 left join (select request_at, count(*) as c2 from trips where client_id not in (select users_id from users where banned="Yes") and driver_id not in (select users_id from users where banned="Yes") and request_at >= "2013-10-01" and request_at <= "2013-10-03" and status like "cancelled_by_%" group by request_at) t2 on t1.request_at = t2.request_at order by t1.request_at
select total.Request_at as Day, IFNULL(cast(canceled/total as decimal(10,2)), 0.00) as "Cancellation Rate" from (select Request_at, count(Id) as canceled from Trips where Client_id not in (select Users_id from Users where Banned = 'Yes') and Driver_id not in (select Users_id from Users where Banned = 'Yes') and Status in ('cancelled_by_driver', 'cancelled_by_client') group by Request_at ) as canceled Right join (select Request_at, count(Id) as total from Trips where Client_id not in (select Users_id from Users where Banned = 'Yes') and Driver_id not in (select Users_id from Users where Banned = 'Yes') group by Request_at ) as total on canceled.Request_at = total.Request_at Where total.Request_at >= "2013-10-01" and total.Request_at <= "2013-10-03"
select tp.Request_at as "Day", round(((COUNT(IF(status = 'cancelled_by_driver' or status = 'cancelled_by_client', 1, NULL)))/(count(tp.Id))),2) as "Cancellation Rate" from Trips as tp WHERE not exists ( select 1 from Users as us where (us.Banned = 'Yes' and us.Users_Id = tp.Client_Id ) or (us.Banned = 'Yes' and us.Users_Id = tp.Driver_Id) ) and DATE(tp.Request_at) BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY tp.Request_at
select trip.Request_at as Day, round((sum(case when trip.Status="cancelled_by_driver" or trip.Status = "cancelled_by_client" then 1 else 0 end))/count(trip.Request_at), 2) as 'Cancellation Rate' from Trips as trip where trip.Request_at >= "2013-10-01" and trip.Request_at <= "2013-10-03" and trip.Client_Id in (select Users_id from Users where Banned = "No") and trip.Driver_Id in (select Users_id from Users where Banned = "No") group by trip.Request_at
select trips.Request_at Day, round(sum(case When trips.status <> 'completed' then 1 else 0 END) / count(*), 2) as "Cancellation Rate" from Trips left join Users a on Trips.Client_Id = a.Users_ID left join Users b on Trips.Driver_Id = b.Users_ID where a.Banned <> 'Yes' AND b.Banned <>'Yes' AND trips.Request_at between "2013-10-01" AND "2013-10-03" group by trips.Request_at order by trips.Request_at asc
select trips.Request_at as 'Day', Round(sum(case when status like 'cancelled_%' then 1 else 0 end)/count(*),2) as 'Cancellation Rate' from trips join users on trips.client_id = users.users_id where users.Banned = 'No' and (trips.Request_at between "2013-10-01" and "2013-10-03") group by Request_at
with T1 as (select Request_at,Client_Id,Driver_Id,Status, case when Client_Id in (select users_id from users where Banned='Yes') then 0 when driver_id in (select users_id from users where Banned='Yes') then 0 else 1 end as ban_flg from Trips where Request_at in("2013-10-01","2013-10-02","2013-10-03") ), T2 as (select Request_at, sum(case when Status like 'cancelled%' then 1 else 0 end)/ count(1) as rat from T1 where ban_flg =1 group by Request_at ) select Request_at as Day , round(rat,2 ) as "Cancellation Rate" from T2
with TripsUnbanned as (select * from (select * from (select Id, Status, Client_Id, Driver_Id, Request_at, Client_Banned from Trips t1 left join (select Users_id, Banned as Client_Banned from Users where Role = "client") u1 on t1.Client_Id = u1.Users_id) t2 left join (select Users_id, Banned as Driver_Banned from Users where Role = "driver") u2 on t2.Driver_Id = u2.Users_id) t3 where Client_Banned <> "Yes" and Driver_Banned <> "Yes"), totalcnt as (select Request_at as Day, count(distinct Id) as totalcnt from TripsUnbanned group by Request_at), cancelcnt as (select Request_at as Day, count(distinct Id) as cancelcnt from TripsUnbanned where Status<>"completed" group by Request_at) select t.Day, ifnull(round(cancelcnt/totalcnt, 2),0) as "Cancellation Rate" from totalcnt t left join cancelcnt c on t.Day = c.Day where t.Day >= "2013-10-01" and t.Day <= "2013-10-03"
with a as ( select Id, Client_Id, Driver_Id, City_Id, Status, Request_at, Role from Trips as t left join Users as u1 on t.Client_Id = u1.Users_Id where u1.Banned = "No" ), b as ( select Id, Client_Id, Driver_Id, City_Id, Status, Request_at, a.Role from a left join Users as u2 on a.Driver_Id = u2.Users_Id where u2.Banned = "No" ), c as ( select Request_at, count(*) as cnt from b where Status != "completed" and request_at between '2013-10-01' and '2013-10-03' group by Request_at ), d as ( select Request_at, count(*) as cnt from b where request_at between '2013-10-01' and '2013-10-03' group by Request_at ) select d.Request_at as 'Day', round(ifnull(c.cnt, 0)/d.cnt, 2) as 'Cancellation Rate' from c right join d on c.Request_at = d.Request_at
with a as ( select t.request_at as Day , avg(case when status = 'completed' then 0 else 1 end ) as n from trips t , users u where t.client_id in ( select users_id from users where banned = 'No' ) and t.driver_id in ( select users_id from users where banned = 'No' ) and u.banned <> 'Yes' and t.request_at between "2013-10-01" and "2013-10-03" group by t.request_at order by t.request_at ) select Day , ifnull(round(n,2),0) as "Cancellation Rate" from a
with a as (Select Status,Request_at as Day from Trips where Client_Id not in (Select Users_Id from Users where Banned = 'Yes') and Driver_Id not in (Select Users_Id from Users where Banned = 'Yes')) ,b as (Select Day , Count(Status) as denominator from a group by(Day)) ,c as (Select Day,count(*) as numerator from (Select Day,Status from a where Status != 'completed')temp group by(Day)) ,t as(Select b.Day, ifnull(c.Numerator,0) as Numerator,b.denominator from b left join c on b.day=c.day) Select Day,Round(Numerator/denominator,2) as 'Cancellation Rate' from t where Day between '2013-10-01' and '2013-10-03'
with banned as ( select Users_Id from Users where Banned = 'Yes' ) select Request_at as Day, round(count(CASE WHEN Status = 'cancelled_by_driver' or Status = 'cancelled_by_client ' THEN 1 END)/count(Id),2) as 'Cancellation Rate' from Trips where (Client_Id NOT IN (select Users_Id from banned)) and (Driver_Id NOT IN (select Users_Id from banned)) and request_at >= '2013-10-01' and request_at <= '2013-10-03' group by Request_at
with base as (select a.* from Trips a inner join (select * from Users where Role = 'client' and Banned = 'No') b on a.Client_id = b.Users_id inner join (select * from Users where Role = 'driver' and Banned = 'No') c on a.Driver_Id = c. Users_Id) select request_at as Day, round(sum(case when Status like 'cancelled%' then 1 else 0 end)/sum(1), 2) as `Cancellation Rate` from base where request_at between "2013-10-01" and "2013-10-03" group by 1 order by 1
with c as (select Id, Client_Id,Driver_Id, City_Id, Status, Request_at from Trips where Client_Id not in (select Users_Id from Users where Banned = 'Yes' and Role ='client') and Driver_Id not in (select Users_Id from Users where Banned = 'Yes' and Role ='driver') and Request_at between '2013-10-01' and '2013-10-03') select Request_at as Day, ifnull(round(round(can,2)/total,2),0) as 'Cancellation Rate' from (select Request_at, sum(case when status = 'cancelled_by_driver' or status ='cancelled_by_client' then 1 else 0 end) as can, count(*) as total from c group by Request_at ) d
with c as (select distinct users_id from users where banned = 'Yes'), b as ( select Request_at Day, case when Status like 'cancelled_%' then 1 else 0 end n_cancelled from trips where client_id not in (select * from c)) select Day, round(sum(n_cancelled)/count(*),2) 'Cancellation Rate' from b where Day between '2013-10-01' and '2013-10-03' group by Day
with cancelled as ( SELECT count(distinct id) as cancelled_trips, Request_at FROM Trips WHERE client_id NOT IN (select users_id FROM Users where Banned = "Yes") AND Driver_Id NOT IN (select users_id FROM Users where Banned = "Yes") AND Status in ('cancelled_by_driver','cancelled_by_client') GROUP BY 2 ) , total_trips as ( SELECT count(distinct id) as total_trips, Request_at FROM Trips WHERE client_id NOT IN (select users_id FROM Users where Banned = "Yes") AND Driver_Id NOT IN (select users_id FROM Users where Banned = "Yes") GROUP BY 2 ) SELECT t.Request_at as Day, IFNULL(ROUND(c.cancelled_trips / t.total_trips,2),0) as `Cancellation Rate` FROM total_trips t LEFT JOIN cancelled c ON t.Request_at = c.Request_at WHERE t.Request_at BETWEEN "2013-10-01" AND "2013-10-03"
with cancelled_trip as ( select Request_at, count(id) as cancel_count from trips where status in ( 'cancelled_by_driver', 'cancelled_by_client') and request_at >= '2013-10-01' and request_at <='2013-10-03' and driver_id in (select Users_Id from Users where Banned='No' and role='driver') and Client_Id in (select Users_Id from Users where Banned='No' and role ='client') group by 1 ), total_trips as ( select Request_at, count(id) as complete_count from trips where request_at >= '2013-10-01' and request_at <='2013-10-03' and driver_id in (select Users_Id from Users where Banned='No' and role='driver') and Client_Id in (select Users_Id from Users where Banned='No' and role ='client') group by 1 ) select a.Request_at as Day, round(coalesce(cancel_count,0)/coalesce(complete_count,1),2) as "Cancellation Rate" from total_trips a left outer join cancelled_trip b on a.Request_at = b.Request_at
with client as (select users_id client_id from users where role='client' and Banned = 'No'), driver as (select users_id driver_id from users where role='driver' and Banned = 'No') select request_at Day, round((sum(case when status !='completed' then 1 else 0 end)/count(*)),2) 'Cancellation Rate' from trips t join client c on c.client_id = t.client_id join driver d on d.driver_id = t.driver_id where Request_at between "2013-10-01" and "2013-10-03" group by 1
with cte as ( Select Request_at,client_id, driver_id, role,status,banned from trips t join users u on t.client_id = u.users_id where Request_at between '2013-10-01' and '2013-10-03' ) Select Request_at as Day,round(sum(case when status in('cancelled_by_driver','cancelled_by_client') and role = 'client' then 1 else 0 end)/count(*),2) as `Cancellation Rate` from cte where banned = 'No' group by Request_at order by request_at
with cte as ( select * from Trips where client_id not in (select users_id from Users where banned = 'Yes') and Driver_Id not in (select users_id from Users where banned = 'Yes') and Request_at between "2013-10-01" and "2013-10-03" ) select Request_at as Day, round (count(case when status !='completed' then cte.id else null end)/count(id),2 ) as 'Cancellation Rate' from cte group by Request_at
with cte as (select * from trips where client_id not in (select users_id from users where banned="yes") and driver_id not in (select users_id from users where banned="yes")) select request_at as day, round(avg(case when status="cancelled_by_driver" or status="cancelled_by_client" then 1 else 0 end),2) as 'cancellation rate' from cte where request_at between "2013-10-01" and "2013-10-03" group by request_at
with cte as (select Users_Id as Id from Users where Role in (1,2) and Banned='No') select Request_at as `Day`, round(sum(case when status like '%cancelled%' then 1 else 0 end)/ count(t1.ID),2) as "Cancellation Rate" from Trips t1 inner join cte t2 on t1.Driver_ID=t2.id inner join cte t3 on t1.Client_ID=t3.id where Request_at between "2013-10-01" and "2013-10-03" group by 1
with cte as (select id,Status,Request_at from trips where Request_at between '2013-10-01' and '2013-10-03' and Client_Id not in (select distinct Users_Id from users where banned="Yes" ) and Driver_Id not in (select distinct Users_Id from users where banned="Yes" ) ) SELECT c.Request_at as Day, ROUND(SUM(CASE WHEN c.Status LIKE 'cancelled%' THEN 1 ELSE 0 END) / COUNT(*), 2) as "Cancellation Rate" from cte c group by c.Request_at
with cte as (select request_at as Day, count(CASE Status WHEN 'completed' THEN null ELSE 1 END) as ride_ct, count(*) as total from trips t join users u on (u.users_id=t.client_id and u.banned='No') join users u2 on (u2.users_id=t.driver_id and u2.banned='No') group by day HAVING day <= '2013-10-03' AND day >= '2013-10-01') select Day,round(ride_ct/total, 2) as 'Cancellation rate' from cte group by day
with cte as (select t.Id, t.Client_Id, t.Driver_Id, t.City_Id, t.Status, t.Request_at from Trips t left join Users u on t.Client_Id = u.Users_Id where (u.Role='client' and u.Banned = 'Yes') or (t.Request_at not BETWEEN '2013-10-01' AND '2013-10-03') union select t.Id, t.Client_Id, t.Driver_Id, t.City_Id, t.Status, t.Request_at from Trips t left join Users u on t.Driver_Id = u.Users_Id where (u.Role='driver' and u.Banned = 'Yes') or (t.Request_at not BETWEEN '2013-10-01' AND '2013-10-03') ) , cte2 as( select * from Trips where Id not in (select Id from cte)) select Request_at as Day, round(sum( case when Status = 'cancelled_by_driver' or Status = 'cancelled_by_client' then 1 else 0 end )/ count(Status),2) as 'Cancellation Rate' from cte2 group by Request_at
with cte as (select t.request_at as day, case when t.status != 'Completed' then 1 else 0 end as Cancelled from trips t where t.client_id not in (select users_id from users where banned = 'Yes') and t.driver_id not in (select users_id from users where banned = 'Yes') and t.request_at between "2013-10-01" and "2013-10-03" ) select day, round(sum(cancelled)/count(day),2) as 'cancellation rate' from cte group by day
with cte as( select * from trips where client_id not in (select users_id from users where banned='Yes') and Driver_Id not in (select users_id from users where banned='Yes') and Request_at between '2013-10-01' and '2013-10-03' ) select request_at as Day, round(sum(case when status like '%cancelled%' then 1 else 0 end)/count(client_id),2) as "cancellation rate" from cte group by request_at
with cte as( select distinct t.id, t.status, t.Request_at from trips t where t.Client_Id in (select Users_Id from users where banned = 'No') and t.Driver_id in (select Users_Id from users where banned = 'No') order by id ) select Request_at as Day, round(sum(case when Status = 'cancelled_by_driver' or Status = 'cancelled_by_client' then 1 else 0 end) / count(*),2) as 'Cancellation Rate' from cte where Request_at between '2013-10-01' and '2013-10-03' group by Day
with cte1 as ( select T.Id, Client_id, Driver_Id, City_Id, Status, Request_at, Banned from Trips T join Users U on T.Client_Id=U.Users_Id ), cte2 as ( select T.Id, Client_id, Driver_Id, City_Id, Status, Request_at, Banned from Trips T join Users U on T.Driver_Id=U.Users_Id ), cte3 as ( select * from ( select cte1.Id, cte1.Client_id, cte1.Driver_Id, cte1.Status, cte1.Request_at, cte1.Banned as Client_banned, cte2.Banned as Driver_banned from cte1 join cte2 on cte1.id=cte2.id ) x where Client_banned='No' and Driver_banned='No' ), cte4 as ( select distinct Request_at, count(Id) over (partition by Request_at) as tot from cte3 ), cte5 as ( select distinct Request_at, count(Id) over(partition by Request_at) as cancelled from ( select Id, Status, Request_at from cte3 where Status='cancelled_by_driver' or Status='cancelled_by_client')z ) select Request_at Day, round(cancelled/tot,2) as 'Cancellation Rate' from ( select cte4.Request_at, ifnull(cancelled, 0) as cancelled, tot from cte4 left join cte5 on cte4.Request_at=cte5.Request_at)z where Request_at between '2013-10-01' and '2013-10-03'
with cte_staging as ( select t.*, case when Status like '%cancelled%' and ( d.Banned = 'No' and c.Banned = 'No') then 1 else 0 end as cancellation from Trips t join Users d on t.Driver_Id = d.Users_Id and d.Banned = 'No' join Users c on t.Client_Id = c.Users_Id and c.Banned = 'No' where Request_at between '2013-10-01' and '2013-10-03' ) select Request_at as Day, round(sum(cancellation) / count(Status) ,2) as 'Cancellation Rate' from cte_staging group by Request_at
with filtered_trips as ( select * from Trips where Client_Id in (select Users_Id from Users where Banned = 'No' and Role = 'client') and Driver_Id in (select Users_Id from Users where Banned = 'No' and Role = 'driver') and Request_at between '2013-10-01' and '2013-10-03' ) select Request_at as Day, round(sum(Status != 'completed') / count(*), 2) as 'Cancellation Rate' from filtered_trips group by Request_at
with intermediate as ( select t.Request_at , count(*) as total_trips , sum(case when t.Status!='completed' then 1 else 0 end) as total_cancels from Trips t inner join Users u1 on t.Client_Id = u1.Users_Id inner join Users u2 on t.Driver_Id = u2.Users_Id where u1.Banned = 'No' and u2.Banned = 'No' and t.Request_at between '2013-10-01' and '2013-10-03' group by 1 ) select Request_at as 'Day' ,round(total_cancels/total_trips,2) as 'Cancellation Rate' from intermediate order by 1
with merged as ( select t.* from Trips t join Users u on t.Client_Id = u.Users_Id and Banned = 'No' ), not_banned as( select t.* from merged t join Users u on t.Driver_Id = u.Users_Id and Banned = 'No') select Request_at as Day, round(sum(case when Status <> 'completed' then 1 else 0 end)/count(*),2) as "Cancellation Rate" from not_banned where Request_at between "2013-10-01" and "2013-10-03" group by 1
with merged as ( select t.* from Trips t join Users u on t.Client_Id = u.Users_Id and Banned = 'No' ), not_banned as( select t.* from merged t join Users u on t.Driver_Id = u.Users_Id and Banned = 'No') select Request_at as Day, round(sum(case when Status <> 'completed' then 1 else 0 end)/count(id),2) as "Cancellation Rate" from not_banned where Request_at between "2013-10-01" and "2013-10-03" group by 1
with nb as ( select users_id from users where banned = 'No' ), tr as ( select * from trips where client_id in (select * from nb) and driver_id in (select * from nb) and request_at between '2013-10-01' and '2013-10-03' ) select request_at day, round(count(case when status like 'cancelled_by_%' then 1 else null end) / count(id), 2) 'Cancellation Rate' from tr group by Request_at
with nb as( select users_id from users where banned = 'No' ), tr as ( select * from trips where client_id in (select * from nb) and driver_id in (select * from nb) and request_at between '2013-10-01' and '2013-10-03' ) select Request_at day, round(count(case when status like 'cancelled_by_%' then 1 else null end)/count(id),2) 'Cancellation Rate' from tr group by Request_at
with new as ( select id, status, request_at from trips as t left join users as u on t.client_id = u.users_id where u.banned = 'No'), rate as( select request_at, count(case when status = 'cancelled_by_driver' or status = 'cancelled_by_client' then 1 else null end) as cancelled, count(new.id) as total from new where request_at between '2013-10-01' and '2013-10-03' group by request_at) select rate.request_at as Day, round(cancelled/total,2) as 'Cancellation Rate' from rate
with newTrips as ( select * from Trips where client_id not in (select users_id from Users where banned = 'Yes') and Driver_Id not in (select users_id from Users where banned = 'Yes')) select Request_at as Day , round(sum(case when Status = 'cancelled_by_driver' or Status = 'cancelled_by_client' then 1 else 0 end ) / count(Request_at ) ,2) 'Cancellation Rate' from newTrips where Request_at between '2013-10-01' and '2013-10-03' group by Request_at
with new_table as (select t.*, u1.Banned Banned_Client, u2.Banned Banned_Driver from trips t left join users u1 on t.Client_Id = u1.Users_Id left join users u2 on t.Driver_ID = u2.Users_Id) select s.Request_at Day, ROUND((SUM(if(s.Banned_Client = 'No' AND s.Banned_Driver = 'No' AND s.Status != 'completed',1, 0))/SUM(if(s.Banned_Client = 'No' AND s.Banned_Driver = 'No',1, NULL))),2) as 'Cancellation Rate' from (select t.*, u1.Banned Banned_Client, u2.Banned Banned_Driver from trips t left join users u1 on t.Client_Id = u1.Users_Id left join users u2 on t.Driver_ID = u2.Users_Id) s group by s.Request_at HAVING s.Request_at >= '2013-10-01' and s.Request_at <= '2013-10-03' Order by Day ASC
with recursive valid_day as ( select '2013-10-01' as day union select date_add(day, interval 1 day) from valid_day where day<'2013-10-03'), unbanned_client as ( select id, status, request_at from trips t join users u on t.Client_Id=u.users_id where u.role='client' and u.banned='no'), unbanned_driver as ( select id, status, request_at from trips t join users u on t.driver_Id=u.users_id where u.role='driver' and u.banned='no'), unbanned_id as ( select uc.id, uc.status, uc.request_at from unbanned_client uc join unbanned_driver ud on uc.id=ud.id where uc.request_at<='2013-10-03' and uc.request_at>='2013-10-01') select request_at as day, round(sum(if(status='cancelled_by_driver' or status='cancelled_by_client',1,0))/count(id),2) as 'Cancellation Rate' from unbanned_id group by 1
with requests_counts as ( select t.Request_at,t.Status,count(*) as counts from Trips as t JOIN Users as ut on t.Client_id=ut.Users_id AND ut.Banned="No" JOIN Users as ut2 ON t.Driver_id=ut2.Users_Id AND ut2.Banned="No" group by t.Request_at,t.Status ) select Request_at as Day , ROUND((sum( IF(Status in ('cancelled_by_driver','cancelled_by_client'), counts, 0) )/ sum(counts)),2) as `Cancellation Rate` from requests_counts where Request_at between '2013-10-01' AND '2013-10-03' group by Day ORDER BY Day
with result as ( select t.* from trips t left join users r on t.client_id = r.users_id left join users d on t.driver_id = d.users_id where r.banned = 'No' and d.banned = 'No' and t.Request_at BETWEEN '2013-10-01' AND '2013-10-03' ) select Request_at as 'Day', round(sum(case when result.Status in ('cancelled_by_driver','cancelled_by_client') then 1 else 0 end)/count(*),2) as 'Cancellation Rate' from result group by 1
with stats as ( select Request_at, T.Status <> 'completed' as IsCancelled from Trips T join Users C on (Client_Id = C.Users_Id and C.Banned = 'No') join Users D on (Driver_Id = D.Users_Id and D.Banned = 'No') where Request_at between '2013-10-01' and '2013-10-03' ) select Request_at as Day, Round( cast(sum(IsCancelled) as real) / cast(count(*) as real), 2 ) as 'Cancellation Rate' from stats group by Request_at
with t as (select *, case when status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end as cancel from trips as t join users as u on t.client_id = u.users_id where (request_at between '2013-10-01' and '2013-10-03') AND (banned = 'No')) select Request_at as 'Day', round(avg(cancel), 2) as 'Cancellation Rate' from t group by Request_at order by Request_at
with t as( select id, request_at, banned, status from trips t join users u on u.users_id = t.client_id and banned = 'No' where request_at between '2013-10-01' and '2013-10-03' ), t1 as ( select id, request_at, banned, status from trips t join users u on u.users_id = t.driver_id and banned = 'No' where request_at between '2013-10-01' and '2013-10-03' ) select Day, cast(canceled/all_reqs as DECIMAL(6, 2)) as 'Cancellation Rate' from( select t.request_at as Day, count(*) as all_reqs, sum(case when t.status !='completed' then 1 else 0 end) as canceled from t join t1 on t.id = t1.id group by t.request_at) a
with tbWhole as ( select t.*, u1.banned as client_banned, u2.banned as driver_banned from trips as t join users as u1 on (t.client_id = u1.users_id and u1.role = "client") join users as u2 on (t.Driver_Id = u2.users_id and u2.role = "driver") where t.Request_at between '2013-10-01' and '2013-10-03' ), tbTotal as ( select Request_at, count(*) as total_cnt from tbWhole where client_banned = 'No' and driver_banned = 'No' group by Request_at ), tbCnt as ( select Request_at, count(*) as cnt from tbWhole where client_banned = 'No' and driver_banned = 'No' and left(tbWhole.Status,9) = 'cancelled' group by Request_at ) select tbTotal.Request_at as Day, round(coalesce(cnt/total_cnt,0),2) as 'Cancellation Rate' from tbTotal left join tbCnt on tbTotal.Request_at = tbCnt.Request_at
with temp as (select * from Trips join Users a on Trips.Client_id=a.Users_id where a.Banned="No"and a.Role="client"), temp2 as (select temp.Request_at, temp.Status from temp join Users b on temp.Driver_id= b.Users_ID where b.Banned="No" and b.Role="driver"), temp3 as (select temp2.Request_at, case when Status like "cancelled%" then 1 else 0 end as flag_cancelled from temp2 where Request_at between "2013-10-01" and "2013-10-03") select temp3.Request_at as "Day", ifnull(round(sum(flag_cancelled)/count(*),2),0.00) as "Cancellation Rate" from temp3 group by temp3.Request_at
with temp as( select distinct t.Client_Id, t.Driver_Id, t.Status,u.Banned,u.Role,t.Request_at,t.Id from Trips t inner join Users u on t.Client_Id=u.Users_Id and (u.Banned='No') where t.Request_at >="2013-10-01" and t.Request_at <="2013-10-03") select t.Request_at as Day ,round(sum(case when t.Status like 'cancelled_by%' then 1 else 0 end)/ count(t.Id),2) as `Cancellation Rate` from temp t group by t.Request_at
with temp_table as ( SELECT Request_at, STATUS, Client_Id, Driver_Id FROM TRIPS t INNER JOIN USERS d ON t.Driver_Id = d.Users_Id INNER JOIN USERS r ON t.Client_Id = r.Users_Id WHERE d.Banned='No' and r.Banned='No' and Request_at between '2013-10-01' and '2013-10-03' ) SELECT Request_at Day, ROUND(Cancel_cnt/total_rides, 2) "Cancellation Rate" FROM ( SELECT Request_at, count(1) total_rides, SUM(CASE WHEN STATUS <> 'completed' THEN 1 ELSE 0 END) Cancel_cnt FROM TEMP_TABLE GROUP BY Request_at ) t
with temp_table as ( select id, Client_id, Driver_Id, u.Banned as UserBanned, Status, Request_at from Trips t inner join Users u on t.Client_Id = u.Users_Id where role = 'client' and Banned = 'No' union select id, Client_id, Driver_Id, u.Banned as UserBanned, Status, Request_at from Trips t inner join Users u on t.Client_Id = u.Users_Id where role = 'driver' and Banned = 'No' ) select request_at as Day, round(sum(case when Status like 'cancelled%' then 1 else 0 end) / count(*), 2) as 'Cancellation Rate' from temp_table where request_at >= '2013-10-01' and request_at <= '2013-10-03' group by request_at
with tmp1 as ( select * from Trips where Driver_Id not in (select users_Id from Users where Banned = "Yes") and Client_Id not in (select users_Id from Users where Banned = "Yes") and Request_at between "2013-10-01" and "2013-10-03" ) , tmp2 as( select Request_at as Day, sum(case when Status = "cancelled_by_driver" then 1 when Status = "cancelled_by_client" then 1 else 0 end) as can_rt, count(id) as tot_ride from tmp1 group by Request_at ) select Day, round(can_rt/tot_ride,2) as "Cancellation Rate" from tmp2 order by Day
with tot As (Select Request_At as Day, Case When Status = 'completed' Then 0 Else 1 End As cancelled, Count(1) Over (Partition By Request_At) as total from Trips Where Request_at Between "2013-10-01" and "2013-10-03" And Client_Id in (Select Users_Id from Users Where Role = 'client' And Banned='No') And Driver_Id in (Select Users_Id from Users Where Role = 'driver' And Banned='No')) Select Day, Round(Sum(cancelled)/total,2) as 'cancellation rate' from tot group by day
with total_non_banned as (select t.id,t.Status, t.Request_at from Trips t inner join users d on t.driver_id = d.users_id inner join users c on t.client_id = c.users_id where d.banned = 'No' and c.banned = 'No') select t2.Request_at as Day,round(count(case when t2.status in ('cancelled_by_driver','cancelled_by_client') then 1 end)/count(t2.id),2) as 'Cancellation Rate' from total_non_banned t2 where t2.Request_at between '2013-10-01' and '2013-10-03' group by t2.Request_at
with total_users as ( select request_at, (case when count(*) is NULL then 0 else count(*) end) as total_trips from Trips where Client_Id not in (select Users_Id from Users where Banned='Yes' and Role='client') and Driver_Id not in (select Users_Id from Users where Banned='Yes' and Role='driver') and Request_at between '2013-10-01' and '2013-10-03' group by request_at ), total_cancelled as ( select t1.request_at, sum(case when t1.status != 'completed' then 1 else 0 end) as total_can from Trips t1 where t1.Client_Id not in (select Users_Id from Users where Banned='Yes' and Role='client') and t1.Driver_Id not in (select Users_Id from Users where Banned='Yes' and Role='driver') and t1.Request_at between '2013-10-01' and '2013-10-03' group by t1.request_at ) select tu.request_at as 'Day', (case when total_trips = 0 then 0.00 else round(total_can/total_trips, 2) end) as 'Cancellation Rate' from total_users tu , total_cancelled tc where tu.request_at = tc.request_at group by tu.request_at order by tu.request_at
with trips_m as( select t.*, c.banned as c_banned, d.banned as d_banned from trips t, users c, users d where t.client_id = c.users_id and c.role = 'client' and t.driver_id = d.users_id and d.role = 'driver' order by id) select Request_at as 'Day', round(sum(cancelled) / sum(total_t), 2) as 'Cancellation Rate' from ( select Request_at, case when (status like '%cancelled%' and (c_banned = 'No' and d_banned = 'No')) then 1 else 0 end as cancelled, case when (c_banned = 'No' and d_banned = 'No') then 1 else 0 end as total_t from trips_m) a group by Request_at having Request_at between '2013-10-01' and '2013-10-03' order by Request_at
with u as(select * from users where banned = 'No') select t.request_at as Day, cast(sum(case when t.status !='completed' then 1 else 0 end)/count(*) as DECIMAL(6, 2)) as 'Cancellation Rate' from trips t where request_at between '2013-10-01' and '2013-10-03' and exists(select 1 from u where users_id = client_id) and exists(select 1 from u where users_id = driver_id) group by t.request_at
with ubClient as (select Users_Id as Id from Users where Banned = 'No'and Role ='client'), ubDriver as (select Users_Id as Id from Users where Banned = 'No'and Role ='driver'), ubTrips as (select Trips.Status as 'Status', Trips.Request_at as 'Request_at', count(*) as 'Count' from Trips join ubClient on Trips.Client_Id =ubClient.Id join ubDriver on Trips.Driver_Id =ubDriver.Id group by Trips.Status, Trips.Request_at), TotalubTrips as (select Request_at as Request_at, sum(Count) as TotalTrips from ubTrips group by Request_at ), CompleteubTrips as ( select Request_at as Request_at, Count as CompleteTrips from ubTrips where status!='completed' ) select TotalubTrips.Request_at as Day, round(ifnull(CompleteTrips,0)/ TotalTrips,2) as 'Cancellation Rate' from TotalubTrips left join CompleteubTrips on TotalubTrips.Request_at = CompleteubTrips.Request_at where TotalubTrips.Request_at>=CAST('2013-10-01' as DATE) and TotalubTrips.Request_at<=CAST('2013-10-03' as DATE)
with unbanned as ( select case when t.Status like '%cancelled%' then 1 else 0 end as status, t.Request_at from Trips t join Users c on t.Client_Id = c.Users_Id join Users d on t.Driver_Id = d.Users_Id where t.Request_at between '2013-10-01' and '2013-10-03' and c.Banned = 'No' and d.Banned = 'No' ) select date(Request_at) as "Day", round(avg(status), 2) as "Cancellation Rate" from unbanned group by 1
with unbanned_users as ( select Users_Id as id from Users where Banned = 'Yes' ) select Day, round(sum(completed) / count(completed), 2) as 'Cancellation Rate' from ( select Request_at as Day, case when Status = 'completed' then 0 else 1 end as completed from Trips where Request_at between '2013-10-01' and '2013-10-03' and Client_Id not in (select id from unbanned_users) and Driver_id not in (select id from unbanned_users) ) t group by 1 order by 1
with users as ( select users_id, role from users where banned = 'No' ), trips AS ( select id, request_at, status, client_id, driver_id from trips where request_at between '2013-10-01' AND '2013-10-03' ), completed_trips as ( select id, status, request_at from trips left join users as clients on trips.client_id = clients.users_id and clients.role = 'client' left join users as drivers on trips.driver_id = drivers.users_id and drivers.role = 'driver' where clients.users_id is not null and drivers.users_id is not null ), cancelled_trips as ( select request_at as day, count(distinct case when status in ('cancelled_by_driver', 'cancelled_by_client') THEN id end) as cancelled_trips, count(distinct id) as all_trips from completed_trips group by 1 ) select day, round(cancelled_trips/all_trips, 2) as 'Cancellation Rate' from cancelled_trips group by 1
with users as (select distinct Users_Id from Users where Banned = "Yes"), cancellations as (select Request_at, count(case when ((Client_Id not in (select Users_Id from users)) and (Driver_Id not in (select Users_Id from users))) then 1 end) as count_unbanned_rides, count(case when (Client_Id not in (select Users_Id from users)) and (Driver_Id not in (select Users_Id from users)) and Status like "%cancelled%" then 1 end) as cancelled_trips from Trips where Request_at between "2013-10-01" and "2013-10-03" group by Request_at) select Request_at as Day, round(cancelled_trips/count_unbanned_rides,2) as "Cancellation Rate" from cancellations
with validTrips as ( select Trips.id, status, request_at from Trips left join users as driver on driver.users_id=Trips.driver_id left join users as client on client.users_id=Trips.client_id where client.banned='No' and driver.banned='No') select t.request_at as Day, round(case when c.count/t.count is null then 0 else c.count/t.count end,2) as "Cancellation Rate" from (select request_at, count(*) as count from validTrips group by request_at) as t left join (select request_at, count(*) as count from validTrips where status!='completed' group by request_at) as c on t.request_at=c.request_at where t.request_at<="2013-10-03" and t.request_at>="2013-10-01"
with validusers (user_id) as (select users_id from Users where Banned='No') select Request_at as Day, Round(sum(case when Status like 'cancelled%' then 1 else 0 end) /count(status),2) as `Cancellation Rate` from Trips where Client_id in (select user_id from validusers) and Driver_Id in (select user_id from validusers) and Request_at between "2013-10-01" and "2013-10-03" group by Request_at
