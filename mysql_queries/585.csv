SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM ( SELECT PID, TIV_2016, COUNT(*) OVER(PARTITION BY TIV_2015) AS tiv2015_count, COUNT(*) OVER(PARTITION BY LAT, LON) AS loc_count FROM insurance ) AS temp WHERE tiv2015_count > 1 AND loc_count = 1
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE PID IN (SELECT PID FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1) AND PID NOT IN (SELECT PID FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) = 1)
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE PID NOT IN (SELECT PID FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) <= 1 UNION SELECT i1.PID FROM insurance i1 JOIN insurance i2 ON i1.LAT = i2.LAT AND i1.LON = i2.LON AND i1.PID <> i2.PID)
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY 1 HAVING COUNT(*) > 1 ) AND CONCAT(LAT, '-', LON) IN ( SELECT CONCAT(LAT, '-', LON) FROM insurance GROUP BY 1 HAVING COUNT(*) = 1 )
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND (LAT, LON) IN ( SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>=2 ) AND (LAT, LON) IN ( SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1 )
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) > 1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND CONCAT(LAT, LON) IN (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1)
SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) > 1) AND (LAT, LON) IN (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1)
SELECT ROUND(SUM(TIV_2016), 2) as TIV_2016 FROM insurance AS i WHERE TIV_2015 in (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015)>=2) AND (LAT, LON) not in (SELECT LAT, LON FROM insurance GROUP BY CONCAT(LAT, LON) HAVING COUNT(CONCAT(LAT,LON))>=2)
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM ( SELECT TIV_2016, COUNT(PID) OVER (PARTITION BY TIV_2015) AS 2015_count, COUNT(PID) OVER (PARTITION BY LAT, LON) AS location_count FROM insurance ) AS table1 WHERE 2015_count >1 AND location_count=1
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM (SELECT *, COUNT(*) OVER(PARTITION BY TIV_2015) AS CNT1, COUNT(*) OVER(PARTITION BY LAT, LON) AS CNT2 FROM INSURANCE ) AS TBL WHERE TBL.CNT1 >=2 AND TBL.CNT2 =1
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM (SELECT *, COUNT(PID) OVER (PARTITION BY TIV_2015) AS IV_occurence, COUNT(PID) OVER (PARTITION BY LAT,LON) AS location_occurence FROM insurance) AS T WHERE IV_occurence > 1 AND location_occurence = 1
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM Insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM Insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND (LAT,LON) IN (SELECT LAT, LON FROM Insurance GROUP BY LAT, LON HAVING COUNT(*)=1)
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM Insurance a WHERE EXISTS (SELECT * FROM Insurance WHERE PID <> a.PID AND TIV_2015 = a.TIV_2015) AND NOT EXISTS (SELECT * FROM Insurance WHERE PID <> a.PID AND (LAT,LON) = (a.LAT,a.LON))
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM Insurance a WHERE EXISTS (SELECT TIV_2016 FROM Insurance WHERE PID <> a.PID AND TIV_2015 = a.TIV_2015) AND NOT EXISTS (SELECT TIV_2016 FROM Insurance WHERE PID <> a.PID AND (LAT,LON) = (a.LAT,a.LON))
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY 1 HAVING COUNT(*) > 1) AND (LAT,LON) IN (SELECT LAT ,LON FROM insurance GROUP BY 1,2 HAVING COUNT(*) = 1 )
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance a WHERE (SELECT COUNT(*) FROM insurance b WHERE a.TIV_2015 = b.TIV_2015) >1 AND (SELECT COUNT(*) FROM insurance c WHERE (a.LAT,a.LON) = (c.LAT,c.LON)) =1
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance a WHERE EXISTS (SELECT * FROM insurance WHERE PID <> a.PID AND TIV_2015 = a.TIV_2015) AND NOT EXISTS (SELECT * FROM insurance WHERE PID <> a.PID AND (LAT,LON) = (a.LAT,a.LON))
SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance i1 WHERE EXISTS (SELECT * FROM insurance i2 WHERE i1.PID <> i2.PID and i1.TIV_2015 = i2.TIV_2015) AND NOT EXISTS (SELECT * FROM insurance i3 WHERE i1.PID <> i3.PID and i1.LAT = i3.LAT and i1.LON = i3.LON)
SELECT ROUND(SUM(TIV_2016),2) TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY 1 HAVING COUNT(*)>1) AND CONCAT(LAT,LON) IN (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY 1 HAVING COUNT(*)=1)
SELECT ROUND(SUM(TIV_2016),2) as "TIV_2016" FROM insurance WHERE PID IN (SELECT DISTINCT(a.PID) FROM insurance a JOIN insurance b ON a.PID <> b.PID WHERE (a.TIV_2015) = (b.TIV_2015) AND a.PID NOT IN ( SELECT DISTINCT(a.PID) FROM insurance a JOIN insurance b ON a.PID <> b.PID WHERE (a.LAT, a.LON) = (b.LAT, b.LON) ) )
SELECT ROUND(SUM(TIV_2016),2) as TIV_2016 FROM insurance WHERE (lat, lon) NOT IN ( SELECT lat, lon FROM insurance GROUP BY lat, lon HAVING COUNT(*) > 1 ) AND TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 )
SELECT ROUND(SUM(TIV_2016),2) as TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(1) > 1) AND (LAT, LON ) IN (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(1)=1)
SELECT ROUND(SUM(TIV_2016),2) as TIV_2016 FROM insurance WHERE TIV_2015 in (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(1) > 1) AND (LAT, LON) in (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(1) = 1)
SELECT ROUND(SUM(insurance.TIV_2016),2) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND (LAT, LON) IN ( SELECT LAT, LON FROM insurance GROUP BY LAT , LON HAVING COUNT(*) = 1 )
SELECT ROUND(SUM(tiv_2016),2) AS tiv_2016 FROM ( SELECT i1.*, i2.c1, i3.c2 FROM insurance i1 JOIN ( SELECT tiv_2015, COUNT(*) AS c1 FROM insurance i2 GROUP BY tiv_2015 )AS i2 ON i2.tiv_2015 = i1.tiv_2015 JOIN ( SELECT lat, lon, COUNT(*) AS c2 FROM insurance i2 GROUP BY lat, lon )AS i3 ON i3.lat = i1.lat AND i3.lon = i1.lon ) AS x WHERE x.c1 > 1 AND x.c2 = 1
SELECT ROUND(sum(TIV_2016), 2) as TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING count(*) > 1) AND concat(LAT, LON) IN ( SELECT concat(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1)
SELECT SUM( i1.TIV_2016 ) AS TIV_2016 FROM insurance AS i1 LEFT JOIN ( SELECT PID, COUNT( * ) OVER( PARTITION BY CONCAT( LAT, ' ', LON ) ) AS count_lat_lon, COUNT( * ) OVER( PARTITION BY TIV_2015 ) AS count_2015 FROM insurance ) AS i2 ON i1.PID = i2.PID WHERE i2.count_lat_lon = 1 AND i2.count_2015 >1
SELECT SUM(BASE.TIV_2016) as TIV_2016 FROM ( SELECT A.PID, A.TIV_2016 FROM (SELECT * FROM Insurance WHERE TIV_2015 in (SELECT TIV_2015 FROM (SELECT TIV_2015, COUNT(*) as N from Insurance GROUP BY TIV_2015)base15 WHERE N>1) ) A LEFT JOIN Insurance B ON A.PID !=B.PId AND A.Lat=B.LAT and A.LON=B.LON WHERE B.PID IS NULL )BASE
SELECT SUM(TIV_2016) AS TIV_2016 FROM ( SELECT *, COUNT(*) OVER (PARTITION BY LAT, LON) AS loc, COUNT(*) OVER (PARTITION BY TIV_2015) AS tiv FROM insurance ) AS temp WHERE loc=1 AND tiv>1
SELECT SUM(TIV_2016) AS TIV_2016 FROM (SELECT PID, TIV_2015, TIV_2016, COUNT(*) OVER(PARTITION BY TIV_2015) AS cnt, COUNT(*) OVER(PARTITION BY CONCAT(LAT, ',',LON)) AS loc_cnt FROM insurance) t WHERE cnt > 1 AND loc_cnt = 1
SELECT SUM(TIV_2016) AS TIV_2016 FROM (SELECT TIV_2016, COUNT(TIV_2015) OVER (PARTITION BY TIV_2015) AS cnt2015, COUNT(*) OVER (PARTITION BY LAT, LON) AS cntloc FROM insurance) t WHERE cnt2015 > 1 AND cntloc = 1
SELECT SUM(TIV_2016) AS TIV_2016 FROM (WITH TEMP AS (SELECT *, CONCAT(LAT,LON) AS LOC FROM Insurance) SELECT PID, TIV_2016 FROM TEMP WHERE LOC IN (SELECT LOC FROM TEMP GROUP BY LOC HAVING COUNT(LOC) = 1) AND TIV_2015 IN (SELECT TIV_2015 FROM Insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) >1)) t
SELECT SUM(TIV_2016) AS TIV_2016 FROM INSURANCE WHERE CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM INSURANCE GROUP BY LAT, LON HAVING COUNT(*) = 1) AND TIV_2015 IN ( SELECT TIV_2015 FROM INSURANCE GROUP BY TIV_2015 HAVING COUNT(*) > 1 )
SELECT SUM(TIV_2016) AS TIV_2016 FROM INSURANCE WHERE TIV_2015 NOT IN (sELECT TIV_2015 FROM INSURANCE GROUP BY TIV_2015 HAVING COUNT(*)=1) AND (LAT,LON) NOT IN (sELECT LAT,LON FROM INSURANCE GROUP BY LAT,LON HAVING COUNT(*)>1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE (LAT, LON) IN (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1) AND TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) > 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE CONCAT(LAT, " ", LON) IN (SELECT CONCAT(LAT, " ", LON) FROM insurance GROUP BY CONCAT(LAT, " ", LON) HAVING COUNT(*) = 1) AND TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE CONCAT(LAT, LON) IN (SELECT CONCAT(LAT, LON) AS city FROM insurance GROUP BY city HAVING COUNT(*) = 1) AND TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE PID IN (SELECT PID FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID) > 1)) AND PID NOT IN ( WITH Locations AS (SELECT *, CONCAT_WS(' ', LAT, LON) AS Location FROM insurance) SELECT PID FROM Locations WHERE Location IN (SELECT Location FROM Locations GROUP BY Location HAVING COUNT(PID) > 1))
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT MAX(TIV_2015) AS TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND PID IN ( SELECT MAX(PID) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1 )
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1) AND (LAT, LON) IN (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1) AND CONCAT(LAT, CONCAT(',', LON)) IN (SELECT CONCAT(LAT, CONCAT(',', LON)) FROM insurance GROUP BY CONCAT(LAT, CONCAT(',', LON)) HAVING COUNT(*) = 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND CONCAT(LAT, LON) IN (SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND CONCAT(LAT, LON) IN (SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND CONCAT(LAT,LON) IN (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LAT,LON HAVING COUNT(*)=1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) > 1) AND (LAT, LON) IN (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015) > 1) AND (LAT, LON) IN( SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(LAT) = 1 AND COUNT(LON) = 1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 NOT IN( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015)<=1) AND CONCAT(LAT,LON) IN( SELECT CONCAT(LAT,LON) FROM insurance GROUP BY CONCAT(LAT,LON) HAVING COUNT(CONCAT(LAT,LON))=1 )
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 in (SELECT(TIV_2015) FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND (LAT,LON) IN (SELECT LAT,LON FROM insurance GROUP BY LAT,LON HAVING count(*)=1)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID) > 1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(PID) =1 )
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance i WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance i GROUP BY TIV_2015 HAVING COUNT(*) > 1) AND CONCAT(LAT, LON) IN (SELECT CONCAT(LAT, LON) FROM insurance i GROUP BY LAT, LON HAVING COUNT(*) < 2)
SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance i1 WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance i2 GROUP BY 1 HAVING COUNT(*) > 1) AND CONCAT(LAT, LON) NOT IN (SELECT CONCAT(LAT, LON) FROM insurance i3 WHERE i1.PID <> i3.PID)
SELECT SUM(TIV_2016) AS tiv_2016 from insurance i where (select count(distinct PID) from insurance where TIV_2015 = i.TIV_2015) >= 2 AND (select count(distinct PID) from insurance where lat = i.lat and lon = i.lon) = 1
SELECT SUM(TIV_2016) As TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1 ) AND CONCAT(LAT,LON) IN ( SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1 )
SELECT SUM(TIV_2016) TIV_2016 FROM INSURANCE I WHERE 1=(SELECT COUNT(*) FROM INSURANCE I1 WHERE I.LAT=I1.LAT AND I.LON=I1.LON) AND 1<(SELECT COUNT(*) FROM INSURANCE I2 WHERE I.TIV_2015 = I2.TIV_2015)
SELECT SUM(TIV_2016) TIV_2016 FROM Insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM Insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1) AND (LAT, LON) NOT IN (SELECT LAT,LON FROM Insurance GROUP BY LAT,LON HAVING COUNT(*) > 1 )
SELECT SUM(TIV_2016) TIV_2016 FROM insurance WHERE (LAT,LON) IN ( SELECT LAT,LON FROM insurance GROUP BY LAT,LON HAVING COUNT(PID)=1) AND TIV_2015 NOT IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID)=1)
SELECT SUM(TIV_2016) TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015)>1) AND CONCAT(LAT,LON) IN (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LAT,LON HAVING COUNT(*)=1 )
SELECT SUM(TIV_2016) as TIV_2016 FROM ( SELECT PID, TIV_2015, COUNT(PID) OVER(PARTITION BY TIV_2015) AS ct_2015, TIV_2016, COUNT(PID) OVER(PARTITION BY CONCAT(LAT,LON)) AS ct_location FROM insurance) as sub WHERE ct_2015 > 1 AND ct_location = 1
SELECT SUM(TIV_2016) as TIV_2016 FROM insurance AS i1 WHERE TIV_2015 in (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND CONCAT(LAT,LON) in (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LON,LAT HAVING COUNT(*)=1)
SELECT SUM(TIV_2016) as TIV_2016 FROM insurance WHERE CONCAT(LON, LAT) IN (SELECT CONCAT(LON, LAT) FROM insurance GROUP BY LON, LAT HAVING Count(*) = 1) AND TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1)
SELECT SUM(TIV_2016) as TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT SUM(TIV_2016) as TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT DISTINCT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND (LAT,LON) NOT IN (SELECT LAT, LON FROM insurance GROUP BY LAT,LON HAVING COUNT(*)>1)
SELECT SUM(TIV_2016) as TIV_2016 FROM insurance where PID not in (select PID from insurance group by TIV_2015 having count(*)=1) AND PID in (select PID from insurance group by LAT, LON having count(*) = 1)
SELECT SUM(insurance.TIV_2016) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND (LAT, LON) IN ( SELECT LAT, LON FROM insurance GROUP BY LAT , LON HAVING COUNT(*) = 1 )
SELECT SUM(insurance.TIV_2016) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT, LON) FROM insurance GROUP BY LAT , LON HAVING COUNT(*) = 1 )
SELECT SUM(insurance.TIV_2016) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) AND CONCAT(LAT, LON) IN ( SELECT CONCAT(LAT,LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT SUM(insurance.TIV_2016) AS TIV_2016 FROM insurance WHERE insurance.TIV_2015 IN (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and concat(lat,lon) in (select concat(lat, lon) from insurance group by lat, lon having count(*) =1)
SELECT SUM(insurance.TIV_2016) AS TIV_2016 FROM insurance where insurance.TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1) and (lat, lon) in (select lat,lon from insurance group by lat, lon having count(*) =1 )
SELECT SUM(insurance.TIV_2016) as TIV_2016 FROM insurance WHERE insurance.TIV_2015 in ( SELECT TIV_2015 from insurance GROUP BY TIV_2015 HAVING COUNT(*)>1 ) and CONCAT(LAT,LON) in ( select concat(LAT,LON) from insurance group by LAT, LON HAVING COUNT(*)=1 )
SELECT SUM(tiv_2016) AS TIV_2016 FROM insurance i WHERE i.tiv_2015 IN ( select tiv_2015 from insurance group by tiv_2015 having count(*) > 1 ) AND CONCAT(i.LAT, '-', i.LON) IN ( SELECT CONCAT(LAT, '-', LON) FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 )
SELECT SUM(tiv_2016) AS tiv_2016 FROM insurance WHERE tiv_2015 IN ( SELECT tiv_2015 FROM insurance GROUP BY tiv_2015 HAVING COUNT(*)>=2) AND (lat, lon) NOT IN ( SELECT lat, lon FROM insurance GROUP BY lat, lon HAVING COUNT(*) > 1 )
SELECT round(SUM(TIV_2016),2) as TIV_2016 FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) AND (LAT,LON) IN (SELECT LAT,LON FROM insurance GROUP BY LAT,LON HAVING COUNT(*)=1 )
SELECT round(sum(TIV_2016), 2) as TIV_2016 FROM insurance WHERE PID not in (Select PID FROM insurance GROUP BY TIV_2015 HAVING count(*) =1) AND PID in (SELECT PID FROM insurance GROUP BY LAT, LON having count(*) =1)
SELECT round(sum(i.TIV_2016), 2) as TIV_2016 FROM insurance i WHERE (select count(*) from insurance i1 where i.TIV_2015 = i1.TIV_2015) > 1 and (select count(*) from insurance i2 where (i.LAT,i.LON)=(i2.LAT,i2.LON))=1
SELECT sum(TIV_2016) AS 'TIV_2016' FROM insurance WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY 1 HAVING COUNT(*) > 1) AND CONCAT(LAT,LON) IN (SELECT CONCAT(LAT,LON) FROM insurance GROUP BY 1 HAVING COUNT(*) = 1)
SELECT sum(TIV_2016) AS TIV_2016 FROM ( SELECT *,CONCAT(LAT,',',LON) AS loc FROM insurance GROUP BY loc HAVING count(*) = 1 ) t WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING count(*) > 1 )
SELECT sum(TIV_2016) AS TIV_2016 from insurance where TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>1) and (lat, lon) in ( select lat, lon from insurance group by lat, lon having count(pid)=1)
Select SUM(TIV_2016) AS TIV_2016 from Insurance where TIV_2015 IN ( Select TIV_2015 from Insurance group by TIV_2015 having count(PID)> 1 AND CONCAT(LAT,LON) in (Select concat(LAT,LON) from Insurance group by LAT,LON having count(*) = 1) )
Select SUM(insurance.TIV_2016) as TIV_2016 From Insurance where insurance.TIV_2015 IN ( Select TIV_2015 from insurance Group by TIV_2015 HAVING COUNT(*) > 1 ) AND CONCAT (LAT, LON) IN ( SELECT CONCAT (LAT, LON) AS UNIQUE_CITY FROM INSURANCE GROUP BY LAT, LON HAVING COUNT(*) = 1 )
Select Sum(TIV_2016) as TIV_2016 From Insurance Where TIV_2015 In (Select TIV_2015 From Insurance Group By TIV_2015 Having Count(*) >= 2) and (LAT, LON) Not In (Select LAT, LON From Insurance Group By LAT, LON Having Count(*) >= 2)
Select sum(TIV_2016) TIV_2016 From (Select *, Count(*) Over (partition by TIV_2015) as 'comval', Count(*) Over (partition by LAT, LON) as 'place' From insurance) t Where comval > 1 And place = 1
Select sum(TIV_2016) as TIV_2016 From insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1) and concat(lat, lon) in (select concat(lat,lon) as ct from insurance group by 1 having count(*) = 1)
Select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (Select TIV_2015 from (Select TIV_2015, count(*) as cnt from insurance group by TIV_2015) tbl1 where cnt > 1) and (LAT,LON) in ( select LAT, LON from (select LAT, LON, count(*) cnt from insurance group by LAT,LON) tbl2 where cnt = 1 )
Select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (Select TIV_2015 from insurance group by TIV_2015 having count(*) > 1) and (LAT,LON) in (select LAT, LON from insurance group by LAT,LON having count(*) = 1 )
Select sum(TIV_2016) as TIV_2016 from( select TIV_2016, count(TIV_2015) over(partition by TIV_2015) AS dr1, count(TIV_2015) over(partition by lat,lon) as dr2 from insurance ) t where dr1 >= 2 and dr2 = 1
Select sum(t.TIV_2016) as TIV_2016 from Insurance t where T.TIV_2015 in (Select TIV_2015 from Insurance group by 1 having count(*) > 1) and concat(lat,lon) in (select concat(lat,lon) from Insurance group by lat,lon having count(*) = 1)
WITH 2015Val AS ( SELECT TIV_2015 FROM insurance GROUP BY 1 HAVING COUNT(TIV_2015) > 1 ), DiffCity AS ( SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(1) > 1 ) SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT * FROM 2015Val) AND (LAT, LON) NOT IN (SELECT * FROM DiffCity)
WITH CTE AS ( SELECT *, CONCAT_WS(', ', LAT, LON) AS LOCATION FROM insurance ), CTE2 AS ( SELECT * FROM ( SELECT *, COUNT(*) OVER ( PARTITION BY LOCATION ) AS cnt_location, COUNT(*) OVER ( PARTITION BY TIV_2015 ) AS cnt_tiv FROM CTE c ) sub WHERE sub.cnt_location = 1 AND sub.cnt_tiv >= 2 ) SELECT ROUND( SUM(TIV_2016), 2) AS TIV_2016 FROM CTE2
WITH CTE1 AS (SELECT DISTINCT TIV_2015 AS inv_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(TIV_2015)>1), CTE2 AS (SELECT DISTINCT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 in (SELECT inv_2015 FROM CTE1) AND CONCAT(LAT, CONCAT(',',LON)) IN (SELECT CONCAT(LAT, CONCAT(',',LON)) FROM CTE2)
WITH CTE_1 AS ( SELECT * FROM INSURANCE I WHERE EXISTS ( SELECT 'X' FROM INSURANCE II WHERE I.TIV_2015 = II.TIV_2015 AND I.PID <> II.PID ) ) ,CTE_2 AS ( SELECT PID, LAT, LON, COUNT(*) OVER (PARTITION BY LAT, LON) LAT_LON_COUNT FROM INSURANCE I ) ,CTE_3 AS ( SELECT * FROM CTE_2 WHERE LAT_LON_COUNT = 1 ) SELECT SUM(TIV_2016) TIV_2016 FROM INSURANCE WHERE PID IN ( SELECT PID FROM CTE_3 ) AND PID IN ( SELECT PID FROM CTE_1 )
WITH CTE_LAT_LON_COMBINED AS ( SELECT PID ,TIV_2015 ,TIV_2016 ,CONCAT(CAST(LAT AS CHAR),CAST(LON AS CHAR)) AS CITY FROM INSURANCE ) , CTE_REMOVE_SAME_CITIES AS ( SELECT A.PID FROM CTE_LAT_LON_COMBINED A INNER JOIN CTE_LAT_LON_COMBINED B ON A.CITY = B.CITY AND A.PID <> B.PID GROUP BY 1 ) , CTE_FINAL_LIST AS ( SELECT A.PID FROM CTE_LAT_LON_COMBINED A INNER JOIN CTE_LAT_LON_COMBINED B ON A.TIV_2015 = B.TIV_2015 AND A.PID <> B.PID WHERE A.PID NOT IN (SELECT PID FROM CTE_REMOVE_SAME_CITIES) GROUP BY 1 ) SELECT SUM(TIV_2016) AS TIV_2016 FROM INSURANCE A INNER JOIN CTE_FINAL_LIST B ON A.PID = B.PID
WITH T1 AS( SELECT PID,TIV_2016,COUNT(*) OVER (PARTITION BY TIV_2015) AS c FROM insurance) SELECT SUM(TIV_2016) AS TIV_2016 FROM T1 WHERE c > 1 AND PID NOT IN ( SELECT I2.PID FROM insurance I1 INNER JOIN insurance I2 WHERE (I1.LAT = I2.LAT) AND (I1.LON = I2.LON) AND (I1.PID != I2.PID))
WITH TEMP AS (select PID, count(PID) OVER (PARTITION BY TIV_2015) ct, TIV_2016, LAT, LON from insurance), t2 as(SELECT PID, count(PID) OVER (PARTITION BY LAT, LON) LOCATION, TIV_2016 FROM insurance) select SUM(TIV_2016) AS TIV_2016 from (select PID, TIV_2016 from t2 where LOCATION=1) t4 where pid IN (select PID from (select PID from temp where ct >1) t3 )
WITH TIV2015 AS (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID)>1), Location AS (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(PID)=1) SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance i JOIN TIV2015 T ON i.TIV_2015=T.TIV_2015 JOIN Location L ON i. LAT=L.LAT AND i.LON=L.LON
WITH complete AS ( SELECT *, COUNT(PID) OVER(PARTITION BY TIV_2015) AS Criteria1, COUNT(PID) OVER(PARTITION BY LAT,LON) AS Criteria2 FROM insurance ) SELECT SUM(TIV_2016) AS TIV_2016 FROM complete WHERE Criteria1 > 1 AND Criteria2 = 1
WITH condition_1 AS ( SELECT DISTINCT s1.pid FROM insurance s1, insurance s2 WHERE s1.LON = s2.LON AND s1.LAT = s2.LAT AND s1.pid != s2.pid ), condition_2 AS ( SELECT DISTINCT s1.pid FROM insurance s1, insurance s2 WHERE s1.TIV_2015 = s2.TIV_2015 AND s1.pid != s2.pid AND s1.pid ), final AS ( SELECT * FROM condition_2 c1 WHERE c1.pid NOT IN (SELECT * FROM condition_1) ) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance s RIGHT JOIN final f ON s.pid = f.pid
WITH cte AS ( SELECT * ,RANK() OVER(ORDER BY TIV_2015) AS rnk ,RANK() OVER(ORDER BY LAT,LON) AS rnk_lat FROM insurance ) , cteb AS (select PID, count(PID) OVER(PARTITION BY rnk) as repeated_tiv, count(PID) OVER(PARTITION BY rnk_lat) as repeated_loc, TIV_2016 from cte) SELECT SUM(TIV_2016) AS TIV_2016 FROM cteb WHERE repeated_tiv > 1 AND repeated_loc = 1
WITH cte AS (SELECT a.pid FROM (SELECT pid FROM insurance WHERE tiv_2015 IN (SELECT tiv_2015 FROM insurance GROUP BY tiv_2015 HAVING count(*) > 1)) a JOIN (SELECT pid FROM insurance WHERE concat(lat, lon) IN (SELECT concat(lat, lon) FROM insurance GROUP BY concat(lat, lon) HAVING count(*) = 1)) b ON a.pid = b.pid) SELECT sum(tiv_2016) as tiv_2016 FROM insurance WHERE pid IN (SELECT pid FROM cte)
WITH dupTIV15 AS ( SELECT TIV_2015, count(1) AS n_pid FROM insurance GROUP BY 1 HAVING count(1) >= 2 ), uniqCITY AS ( SELECT CONCAT(CAST(LAT AS char),',',CAST(LON AS char)) as loc, COUNT(1) as nStr FROM insurance GROUP BY 1 HAVING COUNT(1) = 1 ) SELECT sum(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 in (SELECT TIV_2015 FROM dupTIV15) AND CONCAT(CAST(LAT AS char),',',CAST(LON AS char)) IN (SELECT loc FROM uniqCITY)
WITH eligible AS ( SELECT distinct i1.pid FROM insurance i1 JOIN insurance i2 ON (i1.pid != i2.pid AND i1.TIV_2015 = i2.TIV_2015) ORDER BY 1 asc ), not_eligible AS ( SELECT distinct e1.pid FROM insurance e1 JOIN insurance e2 on (e1.pid != e2.pid AND (e1.lat,e1.lon) = (e2.lat,e2.lon)) ORDER BY 1 ) SELECT SUM(tiv_2016) as 'TIV_2016' FROM insurance WHERE pid in (SELECT * FROM eligible) AND pid not in (SELECT * FROM not_eligible )
WITH get_uniques_ll AS ( SELECT lat, lon, MIN(PID) AS uid FROM insurance GROUP BY 1,2 HAVING COUNT(*) <= 1 ), get_same_tiv AS ( SELECT DISTINCT i1.pid, i1.TIV_2016 FROM insurance i1 INNER JOIN insurance i2 ON i1.PID <> i2.PID AND i1.TIV_2015 = i2.TIV_2015 ) SELECT ROUND(SUM(t1.TIV_2016),2) AS TIV_2016 FROM get_same_tiv t1 INNER JOIN get_uniques_ll t2 ON t1.pid = t2.uid
WITH join_loc AS ( SELECT DISTINCT l.PID, l.TIV_2015, l.TIV_2016 FROM insurance l LEFT JOIN insurance r ON l.pid != r.pid AND l.LAT = r.LAT AND l.LON = r.LON WHERE r.pid IS NULL ), join_2015 AS ( SELECT DISTINCT l.PID, L.TIV_2016 FROM join_loc l INNER JOIN insurance r ON l.PID != r.PID AND l.TIV_2015 = r.TIV_2015 WHERE r.TIV_2015 IS NOT NULL ) SELECT sum(TIV_2016) AS TIV_2016 FROM join_2015
WITH not_same_loc AS ( SELECT PID FROM insurance GROUP BY LAT, LON HAVING COUNT(*)=1 ), investment AS( SELECT PID FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)=1 ) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE PID IN (SELECT PID FROM not_same_loc) AND PID NOT IN (SELECT PID FROM investment)
WITH sub AS( SELECT DISTINCT i1.pid, i1.tiv_2015, i1.tiv_2016, i1.lat, i1.lon FROM insurance i1, insurance i2 WHERE i1.tiv_2015 = i2.tiv_2015 AND i1.pid != i2.pid ), coordinates AS( SELECT lat, lon, count(pid) as count FROM insurance GROUP BY lat, lon HAVING count(pid) = 1 ) SELECT SUM(tiv_2016) as TIV_2016 FROM sub JOIN coordinates ON (sub.lat = coordinates.lat AND sub.lon = coordinates.lon)
WITH t1 AS ( SELECT DISTINCT a.PID FROM insurance a JOIN insurance b ON a.TIV_2015 = b.TIV_2015 AND (a.LAT, a.LON) != (b.LAT, b.LON) ), t2 AS ( SELECT DISTINCT a.PID FROM insurance a JOIN insurance b ON a.PID != b.PID AND (a.LAT, a.LON) = (b.LAT, b.LON) ) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE PID IN (SELECT PID FROM t1) AND PID NOT IN (SELECT PID FROM t2)
WITH t1 AS ( SELECT TIV_2015, 1 AS IsSatTIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID) >= 2 ), t2 AS ( SELECT LAT, LON, 1 AS IsUniqueLoc FROM insurance GROUP BY LAT, LON HAVING COUNT(PID) = 1 ) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance t3 LEFT JOIN t1 ON t3.TIV_2015 = t1.TIV_2015 LEFT JOIN t2 ON t3.LAT = t2.LAT AND t3.LON = t2.LON WHERE t1.IsSatTIV_2015 = 1 AND t2.IsUniqueLoc = 1
WITH table1 AS( SELECT *, COUNT(TIV_2015) OVER(PARTITION BY TIV_2015) AS cnt_value, COUNT(LAT) OVER(PARTITION BY LAT,LON) AS cnt_location FROM Insurance ) SELECT SUM(TIV_2016) AS TIV_2016 FROM table1 WHERE cnt_value > 1 AND cnt_location = 1
WITH temp AS ( SELECT TIV_2016, CONCAT(LAT, LON) AS coord FROM Insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM Insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) ) SELECT ROUND(SUM(TIV_2016), 2) AS TIV_2016 FROM temp WHERE coord NOT IN (SELECT CONCAT(LAT, LON) AS coord FROM Insurance GROUP BY coord HAVING COUNT(*) > 1)
WITH tiv AS ( SELECT tiv_2015, COUNT(*) as cnt FROM insurance GROUP BY tiv_2015 HAVING cnt > 1), located AS (SELECT LAT, LON, COUNT(*) as cnt FROM insurance GROUP BY LAT, LON), holders AS ( SELECT pid, tiv_2016, tiv_2015 FROM insurance as i INNER JOIN located as l ON i.LAT = l.LAT AND i.LON = l.LON WHERE cnt = 1) SELECT SUM(tiv_2016) as tiv_2016 FROM tiv as t INNER JOIN holders as h ON t.tiv_2015 = h.tiv_2015
WITH tiv2015_counts AS (SELECT TIV_2015, COUNT(*) as counts FROM insurance i GROUP BY TIV_2015), unique_city AS ( SELECT LAT, LON, COUNT(*) as counts FROM insurance i GROUP BY LAT, LON ) SELECT SUM(TIV_2016) as TIV_2016 FROM insurance i WHERE TIV_2015 IN (SELECT TIV_2015 FROM tiv2015_counts WHERE counts >= 2) AND (LAT, LON) IN (SELECT LAT, LON FROM unique_city WHERE counts = 1)
WITH tiv_2015_value AS ( SELECT DISTINCT(TIV_2015) FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) >= 2 ), lat_lon AS ( SELECT DISTINCT(CONCAT(LAT, ', ', LON)) AS latlon FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1 ) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance WHERE TIV_2015 IN (SELECT * FROM tiv_2015_value) AND CONCAT(LAT, ', ', LON) IN (SELECT * FROM lat_lon)
WITH tiv_counts AS (SELECT TIV_2015, COUNT(TIV_2015) AS 2015_counts FROM insurance GROUP BY TIV_2015 HAVING 2015_counts > 1), map_freqs AS (SELECT TIV_2015, TIV_2016, COUNT(LAT) AS lat_freqs, COUNT(LON) AS lon_freqs FROM insurance GROUP BY LAT, LON HAVING lat_freqs <= 1 AND lon_freqs <= 1) SELECT SUM(map_freqs.TIV_2016) AS TIV_2016 FROM tiv_counts JOIN map_freqs ON tiv_counts.TIV_2015 = map_freqs.TIV_2015
WITH unique_location AS (SELECT PID,LAT,LON FROM insurance GROUP BY 2,3 HAVING COUNT(PID) = 1), SAME_2015 AS (SELECT PID,TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(PID) =1) SELECT ROUND(SUM(TIV_2016),2) AS TIV_2016 FROM insurance WHERE PID NOT IN (SELECT PID FROM SAME_2015) AND PID IN (SELECT PID FROM unique_location)
WITH valid_LATLON AS (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance AS i INNER JOIN valid_LATLON AS v ON i.LAT = v.LAT AND i.LON=v.LON WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) != 1)
WITH valid_TIV15 AS (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) != 1), valid_LATLON AS (SELECT LAT, LON FROM insurance GROUP BY LAT, LON HAVING COUNT(*) = 1) SELECT SUM(TIV_2016) AS TIV_2016 FROM insurance AS i INNER JOIN valid_LATLON AS v ON i.LAT = v.LAT AND i.LON=v.LON WHERE TIV_2015 IN (SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) != 1)
With temp AS ( SELECT PID, TIV_2015, TIV_2016, CONCAT(LAT,LON) AS 'Location' FROM insurance WHERE TIV_2015 IN ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*)>1) ) SELECT sum(TIV_2016) AS 'TIV_2016' FROM temp WHERE Location IN (SELECT CONCAT(LAT,LON)AS 'Location' FROM insurance GROUP BY Location HAVING COUNT(*)=1)
select ROUND(sum(TIV_2016),2) AS TIV_2016 FROM Insurance where PID IN (select PID from Insurance where TIV_2015 IN (SELECT TIV_2015 FROM Insurance GROUP BY 1 HAVING COUNT(DISTINCT PID) >1) and (LAT,LON) IN (SELECT LAT,LON FROM Insurance GROUP BY LAT, LON HAVING COUNT(*) = 1) )
select ROUND(sum(TIV_2016),2) as TIV_2016 FROM INSURANCE where TIV_2015 IN (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and (LAT,LON) IN (select LAT, LON from insurance group by LAT, LON having count(*)=1)
select SUM(TIV_2016) as TIV_2016 from insurance where TIV_2015 IN (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1) and concat(LAT,LON) IN (select concat(LAT,LON) from insurance group by concat(LAT,LON) having count(concat(LAT,LON)) = 1)
select SUM(TIV_2016) as TIV_2016 from insurance where pid IN ( Select distinct i1.PID FROM insurance i1 JOIN insurance i2 ON i1.TIV_2015 = i2.TIV_2015 AND i1.PID <> i2.PID WHERE i1.PID IN ( SELECT PID from insurance GROUP BY CONCAT(LAT,LON) HAVING COUNT(*) = 1 ) )
select SUM(tiv_2016) as tiv_2016 from insurance where tiv_2015 IN( select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015) > 1) AND CONCAT(LAT,LON) IN (select concat(LAT,LON) from insurance group by lat,lon having count(*) = 1)
select round(SUM(a.TIV_2016),2) as TIV_2016 FROM insurance a WHERE (select COUNT(*) FROM insurance b where a.lat = b.lat and a.lon = b.lon) = 1 and (select count(*) from insurance c where a.tiv_2015 = c.tiv_2015)>1
select round(sum(I.TIV_2016),2) as TIV_2016 from insurance I left join ( select TIV_2015, count(PID) as PID_cnt from insurance group by 1 ) TBL on I.TIV_2015 = TBL.TIV_2015 left join ( select LAT, LON, count(PID) as PID_cnt2 from insurance group by 1,2 ) TBL2 on I.LAT = TBL2.LAT and I.LON = TBL2.LON where TBL.PID_cnt >=2 and PID_cnt2 = 1
select round(sum(TIV_2016), 2) as TIV_2016 from (select distinct i1.PID, i1.TIV_2016 from insurance i1 join insurance i2 where i1.PID != i2.PID and i1.TIV_2015 = i2.TIV_2015) t1 join (select PID, LAT, LON from insurance group by LAT, LON having count(*)=1) t2 on t1.PID=t2.PID
select round(sum(TIV_2016), 2) as TIV_2016 from insurance where (lat, lon) in( select lat, lon from insurance group by lat,lon having count(pid)=1 ) and tiv_2015 in( select tiv_2015 from insurance group by tiv_2015 having count(pid)>1 )
select round(sum(TIV_2016), 2) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1 ) and (lat, lon) not in (select lat, lon from insurance group by lat, lon having count(*)>1)
select round(sum(TIV_2016),2) TIV_2016 from insurance a where (select count(*) from insurance b where a.TIV_2015 = b.TIV_2015)>1 and (select count(*) from insurance c where (a.LAT, a.LON)=(c.LAT, c.LON))=1
select round(sum(TIV_2016),2) as "TIV_2016" from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1) and concat(lat, lon) in (select concat(lat, lon) from insurance group by concat(lat, lon) having count(*)=1)
select round(sum(TIV_2016),2) as TIV_2016 FROM ( SELECT t.PID, t.TIV_2015, t.TIV_2016, t.LAT, t.LON, t1.TIV_2015_COUNT, t2.city_count from insurance t left join( select TIV_2015, COUNT(*) AS TIV_2015_COUNT FROM insurance group by TIV_2015 )t1 on t.TIV_2015=t1.TIV_2015 LEFT JOIN ( SELECT LAT, LON, COUNT(*) AS city_count FROM insurance group by LAT, LON )t2 on t.LAT = t2.LAT and t.LON = t2.LON WHERE t1.TIV_2015_COUNT > 1 AND t2.city_count = 1 )ft
select round(sum(TIV_2016),2) as TIV_2016 FROM (select distinct I1.* from insurance I1 JOIN insurance I2 ON I1.TIV_2015 = I2.TIV_2015 and I1.PID <> I2.PID and (I1.LAT <> I2.LAT OR I1.LON <> I2.LON) and (I1.LAT,I1.LON) IN (select DISTINCT LAT,LON from insurance group by LAT,LON having count(*) = 1))A
select round(sum(TIV_2016),2) as TIV_2016 FROM (select distinct I1.* from insurance I1 JOIN insurance I2 ON I1.TIV_2015 = I2.TIV_2015 and I1.PID <> I2.PID and (I1.LAT <> I2.LAT OR I1.LON <> I2.LON) and (I1.LAT,I1.LON) NOT IN (select DISTINCT LAT,LON from insurance group by LAT,LON having count(*) > 1))A
select round(sum(TIV_2016),2) as TIV_2016 from (select *, concat(lat,',',lon) as loc from insurance group by loc having count(*) = 1) twhere TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1)
select round(sum(TIV_2016),2) as TIV_2016 from Insurance where PID not in (select distinct a.PID from Insurance a join Insurance b on a.PID != b.PID and a.LAT = b.LAT and a.LON = b.LON) and PID in (select distinct a.PID from Insurance a join Insurance b on a.PID != b.PID and a.TIV_2015 = b.TIV_2015)
select round(sum(TIV_2016),2) as TIV_2016 from insurance i join ( select TIV_2015 from insurance group by TIV_2015 having count(*)>1) c on i.TIV_2015 = c.TIV_2015 join( select lat,lon from insurance group by lat,lon having count(*)=1 ) p on i.lat = p.lat and i.lon = p.lon
select round(sum(TIV_2016),2) as TIV_2016 from insurance i join (select PID from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>1) and concat(lat,lon) not in (select concat(lat,lon) from insurance group by concat(lat,lon) having count(concat(lat,lon))>1))sq on i.PID = sq.PID
select round(sum(TIV_2016),2) as TIV_2016 from insurance i where (select count(*) from insurance i1 where i.TIV_2015 = i1.TIV_2015)>1 and (select count(*) from insurance i2 where (i.LAT, i.LON) = (i2.LAT, i2.LON))=1
select round(sum(TIV_2016),2) as TIV_2016 from insurance i where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and (i.LAT,i.LON) not in (select i1.LAT,i1.LON from insurance i1 group by 1,2 having count(*)>1)
select round(sum(TIV_2016),2) as TIV_2016 from insurance where PID in (select PID from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>1) and PID in (select PID from insurance where concat(LAT,LON) in (select concat(LAT,LON) from insurance group by LAT,LON having count(concat(LAT,LON))=1)))
select round(sum(TIV_2016),2) as TIV_2016 from insurance where PID in (select a.PID from insurance a join insurance b on a.PID != b.PID and a.TIV_2015 = b.TIV_2015) and PID not in (select c.PID from insurance c join insurance d on c.PID != d.PID and c.LAT = d.LAT and c.LON = d.LON)
select round(sum(TIV_2016),2) as TIV_2016 from insurance where PID in (select distinct a.PID from insurance a join insurance b on a.PID != b.PID and a.TIV_2015 = b.TIV_2015 where a.PID not in (select c.PID from insurance c join insurance d on c.PID != d.PID and c.LAT = d.LAT and c.LON = d.LON))
select round(sum(TIV_2016),2) as TIV_2016 from insurance where TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>=2 ) and (LAT,LON) in ( select LAT,LON from insurance group by LAT,LON having count(*)=1 )
select round(sum(TIV_2016),2) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and concat(Lat, Lon) in (select concat(Lat, Lon) from insurance group by concat(Lat, Lon) having count(*)=1)
select round(sum(a.TIV_2016), 2) as TIV_2016 from insurance a where 1 > ( select count(b.PID) from insurance b where (a.PID <> b.PID and (b.LAT, b.LON) = (a.LAT, a.LON)) ) and 1 <= ( select count(c.PID) from insurance c where (a.PID <> c.PID and a.TIV_2015 = c.TIV_2015) )
select round(sum(a.tiv_2016),2) as tiv_2016 from insurance a inner join ( select tiv_2015 from insurance group by tiv_2015 having count(*) > 1 ) b on a.tiv_2015 = b.tiv_2015 inner join ( select lon, lat from insurance group by lon,lat having count(*) = 1 ) c on a.lat = c.lat and a.lon = c.lon
select round(sum(distinct a.TIV_2016),2) as TIV_2016 from insurance as a join insurance as b on a.TIV_2015 = b.TIV_2015 where a.PID != b.PID and a.PID in (select distinct i.PID from insurance as i join insurance as j on i.LAT = j.LAT and i.LON = j.LON group by i.PID having count(distinct j.PID) = 1)
select round(sum(i.tiv_2016),2) as 'TIV_2016' from insurance i where i.pid not in (select pid from insurance group by tiv_2015 having count(tiv_2015) < 2) and (i.lat, i.lon) not in (select i2.lat, i2.lon from insurance i2 where i.pid <>i2.pid)
select round(sum(ins1.TIV_2016),2) as TIV_2016 from insurance ins1 join( select LAT ,LON from insurance group by LAT,LON having count(PID) = 1 ) uniqueloc join( select TIV_2015 from insurance group by TIV_2015 having count(PID) > 1 ) 2015val on ins1.LAT = uniqueloc.LAT and ins1.LON = uniqueloc.LON and ins1.TIV_2015 = 2015val.TIV_2015
select round(sum(insurance1.TIV_2016),2) as TIV_2016 from insurance insurance1 left join insurance insurance2 on (insurance1.LAT = insurance2.LAT) and (insurance1.LON = insurance2.LON) and insurance1.PID != insurance2.PID where insurance2.PID is null and insurance1.TIV_2015 in ( select TIV_2015 from insurance where PID != insurance1.PID )
select round(sum(p1.tiv_2016), 2) as tiv_2016 from ( select t1.* from insurance as t1 left join ( select tiv_2015, count(tiv_2015) as count_t15 from insurance group by tiv_2015 ) as t2 on t1.tiv_2015 = t2.tiv_2015 where t2.count_t15 > 1 ) as p1 inner join ( select k1.* from insurance as k1 left join ( select lat, lon, count(lat) as count_city from insurance group by lat, lon ) as k2 on k1.lat = k2.lat and k1.lon = k2.lon where k2.count_city = 1 ) as p2 on p1.pid = p2.pid
select round(sum(sub.TIV_2016),2) as TIV_2016 from ( select distinct a.PID, a.TIV_2016 from insurance a join insurance b on a.TIV_2015 = b.TIV_2015 and a.PID != b.PID where a.PID in ( select PID from insurance group by LAT, LON having count(PID) = 1 ) )AS sub
select round(sum(tiv_2016), 2) as tiv_2016 from insurance where (lat, lon) in (select lat, lon from insurance group by lat, lon having count(*)=1) and tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*)>1)
select round(sum(tiv_2016), 2) as tiv_2016 from insurance where tiv_2015 in ( select tiv_2015 from insurance group by 1 having count(*) > 1 ) and (lat, lon) in ( select lat, lon from insurance group by 1, 2 having count(*) = 1 )
select round(sum(tiv_2016), 2) tiv_2016 from insurance where tiv_2015 in ( select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015) > 1 ) and (lat, lon) not in ( select lat, lon from insurance group by lat, lon having count(pid) > 1 )
select round(sum(tiv_2016),2) as "TIV_2016" from insurance where tiv_2015 in (select tiv_2015 from insurance group by 1 having count(*) >1) and concat(lat,lon) in (select concat(lat,lon) from insurance group by 1 having count(*) = 1)
select round(sum(tiv_2016),2) as 'TIV_2016' from Insurance where TIV_2015 in ( select TIV_2015 from Insurance group by TIV_2015 having count(*) > 1) and concat(lat,' ',lon) in ( select concat(lat,' ',lon) from Insurance group by concat(lat,' ',lon) having count(*) = 1)
select round(sum(tiv_2016),2) as 'TIV_2016' from insurance as i1 where i1.tiv_2015 in (select i2.tiv_2015 from insurance i2 where i1.pid != i2.pid) and (i1.lat, i1.lon) not in (select lat, lon from insurance i3 where i1.pid != i3.pid)
select round(sum(tiv_2016),2) as 'TIV_2016' from insurance i1 where i1.tiv_2015 in (select i2.tiv_2015 from insurance i2 where i1.pid != i2.pid) and (i1.lat, i1.lon) not in (select lat, lon from insurance i3 where i1.pid != i3.pid)
select round(sum(tiv_2016),2) as TIV_2016 from (select *, count(*) over(partition by lat, lon) as cnt1, count(*) over(partition by tiv_2015) as cnt2 from insurance ) a where cnt1 = 1 and cnt2 >= 2
select round(sum(tiv_2016),2) as TIV_2016 from insurance where (lat,lon) in (select lat,lon from insurance group by 1,2 having count(*)=1) and tiv_2015 in (select tiv_2015 from insurance group by 1 having count(*)>1)
select round(sum(tiv_2016),2) tiv_2016 from (select distinct a.PID PID, a.TIV_2016 tiv_2016 from insurance a join insurance b where a.PID != b.PID and a.TIV_2015=b.TIV_2015 and a.PID not in ( select c.PID from insurance c join insurance d where c.PID!=d.PID and c.lat=d.lat and c.lon=d.lon ) ) r1
select sum(A.TIV_2016) 'TIV_2016' from ( select A.TIV_2016, A.LAT, A.LON, count(*) over (partition by A.TIV_2015) 'row_number' from insurance A ) A inner join ( select LAT,LON,count(*) from insurance group by LAT,LON having count(*) = 1 ) B on A.LAT = B.LAT and A.LON = B.LON where A.row_number > 1
select sum(TIV_2016 ) as TIV_2016 from insurance a where (Select count(*) from insurance b where a.LAT=b.LAT and a.LON=b.LON)=1 and (Select count(*) from insurance c where a.TIV_2015=c.TIV_2015)>1
select sum(TIV_2016) AS TIV_2016 from (select * from insurance group by concat(LAT, LON) having count(PID)=1) b where PID not in (select distinct PID from insurance group by TIV_2015 having count(PID)=1)
select sum(TIV_2016) TIV_2016 from ( select *, count(*) over (partition by TIV_2015) cnt1, count(*) over (partition by LAT,LON) cnt2 from insurance ) t where cnt1 >1 and cnt2=1
select sum(TIV_2016) TIV_2016 from insurance a where (select count(*) from insurance b where a.lat=b.lat and a.lon=b.lon)=1 and (select count(*) from insurance b where b.TIV_2015=a.TIV_2015)>1
select sum(TIV_2016) TIV_2016 from insurance a where 1 = (select count(*) from insurance b where a.LAT=b.LAT and a.LON=b.LON) and 1 < (select count(*) from insurance c where a.TIV_2015=c.TIV_2015)
select sum(TIV_2016) TIV_2016 from insurance i join (select pid from insurance where concat(lat,lon) in (select concat(lat,lon) from insurance group by concat(lat,lon) having count(*) = 1))p on i.pid = p.pid join ( select pid from insurance where TIV_2015 in ( (select TIV_2015 from insurance group by 1 having count(*)>1)))q on i.pid = q.pid
select sum(TIV_2016) TIV_2016 from insurance i where exists (select 1 from insurance i2 where i.pid != i2.pid and i.tiv_2015 = i2.tiv_2015) and not exists (select 1 from insurance i2 where i.pid != i2.pid and i.lon = i2.lon and i.lat = i2.lat)
select sum(TIV_2016) TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by 1 having count(1)>1) and concat(LAT, LON) in (select concat(LAT, LON) from insurance group by LAT, LON having count(1) = 1)
select sum(TIV_2016) TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(1)>1) and (lat, lon) in (select lat, lon from insurance group by lat, lon having count(1)=1)
select sum(TIV_2016) as "TIV_2016" from insurance where PID IN (select PID from insurance where TIV_2015 IN(select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1) AND (LAT, LON) NOT IN(select lat,lon from insurance group by lat,lon having count(*) > 1))
select sum(TIV_2016) as 'TIV_2016' from insurance as tbl_1 where TIV_2015 in ( select TIV_2015 from insurance as tbl_2 group by TIV_2015 having count(*) > 1 ) and (tbl_1.LAT, tbl_1.LON) in ( select LAT, LON from insurance as tbl_3 group by LAT, LON having count(*) = 1 )
select sum(TIV_2016) as 'TIV_2016' from insurance where TIV_2015 in( select TIV_2015 from insurance group by 1 having count(TIV_2015)>1 ) and concat(LAT, LON) not in ( select concat(LAT, LON) from insurance group by 1 having count(*)>1)
select sum(TIV_2016) as TIV_2016 from ( select *, concat(LAT,'',LON) as location from insurance group by location having count(*)=1 ) as temp where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1)
select sum(TIV_2016) as TIV_2016 from ( select PID, TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by 1 having count(distinct PID)>=2) and (LAT, LON) in (select LAT, LON from insurance group by 1, 2 having count(distinct PID)=1) )aa
select sum(TIV_2016) as TIV_2016 from (select *, count(*) over (partition by TIV_2015) as cnt1, count(*) over (partition by LAT, LON) as cnt2 from insurance) tbl where cnt1 > 1 and cnt2 = 1
select sum(TIV_2016) as TIV_2016 from (select *, count(*) over(partition by TIV_2015) as num_2015, count(*) over(partition by concat(lat, lon)) as num_loc from insurance)x where num_2015>1 and num_loc=1
select sum(TIV_2016) as TIV_2016 from (select *, count(*) over(partition by lat,lon) as count_latlon, count(TIV_2015) over(partition by TIV_2015) as count_TIV2015 from insurance)T where count_latlon=1 and count_TIV2015>1
select sum(TIV_2016) as TIV_2016 from (select TIV_2015,TIV_2016,concat(LAT,',',LON) as location from insurance group by location having count(*) = 1) q join (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1) w using(TIV_2015)
select sum(TIV_2016) as TIV_2016 from (select TIV_2016, count(1) over(partition by TIV_2015) as cnt_2015, count(1) over(partition by LAT, LON) as cnt_loc from insurance) t where cnt_2015>1 and cnt_loc = 1
select sum(TIV_2016) as TIV_2016 from (select distinct i3.pid, i3.TIV_2016 from insurance i3 inner join insurance i4 on i3.TIV_2015=i4.TIV_2015 where i3.pid<>i4.pid and i3.pid not in (select i1.PID from insurance i1, insurance i2 where i1.lat = i2.lat and i1.lon=i2.lon and i1.pid<>i2.pid)) as t
select sum(TIV_2016) as TIV_2016 from Insurance i where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(PID) > 1) and concat(LAT,LON) in ( select concat(LAT,LON) from insurance group by 1 having count(PID) = 1 )
select sum(TIV_2016) as TIV_2016 from Insurance where TIV_2015 IN (select TIV_2015 from Insurance group by TIV_2015 HAVING COUNT(*) >1) AND concat(LAT,LON) IN (select concat(LAT,LON) from insurance group by LAT, LON having count(*)=1)
select sum(TIV_2016) as TIV_2016 from Insurance where TIV_2015 in (select TIV_2015 from Insurance group by TIV_2015 having count(*)>1) and (LAT,LON) in (select LAT, LON from Insurance group by LAT, LON having count(*)=1)
select sum(TIV_2016) as TIV_2016 from insurance a where (select count(*) from insurance b where a.LAT = b.LAT and a.LON = b.LON) = 1 and (select count(*) from insurance c where a.TIV_2015 = c.TIV_2015) > 1
select sum(TIV_2016) as TIV_2016 from insurance a where (select count(*) from insurance b where a.TIV_2015=b.TIV_2015) >1 and (select count(*) from insurance c where a.LAT = c.LAT and a.LON = c.LON ) =1
select sum(TIV_2016) as TIV_2016 from insurance a where 1 = (select count(*) from insurance b where a.LAT=b.LAT and a.LON=b.LON) and 1 < (select count(*) from insurance c where a.TIV_2015=c.TIV_2015)
select sum(TIV_2016) as TIV_2016 from insurance as a where 1 <= ( select count(*) from insurance where a.PID != PID and TIV_2015 = a.TIV_2015 ) and (a.LAT, a.LON) not in ( select LAT, LON from insurance where a.PID != PID )
select sum(TIV_2016) as TIV_2016 from insurance i inner join (select distinct TIV_2015 from insurance group by TIV_2015 having count(*) >1) a on i.TIV_2015 = a.TIV_2015 inner join (select LAT, LON from insurance group by LAT,LON having count(*) =1) b on i.LAT = b.LAT and i.LON = b.LON
select sum(TIV_2016) as TIV_2016 from insurance where (lat, lon) not in (select lat, lon from insurance group by lat, lon having count(*)>1) and TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1)
select sum(TIV_2016) as TIV_2016 from insurance where PID not in ( select PID from insurance group by TIV_2015 having count(*) = 1 ) and PID in ( select PID from insurance group by LAT, LON having count(*) = 1 )
select sum(TIV_2016) as TIV_2016 from insurance where PID not in ( select PID from insurance group by TIV_2015 having count(PID)=1) and LAT not in ( select LAT from insurance group by LAT,LON having count(*)>1)
select sum(TIV_2016) as TIV_2016 from insurance where PID not in (select PID from insurance group by TIV_2015 having count(*) = 1) and PID in (select PID from insurance group by lat, lon having count(*) = 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 IN ( select TIV_2015 from insurance group by TIV_2015 having count(*) > 1 ) and CONCAT(lat, lon) IN ( select concat(lat, lon) from insurance group by LAT, LON having count(*) = 1 )
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 IN (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1) and concat(LAT,LON) in (select concat(LAT,LON) from insurance group by concat(LAT,LON) having count(*) = 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in ( SELECT TIV_2015 FROM insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1 ) and concat(lat,lon) in ( select concat(lat,lon) from insurance group by lat,lon having count(*) =1 )
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(*) > 1 ) and (lat, lon) in ( select lat, lon from insurance group by lat, lon having count(*) = 1 )
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by 1 having count(*) > 1) and concat(LAT, LON) in (select concat(LAT,LON) from insurance group by 1 having count(*) = 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1 ) and concat(LAT, LON) in (select concat(LAT, LON) from insurance group by LAT, LON having count(*) = 1 )
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and (LAT,LON) not in (select LAT,LON from insurance group by LAT,LON having count(*)>1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>=2) and concat(LAT,LON) in (select concat(LAT,LON) from insurance group by concat(LAT,LON) having count(*)=1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(PID) > 1) and (LAT, LON) not in (select LAT, LON from insurance group by LAT, LON having count(PID) > 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(PID)>1) and concat(LAT,LON) not in (select concat(LAT,LON) from insurance group by LAT,LON having count(PID)>1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1) and concat(LAT,LON) in (select concat(LAT,LON) from insurance group by concat(LAT,LON) having count(concat(LAT,LON)) = 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>1) and concat(LAT, LON) in (select concat(LAT, LON) from insurance group by lat, lon having count(concat(lat, lon))=1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in( select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015)>1) AND concat(LAT,LON) not in ( select concat(LAT,LON) from insurance group by 1 having count(*)> 1)
select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 not in ( select TIV_2015 from insurance group by TIV_2015 having count(*)=1) and (lat,lon) not in ( select lat,lon from insurance group by lat,lon having count(*)>1 )
select sum(TIV_2016) as TIV_2016 from insurance where pid in (select distinct i1.pid from insurance i1 inner join insurance i2 on i1.PID != i2.PID and i1.TIV_2015 = i2.TIV_2015 where i1.pid not in (select i1.pid from insurance i1 inner join insurance i2 on i1.pid != i2.pid and (i1.lat = i2.lat and i1.lon = i2.lon)))
select sum(TIV_2016) as `TIV_2016` from insurance where (lat,lon) not in ( select lat, lon from insurance group by lat,lon having count(*)>1) and TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1)
select sum(TIV_2016) as tiv_2016 from insurance where PID not in (select pid from insurance group by TIV_2015 having count(TIV_2015) = 1) and PID in (select PID from insurance group by lat, lon having count(*) = 1)
select sum(a.TIV_2016) as TIV_2016 from insurance a where a.TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(*) >1 ) and concat(lat, lon) in ( select concat(lat,lon) from insurance group by lat, lon having count(*) = 1)
select sum(c.TIV_2016) as TIV_2016 from ( select a.PID, a.TIV_2015,a.TIV_2016,a.LAT,a.LON from insurance a inner join insurance b on a.TIV_2015 = b.TIV_2015 and a.PID != b.PID group by a.PID, a.TIV_2015,a.TIV_2016,a.LAT,a.LON )c left join insurance d on (c.LAT = d.LAT) and (c.LON = d.LON) and c.PID != d.PID where d.PID is null
select sum(distinct a.TIV_2016) as 'TIV_2016' from (select * from insurance group by LAT, LON having count(*) = 1) as a, insurance as b where a.PID != b.PID and a.TIV_2015 = b.TIV_2015
select sum(distinct i.tiv_2016) as tiv_2016 from insurance i join insurance i1 where i.pid <> i1.pid and i.tiv_2015 = i1.tiv_2015 and i.pid not in (select i.pid from insurance i join insurance i1 where i.pid <> i1.pid and i.lat = i1.lat and i.lon = i1.lon)
select sum(i.TIV_2016) AS TIV_2016 from insurance i where i.tiv_2015 in (select TIV_2015 FROM insurance group by TIV_2015 having count(*) >1 ) and concat(i.lat, i.lon) in (select concat(lat,lon) from insurance group by concat(lat,lon) having count(*)=1)
select sum(i.TIV_2016) as TIV_2016 from insurance i where i.TIV_2015 IN (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1 and concat(lat, lon) IN ( select concat(lat, lon) from insurance group by lat, lon having count(*) =1))
select sum(i.TIV_2016) as TIV_2016 from insurance i where i.TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(*)>1 ) and concat(lat,lon) in ( select concat(lat,lon) from insurance group by concat(lat,lon) having count(*)=1 )
select sum(i.TIV_2016) as TIV_2016 from insurance i where i.TIV_2015 in (select Tiv_2015 from insurance group by tiv_2015 having count(tiv_2015)>1) and concat(i.lat,',',i.lon) in (select concat(LAT, ',', LON) from insurance group by LAT, LON having count(*) = 1 )
select sum(i1.TIV_2016) AS TIV_2016 from insurance i1 where i1.TIV_2015 in (select i2.TIV_2015 from insurance i2 group by i2.TIV_2015 having count(*)>1) and concat(i1.LAT, i1.LON) in (select concat(i3.LAT, i3.LON) from insurance i3 group by i3.LAT, i3.LON having count(*)=1)
select sum(i1.TIV_2016) as TIV_2016 from insurance as i1 WHERE (i1.lat,i1.lon) not in (select lat,lon from insurance group by lat,lon having count(*) >1 ) and i1.TIV_2015 in (select TIV_2015 from insurance GROUP BY TIV_2015 HAVING COUNT(*) > 1)
select sum(i1.TIV_2016) as TIV_2016 from insurance as i1 WHERE (i1.lat,i1.lon) not in (select lat,lon from insurance group by lat,lon having count(*) >1 ) and i1.TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*) > 1)
select sum(i1.TIV_2016) as TIV_2016 from insurance i1 where i1.TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and concat(lat,lon) in (select concat(lat,lon) from insurance group by lat,lon having count(*)=1)
select sum(i1.TIV_2016) as TIV_2016 from insurance i1 where i1.TIV_2015 in (select i2.TIV_2015 from insurance i2 where i1.PID<>i2.PID) and (i1.LAT,i1.LON) not in (select i3.LAT,i3.LON from insurance i3 where i1.PID<>i3.PID)
select sum(i_4.tiv_2016) as TIV_2016 from ( select tiv_2016 from insurance as i_1, (select tiv_2015, count(*) from insurance group by tiv_2015 having count(tiv_2015) > 1) as i_2, (select lat, lon, count(*) from insurance group by lat, lon having count(*) = 1) as i_3 where i_1.tiv_2015 = i_2.tiv_2015 and i_1.lat = i_3.lat and i_1.lon = i_3.lon ) i_4
select sum(insurance.TIV_2016) as TIV_2016 from insurance where insurance.TIV_2015 IN ( select TIV_2015 from insurance group by 1 having count(*)>1 ) and (lat,lon) in ( select lat, lon from insurance group by 1,2 having count(*) = 1 )
select sum(insurance.TIV_2016) as TIV_2016 from insurance where insurance.TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(*) > 1 ) and concat(LAT, LON) IN ( select concat(LAT,LON) from insurance group by LAT, LON having count(*) = 1 )
select sum(insurance.TIV_2016) as TIV_2016 from insurance where insurance.TIV_2015 in ( select TIV_2015 from insurance group by TIV_2015 having count(*)>1 ) and concat(LAT,LON) in ( select concat(LAT, LON) from insurance group by LAT , LON having count(*) = 1 )
select sum(insurance.TIV_2016) as TIV_2016 from insurance where insurance.TIV_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1) and concat(insurance.LAT, insurance.LON) in(select concat(LAT,LON) from insurance group by LAT,LON having count(*) = 1)
select sum(insurance.TIV_2016) as TIV_2016 from insurance where insurance.TIV_2015 in( select TIV_2015 from insurance group by 1 having count(*) >1 ) and CONCAT(LAT, LON) in (select CONCAT(LAT, LON) from insurance group by 1 having count(*) = 1)
select sum(insurance.tiv_2016) as TIV_2016 from insurance where tiv_2015 in (Select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015)>1 ) and concat(lat,',',lon) in (select concat(lat,',',lon) from insurance group by lat, lon having count(concat(lat,',',lon)) <2)
select sum(tiv_2016) AS TIV_2016 from (SELECT distinct a.pid, a.tiv_2016 FROM insurance a INNER JOIN insurance b on a.TIV_2015 = b.TIV_2015 and a.PID <> b.PID WHERE a.PID not in (SELECT a.PID FROM insurance a INNER JOIN insurance b ON a.lat = b.lat and a.lon = b.lon and a.pid <> b.pid) ) a
select sum(tiv_2016) TIV_2016 from ( select distinct I1.pid, I1.tiv_2016 from insurance I1 join insurance I2 on I1.TIV_2015 = I2.TIV_2015 and I1.pid <> I2.pid join (select lat, lon from insurance group by 1,2 having count(*) = 1 ) loc on I1.lat = loc.lat and I1.lon = loc.lon ) A
select sum(tiv_2016) as TIV_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*) > 1) and concat(lat,lon) not in (select concat(lat,lon) from insurance group by concat(lat,lon) having count(*)>1)
select sum(tiv_2016) as TIV_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*)>1) and (lon, lat) in (select lon, lat from insurance group by lon, lat having count(lat)=1)
select sum(tiv_2016) as TIV_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*)>1) and (lon, lat) in (select lon, lat lat from insurance group by lon, lat having count(lat)=1)
select sum(tiv_2016) as tiv_2016 from ( select tiv_2015, tiv_2016, lat, lon, count(tiv_2015)over(partition by tiv_2015) as cnt_tiv_2015, count(lat)over(partition by lat, lon) as cnt_lat, count(lon)over(partition by lat, lon) as cnt_lon from insurance)sub where cnt_tiv_2015 > 1 and cnt_lat = 1 and cnt_lon = 1
select sum(tiv_2016) as tiv_2016 from insurance as i where tiv_2015 in (select tiv_2015 from insurance where pid<> i.pid) and (lat,lon) in (select lat,lon from insurance group by lat,lon having count(lat)=1)
select sum(tiv_2016) as tiv_2016 from insurance where pid in (select distinct pid from (select pid, count(*) over(partition by tiv_2015) as num15, count(*) over(partition by concat(lat,lon)) as num_loc from insurance) x where num15>1 and num_loc=1 )
select sum(tiv_2016) as tiv_2016 from insurance where pid not in ( select pid from insurance group by tiv_2015 having count(*)=1 ) and pid in (select pid from insurance group by lat, lon having count(*)=1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 IN( select tiv_2015 from insurance group by tiv_2015 having count(*)>1) AND concat(LAT,LON) IN (select concat(LAT,LON) from insurance group by lat,lon having count(*) = 1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in ( select tiv_2015 from insurance group by 1 having count(*)>1) and (lat,lon) not in (select lat,lon from insurance group by 1,2 having count(*)>1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in ( select tiv_2015 from insurance group by 1 having count(pid)>1) and concat(lat,lon) in ( select concat(lat,lon) from insurance group by 1 having count(pid)=1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in ( select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015) >= 2 ) and concat(lat, lon) in ( select concat(lat, lon) from insurance group by concat(lat, lon) having count(concat(lat, lon)) = 1 )
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by 1 having count(*)>1) and pid in (select pid from insurance where concat(lat, lon) in (select concat(lat, lon) as lo from insurance group by 1 having count(*)=1))
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by 1 having count(distinct pid) > 1) and concat(lat,lon) not in (select concat(lat,lon) from insurance group by 1 having count(distinct pid) > 1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*) > 1) and concat(lat, lon) in( select concat(lat,lon) from insurance group by lat, lon having count(*) = 1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from insurance group by tiv_2015 having count(*)>1) and (lat, lon) in (select lat, lon from insurance group by lat, lon having count(*)=1)
select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 not in (select tiv_2015 from insurance group by tiv_2015 having count(*)=1) and (lat,lon) not in (select lat,lon from insurance group by lat,lon having count(*)>1)
select sum(tiv_2016) as tiv_2016 from( select * , count(pid) over (partition by tiv_2015) as num_2015 from insurance) as temp where num_2015>=2 and pid not in ( select i1.pid from insurance as i1 inner join (select pid, lat, lon from insurance) as i2 on i1.pid != i2.pid where i1.lat=i2.lat and i1.lon=i2.lon )
select sum(tiv_2016) tiv_2016 from ( select distinct tiv_2016, count(*) over (partition by TIV_2015) cnt1, count(*) over (partition by concat(lat,lon)) cnt2 from insurance ) t where cnt1 >1 and cnt2=1
select sum(tiv_2016) tiv_2016 from (select *, count(*) over (partition by lat,lon) cnt, count(*) over (partition by tiv_2015) tiv from insurance ) z where cnt=1 and tiv>1
select sum(tiv_2016) tiv_2016 from insurance where pid not in (select pid from insurance group by tiv_2015 having count(pid)=1) and pid in (select pid from insurance group by lat, lon having count(pid) = 1)
select sum_TIV_2016 as TIV_2016 from ( select sum(TIV_2016) as sum_TIV_2016 from insurance as ins join (select TIV_2015, count(*) as count_tiv from insurance group by 1 having count_tiv > 1) as tiv on ins.TIV_2015 = tiv.TIV_2015 join (select lat, lon, count(*) as count_loc from insurance group by 1, 2 having count_loc = 1) as loc on ins.lat = loc.lat and ins.lon = loc.lon ) a
with I1 as ( select TIV_2015 from insurance group by TIV_2015 having count(*)>1 ), T2 as ( select LAT, LON from insurance group by LAT, LON having count(*)=1 ) select round(sum(TIV_2016),2) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from I1) and concat(LAT,LON) in (select concat(LAT,LON) from T2)
with a as (select TIV_2015 from insurance group by TIV_2015 having count(PID)>1) , b as ( select TIV_2016 from insurance group by lat,lon having count(PID)=1 ) , c as ( select TIV_2016 from insurance where TIV_2015 in ( select TIV_2015 from a) ) select sum(TIV_2016) as TIV_2016 from c where TIV_2016 in ( select TIV_2016 from B)
with a as( select tiv_2015, count(tiv_2015) from insurance group by tiv_2015 having count(tiv_2015) > 1), b as (select pid, lat, lon from insurance where concat(lat,lon) not in (select concat(lat,lon) from insurance group by 1 having count(*) > 1) ) select ROUND(sum(tiv_2016),2) as TIV_2016 from insurance where pid in (select pid from b) and tiv_2015 in (select tiv_2015 from a)
with conditions as ( select * , count(1) over(partition by lat, lon) as city_count , count(1) over(partition by tiv_2015) as tiv_15_count from insurance ) select sum(tiv_2016) as TIV_2016 from conditions where city_count = 1 and tiv_15_count > 1
with criteria as ( Select *,count(*) over(partition by lat,lon) as cnt, count(*) over(partition by TIV_2015) as val from insurance ) Select sum(TIV_2016) as TIV_2016 from criteria where cnt=1 and val>1
with cte as ( select * from insurance group by lat,lon having count(lat+'-'+lon) = 1 ) , cte2 as ( select * from insurance where TIV_2015 IN ( SELECT TIV_2015 from insurance group by tiv_2015 having count(1) > 1 ) ) select sum(tiv_2016) TIV_2016 from insurance where pid in (select pid from cte) and pid in (select pid from cte2)
with cte as ( select LAT, LON from insurance group by LAT,LON having count(*) = 1 ), cte2 as ( select TIV_2015 from insurance group by TIV_2015 having count(*) >1 ) select round(sum(TIV_2016),2) as TIV_2016 from insurance where (LAT, LON) in (select * from cte) and (TIV_2015 in ( select * from cte2))
with cte as ( select TIV_2015 from insurance group by TIV_2015 having count(TIV_2015) > 1 ) , cte2 as ( select LAT,LON from insurance group by 1,2 having count(lat) = 1 ) select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from cte) and (lat,lon) in (select LAT,LON from cte2)
with cte as ( select i1.PID from insurance as i1 join insurance as i2 on i1.TIV_2015=i2.TIV_2015 and i1.PID!=i2.PID ), cte2 as ( select i1.PID from insurance as i1 join insurance as i2 on i1.LAT=i2.LAT and i1.LON=i2.LON and i1.PID<>i2.PID ), demo as ( select distinct PID from cte where PID not in (select PID from cte2) ) select sum(i.TIV_2016) as TIV_2016 from demo as d join insurance as i on d.PID=i.PID
with cte as ( select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015) > 1 ), cte1 as ( select lat, lon from insurance group by 1, 2 having count(*) = 1 ), cte2 as ( select tiv_2016 from insurance i join cte on i.tiv_2015 = cte.tiv_2015 join cte1 on i.lat = cte1.lat and i.lon = cte1.lon ) select sum(tiv_2016) tiv_2016 from cte2
with cte as (SELECT PID,TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from insurance group by 1 having count(TIV_2015)>1) and (LAT,LON) in (SELECT LAT,LON FROM insurance group by LAT,LON having count(PID)=1)) select sum(TIV_2016) AS TIV_2016 FROM CTE
with cte as (select TIV_2015 from insurance group by 1 having count(*) > 1), cte2 as (select concat(LAT, LON) as city from insurance group by 1 having count(*) = 1) select sum(ifnull(TIV_2016,0)) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from cte) and concat(LAT, LON) in (select city from cte2)
with cte as( select *, count(PID) over (partition by TIV_2015) as cnt1, count(PID) over (partition by LAT, LON) as cnt2 from insurance ) select round(sum(TIV_2016),2) as TIV_2016 from cte where cnt1>1 and cnt2=1
with cte as( select *, dense_rank()over(order by TIV_2015 asc)as same_TIV, dense_rank()over(order by lat,lon asc)as same_lat from insurance), cte2 as( select pid, count(pid)over(partition by same_TIV) as tivcount, count(pid)over(partition by same_lat)as latcount, TIV_2016 from cte) select sum(TIV_2016) as TIV_2016 from cte2 where latcount = 1 and tivcount >1
with cte as( select TIV_2015 from insurance group by TIV_2015 having count(PID)>1 ), cte2 as ( select concat(lat,lon)as loc1 from insurance group by concat(lat,lon) having count(PID)=1 ) select sum(TIV_2016)as TIV_2016 from insurance where TIV_2015 in (select distinct TIV_2015 from cte) and concat(lat,lon) in (select loc1 from cte2)
with cte as( select TIV_2016, count(PID) over(partition by TIV_2015 ) as condition1, count(PID) over(partition by LAT, LON) as condition2 from insurance ) select sum(TIV_2016) as TIV_2016 from cte where condition1 >= 2 and condition2 = 1
with cte as(select TIV_2015, count(*) as num from insurance group by TIV_2015 having count(*) >=2), cte2 as(select count(PID) as cnt, concat_ws(",", LAT, LON) as loc from insurance group by 2 having count(PID) = 1 ) select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from cte) and concat_ws(",", LAT, LON) in (select loc from cte2)
with cte as(select distinct a.PID, a.LAT, a.LON from insurance a join insurance b on a.PID != b.PID and a.TIV_2015 = b.TIV_2015), tmp as( select PID from cte where CONCAT(LAT, LON) not in (select CONCAT(LAT,LON) from insurance group by LAT, LON having count(*)>1)) select sum(TIV_2016) as TIV_2016 from insurance where PID in (select PID from tmp)
with cte1 as ( select TIV_2015 from Insurance group by TIV_2015 having count(*) > 1 ), cte2 as ( select LAT,LON from Insurance group by LAT,LON having count(*) = 1 ) select round(sum(TIV_2016),2) as TIV_2016 from Insurance where TIV_2015 in (select * from cte1) and (LAT,LON) in (select * from cte2)
with cte1 as( select TIV_2015, count(PID) as count15 from insurance i group by TIV_2015), cte2 as( select concat(LAT,LON) as loc, count(PID) as countloc from insurance i group by concat(LAT,LON) ) select round(sum(TIV_2016),2) as TIV_2016 from insurance i where TIV_2015 in (select TIV_2015 from cte1 where count15 >1) and concat(LAT,LON) in (select loc from cte2 where countloc =1)
with f1 as( select distinct a.pid from insurance a cross join insurance b where a.tiv_2015 = b.tiv_2015 and a.pid != b.pid ), f2 as( select pid from insurance where (lat, lon) not in (select lat, lon from insurance group by lat, lon having count(*) > 1)) select sum(tiv_2016) as TIV_2016 from insurance where pid in (select f1.pid from f1 join f2 using(pid))
with insur_plus as ( select *, concat(lat, '-', lon) as lat_lon from insurance ) select sum(i1.tiv_2016) as TIV_2016 from insur_plus as i1 where i1.tiv_2015 in ( select i2.tiv_2015 from insur_plus i2 where i1.pid != i2.pid) and i1.lat_lon not in ( select i3.lat_lon from insur_plus i3 where i1.pid != i3.pid)
with insur_plus as ( select *, concat(lat, '-', lon) as lat_lon from insurance ) select sum(tiv_2016) as TIV_2016 from insur_plus as i1 where tiv_2015 in ( select tiv_2015 from insur_plus group by tiv_2015 having count(*) > 1) and lat_lon not in ( select lat_lon from insur_plus group by lat_lon having count(*) > 1)
with insurance_cte as ( select * ,count(pid) over(partition by tiv_2015) as tiv_2015_cnt ,count(pid) over(partition by lat, lon) as pk_cnt from insurance ) select sum(tiv_2016) as tiv_2016 from insurance_cte where tiv_2015_cnt >= 2 and pk_cnt = 1
with lat_lon as ( select Lat, Lon, count(*) as cnt from insurance group by 1,2 ) select SUM(TIV_2016) as TIV_2016 from ( select DISTINCT(a.PID), a.TIV_2016 from insurance a left join insurance b ON a.TIV_2015 = b.TIV_2015 and a.PID != b.PID left join lat_lon c ON a.lat = c.lat and a.lon = c.lon where b.PID is not NULL and cnt = 1) a
with location_counts_1 as ( select LAT, LON, count(distinct PID) as latlon_count from insurance group by LAT,LON having count(*) = 1 ) , pids_with_unique_location as ( select distinct i.PID, l.latlon_count from insurance i inner join location_counts_1 l on i.LAT = l.LAT and i.LON = l.LON ) , pids_with_nonunique_tiv2015s as ( select distinct i.PID from insurance i inner join insurance i2 on i.pid != i2.pid and i.TIV_2015 = i2.TIV_2015 ) select sum(TIV_2016) as TIV_2016 from insurance i inner join pids_with_unique_location u on u.PID = i.PID inner join pids_with_nonunique_tiv2015s n on n.PID = i.PID
with same_TIV_2015 as ( select TIV_2015 from insurance i group by 1 having count(distinct PID) >= 2 ) , lat_lon_unique as ( select lat, lon from insurance i group by 1, 2 having count(distinct pid) = 1 ) select round(sum(TIV_2016),2) as TIV_2016 from insurance i inner join same_TIV_2015 tiv on tiv.TIV_2015 = i.TIV_2015 inner join lat_lon_unique llu on llu.lat = i.lat and llu.lon = i.lon
with same_tiv_2015 as ( select tiv_2015 from insurance group by tiv_2015 having count(1) > 1 ), diff_lat_long as ( select lat, lon from insurance group by lat, lon having count(1) = 1 ) select sum(tiv_2016) as tiv_2016 from insurance i1 where ( tiv_2015 in (select * from same_tiv_2015) ) and ( (lat,lon) in (select * from diff_lat_long) )
with same_tiv_2015 as ( select tiv_2015 from insurance group by tiv_2015 having count(1) > 1 ), diff_lat_long as ( select lat, lon, count(1) from insurance group by lat, lon having count(1) = 1 ) select sum(tiv_2016) as tiv_2016 from insurance i1 inner join same_tiv_2015 r1 on i1.tiv_2015 = r1.tiv_2015 inner join diff_lat_long r2 on i1.lat = r2.lat and i1.lon = r2.lon
with same_tiv_2015 as (select i.tiv_2015 from insurance i group by i.tiv_2015 having count(i.tiv_2015)>1), diff_lat as (select i2.lat, i2.lon from insurance i2 group by i2.lat, i2.lon having(count(i2.lat)=1)) select sum(i3.tiv_2016) as tiv_2016 from insurance i3 where i3.tiv_2015 in (select tiv_2015 from same_tiv_2015) and (i3.lat,i3.lon) in (select lat,lon from diff_lat)
with same_tiv_2015 as (select tiv_2015, count(*) from insurance group by 1 having count(*) > 1), diff_loc as (select lat, lon, count(*) from insurance group by 1, 2 having count(*) = 1 ) select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from same_tiv_2015) and concat(lat,',',lon) in (select concat(lat,',',lon) from diff_loc)
with same_value AS ( select pid from insurance where TIV_2015 in ( select a.TIV_2015 from (select TIV_2015,count(PID) from insurance group by TIV_2015 having count(PID)>1) a) ), notsame_value AS ( select pid from insurance where concat(lat,lon) not in ( select a.lt from (select concat(lat,lon) as lt,count(PID) from insurance group by concat(lat,lon) having count(PID)>1) a) ) select round(sum(TIV_2016),2) as TIV_2016 from insurance where pid in (select same_value.pid from same_value,notsame_value where notsame_value.pid=same_value.pid)
with short_by_tiv as ( select tiv_2015, count(distinct pid) as c from insurance group by tiv_2015 ) , part1 as( select i.* from insurance as i inner join short_by_tiv as t on t.tiv_2015=i.tiv_2015 and c>1 ), short_by_latlon as ( select ke, count(distinct pid) as pp from (select concat(lat,lon) as ke,pid from insurance ) as sample group by ke ) , part2 as( select ins.* from (select i.pid from (select pid,concat(lat,lon) as ke from insurance ) as i inner join short_by_latlon as t on t.ke=i.ke and pp=1 ) as abc inner join insurance as ins on ins.pid=abc.pid ) ,ans as ( select p1.PID, p1.TIV_2015,p1.TIV_2016,p1.LAT,p1.LON from part1 as p1 inner join part2 as p2 on p1.pid=p2.pid) select sum(tiv_2016) as tiv_2016 from ans
with t as (select distinct b.pid from insurance as a inner join insurance as b on a.PID <> b.PID and concat(a.lat,',',a.lon) = concat(b.lat,',',b.lon) ) , t2 as(select TIV_2015 from insurance group by TIV_2015 having count(*)>1) select sum(tiv_2016) as TIV_2016 from insurance where tiv_2015 in (select TIV_2015 from insurance group by TIV_2015 having count(*)>1) and pid not in (select distinct b.pid from insurance as a inner join insurance as b on a.PID <> b.PID and concat(a.lat,',',a.lon) = concat(b.lat,',',b.lon))
with t as( select *, count(tiv_2015) over(partition by tiv_2015) as num_same_tiv_2015, count(lat) over(partition by lat,lon) as num_same_lat_lon from insurance ) select sum(tiv_2016) as tiv_2016 from t where num_same_tiv_2015 > 1 and num_same_lat_lon = 1
with t1 as ( SELECT PID, TIV_2016 FROM ( SELECT PID, TIV_2016, COUNT(*) OVER(PARTITION BY TIV_2015) As count_2015 FROM insurance) As t3 WHERE count_2015 >1 ), t2 as ( SELECT PID, TIV_2016 FROM ( SELECT PID, TIV_2016, COUNT(*) OVER(PARTITION BY CONCAT(LAT, LON)) As count_loc FROM insurance) As t4 WHERE count_loc =1 ) SELECT SUM(TIV_2016) As TIV_2016 FROM t1 WHERE PID IN (SELECT PID FROM t2)
with t1 as ( select TIV_2015 from insurance group by TIV_2015 having count(*)>1), t2 as ( select LAT,LON from insurance group by LAT,LON having count(*)=1) select round(sum(TIV_2016),2) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from t1) and (LAT,LON) in (select LAT,LON from t2)
with t1 as ( select tiv_2015 from insurance group by tiv_2015 having count(tiv_2015) > 1 ), t2 as( select concat(lat,lon) as a from insurance group by 1 having count(*) = 1 ) select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from t1) and concat(lat,lon) in (select a from t2)
with t1 as (select pid from insurance group by tiv_2015 having count(*) = 1), t2 as (select pid from insurance group by lat, lon having count(*) = 1) select round(sum(tiv_2016), 2) as 'TIV_2016' from insurance where pid not in (select * from t1) and pid in (select * from t2)
with t2015 as ( select tiv_2015 from insurance group by tiv_2015 having count(1)>1) , location as ( select pid, count(1) over( partition by lat,lon) as c from insurance ) select round(sum(tiv_2016),2) as TIV_2016 from insurance i inner join t2015 t on i.tiv_2015 = t.tiv_2015 inner join location l on l.pid = i.pid where l.c=1
with temp as ( select * , count(*) over (partition by lat,lon) cnt, count(*) over (partition by tiv_2015) tiv from insurance ) select sum(tiv_2016) as TIV_2016 from temp where tiv > 1 and cnt = 1
with tiv as (Select PID From insurance where TIV_2015 in (Select TIV_2015 from insurance Group by TIV_2015 having count(TIV_2015) > 1)), loc as (Select PID From insurance Group by CONCAT(LAT,LON) having count(CONCAT(LAT,LON)) = 1) Select Sum(TIV_2016) as TIV_2016 From insurance Where PID in (Select PID from tiv) and PID in (Select PID from loc)
with tiv15 as ( select tiv_2015 from insurance group by 1 having count(*) > 1 ), not_unique_city as ( select lat, lon from insurance group by 1, 2 having count(*) > 1 ) select round(sum(tiv_2016), 2) "tiv_2016" from insurance where tiv_2015 in (select * from tiv15) and (lat, lon) not in (select * from not_unique_city)
with tiv15 as ( select tiv_2015 from insurance group by 1 having count(*) > 1 ), unique_city as ( select lat, lon from insurance group by 1, 2 having count(*) = 1 ) select round(sum(tiv_2016), 2) "tiv_2016" from insurance where tiv_2015 in (select * from tiv15) and (lat, lon) in (select * from unique_city)
with tiv_count as ( select TIV_2015 from insurance group by 1 having count(PID) >1 ), lat_lon_count as ( select lat,lon from insurance group by 1,2 having count(PID) =1 ) select sum(TIV_2016) as TIV_2016 from insurance where TIV_2015 in (select TIV_2015 from tiv_count) AND lat in (select lat from lat_lon_count) AND lon in (select lon from lat_lon_count)
with tmp1 as (select distinct t1.PID from insurance t1, insurance t2 where t1.PID <> t2.PID and t1.TIV_2015 = t2.TIV_2015), tmp2 as ( select t1.PID from insurance t1, insurance t2 where t1.PID <> t2.PID and concat(t1.LAT, t1.LON) = concat(t2.LAT, t2.LON) group by 1 ) select sum(TIV_2016) as TIV_2016 from insurance where PID in (select PID from tmp1) and PID not in (select PID from tmp2)
with tmp1cte as ( select *, rank() over (order by TIV_2015 asc) as same_tiv, rank() over (order by LAT, LON asc) as same_loc from insurance ), tmp2cte as ( select PID,count(PID) over (partition by same_tiv) as repeated_tiv, count(PID) over (partition by same_loc) as repeated_loc, TIV_2016 from tmp1cte ) select sum(TIV_2016) as TIV_2016 from tmp2cte where repeated_tiv > 1 and repeated_loc = 1
with tp1 as( select tiv_2015 from insurance group by tiv_2015 having count(*) > 1) , tp2 as( select lat, lon from insurance group by lat,lon having count(*) = 1 ) select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from tp1) and (lat,lon) in (select lat,lon from tp2)
with unique_locations as ( select lat, lon from insurance group by 1,2 having count(1) = 1 ), previous_year_non_unique as ( select tiv_2015 from insurance group by 1 having count(1) > 1 ) select sum(tiv_2016) as tiv_2016 from insurance where tiv_2015 in (select tiv_2015 from previous_year_non_unique) and (lat,lon) in (select lat, lon from unique_locations)
with unique_locations as ( select lat, lon from insurance group by lat, lon having count(pid) = 1 ), tivs as ( select tiv_2015 from insurance group by tiv_2015 having count(pid) > 1 ) select sum(i.tiv_2016) as tiv_2016 from insurance i inner join unique_locations u on u.lat = i.lat and u.lon = i.lon inner join tivs t on t.tiv_2015 = i.tiv_2015
with w as ( select *, count(*) over (partition by TIV_2015) as same_TIV_2015, count(*) over (partition by LAT, LON) as unique_geo from Insurance ) select sum(TIV_2016) as TIV_2016 from w where same_TIV_2015 > 1 and unique_geo = 1
with xyz as ( select tiv_2015, count(tiv_2015) as cnt from insurance group by tiv_2015 having count(tiv_2015)<>1) , abc as( select concat(LAT,LON) location, count(1) from insurance group by concat(LAT,LON) having count(1)=1 ) select sum(tiv_2016) as TIV_2016 from insurance i where i.TIV_2015 in (select distinct tiv_2015 from xyz) and concat(i.LAT,i.LON) in (select distinct location from abc )
