SELECT B.name AS country FROM (SELECT * FROM Person) A INNER JOIN Country B ON SUBSTRING(A.phone_number, 1, 3) = B.country_code INNER JOIN (SELECT caller_id, duration FROM Calls UNION ALL SELECT callee_id, duration FROM Calls) C ON C.caller_id = A.id GROUP BY B.name HAVING AVG(C.duration) > (SELECT AVG(duration) FROM Calls)
SELECT B.name AS country FROM (SELECT A.name, AVG(C.duration) AS IndiAvg, (SELECT AVG(duration) FROM Calls) AS GlbAvg FROM Calls C JOIN (SELECT P.id, C.name FROM (SELECT id, LEFT(phone_number, 3) AS CountryCode FROM Person) P JOIN Country C ON P.CountryCode = C.country_code) A ON A.id IN (C.caller_id, C.callee_id) GROUP BY A.name) B WHERE B.IndiAvg > B.GlbAvg
SELECT C.name AS country FROM Country C JOIN Person P ON C.country_code = LEFT(phone_number,3) JOIN Calls L ON L.caller_id = P.id OR L.callee_id = P.id GROUP BY 1 HAVING AVG(L.duration) > (SELECT AVG(duration) FROM Calls)
SELECT C.name AS country FROM Person P JOIN Calls ON caller_id = P.id OR callee_id = P.id JOIN Country C ON C.country_code = LEFT(P.phone_number , 3) GROUP BY C.name HAVING AVG(DURATION) > (SELECT AVG(DURATION) FROM CALLS)
SELECT C2.name country FROM Calls C1 JOIN Person P1 ON C1.caller_id = P1.id OR C1.callee_id = P1.id JOIN Country C2 ON LEFT(P1.phone_number,3) = C2.country_code GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT C2.name country FROM Calls C1 JOIN Person P1 ON C1.caller_id = P1.id OR C1.callee_id = P1.id LEFT JOIN Country C2 ON LEFT(P1.phone_number,3) = C2.country_code GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name AS country FROM Country JOIN Person ON LEFT(Person.phone_number, 3) = Country.country_code JOIN Calls ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id GROUP BY Country.name HAVING AVG(Calls.duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name AS country FROM Person JOIN Calls ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id JOIN Country ON Country.country_code = LEFT(Person.phone_number, 3) GROUP BY Country.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name AS country FROM Person inner JOIN Calls ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id inner JOIN Country ON Country.country_code = LEFT(Person.phone_number, 3) GROUP BY Country.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name AS country FROM Person right JOIN Calls ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id inner JOIN Country ON Country.country_code = LEFT(Person.phone_number, 3) GROUP BY Country.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name AS country FROM Person right JOIN Calls ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id right JOIN Country ON Country.country_code = LEFT(Person.phone_number, 3) GROUP BY Country.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT Country.name as country FROM Person JOIN Country on LEFT(phone_number,3)=Country.country_code JOIN Calls ON Person.id=Calls.caller_id or Person.id=Calls.callee_id GROUP BY Country.name HAVING AVG(duration)>(SELECT AVG(duration) FROM Calls)
SELECT DISTINCT c.name AS country FROM Person p JOIN Calls l ON caller_id = id OR id = callee_id JOIN Country c ON LEFT(phone_number, 3) = country_code GROUP BY country_code HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT DISTINCT country FROM ( SELECT country.name country, calls.duration, AVG(calls.duration) over(partition by country.name) avg_duration, AVG(calls.duration) over() avg_total FROM calls JOIN person ON calls.caller_id = person.id or calls.callee_id = person.id JOIN country ON LEFT(person.phone_number, 3) = country.country_code ) t WHERE avg_duration > avg_total
SELECT DISTINCT country FROM (SELECT c.name AS country, ca.duration, AVG(ca.duration) OVER(PARTITION BY c.name) AS avg_country, AVG(ca.duration) OVER() avg_total FROM Calls ca JOIN Person p ON ca.caller_id=p.id OR ca.callee_id=p.id INNER JOIN Country c ON LEFT(p.phone_number, 3)=c.country_code) AS temp WHERE avg_country > avg_total
SELECT DISTINCT name AS country FROM ( SELECT Country.name, AVG(duration) OVER (PARTITION BY Country.name) AS avg_duration, AVG(duration) OVER () AS global_avg FROM Person JOIN Calls ON Person.id=Calls.caller_id OR Person.id=Calls.callee_id JOIN Country ON LEFT(phone_number,3)=country_code ) sub WHERE avg_duration>global_avg
SELECT c.name AS country FROM (SELECT callee_id as caller_id, caller_id as callee_id, duration FROM Calls UNION SELECT * FROM Calls) sub LEFT JOIN Person p ON sub.caller_id = p.id LEFT JOIN Country c ON left(p.phone_number,3) = c.country_code GROUP BY c.name HAVING sum(sub.duration)/count(*) > (SELECT SUM(sub2.duration)/count(*) FROM (SELECT callee_id as caller_id, caller_id as callee_id, duration FROM Calls UNION SELECT * FROM Calls) sub2)
SELECT c.name AS country FROM (SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) AS sub JOIN Person AS p ON p.id = sub.id JOIN Country AS c ON c.country_code = LEFT(p.phone_number, 3) GROUP BY c.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT c.name AS country FROM Country AS c JOIN Person AS p ON c.country_code = LEFT(p.phone_number,3) JOIN Calls AS ca ON p.id = caller_id or p.id = callee_id GROUP BY c.name HAVING AVG(duration) >( SELECT AVG(duration) AS global FROM Calls)
SELECT c.name AS country FROM Country c JOIN ( SELECT SUBSTR(p.phone_number, 1, 3) AS country_code, AVG(c.duration) AS avg_duration FROM Calls c JOIN Person p ON c.caller_id = p.id OR c.callee_id = p.id GROUP BY country_code HAVING avg_duration > ( SELECT AVG(duration) FROM Calls ) ) t ON c.country_code = t.country_code
SELECT c.name AS country FROM Country c LEFT JOIN Person p ON c.country_code = LEFT(p.phone_number, 3) LEFT JOIN Calls cl ON p.id = cl.caller_id OR p.id = cl.callee_id GROUP BY c.name HAVING AVG(duration) is not null AND AVG(duration) > (SELECT AVG(duration) FROM Calls )
SELECT c.name AS country FROM Person p JOIN Country c ON LEFT(p.phone_number,3) = c.country_code JOIN Calls ca ON ( p.id = ca.caller_id OR p.id = ca.callee_id ) GROUP BY 1 HAVING AVG(ca.duration) > ( SELECT AVG(duration) FROM Calls)
SELECT c.name as country FROM Country c JOIN (SELECT SUBSTRING(p.phone_number, 1, 3) as country_code, SUM(ca.duration)/COUNT(ca.duration) as average FROM Person p LEFT JOIN Calls ca ON ca.caller_id = p.id OR ca.callee_id = p.id GROUP BY country_code) t ON t.country_code = c.country_code WHERE t.average > (SELECT SUM(duration)/COUNT(duration) FROM Calls)
SELECT c.name as country FROM Person p JOIN Country c ON substr(p.phone_number, 1,3) = c.country_Code JOIN Calls cl ON cl.caller_id=p.id or cl.callee_id=p.id GROUP BY c.name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
SELECT c.name as country FROM calls ca JOIN person p ON p.id = ca.caller_id OR p.id = ca.callee_id JOIN country c ON c.country_code = LEFT(p.phone_number,3) GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT c.name as country FROM country c JOIN person p ON LEFT(p.phone_number,3)=c.country_code JOIN calls a ON a.caller_id=p.id or a.callee_id=p.id GROUP BY c.name HAVING avg( duration )> (select avg(duration) from calls)
SELECT c.name as country from Person p JOIN Country c ON LEFT(phone_number,3)=country_code JOIN Calls ON (p.id=Calls.caller_id or p.id=Calls.callee_id) GROUP BY 1 HAVING AVG(duration)>(SELECT AVG(duration) FROM Calls)
SELECT c.name country FROM ( SELECT caller_id as id, duration FROM calls UNION ALL SELECT callee_id as id, duration FROM calls ) x JOIN person p ON p.id=x.id JOIN Country c on left(p.phone_number,3)=c.country_code GROUP BY left(p.phone_number,3) HAVING AVG(x.duration)> (SELECT avg(duration) as "average" FROM Calls)
SELECT c.name country FROM Person p JOIN Country c ON LEFT(p.phone_number,3) = c.country_code JOIN Calls ca ON p.id = ca.caller_id or p.id = ca.callee_id GROUP BY c.country_code HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT c1.name AS country FROM Person p JOIN Calls c ON p.id = c.caller_id OR p.id = c.callee_id JOIN Country c1 ON LEFT(p.phone_number, 3) = c1.country_code GROUP BY c1.name HAVING AVG(c.duration) > (SELECT AVG(duration) FROM Calls)
SELECT co.name AS country FROM Country co JOIN Person p ON co.country_code = SUBSTR(p.phone_number, 1, 3) JOIN Calls c ON p.id IN (c.caller_id, c.callee_id) GROUP BY co.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT co.name AS country FROM Person p JOIN Calls c ON p.id = c.caller_id OR p.id = c.callee_id JOIN Country co ON co.country_code = LEFT(p.phone_number,3) GROUP BY co.name HAVING AVG(c.duration) > (SELECT AVG(duration) FROM Calls)
SELECT co.name AS country FROM Person p JOIN Country co ON LEFT(p.phone_number, 3) = co.country_code JOIN CALLS ca ON p.id IN (ca.caller_id, ca.callee_id) GROUP BY co.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT co.name AS country FROM person p JOIN country co ON SUBSTR(phone_number,1,3) = country_code JOIN calls c ON p.id IN (c.caller_id, c.callee_id) GROUP BY co.name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
SELECT co.name AS country FROM person p JOIN country co ON SUBSTRING(phone_number,1,3) = country_code JOIN calls c ON p.id IN (c.caller_id, c.callee_id) GROUP BY co.name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
SELECT co.name AS country FROM person p JOIN country co ON left(p.phone_number,3) = country_code JOIN calls c ON p.id IN (c.caller_id, c.callee_id) GROUP BY co.name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
SELECT co.name as country FROM ( SELECT caller_id AS ID,duration FROM Calls UNION ALL SELECT callee_id AS ID,duration FROM Calls ) C INNER JOIN (SELECT id, SUBSTRING(phone_number,1,3) AS country_code FROM Person) P ON C.id = P.id INNER JOIN Country CO ON P.country_code = co.country_code GROUP BY co.name HAVING AVG(duration) > (SELECT SUM(duration)/COUNT(*) FROM Calls)
SELECT co.name as country FROM Country co JOIN Person p ON co.country_code = LEFT(p.phone_number, 3) JOIN (SELECT p.id, duration FROM Person p JOIN Calls ca ON p.id = ca.caller_id OR p.id = ca.callee_id) a ON p.id = a.id GROUP BY co.name having AVG(a.duration) > (SELECT avg(duration) FROM Calls)
SELECT co.name as country FROM Country co JOIN Person p ON co.country_code = LEFT(p.phone_number, 3) JOIN (SELECT p.id, duration FROM Person p JOIN Calls ca ON p.id = ca.caller_id UNION all SELECT p.id, duration FROM Person p JOIN Calls ca ON p.id = ca.callee_id) a ON p.id = a.id GROUP BY co.name having AVG(a.duration) > (SELECT avg(duration) FROM Calls)
SELECT co.name as country FROM Country co JOIN Person p ON co.country_code = LEFT(p.phone_number, 3) JOIN Calls ca ON p.id = ca.caller_id OR p.id = ca.callee_id GROUP BY co.name having AVG(duration) > (SELECT avg(duration) FROM Calls)
SELECT co.name as country FROM Person p JOIN Calls ca ON p.id = ca.caller_id OR p.id = ca.callee_id JOIN Country co ON co.country_code = LEFT(p.phone_number, 3) GROUP BY co.name Having AVG(ca.duration) > (select avg(duration) from Calls)
SELECT country FROM (SELECT C1.name country, AVG(IFNULL(duration,0)) AVERAGE, (SELECT AVG(duration) FROM Calls) global_average FROM Country C1 JOIN Person P1 ON C1.country_code = LEFT(P1.phone_number, 3) JOIN Calls C2 ON P1.id = C2.caller_id OR P1.id = C2.callee_id GROUP BY 1) Temp WHERE AVERAGE>global_average
SELECT ct.name AS country FROM Calls c JOIN Person p ON p.id = c.caller_id OR p.id = c.callee_id JOIN Country ct ON ct.country_code = LEFT(p.phone_number,3) GROUP BY 1 HAVING AVG(c.duration) > (SELECT AVG(c.duration) FROM Calls c)
SELECT ct.name AS country FROM Calls c JOIN Person p ON p.id = c.caller_id OR p.id = c.callee_id JOIN Country ct ON ct.country_code = LEFT(p.phone_number,3) GROUP BY 1 HAVING AVG(c.duration) > (SELECT AVG(duration) FROM Calls)
SELECT ct.name AS country FROM Country ct JOIN Person p ON ct.country_code = LEFT(p.phone_number,3) JOIN Calls c ON p.id = c.caller_id OR p.id = c.callee_id GROUP BY 1 HAVING AVG(c.duration) > (SELECT AVG(duration) FROM Calls)
SELECT ct.name AS country FROM Person p JOIN Calls ca ON p.id = ca.caller_id OR p.id = ca.callee_id JOIN Country ct on LEFT(p.phone_number, 3) = ct.country_code GROUP BY ct.name HAVING AVG(ca.duration) > (SELECT AVG(duration) FROM Calls)
SELECT ct.name As country FROM calls c INNER JOIN person p ON p.id IN (c.caller_id, c.callee_id) INNER JOIN country ct ON ct.country_code = SUBSTRING(phone_number, 1, 3) GROUP BY ct.name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
SELECT distinct c2.name country FROM( SELECT caller_id as id, duration FROM calls UNION ALL SELECT callee_id as id, duration FROM calls ) x JOIN person p ON p.id=x.id JOIN country c2 ON LEFT(p.phone_number,3)=c2.country_code GROUP BY 1 HAVING avg(x.duration)> (select avg(duration) from calls)
SELECT name 'country' FROM ( SELECT P.id, T.name, C1.duration FROM Person P LEFT JOIN Country T ON LEFT(P.phone_number,3) = T.country_code LEFT JOIN Calls C1 ON P.id = C1.caller_id UNION SELECT P.id, T.name, C2.duration FROM Person P LEFT JOIN Country T ON LEFT(P.phone_number,3) = T.country_code LEFT JOIN Calls C2 ON P.id = C2.callee_id ) tb GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT name AS country FROM ( SELECT c.name ,m.duration FROM Person p, Country c, Calls m WHERE LEFT(p.phone_number, 3) = c.country_code AND p.id = m.caller_id UNION ALL SELECT c1.name ,m1.duration FROM Person p1, Country c1, Calls m1 WHERE LEFT(p1.phone_number, 3) = c1.country_code AND p1.id = m1.callee_id ) t GROUP BY name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
SELECT name AS country FROM (SELECT a.id, LEFT(p.phone_number,3) AS country_code,duration FROM (SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) a JOIN Person p ON p.id=a.id) b JOIN Country c ON c.country_code=b.country_code GROUP BY 1 HAVING AVG(duration)>(SELECT AVG(duration) FROM Calls)
SELECT name AS country FROM Country c JOIN (SELECT SUBSTRING(phone_number, 1, 3) AS country_code, SUM(duration)*1.0/COUNT(*) AS duration FROM Person P JOIN ( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) B ON P.id= B.id GROUP BY SUBSTRING(phone_number, 1, 3))A ON a.country_code=c.country_code WHERE duration>(SELECT SUM(duration)*1.0/COUNT(duration) FROM Calls)
SELECT name as country FROM ( SELECT id , left(phone_number, 3) as country_code FROM Person) t1 JOIN Calls ca on (t1.id = ca.caller_id or t1.id = ca.callee_id) JOIN Country co on co.country_code = t1.country_code GROUP BY name HAVING avg(duration) > (SELECT avg(duration) FROM Calls)
SELECT name as country FROM (SELECT country_code, c2.name, avg(duration)avgs from Person p join Calls c on p.id = c.caller_id or p.id=c.callee_id join Country c2 on left(p.phone_number,3)=c2.country_code group by country_code )t where avgs>(select AVG(duration)from calls)
SELECT name as country FROM Country WHERE country_code in (SELECT SUBSTR(p.phone_number, 1,3) as country_code FROM Calls c JOIN Person p ON c.caller_id = p.id or c.callee_id = p.id GROUP BY country_code HAVING AVG(c.duration) > (SELECT AVG(duration) FROM Calls))
SELECT new.countryFROM (SELECT P.id,P.name,C.name AS country FROM Person AS P JOIN Country AS C ON LEFT(P.phone_number,3)=C.country_code) AS new JOIN Calls AS c ON new.id=c.caller_id OR new.id=c.callee_id GROUP BY new.country HAVING avg(duration) > (SELECT AVG(duration) FROM Calls)
SELECT o.name as country FROM Calls c Join Person p ON p.id= c.caller_id OR p.id= callee_id JOIN Country o ON o.country_code=LEFT(p.phone_number,3) GROUP BY o.name HAVING AVG(c.duration) >(SELECT AVG(duration) FROM Calls)
Select B.name as country From (Select caller_id as user_id, duration From Calls UNION ALL Select callee_id as user_id, duration From Calls) A LEFT Join (Select P.id as user_id, C.name From Person P Inner Join Country C On LEFT(P.phone_number,3)=C.country_code) B On A.user_id=B.user_id Group by B.name Having AVG(duration) > (Select AVG(duration) as world_time From Calls)
Select C.name as country From Person as P Left Join Country as C on Left(P.phone_number, 3) = C.country_code Join (Select caller_id as id, duration from Calls Union all Select callee_id as id, duration from Calls) phn On P.id = phn.id Group by country Having avg(duration) > (Select avg(duration) From Calls)
Select C.name as country from Person as P left join Country as C on left(P.phone_number,3)=C.country_code left join (select caller_id as id,duration as duration_1 from Calls Union all select callee_id as id,duration as duration_1 from Calls) as Calls_1 on P.id=Calls_1.id group by 1 having avg(duration_1) > (select AVG(duration) FROM calls)
Select Country.name as country From Person Inner Join Calls on Person.id = Calls.caller_id or Person.id = Calls.callee_id Inner Join Country On Country.country_code = Substring(Person.phone_number, 1, 3) Group By Country.country_code Having coalesce(Avg(Calls.duration), 0) > (Select coalesce(Avg(duration), 0) From Calls)
Select c.name as country From (Select caller_id as user, duration From Calls Union Select callee_id as user, duration From Calls) As temp Join Person as b On temp.user = b.id Join Country as c On left(b.phone_number,3) = c.country_code Group By c.name, c.country_code Having avg(temp.duration) > ( Select sum(duration)/count(*) From Calls)
Select country from (select c.name as country, avg(ca.duration) over(partition by c.name)as avg_duration, avg(ca.duration) over() as global_avg_duration from calls ca join person p on ca.caller_id = p.id OR ca.callee_id = p.id join country c on SUBSTRING_INDEX( phone_number, '-', 1 )= c.country_code )aa where avg_duration> global_avg_duration group by 1
Select country from (select c.name as country, avg(ca.duration) over(partition by c.name)as avg_duration, avg(ca.duration) over() as global_avg_duration from calls ca join person p on ca.caller_id = p.id OR ca.callee_id = p.id join country c on substring(p.phone_number,1,3)= c.country_code )aa where avg_duration> global_avg_duration group by 1
Select country from (select c.name as country, avg(ca.duration) over(partition by c.name)as avg_duration, avg(ca.duration) over() as global_avg_duration from calls ca left join person p on ca.caller_id = p.id OR ca.callee_id = p.id left join country c on substring(p.phone_number,1,3)= c.country_code )aa where avg_duration> global_avg_duration group by 1
WITH ALL_CALLS AS ( SELECT caller_id AS user_id, duration FROM Calls UNION ALL SELECT callee_id AS user_id, duration FROM Calls ), Persons AS ( SELECT p.*, c.name AS country FROM Person p LEFT JOIN Country c ON SUBSTRING(p.phone_number, 1, 3) = c.country_code ) SELECT country FROM ALL_CALLS c LEFT JOIN Persons p ON p.id = c.user_id GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH CTE AS ( SELECT a.id, a.country_code, b.name AS country, c.duration FROM ( SELECT id, LEFT(phone_number, 3) AS country_code FROM Person ) a LEFT JOIN Country b ON a.country_code = b.country_code LEFT JOIN ( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls ) c ON a.id = c.id ) SELECT country FROM CTE GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM CTE)
WITH CTE AS ( SELECT cou.country_code, cou.name, sub.duration FROM ( SELECT c.caller_id, p.name, p.phone_number, SUBSTR(p.phone_number, 1, 3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.caller_id = p.id UNION ALL SELECT c.callee_id, p.name, p.phone_number, SUBSTR(p.phone_number, 1, 3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.callee_id = p.id ) sub LEFT JOIN Country cou ON sub.country_code = cou.country_code ) SELECT sub2.name AS country FROM ( SELECT name, AVG(duration) AS avg_duration FROM CTE GROUP BY name HAVING AVG(duration) > (SELECT AVG(duration) FROM CTE) ) sub2
WITH CTE AS (SELECT A.id, B.name FROM Person A JOIN Country B ON SUBSTRING(A.phone_number, 1,3) = B.country_code) SELECT t.name AS country FROM (SELECT B.name, A.duration FROM Calls A JOIN CTE B ON A.caller_id = B.id UNION ALL SELECT D.name, C.duration FROM Calls C JOIN CTE D ON C.callee_id = D.id ) t GROUP BY t.name HAVING AVG(t.duration) > (SELECT AVG(duration) FROM Calls)
WITH CTE AS (SELECT C2.name, AVG(duration) avg_call FROM Calls C1 JOIN Person P1 ON C1.caller_id = P1.id OR C1.callee_id = P1.id LEFT JOIN Country C2 ON LEFT(P1.phone_number,3) = C2.country_code GROUP BY 1) SELECT name country FROM CTE WHERE avg_call > (SELECT AVG(duration) FROM Calls)
WITH CTE AS( Select c.name, avg(ca.duration) as country_avg From Country c join Person p on c.country_code = substring(p.phone_number,1,3) join Calls ca on ca.caller_id = p.id OR ca.callee_id = p.id group by c.name ) Select name as country from CTE where country_avg > (select avg(duration) from calls)
WITH CTE1 AS ( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id, duration FROM Calls), CTE2 AS ( SELECT CTE1.id, duration, SUBSTR(phone_number, 1, 3) AS country_code FROM CTE1 JOIN Person ON CTE1.id= Person.id), CTE3 AS ( SELECT DISTINCT country_code, AVG(duration) OVER (PARTITION BY country_code) AS in_duration, AVG(duration) OVER () AS t_duration FROM CTE2) SELECT COUNTRY.name AS country FROM Country WHERE country_code IN ( SELECT country_code FROM CTE3 WHERE in_duration>t_duration )
WITH DURATION AS ( SELECT AVG(duration) AS AVG_DURATION FROM Calls ), PERSON_COUNTRY AS ( SELECT A.id , A.name , A.phone_number , B.name AS COUNTRY FROM Person A LEFT JOIN Country B ON SUBSTRING(A.phone_number,1,3) = b.country_code ), COUNTRY_CALL AS ( SELECT B.COUNTRY AS CALLER_COUNTRY , C.COUNTRY AS CALLEE_COUNTRY , A.duration , 1 AS COUNT FROM Calls A LEFT JOIN PERSON_COUNTRY B ON A.caller_id = B.id LEFT JOIN PERSON_COUNTRY C ON A.callee_id = C.id ), FINAL_TABLE AS ( SELECT CALLER_COUNTRY AS COUNTRY , SUM(DURATION) AS DURATION , SUM(COUNT) AS COUNT FROM COUNTRY_CALL GROUP BY CALLER_COUNTRY UNION ALL SELECT CALLEE_COUNTRY AS COUNTRY , SUM(DURATION) AS DURATION , SUM(COUNT) AS COUNT FROM COUNTRY_CALL GROUP BY CALLEE_COUNTRY ), FINAL_TABLE_FOR_REAL AS ( SELECT COUNTRY , AVG(DURATION/COUNT) AS AVERAGE_DURATION FROM ( SELECT COUNTRY , SUM(DURATION) AS DURATION , SUM(COUNT) AS COUNT FROM FINAL_TABLE GROUP BY COUNTRY ) A GROUP BY COUNTRY ) SELECT COUNTRY FROM FINAL_TABLE_FOR_REAL A WHERE AVERAGE_DURATION > (SELECT AVG_DURATION FROM DURATION)
WITH Durations AS( SELECT A.duration, C.name AS country FROM Calls A LEFT JOIN Person B ON A.caller_id = B.id LEFT JOIN Country C ON SUBSTR(B.phone_number, 1, 3) = C.country_code UNION ALL SELECT A.duration, C.name FROM Calls A LEFT JOIN Person B ON A.callee_id = B.id LEFT JOIN Country C ON SUBSTR(B.phone_number, 1, 3) = C.country_code ) SELECT country FROM Durations GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH PC as ( Select id as Person_id, C.name country from Person P join Country C ON c.country_code = LEFT(P.phone_number,3) ), CALLS as ( Select caller_id as person_id,duration from calls union all Select callee_id as person_id,duration from calls ) Select PC.Country from PC join CALLS on PC.person_id = CALLS.person_id group by country having AVG(duration) > (Select avg(duration) from calls)
WITH PersonCounter AS (SELECT P.id ,C.name FROM Person P INNER JOIN Country C ON LEFT(P.phone_number,3) = C.country_code), CountryCalls AS (SELECT PC.name ,C.duration FROM Calls C INNER JOIN PersonCounter PC ON PC.id = C.caller_id UNION ALL SELECT PC.name ,C.duration FROM Calls C INNER JOIN PersonCounter PC ON PC.id = C.callee_id), CountryAverage AS (SELECT name ,AVG(duration) AS Avgduration FROM CountryCalls GROUP BY name) SELECT name AS country FROM CountryAverage WHERE Avgduration > (SELECT AVG(duration) FROM CountryCalls)
WITH Person_tmp AS ( SELECT id, LEFT(phone_number, 3) AS country_code FROM Person ), Calls_tmp AS ( SELECT caller_id AS id, duration FROM Calls UNION SELECT callee_id AS id, duration FROM Calls ) SELECT name AS country FROM Country WHERE country_code IN ( SELECT country_code FROM ( SELECT c.*, country_code, AVG(duration) AS avg_duration FROM Calls_tmp c LEFT JOIN Person_tmp p ON c.id = p.id GROUP BY country_code ) t WHERE avg_duration > ( SELECT AVG(duration) FROM Calls ) )
WITH T1 AS ( SELECT Caller_id AS id,duration,LEFT(phone_number,3) AS num FROM Calls C1 INNER JOIN Person P1 ON C1.caller_id = P1.id UNION ALL SELECT Callee_id AS id,duration,LEFT(phone_number,3) AS num FROM Calls C2 INNER JOIN Person P2 ON C2.callee_id = P2.id) SELECT DISTINCT name AS country FROM ( SELECT name, CASE WHEN AVG(duration) OVER (PARTITION BY name) <= AVG(duration) OVER () THEN 0 ELSE 1 END AS test FROM T1 INNER JOIN Country C ON T1.num = C.country_code) AS sub WHERE test = 1
WITH T1 AS ( SELECT caller_id id, duration, SUBSTRING(phone_number, 1, 3) c_code FROM calls c JOIN person p ON p.id = c.caller_id UNION ALL SELECT callee_id id, duration, SUBSTRING(phone_number, 1, 3) c_code FROM calls c JOIN person p ON p.id = c.callee_id) SELECT c.name country FROM T1 JOIN country c ON c.country_code = T1.c_code GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM T1)
WITH TEMP AS ( SELECT caller_id AS id, duration FROM calls UNION SELECT callee_id AS id, duration FROM calls ) SELECT c.name AS country FROM temp t JOIN person p ON (t.id = p.id) JOIN country c ON (SUBSTR(phone_number, 1, 3) = c.country_code) GROUP BY country_code HAVING AVG(duration) > (SELECT AVG(duration) AS globAvg FROM calls)
WITH TT1 (Average) AS ( SELECT SUM(duration)/COUNT(*) FROM (SELECT Caller_id, id, Callee_id, duration, LEFT(phone_number,3) AS number FROM Calls LEFT JOIN Person ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id) AS t1 JOIN Country ON t1.number = Country.country_code) , TT2 (name, A2) AS ( SELECT Country.name, SUM(duration)/COUNT(*) FROM (SELECT Caller_id, id, Callee_id, duration, LEFT(phone_number,3) AS number FROM Calls LEFT JOIN Person ON Calls.caller_id = Person.id OR Calls.callee_id = Person.id) AS t1 JOIN Country ON t1.number = Country.country_code GROUP BY Country.name) SELECT TT2.name as country FROM TT1, TT2 WHERE TT2.A2 > TT1.Average
WITH a AS ( SELECT caller_id AS id, duration FROM calls UNION ALL SELECT callee_id AS id, duration FROM Calls), b AS ( SELECT a.duration, SUBSTRING(Person.phone_number, 1, 2+1) AS country_code FROM a JOIN Person ON a.id = Person.id), c AS ( SELECT AVG(duration) as average FROM b ), d AS ( SELECT country_code, AVG(duration) AS duration FROM b GROUP BY country_code HAVING duration>(SELECT * FROM c) ) SELECT Country.name AS country FROM Country JOIN d ON Country.country_code = d.country_code
WITH a AS( SELECT id, Country.name as countryname FROM Person LEFT JOIN Country ON substr(Person.phone_number,1,3) = Country.country_code ), b AS( SELECT a.countryname as cn,avg(duration) as c_duration FROM Calls LEFT JOIN a ON Calls.caller_id = a.id or Calls.callee_id = a.id GROUP BY a.countryname ) SELECT b.cn as country FROM b WHERE c_duration > (SELECT avg(duration)as global_ave FROM Calls)
WITH all_call_durations AS (SELECT co1.name, duration FROM calls c1 LEFT JOIN person p1 ON c1.caller_id = p1.id LEFT JOIN country co1 ON LEFT(p1.phone_number,3) = co1.country_code UNION ALL SELECT co2.name, duration FROM calls c2 LEFT JOIN person p2 ON c2.callee_id = p2.id LEFT JOIN country co2 ON LEFT(p2.phone_number,3) = co2.country_code ) SELECT name as country FROM (SELECT name, AVG(duration) as avg_duration FROM all_call_durations GROUP BY NAME) z WHERE avg_duration > (SELECT AVG(duration) FROM calls)
WITH all_calls AS ( SELECT * FROM Calls UNION ALL SELECT callee_id AS caller_id, caller_id AS callee_id, duration FROM Calls) SELECT c.name AS country FROM all_calls LEFT JOIN Person p ON all_calls.caller_id = p.id JOIN Country c ON SUBSTRING(p.phone_number, 1, 3) = c.country_code GROUP BY c.name HAVING AVG(all_calls.duration) > (SELECT AVG(all_calls.duration) FROM all_calls)
WITH all_calls AS( SELECT caller_id call_id, duration FROM Calls UNION ALL SELECT callee_id call_id, duration FROM Calls) SELECT c.name country FROM Country c JOIN Person p ON c.country_code=LEFT(p.phone_number,3) JOIN all_calls a ON p.id=a.call_id GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM all_calls)
WITH all_calls as ( select co.name, ca.duration from calls as ca join person as p on ca.caller_id = p.id join country as co on substring(p.phone_number,1,3) = co.country_code UNION all select co.name, ca.duration from calls as ca join person as p on ca.callee_id = p.id join country as co on substring(p.phone_number,1,3) = co.country_code ), Country_Avg as ( select name as country, sum(duration) / count(*) as avg_duration from all_calls group by name ) Select country from country_avg where avg_duration > (select (sum(duration) * 2) / (count(*) * 2) as total_avg from calls)
WITH c1 AS (SELECT a.* ,b.country FROM (SELECT caller_id AS id ,duration FROM Calls UNION ALL SELECT callee_id AS id ,duration FROM Calls) a LEFT JOIN (SELECT p.* ,c.name AS country FROM Person p LEFT JOIN Country c ON LEFT(p.phone_number,3)=c.country_code) b ON a.id = b.id) SELECT country FROM c1 GROUP BY 1 HAVING AVG(duration) > (SELECT AVG(duration) FROM c1)
WITH c1 as (SELECT id, SUBSTRING_INDEX(phone_number, '-', 1) as country_code FROM Person) SELECT name as country FROM Country as c2 LEFT JOIN c1 ON c2.country_code=c1.country_code LEFT JOIN Calls as c3 ON c1.id=c3.caller_id OR c1.id=c3.callee_id GROUP BY c2.name HAVING AVG(c3.duration) > (SELECT AVG(duration) FROM Calls)
WITH caller AS (SELECT c.name AS country, SUM(a.duration) AS duration, COUNT(*) AS call_cnt FROM Person p INNER JOIN Country c ON left(p.phone_number,3) = c.country_code INNER JOIN Calls a ON a.caller_id = p.id GROUP BY c.name ), callee AS (SELECT c.name AS country, SUM(a.duration) AS duration, COUNT(*) AS call_cnt FROM Person p INNER JOIN Country c ON left(p.phone_number,3) = c.country_code INNER JOIN Calls a ON a.callee_id = p.id GROUP BY c.name ) SELECT country FROM ( SELECT * FROM caller UNION ALL SELECT * FROM callee )t GROUP BY country HAVING SUM(duration)/SUM(call_cnt) > (SELECT AVG(duration) FROM Calls)
WITH country_calls AS ( SELECT LEFT(p.phone_number,3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.caller_id = p.id UNION ALL SELECT LEFT(p.phone_number,3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.callee_id = p.id ), country_avg AS ( SELECT c.name, AVG(cc.duration) AS avg_duration FROM country_calls cc LEFT JOIN Country c ON cc.country_code = c.country_code GROUP BY cc.country_code ) SELECT name AS country FROM country_avg WHERE avg_duration > ( SELECT AVG(duration) FROM Calls )
WITH country_code AS ( SELECT id, c.name FROM person as p INNER JOIN country as c ON c.country_code = SUBSTRING_INDEX(p.phone_number, '-', 1)), call_duration AS ( SELECT caller_id as id, duration FROM calls UNION ALL SELECT callee_id as id, duration FROM calls) SELECT name as country FROM country_code INNER JOIN call_duration ON country_code.id = call_duration.id GROUP BY name HAVING AVG(duration) > (SELECT AVG(duration) FROM calls)
WITH cte AS ( SELECT *, substr(phone_number, 1, 3) as country_code FROM person ), cte2 AS ( SELECT caller_id as id, duration FROM calls UNION ALL SELECT callee_id as id, duration FROM calls ) SELECT c.name as country FROM cte JOIN country as c ON cte.country_code = c.country_code JOIN cte2 ON cte.id = cte2.id GROUP BY c.name HAVING avg(duration) > ( SELECT avg(duration) FROM cte2 )
WITH cte AS (SELECT a.id, b.name FROM Person a LEFT JOIN Country b ON (LEFT(a.phone_number,3)) = b.country_code), cte2 AS ( SELECT b.name AS country, duration FROM Calls a LEFT JOIN cte b ON a.caller_id = b.id UNION ALL SELECT b.name AS country, duration FROM Calls a LEFT JOIN cte b ON a.callee_id = b.id) SELECT country FROM cte2 GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH cte AS (SELECT caller_id AS caller, duration AS duration FROM Calls UNION ALL SELECT callee_id AS caller, duration AS duration FROM Calls), country_calls AS (SELECT c.duration, c2.name FROM cte AS c JOIN Person AS p ON c.caller = p.id JOIN Country AS c2 ON SUBSTRING(p.phone_number,1,3) = c2.country_code) SELECT name AS country FROM country_calls GROUP BY name HAVING SUM(duration)/COUNT(*) > (SELECT SUM(duration)/COUNT(*) FROM Calls)
WITH cte AS (SELECT t2.caller_id as caller_id,t2.calls as calls,t2.duration as duration,SUBSTRING(p.phone_number,1,3) as country_code FROM (SELECT t1.caller_id as caller_id,SUM(t1.calls) as calls,SUM(t1.duration) as duration FROM (SELECT caller_id,COUNT(duration) as calls,SUM(duration) as duration FROM Calls GROUP BY 1 UNION ALL SELECT callee_id,COUNT(duration) as calls,SUM(duration) as duration FROM Calls GROUP BY 1) t1 GROUP BY 1 ) t2 LEFT JOIN Person p ON t2.caller_id = p.id) SELECT c.name as country FROM cte LEFT JOIN Country c ON c.country_code=cte.country_code GROUP BY 1 HAVING SUM(cte.duration) /SUM(cte.calls) > (SELECT SUM(duration)/SUM(calls) FROM cte)
WITH cte AS( SELECT c.caller_id as id, c.duration, LEFT(p.phone_number,3) as countrycode FROM Calls as c JOIN Person as p ON c.caller_id=p.id UNION ALL SELECT c.callee_id as id, c.duration, left(p.phone_number, 3) as countrycode FROM Calls as c JOIN Person AS p ON c.callee_id=p.id ), countryavg as( SELECT c.name AS country, avg(duration) as avgduration FROM Country as c LEFT JOIN cte as cte ON c.country_code=cte.countrycode GROUP BY c.country_code ) SELECT country FROM countryavg WHERE avgduration> (SELECT avg(duration) from calls)
WITH cte AS( SELECT caller_id as cid, duration from Calls UNION ALL SELECT callee_id as id, duration from Calls), cte2 AS ( SELECT substring(phone_number,1,3) as 'code', SUM(duration)/count(id) as num FROM cte LEFT JOIN Person p ON cte.cid = p.id GROUP BY substring(phone_number,1,3) ) SELECT name AS country FROM cte2 LEFT JOIN Country c ON c.country_code = cte2.code WHERE num > (select sum(duration)/count(*) from Calls)
WITH cte AS( SELECT duration, country.name FROM( SELECT caller_id as id, duration FROM calls UNION ALL SELECT callee_id AS id, duration FROM calls ) a LEFT JOIN Person using (Id) LEFT JOIN Country ON left(Person.phone_number, 3)=country.country_code ) SELECT name as country FROM CTE GROUP BY name HAVING AVG(duration)> (SELECT AVG(duration) FROM calls)
WITH cte AS( SELECT id, SUBSTRING(phone_number, 1, 3) AS c_code FROM Person) , cte1 AS ( SELECT caller_id AS call_id, duration FROM Calls UNION ALL SELECT callee_id, duration FROM Calls) , cte2 AS( SELECT co.name, AVG(c1.duration) AS total FROM cte1 c1 JOIN cte c ON c1.call_id = c.id JOIN Country co ON c.c_code = co.country_code GROUP BY co.name) SELECT name AS country FROM cte2 WHERE total > (SELECT AVG(duration) FROM cte1)
WITH cte_duration AS ( SELECT co.name, c.duration FROM Calls c INNER JOIN Person p ON c.caller_id = p.id OR c.callee_id = p.id INNER JOIN Country co ON co.country_code = LEFT(p.phone_number, 3) ) SELECT country FROM ( SELECT name AS country, AVG(duration) AS country_avg_duration FROM cte_duration GROUP BY name ) d WHERE country_avg_duration > (SELECT AVG(duration) FROM cte_duration)
WITH dur AS ( SELECT id, SUM(tot) AS total, SUM(num) AS num FROM ( SELECT caller_id AS id, SUM(duration) AS tot, COUNT(duration) AS num FROM calls GROUP BY caller_id UNION ALL SELECT callee_id AS id, SUM(duration) AS tot, COUNT(duration) AS num FROM calls GROUP BY callee_id ) AS sub GROUP BY id ), main AS ( SELECT Person.*, Country.name AS country, total, num, SUM(total) OVER(PARTITION BY Country.name) AS id_tot, SUM(num) OVER(PARTITION BY Country.name) AS id_num, SUM(total) OVER() AS global_tot, SUM(num) OVER() AS global_num FROM Person INNER JOIN Country ON LEFT(phone_number,3)=country_code LEFT JOIN dur ON Person.id = dur.id ) SELECT DISTINCT country FROM main WHERE id_tot/id_num > global_tot/global_num
WITH global_avg AS ( SELECT AVG(duration) AS avg_duration FROM Calls ), country_calls AS ( SELECT LEFT(p.phone_number,3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.caller_id = p.id UNION ALL SELECT LEFT(p.phone_number,3) AS country_code, c.duration FROM Calls c LEFT JOIN Person p ON c.callee_id = p.id ), country_avg AS ( SELECT country_code, AVG(duration) AS avg_duration FROM country_calls GROUP BY country_code ) SELECT c.name AS country FROM country_avg ca LEFT JOIN Country c ON ca.country_code = c.country_code WHERE ca.avg_duration > ( SELECT AVG(duration) FROM Calls )
WITH global_calls as (SELECT 'Global' as Country, AVG(c.duration) as avg_duration FROM calls c), country_calls as ( SELECT ct.name as Country, AVG(c.duration) as avg_duration FROM calls c INNER JOIN person p on p.id = c.caller_id OR p.id = c.callee_id INNER JOIN country ct on TRIM(LEADING '0' FROM ct.country_code) = TRIM(LEADING '0' FROM LEFT(p.phone_number,3)) GROUP BY 1 ) select cc.country from country_calls cc WHERE cc.avg_duration > (SELECT avg_duration from global_calls)
WITH m AS ( SELECT caller_id AS id, duration FROM calls UNION SELECT callee_id AS id, duration FROM calls ) SELECT c.name AS country FROM m INNER JOIN person p ON p.id = m.id INNER JOIN country c ON c.country_code = LEFT(p.phone_number, 3) GROUP BY c.name HAVING avg(duration) > (SELECT AVG(duration) FROM calls)
WITH name AS (SELECT p.id, p.name AS person_name, c.name AS country_name FROM Person p LEFT JOIN Country c ON LEFT(p.phone_number, 3) = c.country_code) SELECT country_name AS country FROM (SELECT n1.country_name, duration FROM Calls c LEFT JOIN name n1 ON c.caller_id = n1.id LEFT JOIN name n2 ON c.callee_id = n2.id UNION ALL SELECT n2.country_name, duration FROM Calls c LEFT JOIN name n1 ON c.caller_id = n1.id LEFT JOIN name n2 ON c.callee_id = n2.id) tmp GROUP BY country_name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH pc AS ( SELECT p.id, p.country_code, c.name AS country FROM ( (SELECT id, left(phone_number, 3) AS country_code FROM Person) p LEFT JOIN Country c ON p.country_code = c.country_code ) ), Caller AS ( SELECT c.caller_id AS id, c.duration, pc.country_code, pc.country FROM Calls c LEFT JOIN pc ON c.caller_id = pc.id ), Callee AS ( SELECT c.callee_id AS id, c.duration, pc.country_code, pc.country FROM Calls c LEFT JOIN pc ON c.callee_id = pc.id ), c AS ( SELECT * FROM Caller UNION ALL SELECT * FROM Callee ), cavg AS ( SELECT country, AVG(duration) OVER(PARTITION BY country_code) AS cd, AVG(duration) OVER() AS gd FROM c ) SELECT DISTINCT country as country FROM cavg WHERE cd > gd
WITH person_country AS ( SELECT p.id, c.name AS country_name FROM Person p LEFT JOIN Country c ON LEFT(p.phone_number, 3) = c.country_code ), all_calls AS ( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls ) SELECT pc.country_name AS country FROM person_country pc LEFT JOIN all_calls ac ON pc.id = ac.id GROUP BY pc.country_name HAVING AVG(ac.duration) > (SELECT AVG(duration) FROM Calls)
WITH ref as ( SELECT c.name as country, AVG(duration) as avg_call FROM Calls ca LEFT JOIN Person p ON ca.caller_id=p.id OR ca.callee_id=p.id LEFT JOIN Country c ON LEFT(phone_number, 3)=c.country_code GROUP BY c.name) SELECT country FROM ref WHERE avg_call> (SELECT avg(duration) FROM Calls)
WITH t AS ( SELECT caller_id AS id, duration FROM calls UNION ALL SELECT callee_id AS id, duration FROM calls ) SELECT c.name AS country FROM t JOIN Person p USING (id) JOIN Country c ON c.country_code = LEFT(p.phone_number, 3) GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH t AS ( SELECT caller_id, duration FROM Calls UNION ALL SELECT callee_id, duration FROM Calls ) SELECT c.name AS country FROM t JOIN Person p ON p.id = t.caller_id JOIN Country c ON c.country_code = LEFT(p.phone_number, 3) GROUP BY LEFT(p.phone_number, 3) HAVING AVG(t.duration) > (SELECT AVG(duration) FROM t)
WITH t AS ( SELECT caller_id, duration, LEFT(phone_number, 3) AS country_code FROM Calls c INNER JOIN Person p ON c.caller_id=p.id UNION ALL SELECT callee_id, duration, LEFT(phone_number, 3) AS country_code FROM Calls c INNER JOIN Person p ON c.callee_id=p.id ), t1 AS ( SELECT t.country_code, name, AVG(duration) AS country_duration FROM t INNER JOIN Country c ON t.country_code=c.country_code GROUP BY t.country_code ), average AS ( SELECT AVG(duration) as avg_duration FROM t ) SELECT name AS country FROM t1 WHERE country_duration > (SELECT avg_duration FROM average)
WITH t AS ( SELECT co.name AS country, duration FROM Calls ca INNER JOIN Person p ON ca.caller_id = p.id INNER JOIN Country co ON LEFT(p.phone_number, 3) = co.country_code UNION ALL SELECT co.name AS country, duration FROM Calls ca INNER JOIN Person p ON ca.callee_id = p.id INNER JOIN Country co ON LEFT(p.phone_number, 3) = co.country_code ) SELECT country FROM t GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM t)
WITH t1 AS ( SELECT p.id, c.country_code, c.name FROM Person p LEFT JOIN Country c ON LEFT(p.phone_number, 3) = c.country_code ), t2 AS ( SELECT t1.name, duration FROM ( (SELECT caller_id, duration FROM Calls) UNION ALL (SELECT callee_id caller_id, duration FROM Calls) ) tmp1 LEFT JOIN t1 ON tmp1.caller_id = t1.id ) SELECT name country FROM (SELECT DISTINCT name, AVG(duration) OVER(PARTITION BY name) country_avg, AVG(duration) OVER() global_avg FROM t2) tmp2 WHERE country_avg > global_avg
WITH table1 AS( SELECT id, LEFT(phone_number,3) AS code FROM Person ), table2 AS( SELECT id, c.name AS country FROM table1 LEFT JOIN Country c ON table1.code=c.country_code ), table3 AS( (SELECT country, caller_id, duration FROM Calls c INNER JOIN table2 ON c.caller_id=table2.id) UNION ALL (SELECT country, callee_id, duration FROM Calls c INNER JOIN table2 ON c.callee_id=table2.id) ), table4 AS( SELECT country, AVG(duration)OVER(PARTITION BY country) AS country_avg, AVG(duration)OVER() AS global_avg FROM table3 ) SELECT DISTINCT country FROM table4 WHERE country_avg > global_avg
WITH temp as (SELECT *, LEFT(phone_number, 3) as country_code FROM Person) SELECT c1.name as country FROM Country c1 LEFT JOIN temp t ON c1.country_code = t.country_code LEFT JOIN calls c2 ON t.id = c2.caller_id OR t.id = c2.callee_id GROUP BY c1.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH temp1 AS ( SELECT caller_id, duration FROM Calls UNION ALL SELECT callee_id, duration FROM Calls ), temp2 AS ( SELECT *, SUBSTRING(phone_number, 1, 3) AS 'code' FROM Person ), temp3 AS ( SELECT temp1.duration, c.name FROM (Country c RIGHT JOIN temp2 ON temp2.code = c.country_code) RIGHT JOIN temp1 ON temp2.id = temp1.caller_id ) SELECT name AS country FROM temp3 GROUP BY name HAVING AVG(duration) > (SELECT AVG(duration) FROM temp1)
WITH temp1 as ( SELECT *, LEFT(phone_number, 3) as country_code FROM Person ) SELECT c1.name as country FROM Country c1 LEFT JOIN temp1 t1 ON c1.country_code = t1.country_code LEFT JOIN calls c2 ON t1.id = c2.caller_id OR t1.id = c2.callee_id GROUP BY c1.name HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
WITH uni AS ( SELECT caller_id AS id, duration FROM calls UNION ALL SELECT callee_id AS id, duration FROM calls ), map AS ( SELECT p.id, c.name FROM person AS p JOIN country AS c ON LEFT(p.phone_number, 3) = c.country_code ) SELECT DISTINCT m.name AS country FROM uni AS u JOIN map AS m ON u.id = m.id GROUP BY 1 HAVING AVG(u.duration) > (SELECT AVG(duration) FROM calls)
WITH union_table AS (SELECT caller_id as calling, duration FROM Calls UNION ALL SELECT callee_id as calling, duration FROM Calls), person_country as ( SELECT p.id, c.name as country_name FROM (SELECT *,LEFT(phone_number, 3) as country_c FROM Person) p JOIN Country c ON p.country_c = c.country_code ), final as (SELECT country_name, AVG(duration) > (SELECT AVG(duration) FROM Calls) as durat FROM union_table t JOIN person_country p ON t.calling = p.id GROUP BY country_name ) SELECT country_name as country FROM final WHERE durat = 1
With CTE AS ( SELECT b.name, AVG(c.duration) as average FROM Person a INNER JOIN Country b ON substr(a.phone_number, 1, 3) = b.country_code INNER JOIN Calls c ON c.caller_id = a.id OR c.callee_id = a.id GROUP BY b.name ) SELECT name AS country FROM CTE where average > ( SELECT AVG(duration) FROM Calls )
With t AS( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) SELECT distinct name AS Country FROM (SELECT c.name, avg(duration) over(partition by c.name) AS c_avg, avg(duration) over() AS g_avg FROM t JOIN Person p ON t.id=p.id JOIN Country c ON left(p.phone_number,3)=c.country_code) a WHERE c_avg>g_avg
With tmp AS ( SELECT b.name, SUM(c.duration) AS p_sum, COUNT(c.caller_id) AS counts FROM Person a INNER JOIN Country b ON substr(a.phone_number, 1, 3) = b.country_code INNER JOIN Calls c ON c.caller_id = a.id OR c.callee_id = a.id GROUP BY b.name ) SELECT name AS country FROM tmp GROUP BY name HAVING SUM(p_sum) / SUM(counts) > ( SELECT AVG(duration) FROM Calls )
With vt as (Select name, sum(duration) as duration, count(name) as nums from calls c left join (Select id,c.name from person p left join country c on c.country_code= substring(p.phone_number,1,3)) x on c.caller_id=x.id group by name union all select name,sum(duration) as duration, count(name) as nums from calls c left join (Select id,c.name from person p left join country c on c.country_code= substring(p.phone_number,1,3)) x on c.callee_id=x.id group by name) Select name as 'country' from (Select name, sum(duration)/sum(nums), case when sum(duration)/sum(nums) > (select avg(duration) from calls) then 'yes' else 'no' end as 'ans' from vt group by name) m where ans= 'yes'
select Co.name as country from Person P JOIN Country Co on substr(P.phone_number,1,3) = Co.country_code JOIN Calls Ca on P.id = Ca.caller_id OR P.id = Ca.callee_id group by Co.name having avg(Ca.duration) > (select avg(duration) from Calls)
select Country.name as country from Country join ( select * from (select avg(duration) as global_avg_duration from Calls) as t1, (select SUBSTRING(phone_number,1,3) as prefix, avg(duration) avg_duration from Person join (select caller_id, duration from Calls union all select callee_id as caller_id, duration from Calls) as calls_union on (calls_union.caller_id=Person.id) group by prefix) as t2 where avg_duration>global_avg_duration) as t3 on (Country.country_code=t3.prefix)
select Country.name as country from Person join Country on left(phone_number,3) = Country.country_code join Calls on Person.id in (Calls.caller_id, Calls.callee_id) group by country having avg(duration) > (select avg(duration) from Calls)
select a.name as country from Country a join Person b on a.country_code = substring(b.phone_number, 1,3) join Calls c on b.id = c.caller_id or b.id = c.callee_id group by 1 having avg(duration) > (select avg(duration) from Calls)
select b.name as country from (select distinct country_code from (select avg(duration) over(partition by country_code) as avg_country,country_code,avg(duration) over() as average_global from (select a.duration,a.caller_id,b.country_code from (select duration,caller_id from Calls union all select duration, callee_id as caller_id from Calls)a left join (select *,left(phone_number,3) as country_code from Person)b on a.caller_id=b.id)c) d where avg_country>average_global) e left join Country b on e.country_code=b.country_code
select b.name as country from Person a join Country b on substring(a.phone_number,1,3) = b.country_code join Calls c on (a.id = c.caller_id) or (a.id = c.callee_id) group by b.name having avg(c.duration ) > (select avg(duration) from calls)
select c.Name as country from (select caller_id as id, duration from Calls UNION ALL select callee_id as id, duration from Calls) a join Person p on a.id=p.id join Country c on c.country_code=substring(p.phone_number,1,3) group by c.Name having avg(duration)>(select avg(duration) from Calls)
select c.name as 'country' from person p join country c on c.country_code = left(p.phone_number,3) join calls ca on ca.caller_id = p.id or ca.callee_id = p.id group by c.name having avg(duration) > (select avg(duration) from calls)
select c.name as Country from country c join person p on substring(phone_number,1,3) = c.country_code join calls a on p.id IN (a.caller_id,a.callee_id) group by 1 having avg(duration) > (select avg(duration) from calls)
select c.name as country from ( select caller_id as call_id, duration from calls union all select callee_id as call_id, duration from calls ) a join person b on a.call_id = b.id join country c on left(b.phone_number, 3) = c.country_code group by c.country_code having avg(a.duration) > (select avg(duration) from calls)
select c.name as country from ( select caller_id as id, duration from calls UNION ALL select callee_id as id, duration from calls ) a join person p on p.id= a.id join country c on c.country_code=left(p.phone_number,3) group by 1 having avg(duration)>(select avg(duration) from calls)
select c.name as country from ( select caller_id as id, duration from calls a union all select callee_id as id, duration from calls b ) a join person p on a.id = p.id join country c on left(p.phone_number, 3) = c.country_code group by c.name having avg(duration) > (select avg(duration) from calls)
select c.name as country from ( select caller_id as id, duration from calls union all select callee_id as id, duration from calls ) f join person p on p.id = f.id join country c on c.country_code = substring(p.phone_number, 1, 3) group by 1 having avg(duration) > (select avg(duration) from calls)
select c.name as country from ( select caller_id as id, duration from calls union all select callee_id as id, duration from calls )f join person p on p.id = f.id join country c on c.country_code = substring(p.phone_number, 1, 3) group by 1 having avg(duration) > (select avg(duration) from calls)
select c.name as country from (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) a join Person b on a.id=b.id join Country c on left(b.phone_number,3)=c.country_code group by 1 having avg(duration)> (select avg(duration) as global_average from Calls)
select c.name as country from (select caller_id as id, duration from calls union all select callee_id as id, duration from calls) c1 left join person p on p.id = c1.id left join country c on c.country_code = left(p.phone_number,3) group by country having avg(c1.duration) > (select avg(duration) from calls)
select c.name as country from (select caller_id as id, duration from calls union select callee_id as id, duration from calls) t left join person p on t.id = p.id left join country c on c.country_code = substring(phone_number,1,3) group by 1 having sum(t.duration)/count(t.id) > (select sum(duration)/count(duration) from calls)
select c.name as country from Country c inner join Person p on left(p.phone_number,3) =c.country_code inner join (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) as temp on p.id = temp.id group by country having avg(duration) > (select avg(duration) from Calls)
select c.name as country from Country c inner join Person p on left(p.phone_number,3)= c.country_code inner join Calls a on p.id = a.caller_id or p.id=a.callee_id group by country_code having avg(duration) - (select avg(duration) from Calls) > 0
select c.name as country from Country c join Person p on c.country_code = left(p.phone_number,3) join (select caller_id as id ,duration from Calls union all select callee_id as id ,duration from Calls )tmp on tmp.id = p.id group by 1 having round(sum(tmp.duration)/count(tmp.id),1) > (select round((sum(duration)*2)/(count(*)*2),1) from Calls)
select c.name as country from Country c join Person p on c.country_code = left(p.phone_number,3) join Calls ca on p.id = ca.caller_id or p.id = ca.callee_id group by 1 having avg(duration) > (select avg(duration) from calls)
select c.name as country from Person p inner join Country c on left (p.phone_number,3) = c.country_code inner join (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) phn on p.id = phn.id group by country having avg(duration) > (select avg(duration) from Calls)
select c.name as country from Person p join Country c on left (p.phone_number,3) = c.country_code inner join (select caller_id as id, duration from Calls union select callee_id as id, duration from Calls) phn on p.id = phn.id group by country having avg(duration) > (select avg(duration) from Calls)
select c.name as country from Person p join Country c on left(phone_number, 3) = country_code join Calls on id = caller_id or id = callee_id group by c.name having avg(duration) > (select avg(duration) from Calls)
select c.name as country from Person p join Country c on left(phone_number, 3) = country_code join Calls on id = caller_id or id = callee_id group by c.name having avg(duration) > (select sum(duration) *2 / (select count(*)*2 from Calls) from Calls)
select c.name as country from Person p join Country c on substr(p.phone_number, 1, 3) = c.country_code join Calls c1 on c1.caller_id = p.id or c1.callee_id = p.id group by c.name having avg(duration) > (select avg(duration) from Calls)
select c.name as country from country as c join person as p on c.country_code=left(p.phone_number,3) join calls as ca on p.id=ca.caller_id or p.id=ca.callee_id group by 1 having avg(duration) >( select avg(duration) from calls)
select c.name as country from country c JOIN person p on LEFT(p.phone_number,3) = c.country_code JOIN calls on (p.id = calls.caller_id OR p.id = calls.callee_id) group by c.name having AVG(calls.duration) > (select (2*(SUM(duration))/(2*count(*))) as total_avg from calls)
select c.name as country from country c left join person p on c.country_code=substring(p.phone_number,1,3) left join calls ca on ca.caller_id=p.id or ca.callee_id=id group by c.name having avg(ca.duration) > (select avg(duration) from calls)
select c.name as country from person a join calls b on a.id = b.caller_id or a.id = b.callee_id join country c on c.country_code = left(a.phone_number, 3) group by c.name having avg(b.duration)>(select avg(duration) from calls)
select c.name as country from( select id, left(phone_number,3) as country_code from Person) p join Country c using(country_code) left join (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) comb on p.id=comb.id group by c.country_code having avg(duration) > (select avg(duration) from Calls)
select c1.name as country from person p left join country c1 on LEFT(p.phone_number,3) = c1.country_code left join calls c2 on p.id in (c2.caller_id, c2.callee_id) group by 1 having avg(duration) > (select avg(duration) from calls)
select cc.name as country from calls c join person p on p.id = c.caller_id or id = c.callee_id join country cc on cc.country_code = left(phone_number,3) group by cc.name having avg(c.duration) > (select avg(duration) from calls)
select co.name 'country' from person p join country co on substring(p.phone_number,1,3)=co.country_code join calls c on p.id in (c.caller_id, c.callee_id) group by co.name having avg(duration) > (select avg(duration) from calls)
select co.name as country from Person p join Calls ca on p.id = ca.caller_id OR ca.callee_id = p.id join Country co on substr(p.phone_number, 1, 3) = co.country_code group by co.country_code having avg(duration) > (select avg(duration) from Calls)
select co.name as country from calls c join person p on c.callee_id = p.id or c.caller_id = p.id join country co on left(phone_number, 3) = co.country_code group by 1 having avg(duration)> (select avg(duration) from calls)
select co.name as country from country as co inner join person as p on co.country_code = left(p.phone_number, 3) inner join calls as ca on p.id = ca.caller_id or p.id = ca.callee_id group by 1 having avg(ca.duration) > (select avg(duration) from calls)
select co.name as country from person p join country co on left(phone_number, 3) = country_code join calls c on p.id in (c.caller_id, c.callee_id) group by co.name having avg(duration) > (select avg(duration) from calls)
select co.name as country from person p left join calls c on p.id=c.caller_id or p.id=c.callee_id inner join country co on left(p.phone_number,3)=co.country_code group by 1 having avg(duration)>(select avg(duration) from calls)
select co.name country from Person p, Country co, Calls c where p.id in (c.caller_id, c.callee_id) and co.country_code = left(p.phone_number, 3) group by 1 having avg(duration) > (select avg(duration) from Calls)
select co.name country from calls ca join person p on ca.caller_id = p.id or ca.callee_id = p.id join country co on substr(p.phone_number, 1, 3) = co.country_code group by co.name having avg(ca.duration) > ( select avg(duration) from calls )
select country from ( select c.name as country, avg(duration) as avg_duration from Calls ca join Person p on (ca.caller_id = p.id) or (ca.callee_id = p.id) join Country c on (c.country_code = left(p.phone_number,3)) group by 1 ) t1 where avg_duration > (select avg(duration) as global_avg from Calls)
select country from ( select country, sum(dura)/sum(cnt) as avg_duration from (select c.name as country, sum(duration) as dura, count(caller_id) as cnt from Calls ca join Person p on (ca.caller_id = p.id) join Country c on (c.country_code = left(p.phone_number,3)) group by 1 UNION ALL select c.name as country, sum(duration) as dura, count(callee_id) as cnt from Calls ca join Person p on (ca.callee_id = p.id) join Country c on (c.country_code = left(p.phone_number,3)) group by 1) t1 group by 1) t2 where avg_duration > (select (sum(duration) * 2) / (count(1) * 2) as global_avg from Calls)
select country from (select a.name as country, avg(duration) as average from Country a, (select caller_id as id, duration from Calls union select callee_id, duration from Calls) b, Person c where c.id = b.id and substr(c.phone_number, 1,3) = a.country_code group by 1) e, (select avg(duration) as mean from Calls ) d where e.average > d.mean
select country from (select distinct c.name as country, avg(a.duration) over (partition by c.name) as avg_c, avg(a.duration) over () as avg_global from person p join country c on substring(phone_number, 1, 3) = c.country_code join (select caller_id as id, duration from calls union all select callee_id as id, duration from calls ) a on a.id = p.id ) b where avg_c > avg_global
select country.name as country from country join person on country.country_code=left(person.phone_number, 3) join calls on person.id=calls.caller_id or person.id=calls.callee_id group by country.country_code having avg(calls.duration) > (select avg(duration) from calls)
select country.name as country from country join person on country_code=left(phone_number, 3) join calls on person.id=calls.caller_id or person.id=calls.callee_id group by country_code having avg(duration) > (select avg(duration) from calls)
select country.name as country from country join person on left(person.phone_number, 3)=country.country_code join calls on person.id=calls.caller_id or person.id=calls.callee_id group by country.country_code having avg(duration) > (select avg(duration) from calls)
select country.name as country from country join person on left(phone_number, 3) = country_code join calls on person.id=calls.callee_id or person.id=calls.caller_id group by country_code having avg(duration) > (select avg(duration) from calls)
select country.name as country from country join person on left(phone_number, 3) = country_code join calls on person.id=calls.caller_id or person.id=calls.callee_id group by country_code having avg(duration) > (select avg(duration) from calls)
select country.name country from (select * from calls union all select callee_id, caller_id, duration from calls) c join person p on c.caller_id = p.id join country on substring(p.phone_number,1,3) = country.country_code group by country.name having avg(duration) > (select avg(duration) from calls)
select country.name country from calls, person, country where (calls.caller_id = person.id or calls.callee_id = person.id) and left(phone_number,3) = country_code group by country.name having sum(duration)/count(*) > (select sum(duration)/count(*) from calls)
select ct.name as country from ( select caller_id as id, duration from Calls union all select callee_id, duration from Calls ) as c left join ( select id, substring(phone_number,1,3) as country_code from Person ) as p on c.id = p.id left join Country as ct on p.country_code = ct.country_code group by 1 having avg(c.duration) > (select avg(duration) as global_avg from Calls)
select ct.name as country from (select caller_id as id, duration from calls UNION ALL select callee_id as id, duration from calls) c JOIN person p ON p.id = c.id JOIN country ct ON ct.country_code = substring(p.phone_number,1,3) group by ct.name having avg(c.duration) > (select avg(duration) from calls)
select d.name as country from (select distinct c.name, sum(a.duration) over (partition by c.name)/count(a.duration) over (partition by c.name) as avg_duration, sum(a.duration) over ()/count(a.duration) over () as sum_duration from (select caller_id as id, duration from calls union all select callee_id as id, duration from calls)a left join person b on a.id=b.id left join country c on substr(b.phone_number, 1,3)=c.country_code)d where d.avg_duration>d.sum_duration
select distinct c.name country from Person p join Country c on substring(p.phone_number, 1, 3) = c.country_code join (select id, duration from (select caller_id id, duration from Calls union all select callee_id id, duration from Calls) a ) b on p.id = b.id group by country_code having avg(duration) > (select avg(duration) from Calls)
select distinct country from ( select c.name as country, ca.duration, avg(ca.duration) over (partition by c.name) as con_avg, avg(ca.duration) over () as total_avg from person p left join country c on substring(p.phone_number,1,3) = c.country_code join calls ca on p.id=ca.caller_id or p.id=ca.callee_id ) a where con_avg>total_avg
select distinct country from (select c.name as country, avg(ca.duration) over (partition by c.name) as avg_duration, avg(ca.duration) over () as global_avg_duration from calls ca left join Person p on ca.caller_id = p.id or ca.callee_id = p.id left join Country as c on left(p.phone_number,3) = c.country_code ) as temp where avg_duration> global_avg_duration
select distinct country from (select d.name as country, avg(ca.duration)over(partition by d.name ) as ind_sum, avg(ca.duration)over() as total_sum from Calls ca left join Person p on (p.id=ca.caller_id) or (p.id=ca.callee_id) inner join Country d on substring(p.phone_number,1,3) = d.country_code )a where ind_sum > total_sum
select distinct country from( select c.name country, ca.duration ,avg(ca.duration) over(partition by c.name) avg_duration ,avg(ca.duration) over() avg_total from calls ca left join person p on (ca.caller_id = p.id) or (ca.callee_id = p.id) inner join country c on substring(p.phone_number,1,3) = c.country_code ) a where avg_duration > avg_total
select distinct country from( select c.name country, ca.duration ,avg(ca.duration) over(partition by c.name) avg_duration ,avg(ca.duration) over() avg_total from calls ca right join person p on (ca.caller_id = p.id) or (ca.callee_id = p.id) inner join country c on substring(p.phone_number,1,3) = c.country_code ) a where avg_duration > avg_total
select distinct country from( select p.id, c.name as country, avg(duration)over(partition by c.name)as country_ave_time, avg(duration)over()as total_time from calls ca left join person p on ca.caller_id=p.id or ca.callee_id=p.id join country c on c.country_code=left(p.phone_number,3))t1 where country_ave_time>total_time
select distinct country from( select p.id, c.name as country, avg(duration)over(partition by c.name)as country_ave_time, avg(duration)over()as total_time from calls ca left join person p on ca.caller_id=p.id or ca.callee_id=p.id left join country c on c.country_code=left(p.phone_number,3))t1 where country_ave_time>total_time
select distinct name as country from ( select name, avg(duration) over() as avg_g, avg(duration) over(partition by name) as avg_c from calls join ( select id, country.name from person join country on left(person.phone_number,3) = country.country_code ) as t on calls.caller_id = t.id or calls.callee_id = t.id ) as src where avg_c > avg_g
select distinct name as country from ( select name, avg(duration) over() as avg_global, avg(duration) over(partition by name) as country_avg from ( select caller_id, callee_id, duration, country.name from ( select caller_id, callee_id, duration from calls union select callee_id, caller_id, duration from calls ) as ca left join person on person.id = ca.caller_id left join country on left(person.phone_number,3) = country.country_Code ) as t ) as sr where country_avg > avg_global
select drv.country_name as country from (select p.name, p.id, left(p.phone_number,3) as country_code, c1.name as country_name, c.caller_id, c.callee_id, c.duration from person as p join calls as c on c.caller_id = p.id or c.callee_id = p.id join country as c1 on c1.country_code = left(p.phone_number,3) ) as drv group by country_name having round(sum(duration)/count(id),5) > (select (sum(duration)*2) / (count(caller_id) *2) as avg_call from calls)
select name "country" from ( select ca.caller_id, co.name, duration from calls ca join person p on p.id = ca.caller_id join country co on left(p.phone_number, 3) = co.country_code union select ca.callee_id, co.name, duration from calls ca join person p on p.id = ca.callee_id join country co on left(p.phone_number, 3) = co.country_code ) result_table group by 1 having avg(duration) > (select avg(duration) from calls)
select name as Country from (select country_code, avg(duration) as mean_duration from ((select c.caller_id as id, substr(p.phone_number, 1, 3) as country_code, duration from Calls c left join Person p on c.caller_id = p.id) union all (select c.callee_id as id, substr(p.phone_number, 1, 3) as country_code, duration from Calls c left join Person p on c.callee_id = p.id) )t group by country_code) t1 left join Country c on t1.country_code = c.country_code, (select avg(duration) as global_mean_duration from ((select c.caller_id as id, substr(p.phone_number, 1, 3) as country_code, duration from Calls c left join Person p on c.caller_id = p.id) union all (select c.callee_id as id, substr(p.phone_number, 1, 3) as country_code, duration from Calls c left join Person p on c.callee_id = p.id) )t2 ) t3 where t1.mean_duration > t3.global_mean_duration
select name as country from ( select country.name, avg(allcalls.duration) avg_country_duration from ( select caller_id as id, duration from calls union all select callee_id as id, duration from calls ) as allcalls left join person on person.id = allcalls.id left join country on country.country_code = left(person.phone_number,3) group by country.name) as t where avg_country_duration > (select avg(duration) from calls)
select name as country from (select distinct c.name, avg(t.duration) over(partition by c.country_code) as avg_country, avg(t.duration) over() as avg_global from (select caller_id as user_id, duration from Calls union all select callee_id, duration from Calls) as t join Person p on t.user_id = p.id join Country c on left(p.phone_number,3) = c.country_code) as j where avg_country > avg_global
select name as country from( select distinct N.name, (2 * sum(C.duration) over (partition by N.name)) / (2 * count(C.caller_id) over (partition by N.name)) as average, (2 * sum(C.duration) over ()) / (2 * count(C.caller_id) over ()) as global_average from Person as P inner join Country as N on left(P.phone_number, 3) = N.country_code inner join Calls as C on C.caller_id = P.id or C.callee_id = P.id) as TMP where average > global_average
select name as country from( select name, sum(duration) as sum_duration, sum(cnt) as sum_cnt from( select caller_id as id, c.name, sum(duration) as duration, count(caller_id) as cnt from person p join country c on c.country_code = substr(p.phone_number,1,3) join calls ca on ca.caller_id = p.id group by caller_id, c.name union all select callee_id as id, c.name, sum(duration) as duration, count(callee_id) as cnt from person p join country c on c.country_code = substr(p.phone_number,1,3) join calls ca on ca.callee_id = p.id group by callee_id, c.name )A group by name)B where sum_duration/sum_cnt > (select avg(duration) as global_average from calls)
select t1.name as country from (select a.name, b.id, avg(c.duration) as avg_call from Country as a left join Person as b on a.country_code = left(b.phone_number,3) left join (select distinct * from Calls) as c on b.id = c.caller_id or b.id = c.callee_id group by a.name) as t1 where t1.avg_call > (select sum(duration)/count(duration) from (select distinct * from Calls) as d)
select t4.name as country from ( select t3.name, avg(t1.duration) as country_avg, '1' as temp from calls t1 join person t2 on t1.caller_id=t2.id or t1.callee_id=t2.id join country t3 on left(t2.phone_number,3)=t3.country_code group by 1) t4 join (select avg(duration) as global_avg, '1' as temp from calls group by 2) t5 on t4.temp=t5.temp where t4.country_avg>t5.global_avg
with A as (select caller_id as user, duration from Calls union all select callee_id, duration from Calls) select C.name as country from A join Person P on A.user = P.id join Country C on left(P.phone_number,3) = C.country_code group by C.name having avg(duration) > (select avg(duration) from A)
with PersonCountry as (select * from Country C join( select id, substring(phone_number,1,3) as phone_code from Person ) P on C.country_code = P.phone_code ) select name as country from( select name, avg(duration) as average_duration from PersonCountry join Calls on id = caller_id or id = callee_id group by name ) PC where average_duration > (select avg(duration) from Calls)
with Person_tmp as ( select id, left(phone_number, 3) as country_code from Person ), Calls_tmp as ( select caller_id as calls_id, duration from Calls union select callee_id as calls_id, duration from Calls ) select name as country from Country where country_code in (select distinct country_code from (select c.*, country_code, avg(duration) over (partition by country_code) as avg_duration from Calls_tmp c left join Person_tmp p on c.calls_id = p.id) t where avg_duration > (select avg(duration) from Calls))
with a as ( select *, substring(phone_number,1,3) pcode from person p ), b as( (select ca.caller_id, ca.duration, co.name, co.country_code from calls ca left join a on ca.caller_id = a.id left join country co on a.pcode = co.country_code) union all (select ca.caller_id, ca.duration, co.name, co.country_code from calls ca left join a on ca.callee_id = a.id left join country co on a.pcode = co.country_code) ), c as( select avg(duration) wa from calls ) select name as country from b group by country_code having avg(duration) > (select * from c)
with a as (select caller_id as 'id', duration from calls union all select callee_id as 'id', duration from calls) select name as 'country' from (select a.id, c.name, duration from a left join person p on a.id = p.id left join country c on left(p.phone_number,3) = c.country_code) tmp group by name having sum(duration)/count(duration) > (select sum(duration)/count(duration) from a)
with a as( select caller_id as id,duration from Calls union all select callee_id,duration from Calls), b as( select c.name,avg(a.duration)over(partition by c.name) as avg_c, avg(a.duration)over() as avg_t from Person p left join a using (id) left join Country c on c.country_code=left(p.phone_number,3)) select distinct name as country from b where avg_c>avg_t
with a as(SELECT caller_id,callee_id,duration FROM Calls UNION ALL SELECT callee_id as caller_id, caller_id as callee_id,duration FROM Calls) , b as (SELECT distinct substring(p.phone_number,1,3) as code, avg(a.duration) as perc FROM a LEFT JOIN Person as p ON a.caller_id = p.id GROUP BY substring(p.phone_number,1,3)) SELECT c.name as country FROM b LEFT JOIN Country as c ON b.code = c.country_code WHERE perc > (SELECT avg(duration) from Calls)
with a as(SELECT caller_id,callee_id,duration FROM Calls UNION ALL SELECT callee_id as caller_id, caller_id as callee_id,duration FROM Calls) , b as (SELECT distinct substring(p.phone_number,1,3) as code, sum(a.duration)/count(a.caller_id) as perc FROM a LEFT JOIN Person as p ON a.caller_id = p.id GROUP BY substring(p.phone_number,1,3)) SELECT c.name as country FROM b LEFT JOIN Country as c ON b.code = c.country_code WHERE perc > (SELECT sum(duration)/count(*) from Calls)
with abc as (select id,name,left(phone_number,3) as c from person), xyz as (select a.id,a.name ,a.c, b.name as cou from abc as a join country as b on a.c =b.country_code), final as ( select a.duration , b.cou from calls as a join xyz as b on a.caller_id = b.id union all select a.duration , b.cou from calls as a join xyz as b on a.callee_id = b.id ), ans as ( select cou, avg(duration)over() as globald, avg(duration)over(partition by cou) as regionald from final ) select cou as country from ans where regionald > globald group by 1
with all_calls as (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls), cte as (select a.id, c.name as country, a.duration from all_calls a left join (select id, left(phone_number,3) as country_code from Person) p on a.id = p.id left join Country c on c.country_code = p.country_code ) select country from (select country, avg(duration) as avg_duration from cte group by country) t where avg_duration > (select avg(duration) from cte)
with arranged_calls as (select caller_id,duration from calls union select callee_id as caller_id,duration from calls) select distinct c.name as country from country c join person on country_code=left(phone_number,3) join arranged_calls on id=caller_id group by c.name having avg(duration)>(select avg(duration) as average from calls)
with base as ( ( select country_code, country.name, count(*) as calls, sum(c.duration) as duration from calls c join person p on c.caller_id = p.id join country on left(p.phone_number, 3) = country.country_code group by 1,2 ) union all ( select country_code, country.name, count(*) as calls, sum(c.duration) as duration from calls c join person p on c.callee_id = p.id join country on left(p.phone_number, 3) = country.country_code group by 1,2 ) ) select name as country from base group by country_code, name having sum(duration) / sum(calls) > (select sum(duration) / sum(calls) from base)
with base as ( select distinct caller_id as id, Country.name, duration from Calls left join Person on Calls.caller_id = Person.id left join country on country.country_code = left(Person.phone_number,3) union all select distinct callee_id as id, Country.name, duration from Calls left join Person on Calls.callee_id = Person.id left join country on country.country_code = left(Person.phone_number,3) ), base1 as ( select distinct name, avg(duration) over(partition by name) as avg_country, (select avg(duration) from Calls) as avg_global from base ) select name as country from base1 where avg_country>avg_global
with base as (select name, avg(duration) as avg_duration, count(*) as count_calls from (select country.name, duration from country, person, calls where person.id = caller_id AND substring(phone_number,1,3) = country_code UNION ALL select country.name, duration from country, person, calls where person.id = callee_id AND substring(phone_number,1,3) = country_code ) as A group by name ) select name as country from base where avg_duration > (select avg(duration) from calls)
with c as (select caller_id as callid, duration from calls union all select callee_id as callid, duration from calls) select ct.name as country from person p right join c on p.id = c.callid left join country ct on substring(p.phone_number, 1, 3)=ct.country_code group by ct.name having avg(c.duration) > (select avg(duration) from c)
with c1 as ( Select sum(duration)/count(*) global_avg from Calls ), c2 as ( Select p.id, c.name country_name, sum(ca.duration) call_duration, count(*) cnt from person p inner join country c on left(p.phone_number,3) = c.country_code inner join calls ca on p.id = ca.caller_id group by p.id, c.name union all Select p.id, c.name country_name, sum(ca.duration) call_duration, count(*) cnt from person p inner join country c on left(p.phone_number,3) = c.country_code inner join calls ca on p.id = ca.callee_id group by p.id, c.name ) Select country_name country from c2 group by country_name having sum(call_duration)/sum(cnt) > (select global_avg from c1 )
with call_duration as ( select caller_id as id, duration as duration from calls union all select callee_id as id, duration as duration from calls ) , call_info as ( select c.name as country, avg(cd.duration) as avg_dur from country c join person p on c.country_code = left(p.phone_number, 3) join call_duration cd on cd.id = p.id group by c.name ) select country from call_info where avg_dur > (select avg(duration) from calls)
with call_duration as (select * from (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) sub), person_country as (select p.id, substr(p.phone_number, 1, 3) as country_code from Person p) select name as country from (select distinct co.name, avg(c.duration) over (partition by co.name) as country_avg, avg(c.duration) over () as global_avg from call_duration c left join person_country p on c.id = p.id left join Country co on co.country_code = p.country_code) sub2 where country_avg > global_avg
with call_info as ( select cl.caller_id as person_id, left(p.phone_number, 3) as country_code, cl.duration from calls as cl inner join person as p on cl.caller_id = p.id union all select cl.callee_id as person_id, left(p.phone_number, 3) as country_code, cl.duration from calls as cl inner join person as p on cl.callee_id = p.id ) , glob_avg as ( select avg(duration) as avg_duration from call_info ) , country_avg as ( select country_code, avg(duration) as avg_duration from call_info as ci group by country_code ) , get_gt as ( select ca.country_code, case when ca.avg_duration > ga.avg_duration then 1 else 0 end as is_gt_glob from country_avg as ca cross join glob_avg as ga ) select cc.name as country from get_gt as t inner join country as cc on t.country_code = cc.country_code where t.is_gt_glob = 1
with call_logs as (select caller_id as pid,duration from calls union all select callee_id as pid,duration from calls), cntry_info as (select p.id,c.country_code,c.name country_name from person p inner join country c on substr(p.phone_number,1,3)=c.country_code) select t.country_name country from (select cntry.country_name,sum(cl.duration)/count(cntry.id) as avg_duration from call_logs cl inner join cntry_info cntry on cl.pid=cntry.id group by cntry.country_name) t where t.avg_duration>(select sum(duration)/count(pid) as global_avg_duration from call_logs)
with call_person_tab as ( select c.duration, p1.phone_number as caller_num, p2.phone_number as callee_num from Calls c left join Person p1 on p1.id = c.caller_id left join Person p2 on p2.id = c.callee_id ), country_tab as ( select cp.duration, ctry1.name as caller_ctry, ctry2.name as callee_ctry from call_person_tab cp left join Country ctry1 on left(cp.caller_num,3) = ctry1.country_code left join Country ctry2 on left(cp.callee_num,3) = ctry2.country_code ), avg_caller as ( select caller_ctry, sum(duration) as sum_duration, count(duration) as count_duration from country_tab group by caller_ctry ), avg_callee as ( select callee_ctry, sum(duration) as sum_duration, count(duration) as count_duration from country_tab group by callee_ctry ), union_tab as ( select * from avg_caller union select * from avg_callee )select ut.caller_ctry as country from union_tab ut, Calls c group by caller_ctry having sum(ut.sum_duration) / sum(ut.count_duration) > avg(c.duration)
with calls as ( select left(person.phone_number,3) as country_code ,cls.user_id as user_id ,cls.duration duration from( select caller_id as user_id ,duration from Calls union all select callee_id as user_id ,duration from Calls ) cls join Person person on cls.user_id = person.id ) select country.name as country from calls cal1 join Country country on country.country_code = cal1.country_code group by country.country_code having avg(cal1.duration)>(select avg(duration) from calls) = 1
with calls_long as ( select caller_id as id, duration from calls union all select callee_id as id, duration from calls), country_person as ( select p.id, c.name from person p join country c on substring_index(p.phone_number, '-', 1) = c.country_code ) select distinct name as country from ( select cp.name, avg(duration) over (partition by name) as country_avg, avg(duration) over () as global_avg from calls_long cl join country_person cp using (id)) a where country_avg > global_avg
with callss as (select caller_id, duration from calls union all select callee_id, duration from calls), cte as (select c.name, p.id from person p join country c where c.country_code=substring(p.phone_number,1,3)) select name country from callss c join cte t on t.id=c.caller_id group by 1 having avg(duration)>(select avg(duration)from callss)
with calltable as( select c.caller_id as id, c.duration as duration, left(p.phone_number, 3) as country_code, ct.name from calls as c join person as p on c.caller_id=p.id join country as ct on left(p.phone_number, 3) = ct.country_code union all select c.callee_id as id, c.duration as duration, left(p.phone_number, 3) as country_code, ct.name from calls as c join person as p on c.callee_id=p.id join country as ct on left(p.phone_number, 3) = ct.country_code ) select c.name as country from( select country_code, name, avg(duration) as duration from calltable group by country_code, name )c where c.duration>(select avg(duration) from calls)
with calltable as( select c.caller_id as id, c.duration as duration, left(p.phone_number, 3) as country_code, ct.name from calls as c join person as p on c.caller_id=p.id join country as ct on left(p.phone_number, 3) = ct.country_code union all select c.callee_id as id, c.duration as duration, left(p.phone_number, 3) as country_code, ct.name from calls as c join person as p on c.callee_id=p.id join country as ct on left(p.phone_number, 3) = ct.country_code ) select name as country from calltable group by country_code having avg(duration)>(select avg(duration) from calls)
with calltable as( select caller_id as id, duration, left(p.phone_number,3) as country_code from calls as c join person as p on c.caller_id=p.id union all select callee_id as id, duration, left(p.phone_number,3) as country_code from calls as c join person as p on c.callee_id=p.id ) select c.name as country from country as c join calltable as t using (country_code) group by c.name having avg(duration)>(select avg(duration) from calls)
with country_info as ( select distinct p.id,country.name from (select id, left(phone_number,3) as number from person) as p left join country on country.country_code = p.number), total_call as( select caller_id as person,duration from calls union select callee_id as person, duration from calls), country_avg as ( select country_info.name, avg(total_call.duration) as country_avg from country_info inner join total_call on country_info.id = total_call.person group by country_info.name) select country_avg.name as country from country_avg where country_avg > (select avg(duration) from calls)
with country_personId as ( select c.name as country, c.country_code, p.id as id from person as p join country as c on c.country_code=left(p.phone_number,3)) select country from country_personId left join ( select caller_id as caller, duration from calls union select callee_id as caller, duration from calls) as caller_duration on country_personId.id=caller_duration.caller group by country having avg(duration) > (select avg(duration) from calls)
with countrycode as ( select id, cc, c.name as country from (select *, substr(phone_number,1,3) as cc from person) p join country c on p.cc = c.country_code ), global_avg as( select avg(duration) as avg_duration from calls ), base as( select country, avg(duration) as duration from( select caller_id as id, duration from calls union select callee_id as id, duration from calls ) c1 join countrycode c2 on c1.id = c2.id group by country ) select country from base, global_avg where duration> avg_duration
with cte as ( SELECT co.name, SUM(ca.duration) as total_time, count(*) as total_calls FROM Person p JOIN Country co ON co.country_code = LEFT(p.phone_number, 3) JOIN Calls ca ON (ca.caller_id = p.id or ca.callee_id = p.id) GROUP BY co.name ) SELECT name as country FROM cte WHERE (total_time/total_calls) > (SELECT AVG(duration) from Calls)
with cte as ( Select p.id, p.name, c.country_code, c.name as country_name from Person p join Country c on SUBSTRING(p.phone_number, 1,3) = c.country_code ) Select country_name as country from ( Select caller_id as id, c.duration, cte.country_name from Calls c join cte on c.caller_id = cte.id union all Select callee_id as id, c.duration, cte.country_name from Calls c join cte on c.callee_id = cte.id ) temp group by country_name having avg(duration) > (Select avg(duration) from Calls) order by country_name
with cte as ( select AVG(duration) as global_avg from Calls ) (select c.name as country from Person p inner join Country c on substring(p.phone_number,1,3) = c.country_code inner join Calls ca on p.id = ca.caller_id or p.id = ca.callee_id group by c.name having AVG(ca.duration) > (select global_avg from cte))
with cte as ( select Country.name as country,avg(duration) as duration from ( select caller_id,duration from Calls union all select callee_id as caller_id,duration from Calls ) Calls join Country join Person on Calls.caller_id = Person.id and Country.country_code = substr(phone_number,1,3) group by Country.name ) select country from cte where duration > ( select avg(duration) from calls )
with cte as ( select a.*, b.country_code as caller_code, c.country_code as callee_code from Calls as a left join (select *, substring(phone_number,1,3) as country_code from Person) as b on a.caller_id = b.id left join ( select *, substring(phone_number,1,3) as country_code from Person ) as c on a.callee_id = c.id) select g.name as country from (select country_code from (select country_code, avg(duration) as avg_duration from (select caller_code as country_code, duration from cte union all select callee_code as country_code, duration from cte) as d group by country_code) as e where avg_duration>(select avg(duration) from Calls)) as f left join Country as g on f.country_code = g.country_code
with cte as ( select a.id, b.name from Person a inner join Country b on left(a.phone_number,3)=b.country_code), cte2 as ( (select caller_id as id, duration from calls) union all (select callee_id as id, duration from calls) ) select a.name as country from cte a join cte2 b on a.id=b.id group by a.name having sum(duration)/count(duration)>(select sum(duration)/count(duration) from cte2)
with cte as ( select avg(duration) as g_duration from Calls), cte2 as ( select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) select country from(select cte2.*, y.name as country from cte2 join Person x on cte2.id = x.id left join Country y on substr(x.phone_number,1,3) = y.country_code) a group by 1 having avg(duration) > (select g_duration from cte)
with cte as ( select c.name , a.duration from Calls a inner join Person b on a.callee_id = b.id inner join Country c on c.country_code = left(b.phone_number,3) union all select c.name , a.duration from Calls a inner join Person b on a.caller_id = b.id inner join Country c on c.country_code = left(b.phone_number,3) ) select name country from cte group by name having avg(duration) > (select avg(duration) from cte )
with cte as ( select c.name as country, avg(ca.duration) over(partition by c.name)as avg_duration, avg(ca.duration) over() as global_avg_duration from calls ca left join person p on ca.caller_id = p.id OR ca.callee_id = p.id left join country c on substring(p.phone_number,1,3)= c.country_code ) select distinct country from cte where avg_duration> global_avg_duration
with cte as ( select c.name country, duration from Calls join Person on id = caller_id join Country c on country_code = left(phone_number,3) union all select c.name country, duration from Calls join Person on id = callee_id join Country c on country_code = left(phone_number,3) ) select country from cte group by country having avg(duration) > (select avg(duration) from cte)
with cte as ( select c.name country,duration from calls join person on id=caller_id join country c on country_code =left(phone_number,3) union all select c.name country,duration from calls join person on id=callee_id join country c on country_code =left(phone_number,3) ) select country from cte group by country having avg(duration) >(select avg(duration )from cte)
with cte as ( select caller_id as id , duration , left(b.phone_number,3) as country_code from calls a join person b on a.caller_id = b.id union all select caller_id as id , duration, left(b.phone_number,3) as country_code from calls a join person b on a.callee_id = b.id ) select b.name as country from cte a join country b on a.country_code = b.country_code group by 1 having avg(duration) > (select avg(duration) from cte)
with cte as ( select caller_id as id , duration from calls union select callee_id , duration from calls ) select co.name as country from cte c inner join person p on c.id = p.id inner join country co on left(p.phone_number, 3) = co.country_code group by 1 having avg(duration) > (select avg(duration) from calls)
with cte as ( select caller_id as id , duration from calls union select callee_id as id , duration from calls ) select c.name as country from cte c1 inner join person p on c1.id = p.id inner join country c on (left(phone_number, 3)) = c.country_code group by country_code having avg(duration) > (select avg(duration) as glob from calls)
with cte as ( select caller_id as user_id, duration from calls union all select callee_id as user_id, duration from calls ) select c.name as country from person p join country c on c.country_code=substring(p.phone_number, 1,3) join cte on cte.user_id=p.id group by c.country_code having avg(cte.duration)> (select avg(duration) from cte)
with cte as ( select caller_id as user_id,duration from calls union all select callee_id as user_id,duration from calls ), cte2 as ( Select id,name,substring(phone_number,1,3) as code from person ), cte3 as ( select id,t1.name,t2.name as country_name from cte2 t1 left join country t2 on t2.country_code=t1.code ) select country_name as country from ( select country_name,avg(duration) a1 from ( select t1.user_id,t1.duration,t2.country_name from cte t1 left join cte3 t2 on t1.user_id=t2.id )x group by country_name )x where a1>(select avg(duration) from cte)
with cte as ( select caller_id as user_id,duration from calls union all select callee_id as user_id,duration from calls ), cte2 as ( Select id,name,substring(phone_number,1,3) as code from person ), cte3 as ( select id,t1.name,t2.name as country_name from cte2 t1 left join country t2 on t2.country_code=t1.code ) select country_name as country from ( select distinct country_name,avg(duration) over(partition by country_name) a1,avg(duration) over() as a2 from ( select t1.user_id,t1.duration,t2.country_name from cte t1 left join cte3 t2 on t1.user_id=t2.id )x)y where a1>a2
with cte as ( select co.name as country, c.duration from calls c join person p on c.caller_id = p.id join country co on left(p.phone_number,3) = co.country_code union all select co.name as country, c.duration from calls c join person p on c.callee_id = p.id join country co on left(p.phone_number,3) = co.country_code ) select country from cte group by country having avg(duration) > (select avg(duration) from cte)
with cte as ( select co.name, avg(duration) over(partition by co.name) as cavg, avg(duration) over() as gavg from calls c left join person p on p.id = c.callee_id or p.id = c.caller_id left join country co on substring(p.phone_number,1,3) = co.country_code ) select distinct name as country from cte where cavg>gavg
with cte as ( select id, c.name as country from Person p join Country c on substring(p.phone_number,1,3) = c.country_code) ,all_calls as ( select country,id as caller,duration from cte c join Calls pc on c.id = caller_id union all select country,id as caller,duration from cte c join Calls pc on c.id = callee_id) ,averages as ( select distinct country, avg(duration) over(partition by country) as cnt_avg ,avg(duration) over() as global_avg from all_calls order by country desc) select country from averages where cnt_avg > global_avg order by 1
with cte as ( select id,c.name from person p join country c on substring(p.phone_number,1,3) = c.country_code ), cte1 as ( select name, duration from calls c join cte c1 on c.caller_id = c1.id union all select name, duration from calls c join cte c1 on c.callee_id = c1.id ), cte2 as (select name,avg(duration) avg_duration, sum(duration) sum_duration, count(*) cnt from cte1 group by 1) select name as country from cte2 where avg_duration > (select sum(sum_duration)/sum(cnt) from cte2)
with cte as ( select left(phone_number, 3) as country_code, avg(duration) as country_avg from person p inner join ( select caller_id, duration from calls union all select callee_id, duration from calls ) c on p.id = c.caller_id group by left(phone_number, 3) ) select name as country from cte inner join country on cte.country_code = country.country_code where country_avg > (select avg(duration) from calls)
with cte as ( select left(phone_number, 3) as country_code, avg(duration) over(partition by left(phone_number, 3)) as country_avg, avg(duration) over() as overall_avg from person p inner join ( select caller_id, duration from calls union all select callee_id, duration from calls ) c on p.id = c.caller_id ) select distinct name as country from cte inner join country on cte.country_code = country.country_code where country_avg > overall_avg
with cte as ( select p.id , p.name, c.name AS country_name , c.country_code from Person as p inner join Country as c on LEFT(p.phone_number , 3) = c.country_code ), cte1 as (select caller_id as id , sum(duration) as duration , count(caller_id) as c from Calls group by caller_id) , cte2 as (select callee_id as id , sum(duration) as duration , count(callee_id) as c from Calls group by callee_id) , cte3 as (select * from cte1 union all select * from cte2), cte4 as (select id, sum(duration) as total, sum(c) as c from cte3 group by id), cte5 as (select cte4.id, cte4.total,cte4.c , cte.country_name from cte4 inner join cte on cte.id =cte4.id) , cte6 as (select country_name, sum(total)/sum(c) as avg_dur from cte5 group by country_name) select country_name as country from cte6 where avg_dur > (select avg(duration) from Calls)
with cte as ( select p.id, p.country_code, ifnull(c.duration, 0) as duration, ca.name from (select id, substr(phone_number, 1, 3) as country_code from Person) p inner join Calls c on p.id in (c.caller_id, c.callee_id) inner join Country ca on p.country_code = ca.country_code ) select distinct name as country from (select *, avg(duration) over(partition by country_code) as adur from cte) ct where adur > (select avg(duration) from Calls)
with cte as ( with cte as ( with cte as ( with consolidated as ( Select p.id,p.name,left(phone_number,3) as 'phn',c.name as 'country' from Person p inner join Country c on left(phone_number,3) = c.country_code ) Select consolidated.*,c.duration from consolidated inner join Calls c on id = c.caller_id or id = c.callee_id ) Select name,country,duration,avg(duration) over() as 'national' from cte ) Select country,avg(duration) as 'average_personal',national from cte group by country ) Select country from cte where average_personal > national
with cte as (Select country.name as name, avg(duration) as country_average, (Select avg(duration) from calls) as global_average from calls join person on calls.caller_id=id or callee_id=id join country on country_code=left(person.phone_number,3) group by name) select name as country from cte where country_average>global_average
with cte as (select P.id, P.name as person_name, C2.country_code, C2.name as country_name, C.duration from Person P join Calls C on P.id = C.caller_id or P.id = C.callee_id join Country C2 on left(P.phone_number,3)=C2.country_code ) select country_name as country from cte group by 1 having avg(duration) > (select avg(duration) from cte)
with cte as (select avg(duration) as avg_duration from Calls ) select c.name as country from Person p inner join Country c on SUBSTRING(phone_number,1,3) = c.country_code inner join Calls l on (p.id =l.caller_id or p.id = l.callee_id) group by c.name having avg(duration) > (select avg_duration from cte )
with cte as (select c.name, avg(ca.duration) as country_avg from country c join person p on c.country_code= substring(p.phone_number,1,3) join calls ca on p.id = ca.caller_id or p.id = ca.callee_id group by c.name) select name as country from cte where country_avg > (select avg(duration) from calls)
with cte as (select c.name, ifnull(avg(calls.duration),0) as avg_duration from country c left join person p on c.country_code= left(p.phone_number,3) left join calls on calls.caller_id = p.id or calls.callee_id=p.id group by 1 ) select name as country from cte where avg_duration > (select avg(duration) from calls)
with cte as (select c.name,p.id from person p inner join country c on c.country_code = substr(p.phone_number,1,3)) select ct.name as country from calls c inner join cte ct on c.caller_id = ct.id or c.callee_id = ct.id group by 1 having avg(duration) > (select avg(duration) from calls)
with cte as (select c2.name as country, c1.duration from Calls c1 join Person p on c1.caller_id = p.id join Country c2 on left(p.phone_number,3) = c2.country_code union all select c2.name as country, c1.duration from Calls c1 join Person p on c1.callee_id = p.id join Country c2 on left(p.phone_number,3) = c2.country_code) select cte.country from cte group by country having avg(duration) > (select avg(duration) from cte)
with cte as (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls), cte1 as (select a.name, avg(c.duration) as country_avg from Country a join Person b on a.country_code = substring(b.phone_number, 1,3) join cte c on b.id = c.id group by 1) select name as country from cte1 where country_avg > (select avg(duration) from cte)
with cte as (select caller_id as id, duration from calls union all select callee_id as id, duration from calls) select distinct name as country from (select c.name, avg(duration)over(partition by c.country_code) as country_avg, avg(duration)over()as global_avg from cte join person as p using (id) join country as c on left(p.phone_number, 3) = c.country_code) as temp where country_avg> global_avg
with cte as (select caller_id, duration from calls union all select callee_id, duration from calls), cte2 as (select id, duration, name, left(phone_number,3) as country_code from cte c join person p on c.caller_id = p.id) select distinct b.name as country from cte2 a join country b on a.country_code = b.country_code group by a.country_code having avg(duration) > (select avg(duration) from calls)
with cte as (select country_code, name, id from country c join (select left(phone_number,3) as phone, id from person ) p on c.country_code = p.phone), cte1 as (select a.caller_id as id1, name,country_code, duration from cte b join calls a on a.caller_id = b.id union select a.callee_id as id1,name,country_code, duration from cte b join calls a on a.callee_id = b.id) select name as country from cte1 group by name having sum(duration)/ count(id1) > (select avg(duration) from calls)
with cte as (select d.name as country, a.duration from Calls a left join Person b on a.caller_id = b.id left join Person c on a.callee_id = c.id left join Country d on left(b.phone_number,3) = d.country_code left join Country e on left(c.phone_number,3) = e.country_code union all select e.name as country, a.duration from Calls a left join Person b on a.caller_id = b.id left join Person c on a.callee_id = c.id left join Country d on left(b.phone_number,3) = d.country_code left join Country e on left(c.phone_number,3) = e.country_code) select country from cte group by country having avg(duration) > (select avg(duration) from cte)
with cte as (select id,name,left(phone_number,3) as country_code,duration from person left join calls on person.id=calls.caller_id or person.id=calls.callee_id) select b.name as Country from cte a left join country b on a.country_code=b.country_code group by b.name having avg(duration)>(select avg(duration) from calls)
with cte as (select p.id,c.name,x.* from person p left join country c on left(p.phone_number,3)= c.country_code right join calls x on x.caller_id=p.id or x.callee_id=p.id), t2 as (select *, avg(duration) over() as g_avg, avg(duration) over (partition by name) as c_avg from cte) select distinct name as country from t2 where g_avg < c_avg
with cte as (select p.id,left(phone_number,3) as country_code,c.name,callee_id,duration from person p join country c on left(p.phone_number,3) =c.country_code left join calls on caller_id=p.id or p.id=callee_id order by p.id) , cte2 as (select name as country,avg(duration) as avg_duration ,row_number() over (order by avg(duration) desc) rn from cte group by name ) select country from cte2 where avg_duration> (select avg(duration) from calls)
with cte as (select p.id,p.name caller_name, p.phone_number, c.name country_name,c.country_code from Person p join Country c on left(p.phone_number,3) = c.country_code) select country_name as country from(select country_name,avg(case when cte.id= Calls.caller_id or cte.id= Calls.callee_id then duration else 0 end) D from cte join Calls on cte.id= Calls.caller_id or cte.id= Calls.callee_id group by country_name having D>(select avg(duration) from Calls))tmp
with cte as (select p.id,p.name caller_name, p.phone_number, c.name country_name,c.country_code from Person p left join Country c on left(p.phone_number,3) = c.country_code) select country_name as country from(select country_name,avg(case when cte.id= Calls.caller_id or cte.id= Calls.callee_id then duration else 0 end) D from cte join Calls on cte.id= Calls.caller_id or cte.id= Calls.callee_id group by country_name having D>(select avg(duration) from Calls))tmp
with cte as (select p.id,p.name caller_name, p.phone_number, c.name country_name,c.country_code from Person p left join Country c on left(p.phone_number,3) = c.country_code) select country_name as country from(select country_name,avg(case when cte.id= Calls.caller_id or cte.id= Calls.callee_id then duration else 0 end) D from cte right join Calls on cte.id= Calls.caller_id or cte.id= Calls.callee_id group by country_name having D>(select avg(duration) from Calls))tmp
with cte as (select p.id,p.name caller_name, p.phone_number, c.name country_name,c.country_code from Person p right join Country c on left(p.phone_number,3) = c.country_code) select country_name as country from(select country_name,avg(case when cte.id= Calls.caller_id or cte.id= Calls.callee_id then duration else 0 end) D from cte join Calls on cte.id= Calls.caller_id or cte.id= Calls.callee_id group by country_name having D>(select avg(duration) from Calls))tmp
with cte as (select p.id,p.name, c.name as country from Person p left join Country c on left(phone_number,3) = country_code ), cte1 as( (select caller_id, cte.country as country, duration from Calls left join cte on Calls.caller_id = cte.id) union all (select caller_id, cte.country as country, duration from Calls left join cte on Calls.callee_id = cte.id)) select country from cte1 group by country having avg(duration)>(select avg(duration) from cte1)
with cte as (select sum(duration)/count(*) as global_call_duration from calls) select c.name as country from person p join country c on c.country_code = left(p.phone_number,3) join calls on p.id IN (callee_id, caller_id) group by c.name having avg(duration) > (select avg(duration) from calls)
with cte as( SELECT c.name as country, ca.duration as duration FROM calls ca JOIN person p ON p.id = ca.caller_id OR p.id = ca.callee_id JOIN country c ON c.country_code = LEFT(p.phone_number,3) ) SELECT country FROM cte GROUP BY country HAVING AVG(duration) > (SELECT AVG(duration) FROM cte)
with cte as( select caller_id, duration from calls union all select callee_id, duration from calls) select c.name as country from cte c1 inner join person p on c1.caller_id = p.id inner join country c on left(p.phone_number,3) = c.country_code group by 1 having avg(c1.duration) > (select avg(duration) from calls)
with cte as( select caller_id, phone_number, duration, substr(phone_number,1,3) as country_code from Calls c left join Person p on c.caller_id = p.id or c.callee_id = p.id), country_avg as( select co.name, avg(duration) avg_duration from cte left join Country co on cte.country_code = co.country_code group by 1) select country_avg.name as country from country_avg where avg_duration > (select avg(duration) from calls )
with cte as( select id, c.name country from country c, person p where c.country_code = left(p.phone_number,3) ), cte2 as ( select avg(duration) as avg_dur, country from calls c left join cte p1 on c.caller_id = p1.id or c.callee_id = p1.id group by country ) select distinct country from cte2 where avg_dur>(select avg(duration) from calls)
with cte as( select id,c.name as country from (select id, left(phone_number,3) as code from person p) t left join country c on t.code = c.country_code) select country from (select t2.id, duration, cte.country from (select caller_id id, duration from calls union all select callee_id id, duration from calls) t2 left join cte on t2.id= cte.id) t3 group by country having avg(duration) > (select avg(duration) from calls)
with cte as(select c.name as country, avg(ca.duration)over(partition by c.name)as avg_duration, avg(ca.duration)over()as avg_total from calls ca join person p on ca.caller_id=p.id or ca.callee_id=p.id join country c on left(p.phone_number,3)=c.country_code) select distinct country from cte where avg_duration>avg_total
with cte1 as ( select caller_id as caller, duration from calls union all select callee_id as caller, duration from calls ), cte2 as ( select co.name, avg(c.duration) as avg_duration from cte1 c left join person p on p.id=c.caller left join country co on co.country_code=substr(p.phone_number, 1, 3) group by 1 ), cte3 as ( select avg(duration) as global_avg from cte1 ), cte4 as ( select cte2.name, cte2.avg_duration, cte3.global_avg from cte2 cross join cte3 ) select name as country from cte4 where avg_duration > global_avg
with cte1 as ( select caller_id as id, duration from calls union select callee_id as id, duration from calls ) select c.name as country from cte1 c1 join person p on (c1.id = p.id) join country c on (substr(phone_number, 1, 3) = c.country_code) group by country_code having avg(duration) > (select avg(duration) as globAvg from calls)
with cte1 as ( select id,C.name as country from ( select id,left(phone_number,3) as country_code from Person ) it join Country C on C.country_code = it.country_code ) ,cte2 as ( select avg(duration) as global_avg from Calls ) select country from ( select country, avg(case when id = caller_id or id = callee_id then duration else NULL end) as country_avg from cte1 cross join Calls group by country ) itm where country_avg > (select global_avg from cte2)
with cte1 as (select a.id, b.name from Person a left join Country b on left(a.phone_number, 3) = b.country_code), cte2 as (select c.name, d.duration from cte1 c right join Calls d on c.id=d.caller_id), cte3 as (select e.name, f.duration from cte1 e right join Calls f on e.id=f.callee_id), cte4 as (select * from cte2 union all select * from cte3), cte5 as (select name as country, avg(duration) as avg_duration from cte4 group by name) select country from cte5 where avg_duration > (select avg(duration) over () from Calls limit 1)
with cte1 as (select id, left(p.phone_number,3) as country_code, c.name from Person p left join Country c on left(phone_number,3) = c.country_code ), cte2 as (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) select name as country from cte2 left join cte1 using (id) group by 1 having avg(duration) > (select avg(duration) from Calls)
with cte_code as ( select substr(phone_number, 1, 3) as country_code, id from person ), cte_country as ( select name, id from country join cte_code on country.country_code = cte_code.country_code ), cte_caller as ( select name, sum(duration) as tot_duration, count(duration) as tot_ct from cte_country join calls on cte_country.id = calls.caller_id group by name ), cte_callee as ( select name, sum(duration) as tot_duration, count(duration) as tot_ct from cte_country join calls on cte_country.id = calls.callee_id group by name ), cte_all as ( select name, sum(tot_duration) as tot_duration, sum(tot_ct) as tot_ct from ( select * from cte_caller union all select * from cte_callee ) as t group by name ) select name as country from cte_all where tot_duration/tot_ct > (select sum(tot_duration)/sum(tot_ct) from cte_all)
with cte_ppl_ctry as ( select id, p.name as person, phone_number, c.name as country, country_code from Person as p join Country as c on left(p.phone_number, 3) = c.country_code ), cte_final as ( select country from Calls as c join cte_ppl_ctry as pc on c.caller_id = pc.id or c.callee_id = pc.id group by 1 having avg(duration) > ( select avg(duration) from Calls ) ) select * from cte_final
with cus_country as (select cus.id as cust_id, Country.name as country_name from (select id, left(phone_number,3) as country_code from Person) as cus left join Country on cus.country_code = Country.country_code), call_min as(select caller_id as cust_id, duration from Calls union all select callee_id as cust_id, duration from calls), g_avg as (select avg(duration) as global_avg from Calls) select country_name as Country from call_min left join cus_country on call_min.cust_id = cus_country.cust_id group by country_name having avg(duration)>(select global_avg from g_avg)
with derived as (select country,avg(duration) as avg_duration from calls join (select id,country.name as country from person join country on substring(phone_number from 1 for 3)=country_code) t on caller_id = t.id OR callee_id = t.id group by 1) select country from derived where avg_duration>(select avg(duration) from calls)
with df_country as ( select left(p.phone_number, 3) as country_code, avg(duration) as avg_duration_per_country from calls c join person p on c.caller_id = p.id or c.callee_id = p.id group by 1 ) select c.name as country from df_country join country c using(country_code) where avg_duration_per_country > (select avg(duration) as avg_global from calls)
with ect as( select name, avg(ca.duration) as ad from Country c join (select id, left(phone_number,3) code from Person) as p on c.country_code=p.code join Calls ca on ca.caller_id= p.id or ca.callee_id= p.id group by name ) select name as country from ( select name, ad from ect group by name having avg(ad) >(select avg(duration) from Calls) ) as t
with ga as ( select avg(duration) as g from calls ), cte1 as (select id,C.name as country from ( select id,left(phone_number,3) as country_code from Person ) it join Country C on C.country_code = it.country_code) select country from ( select country, avg(case when id = caller_id or id = callee_id then duration else NULL end) as country_avg from cte1 cross join Calls group by country ) itm where country_avg > (select g from ga)
with global_avg as ( select avg(duration) "avg_duration" from calls ) select name "country" from ( select ca.caller_id, co.name, duration from calls ca join person p on p.id = ca.caller_id join country co on left(p.phone_number, 3) = co.country_code union select ca.callee_id, co.name, duration from calls ca join person p on p.id = ca.callee_id join country co on left(p.phone_number, 3) = co.country_code ) result_table group by 1 having avg(duration) > (select * from global_avg)
with global_avg as ( select avg(duration) as drt from country join (select left(p.phone_number,3) as ccode, duration from calls left join person as p on calls.caller_id = p.id union all select left(p.phone_number,3) as ccode, duration from calls left join person as p on calls.callee_id = p.id) as t on country.country_code = t.ccode ) select country.name as country from country join (select left(p.phone_number,3) as ccode, duration from calls left join person as p on calls.caller_id = p.id union all select left(p.phone_number,3) as ccode, duration from calls left join person as p on calls.callee_id = p.id) t on country.country_code = t.ccode group by t.ccode having avg(duration) > (select drt from global_avg )
with global_avg as ( select avg(duration) from calls ) select ct.name as country from calls cl left join person p on cl.caller_id=p.id or cl.callee_id=p.id left join country ct on ct.country_code=left(p.phone_number,3) group by ct.country_code having avg(duration) > (select * from global_avg) order by 1
with id_country as ( select id, country.name from person join country on SUBSTR(person.phone_number, 1, 3) = country.country_code ), country_duration as ( select calls.*, t1.name as caller_country, t2.name as callee_country from calls join id_country as t1 on calls.caller_id = t1.id join id_country as t2 on calls.callee_id = t2.id), melt_table as ( select duration, caller_country as country from country_duration union all select duration, callee_country as country from country_duration) select country from melt_table group by country having avg(duration) > (select avg(duration) from melt_table)
with p as ( select c.name as country,id from person p join country c on c.country_code=substring(phone_number,1,3) ), c as ( select distinct p1.country,duration,callee_id,caller_id from calls c join p p1 on p1.id = caller_id union all select distinct p2.country,duration,callee_id,caller_id from calls c join p p2 on p2.id = callee_id ), c1 as ( select country,avg(duration) as ad from c group by 1 ) select country from c1 where ad > (select avg(duration) from calls)
with person_country as ( select p.*, c.name country from person p join country c on substring(p.phone_number, 1, 3) = c.country_code ), duration as ( select country, avg(duration) avg_duration from ( select p.id, p.country, ca.duration from calls ca join person_country p on ca.caller_id = p.id union all select p.id, p.country, ca.duration from calls ca join person_country p on ca.callee_id = p.id ) t group by country ) select country from duration where avg_duration > (select avg(duration) from calls)
with person_country as ( select p.id, p.phone_number, c.name as country, c.country_code from person as p inner join country as c on c.country_code = substring(p.phone_number,1,3) ), final_query as ( select country from Calls as cls inner join person_country as pc on pc.id = cls.caller_id or pc.id = cls.callee_id group by country having avg(duration) > ( select avg(duration) from Calls) ) select * from final_query
with person_country_code as ( select id, SUBSTRING_INDEX(phone_number,'-',1) as country_code_person from Person ), avg_global_average as ( select country_code_person, avg(duration) average from Calls c inner join person_country_code p on (c.caller_id = p.id) OR (c.callee_id = p.id) group by 1 ) select c.name as country from avg_global_average a inner join Country c on a.country_code_person = c.country_code where average > (select avg(duration) from calls)
with person_mod as( select id, left(phone_number,3) as country_code from person ), country_mod as( select person_mod.id, country.name from country join person_mod on country.country_code=person_mod.country_code ), calls_mod as ( select caller_id as person_id, duration from calls union all select callee_id as person_id, duration from calls ), country_duration as( select ca.duration, co.name from calls_mod as ca join country_mod as co on ca.person_id=co.id ), country_avg as( select name as country, avg(duration) as co_avg from country_duration group by name ), global_avg as( select avg(duration) as glo_avg from country_duration ) select ca.country from country_avg as ca join global_avg as ga where ca.co_avg > ga.glo_avg
with person_w_country_code AS ( SELECT id, name, LEFT(phone_number, POSITION('-' IN phone_number)-1) AS country_code FROM Person ), all_calls AS ( SELECT caller_id AS call_id, duration FROM Calls UNION ALL SELECT callee_id AS call_id, duration FROM Calls ) SELECT c.name AS country FROM all_calls calls JOIN person_w_country_code p ON calls.call_id = p.id JOIN Country c ON c.country_code = p.country_code GROUP BY p.country_code HAVING AVG(duration) > (SELECT AVG(duration) FROM Calls)
with s as (select id, c.name as country from person p join country c on left(p.phone_number,3) = c.country_code) , x as (select s.country, duration from calls c join s on c.caller_id = s.id union all select s.country, duration from calls c join s on c.callee_id = s.id) select country from x group by 1 having avg(duration) > (select avg(duration) from x)
with t AS ( SELECT id, name FROM( SELECT id, c.name, LEFT(phone_number,3) cty FROM Person JOIN Country c ON LEFT(phone_number,3) = c.country_code ) t2 ) SELECT name country FROM ( SELECT DISTINCT name, avg(duration) over (PARTITION BY name) avg , AVG(duration) OVER() avg2 FROM ( SELECT t1.name ,duration FROM Calls c JOIN t t1 ON c.caller_id = t1.id UNION ALL SELECT t2.name ,duration FROM Calls c JOIN t t2 ON c.callee_id = t2.id ) d ) d2 WHERE avg>avg2
with t AS( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) SELECT distinct name AS Country FROM (SELECT c.name, avg(duration) over(partition by country_code) AS c_avg, avg(duration) over() AS g_avg FROM t JOIN Person p ON t.id=p.id JOIN Country c ON left(p.phone_number,3)=c.country_code) a WHERE c_avg>g_avg
with t AS( SELECT caller_id AS id, duration FROM Calls UNION ALL SELECT callee_id AS id, duration FROM Calls) SELECT distinct name AS country FROM (SELECT c.name, avg(duration) over(partition by c.name) AS c_avg, avg(duration) over() AS g_avg FROM t JOIN Person p ON t.id=p.id JOIN Country c ON left(p.phone_number,3)=c.country_code) a WHERE c_avg>g_avg
with t as ( Select p.id, p.name, p.phone_number, c.name as country from Person p left join Country c on c.country_code = substring(p.phone_number,1, 3) ), t2 as ( Select c.caller_id, c.duration from Calls c union Select c1.callee_id, c1.duration from Calls c1 ), t3 as ( Select t2.caller_id, t2.duration, t.country from t2 left join t on t.id = t2.caller_id ), t5 as ( Select sum(duration)/ count(duration) as avg_global from Calls ), t4 as ( Select sum(duration)/ count(duration) as time_call, country from t3 group by country) Select country from t4 where time_call > (Select avg_global from t5)
with t as ( select id, c.name as 'country' from person p join country c on substr(phone_number,1,3) = country_code) , c as ( select caller_id as 'id', duration from calls union all select callee_id as 'id', duration from calls) select country from c left join t on t.id = c.id group by 1 having avg(duration) > (select avg(duration) from c)
with t as ( select id,c.name as country from Person p join Country c on left(phone_number,3)=country_code ) select country from Calls c join t on c.caller_id=t.id or c.callee_id=t.id group by country having avg(duration)>(select avg(duration) from Calls c)
with t as (select c.name country, duration from calls join person on caller_id = id join country c on country_code = left(phone_number, 3) union all select c.name country, duration from calls join person on callee_id = id join country c on country_code = left(phone_number, 3) ) select country from t group by country having avg(duration) > (select avg(duration) from calls)
with t as (select id, c.name from Person p join Country c on substr(phone_number,1,3)= country_code ), t2 as ( select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls), t3 as (select sum(duration)/count(*) global_dur from t2) select name as country from(select name, avg(duration) from t2 join t using(id) group by 1 having avg(duration) > (select sum(duration)/count(*) global_dur from t2)) t4
with t as( select p.id as id, left(p.phone_number,3) as ctry_code, c.name from person p join country c on left(p.phone_number,3) = c.country_code ), t2 as ( select t.name as name,ctry_code, sum(case when c.caller_id = id or c.callee_id = id then duration end)/count(*) as ctry from t join calls c on c.caller_id = id or c.callee_id = id group by t.ctry_code ) select name as country from t2 where (select (sum(duration)* 2)/(count(duration)*2 ) as global_avg from calls) < ctry
with t as( select p.id as id, left(p.phone_number,3) as ctry_code, c.name from person p join country c on left(p.phone_number,3) = c.country_code ), t2 as ( select t.name as name,ctry_code, sum(case when c.caller_id = id or c.callee_id = id then duration end)/count(*) as ctry from t join calls c on c.caller_id = id or c.callee_id = id group by t.ctry_code ) select name as country from t2 where (select avg(duration) from calls) < ctry
with t1 as ( Select caller_id as id, duration from Calls union all Select callee_id as id, duration from Calls ), t2 as ( Select avg(duration) as globalAvg from Calls ), t3 as ( Select c.name, t2.globalAvg, avg(t1.duration) as countryAVg from (t1,t2) join Person p on t1.id = p.id join Country c on substring(p.phone_number,1,3) = c.country_code group by c.name, t2.globalAvg ) Select name as country from t3 where countryAVg > globalAvg
with t1 as ( select c.name as country, p.id from Country c inner join Person p ON c.country_code = LEFT(p.phone_number,3) ), t2 as( select t.country, t.id, c.duration from t1 t inner join Calls c ON t.id = c.caller_id or t.id = c.callee_id), t3 as ( select a.country, avg(a.duration) as avg1 from t2 a group by 1 ) select country from t3 where avg1 > (select avg(d.duration) from Calls d)
with t1 as ( select c2.name, c1.duration from person p join ( select caller_id as id, duration from calls union all select callee_id as id, duration from calls ) c1 on c1.id = p.id join country c2 on c2.country_code = left(p.phone_number,3) ) select name as country from t1 group by name having avg(duration) > (select avg(duration) from t1)
with t1 as ( select id, c.name as country from person join country c on left(phone_number, 3) = c.country_code ), t2 as ( select country, duration from t1 join calls where t1.id = caller_id or t1.id = callee_id ), t3 as ( select country, avg(duration) as avg_country from t2 group by country ) select country from t3 where avg_country > (select avg(duration) as avg from t2)
with t1 as ( select id, duration from (select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls) as tmp1 ), t2 as ( select p.id, c.name as country from person as p join country as c on substr(p.phone_number,1,3) = c.country_code ), t3 as( select t1.id, avg(t1.duration) as peravg, t2.country from t1 join t2 using(id) group by t2.country having avg(t1.duration) > (select avg(duration) from t1) ) select country from t3
with t1 as (select caller_id, duration from calls union all select callee_id, duration from calls) select b.name as country from t1 join person a on t1.caller_id = a.id join country b on left(a.phone_number, 3) = b.country_code group by 1 having avg(duration) > (select avg(duration) from calls)
with t1 as (select id, b.name as country_name from person a join country b on left(phone_number, 3) = country_code), t2 as (select caller_id as id, duration from calls union all select callee_id as id, duration from calls) select country_name as country from t1 join t2 on t1.id = t2.id group by 1 having avg(duration) > (select avg(duration) from t2)
with t1 as (select p.id, c.name from person p left join country c on substring(p.phone_number, 1,3)=c.country_code), t2 as (select caller_id as cid, duration from calls union select callee_id as cid, duration from calls) select name as country from t2 join t1 on t2.cid=t1.id group by name having avg(duration) > (select avg(duration) from calls)
with t1 as( select p.id, c.name as country from Person p left join Country c on left(p.phone_number,3) = c.country_code), t2 as( select t3.caller_id, t3.duration from Calls t3 union all select t3.callee_id, t3.duration from Calls t3), t4 as( select avg(t2.duration) as country_avg, t1.country from t2 left join t1 on t2.caller_id = t1.id group by t1.country) select country from t4 where country_avg > (select avg(t2.duration) from t2)
with t1 as( select sum(duration)*2/(count(*) *2) as global_average from calls ), t2 as( select p.id, c.name as country from person p join country c on left(p.phone_number, 3) = c.country_code ), t3 as( select t2.country, avg(case when c.caller_id = t2.id or c.callee_id = t2.id then duration end) as average from t2, calls c group by 1 ) select country from t3, t1 where average > global_average
with temp as ( select c.name,avg(duration) over(partition by c.name) as average, avg(duration) over() as total from person as p join country as c on substring(p.phone_number,1,3)=c.country_code right join calls on p.id=caller_id or p.id=callee_id) select distinct name as country from temp where average>total
with temp as (select c.name as country, avg(ca.duration) as duration from country c, person p, calls ca where c.country_code = substr(p.phone_number,1,3) and (p.id = ca.caller_id or p.id = ca.callee_id) group by c.name) select t.country from temp t, (select avg(duration) duration from calls) t2 where t.duration > t2.duration
with temp as (select caller_id as id, duration from calls union all select callee_id as id, duration from calls) , phone as (select b.id, a.name as country from country a join (select id, name, left(phone_number, 3) as cod from person) b on a.country_code=b.cod) select country from temp a join phone b on a.id=b.id group by country having avg(duration) > (select avg(duration) from calls )
with temp as (select country.name as country, c1.duration as duration from country left join person on country.country_code = substr(person.phone_number,1,3) join calls c1 on person.id = c1.caller_id union all select country.name as country, c2.duration as duration from country left join person on country.country_code = substr(person.phone_number,1,3) join calls c2 on person.id = c2.callee_id) select country from temp group by country having avg(duration) > (select avg(duration) from calls)
with temp as (select id, name as country from (select id, left(phone_number,3) as country_code from person) as t1 inner join country as c on c.country_code = t1.country_code), cte as (select country, duration from (select caller_id as id, duration from calls union all select callee_id, duration from calls) as t1 inner join temp as t on t1.id = t.id) select country from cte group by 1 having avg(duration)> (select avg(duration) from cte)
with temp1 as ( select caller_id as id, duration from Calls union all select callee_id as id, duration from Calls ) , temp2 as ( select a.id, a.duration, b.phone_number, c.name as country from temp1 as a left join Person b on a.id = b.id left join Country c on substring(b.phone_number, 1,3) = c.country_code ) , temp3 as ( select country, avg(duration) over () as avg_dur, avg(duration) over (partition by country) as country_dur from temp2 ) select distinct country from temp3 where avg_dur < country_dur
with temp1 as ( select id, left(phone_number,3) as code from person), temp2 as ( select temp1.id, country.name from temp1 left join country on temp1.code=country.country_code), temp3 as ( select caller_id, duration from calls union select callee_id, duration from calls), temp4 as( select temp2.name, temp3.duration from temp3 left join temp2 on temp2.id=temp3.caller_id), temp5 as( select name, avg(duration) as duration from temp4 group by 1) select name as country from temp5 where duration >(select avg(duration) from calls)
with tmp as ( select distinct a.name as country, id from country a inner join person b on a.country_code=left(phone_number,3) ) select country from ( select b.country, sum(duration) as duration, count(*) as cnt from calls a inner join tmp b on a.caller_id=b.id group by 1 union select c.country, sum(duration) as duration, count(*) as cnt from calls a inner join tmp c on a.callee_id=c.id group by 1) t group by 1 having sum(duration)/sum(cnt)>(select avg(duration) from calls)
with tmp as (select * from calls union all select callee_id as caller_id, caller_id as callee_id, duration from calls ) select c.name as country from tmp a inner join person b on a.caller_id=b.id inner join country c on left(b.phone_number,3)=c.country_code group by 1 having avg(duration)>(select avg(duration) from tmp)
with tmp as (select id, c.name from Person p join Country c on substring_index(p.phone_number,'-',1)=c.country_code) , tmp1 as (select name, avg(duration) avg_duration from (select name,caller_id, duration from Calls c join tmp t on c.caller_id=t.id union all select name,callee_id as caller_id, duration from Calls c join tmp t on c.callee_id=t.id ) t1 group by 1) select name country from tmp1 where avg_duration>(select avg(duration) from Calls)
with tmp_table1 as (select e.*, f.name as caller_country_name, g.name as callee_country_name from (select c.*, d.phone_number as callee_phone_number from (select a.phone_number as caller_phone_number, b.caller_id, b.callee_id, b.duration from Person a right join Calls b on a.id = b.caller_id) c left join Person d on c.callee_id = d.id) e left join Country f on left(e.caller_phone_number, 3) = f.country_code left join Country g on left(e.callee_phone_number, 3) = g.country_code) select name as country from ( select a.name, (ifnull((ifnull(b.caller_duration, 0) + ifnull(c.callee_duration, 0))/ ifnull((ifnull(b.caller_count, 0) + ifnull(c.callee_count, 0)), 1), 0)) as 'country_avg' from Country a left join (select sum(duration) as caller_duration, count(caller_country_name) as caller_count, caller_country_name from tmp_table1 group by caller_country_name) b on a.name = b.caller_country_name left join (select sum(duration) as callee_duration, count(callee_country_name) as callee_count, callee_country_name from tmp_table1 group by callee_country_name) c on a.name = c.callee_country_name) h where country_avg > (select * from (select avg(duration) as world_avg from tmp_table1) i)
with total_call as ( select caller_id as call_id, duration from calls union all select callee_id as call_id, duration from calls ), person_country as ( select p.id, left(p.phone_number,3) as country_code, c.name as country from person p left join country c on left(p.phone_number,3) = c.country_code ), d as ( select call_id, duration, country, avg(duration) as avg_d from total_call c left join person_country p on c.call_id = p.id group by country ) select country from d where avg_d > (select sum(duration)/(select count(caller_id) from calls) from calls)
with u as(select distinct * from calls ), t as (select avg(duration) as avg_duration from calls) select c.name as country from person as p inner join u on u.caller_id = p.id or u.callee_id = p.id inner join country as c on c.country_code = left(p.phone_number,3) group by c.country_code,c.name having avg(duration)> (select * from t)
with users as ( select r.id, r.duration, substr(p.phone_number, 1, 3) as country_code from Person p right join (select caller_id id, duration from Calls union all select callee_id id, duration from Calls) r on r.id = p.id ) select c.name country from Country c join users u on u.country_code = c.country_code group by c.country_code having avg(duration) > (select avg(duration) glob_duration from users)
with world as ( select avg(duration) as world_average_duration from country cou left join person p on left(phone_number, 3)=country_code join calls ca on id=caller_id or id=callee_id ), country as ( select country_code, cou.name, avg(duration) as country_average_duration from country cou left join person p on left(phone_number, 3)=country_code join calls ca on id=caller_id or id=callee_id group by country_code, cou.name ) select name as country from country where country_average_duration>( select world_average_duration from world )
with x as ( select p.id,c.name as country from person as p inner join country as c on left(p.phone_number,3) = c.country_code ), y as ( select c.duration, x1.country as caller_country, x2.country as callee_country from calls as c inner join x as x1 on c.caller_id = x1.id inner join x as x2 on c.callee_id = x2.id ), z as ( select caller_country as country,duration from y union all select callee_country as country,duration from y ) select country from z group by country having avg(duration) > (select avg(duration) from z)
with x as (select c.name,avg(duration) avg_dur from person p join country c on substring(p.phone_number,1,3) = c.country_code join calls ca on (p.id = ca.caller_id or p.id = ca.callee_id) group by 1 having avg_dur > (select avg(duration) from calls)) select name as country from x
with zte as (select Country.name,duration from (select caller_id , duration from Calls union all select callee_id , duration from Calls) temp1 left join Person on temp1.caller_id = Person.id left join Country on Country.country_code = left(Person.phone_number,3)) select name as country from zte group by 1 having avg(duration) > (select avg(duration) as tot_duration from zte)
