SELECT A.BOOK_ID, A.NAME FROM ( SELECT * FROM BOOKS WHERE available_from<"2019-05-23" ) AS A LEFT JOIN ( SELECT * FROM ORDERS WHERE dispatch_date>"2018-06-23" ) AS B ON A.BOOK_ID = B.BOOK_ID GROUP BY A.BOOK_ID HAVING SUM(B.QUANTITY) IS NULL OR SUM(B.QUANTITY)<10
SELECT B.book_id, B.name FROM ( SELECT * FROM Books WHERE available_from < "2019-05-23" ) B WHERE book_id NOT IN ( SELECT book_id FROM Orders WHERE dispatch_date >= "2018-06-23" AND dispatch_date < "2019-06-23" GROUP BY book_id HAVING SUM(quantity) >= 10 )
SELECT B.book_id, B.name FROM Books B LEFT JOIN (SELECT book_id, sum(quantity) count_books FROM orders WHERE dispatch_date >= date_sub("2019-06-23", INTERVAL 1 YEAR) GROUP BY 1) sub_count_sold ON sub_count_sold.book_id = B.book_id WHERE B.available_from <= date_sub("2019-06-23", INTERVAL 1 MONTH) AND (sub_count_sold.count_books IS NULL OR sub_count_sold.count_books<10)
SELECT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON B.book_id = O.book_id AND COALESCE(DATEDIFF('2019-06-23', O.dispatch_date),0) < 365 WHERE DATEDIFF('2019-06-23', available_from) > 30 GROUP BY 1 HAVING COALESCE(SUM(O.quantity),0) < 10
SELECT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON B.book_id = O.book_id AND IFNULL(DATEDIFF('2019-06-23', O.dispatch_date),0) < 365 WHERE DATEDIFF('2019-06-23', B.available_from) > 30 GROUP BY 1 HAVING IFNULL(SUM(O.quantity),0) < 10
SELECT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON O.book_id=B.book_id AND O.dispatch_date > '2018-06-23' WHERE B.available_from <= '2019-05-23' GROUP BY B.book_id HAVING sum(O.quantity) < 10 or sum(O.quantity) IS NULL
SELECT B.book_id,B.name FROM (SELECT * FROM Books WHERE book_id NOT IN (SELECT book_id FROM Books WHERE available_from>'2019-05-23') ) AS B LEFT JOIN (SELECT * FROM Orders WHERE dispatch_date>'2018-06-23') AS O ON B.book_id = O.book_id GROUP BY B.Book_id HAVING IFNULL(SUM(quantity),0)<10
SELECT B.book_id,B.name FROM Books B ,Orders O WHERE available_from<="2019-05-23" AND B.book_id = O.book_id GROUP BY B.book_id HAVING SUM(quantity*(dispatch_date>="2018-06-23"))<10 UNION SELECT book_id,name FROM Books B WHERE book_id NOT IN (SELECT DISTINCT book_id FROM Orders O)
SELECT BOOKS.BOOK_ID, NAME FROM BOOKS LEFT JOIN ORDERS USING (BOOK_ID) WHERE available_from <'2019-05-23' GROUP BY BOOKS.BOOK_ID HAVING SUM(CASE WHEN DISPATCH_DATE BETWEEN '2018-06-23' and '2019-06-23' THEN QUANTITY ELSE 0 END)<10
SELECT BOOK_ID,NAME FROM( SELECT B.BOOK_ID,NAME,COALESCE(TTL,0) AS TTL2,AVAILABLE_FROM FROM BOOKS B LEFT JOIN ( SELECT BOOK_ID,SUM(QUANTITY) AS TTL FROM ORDERS WHERE DISPATCH_DATE BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY BOOK_ID ) X ON B.BOOK_ID=X.BOOK_ID ) Y WHERE TTL2<10 AND DATEDIFF('2019-06-23',AVAILABLE_FROM)>30
SELECT Books.book_id, name FROM Books LEFT JOIN Orders ON Books.book_id=Orders.book_id AND DATEDIFF('2019-06-23',dispatch_date)<=365 WHERE DATEDIFF('2019-06-23',available_from)>=30 GROUP BY 1 HAVING (SUM(quantity)<10 OR SUM(quantity) IS NULL)
SELECT C.BOOK_ID, C.NAME FROM ( SELECT A.BOOK_ID, A.NAME, SUM(B.QUANTITY)AS TOTAL FROM ( SELECT * FROM BOOKS WHERE available_from<"2019-05-23" ) AS A LEFT JOIN ( SELECT * FROM ORDERS WHERE dispatch_date>"2018-06-23" ) AS B ON A.BOOK_ID = B.BOOK_ID GROUP BY A.BOOK_ID ) AS C WHERE C.TOTAL IS NULL OR C.TOTAL <10
SELECT DISTINCT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON O.book_id=B.book_id WHERE B.available_from<'2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>= '2018-06-23' THEN quantity ELSE 0 END)<10
SELECT DISTINCT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON O.book_id=B.book_id WHERE B.available_from<'2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>=DATE_SUB('2019-06-23', interval 1 year) THEN quantity ELSE 0 END)<10
SELECT DISTINCT B.book_id, B.name FROM Books B LEFT JOIN Orders O ON O.book_id=B.book_id WHERE B.available_from<'2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>=DATE_SUB('2019-06-23',interval 1 year) THEN quantity ELSE 0 END)<10
SELECT DISTINCT b.book_id, b.name FROM books b LEFT JOIN (SELECT book_id, SUM(quantity) as copies_sold FROM orders o WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY 1) m ON b.book_id = m.book_id WHERE b.available_from < '2019-05-23' AND (copies_sold < 10 or copies_sold IS NULL)
SELECT a.book_id, a.name FROM (SELECT * FROM Books WHERE DATEDIFF('2019-06-23', available_from) >= 30) a LEFT JOIN (SELECT * FROM Orders WHERE DATEDIFF('2019-06-23', dispatch_date) BETWEEN 0 AND 365) b ON a.book_id = b.book_id GROUP BY book_id HAVING IFNULL(SUM(quantity), 0) < 10
SELECT a.book_id, a.name FROM (SELECT b.book_id, b.name FROM books b WHERE DATEDIFF("2019-06-23",b.available_from)>30) AS a LEFT JOIN (SELECT o.book_id, sum(o.quantity) as total FROM orders o WHERE o.dispatch_date>="2018-06-23" GROUP BY o.book_id) AS b ON a.book_id=b.book_id WHERE b.total<10 or b.total is null
SELECT a.book_id, a.name FROM Books a LEFT JOIN (SELECT book_id, SUM(quantity) AS n_sold FROM Orders WHERE dispatch_date between '2018-06-24' AND '2019-06-23' GROUP BY book_id) AS b ON a.book_id = b.book_id WHERE IFNULL(n_sold, 0) < 10 AND a.available_from <= '2019-05-24'
SELECT a.book_id, a.name FROM books a LEFT JOIN orders b ON a.book_id = b.book_id AND b.dispatch_date >= DATE_ADD('2019-06-23',INTERVAL -1 YEAR) WHERE a.available_from < DATE_ADD('2019-06-23',INTERVAL -1 MONTH) GROUP BY 1,2 HAVING SUM(IFNULL(quantity,0)) < 10
SELECT a.book_id, a.name FROM books a LEFT JOIN orders b ON a.book_id = b.book_id AND b.dispatch_date >= DATE_ADD('2019-06-23',INTERVAL -1 YEAR) WHERE available_from < DATE_ADD('2019-06-23',INTERVAL -1 MONTH) GROUP BY 1,2 HAVING SUM(IFNULL(quantity,0)) < 10
SELECT b.book_id ,b.name FROM ( SELECT book_id ,name FROM Books WHERE available_from <= '2019-05-23' ) b LEFT JOIN ( SELECT book_id ,quantity FROM Orders WHERE dispatch_date >= '2018-06-23' AND dispatch_date <= '2019-06-23' ) o ON b.book_id = o.book_id GROUP BY b.book_id HAVING SUM(CASE WHEN o.quantity IS NOT NULL THEN o.quantity ELSE 0 END) < 10
SELECT b.book_id ,b.name FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id AND (DATEDIFF('2019-06-23', o.dispatch_date) >= 0 AND DATEDIFF('2019-06-23', o.dispatch_date) <= 365) WHERE DATEDIFF('2019-06-23', b.available_from) >= 30 GROUP BY b.book_id, b.name HAVING SUM(CASE WHEN o.quantity IS NOT NULL THEN o.quantity ELSE 0 END) < 10
SELECT b.book_id as book_id, b.name as name FROM Books b LEFT JOIN Orders o On b.book_id = o.book_id WHERE b.available_from <= '2019-05-23' GROUP BY b.book_id HAVING SUM(CASE WHEN dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' THEN quantity ELSE 0 END) < 10
SELECT b.book_id, b.name FROM (SELECT * FROM Books WHERE available_from <= '2019-05-23') b LEFT JOIN (SELECT * FROM Orders WHERE dispatch_date >= '2018-06-23') o ON b.book_id = o.book_id GROUP BY b.book_id HAVING SUM(o.quantity) IS NULL OR SUM(o.quantity) < 10
SELECT b.book_id, b.name FROM (SELECT * FROM Books WHERE available_from <= '2019-05-23') b LEFT JOIN Orders o ON b.book_id = o.book_id AND dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(IFNULL(quantity,0)) < 10
SELECT b.book_id, b.name FROM (SELECT b.book_id FROM Books b Left Join Orders o ON b.book_id = o.book_id and Datediff('2019-06-23', dispatch_date) <= 365 Group by b.book_id Having Sum(IF(quantity is null, 0, quantity)) < 10) as a JOIN Books b ON a.book_id = b.book_id WHERE datediff('2019-06-23', available_from) > 30
SELECT b.book_id, b.name FROM (SELECT book_id, name FROM Books WHERE available_from < '2019-05-23') b LEFT JOIN (SELECT * FROM Orders WHERE dispatch_date >= "2018-06-23") o USING(book_id) GROUP BY b.book_id, b.name HAVING SUM(o.quantity) IS NULL OR SUM(o.quantity) < 10
SELECT b.book_id, b.name FROM (SELECT book_id, name FROM books WHERE available_from NOT BETWEEN DATE_SUB('2019-06-23', INTERVAL 30 DAY) AND '2019-06-23') AS b LEFT JOIN orders o ON b.book_id = o.book_id AND o.dispatch_date BETWEEN DATE_SUB('2019-06-23', INTERVAL 365 DAY) AND '2019-06-23' GROUP BY b.book_id HAVING IFNULL(SUM(o.quantity), 0) < 10
SELECT b.book_id, b.name FROM Books as b lEFT JOIN Orders as o ON b.book_id = o.book_id AND dispatch_date between '2018-06-23' and '2019-06-23' WHERE NOT b.available_from BETWEEN date_sub('2019-06-23', interval 31 day) AND '2019-06-23' GROUP BY b.book_id, b.name HAVING COALESCE(SUM(o.quantity),0) < 10
SELECT b.book_id, b.name FROM Books b LEFT JOIN ( SELECT o.book_id, SUM(quantity) AS total_quantity FROM Orders o WHERE o.dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY o.book_id ) b_less ON b.book_id = b_less.book_id WHERE COALESCE(total_quantity, 0) < 10 AND b.available_from <= '2019-05-23'
SELECT b.book_id, b.name FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id AND o.dispatch_date > DATE('2018-06-23') WHERE b.available_from + 30 <= DATE('2019-06-23') GROUP BY b.book_id HAVING SUM(quantity) < 10 OR SUM(quantity) IS NULL
SELECT b.book_id, b.name FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id AND o.dispatch_date BETWEEN DATE_ADD("2019-06-23", INTERVAL -1 YEAR) AND "2019-06-23" WHERE b.available_from < DATE_ADD("2019-06-23", INTERVAL -1 MONTH) GROUP BY b.book_id HAVING SUM(IFNULL(o.quantity, 0)) < 10
SELECT b.book_id, b.name FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id WHERE b.available_from <= '2019-05-23' GROUP BY b.book_id HAVING SUM(CASE WHEN dispatch_date < '2018-06-23' THEN 0 WHEN dispatch_date IS NULL THEN 0 ELSE quantity END) < 10
SELECT b.book_id, b.name FROM Books b LEFT JOIN Orders o ON o.book_id = b.book_id AND o.dispatch_date >= DATE_ADD('2019-06-23', INTERVAL -1 YEAR) WHERE b.available_from < DATE_ADD('2019-06-23', INTERVAL -1 MONTH) GROUP BY 1,2 HAVING COALESCE(SUM(o.quantity),0) < 10
SELECT b.book_id, b.name FROM Books b LEFT JOIN Orders o ON o.book_id = b.book_id AND o.dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' WHERE b.available_from<'2019-05-23' GROUP BY 1 HAVING COALESCE(SUM(o.quantity),0) < 10
SELECT b.book_id, b.name FROM Books b left JOIN Orders o ON b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 GROUP BY b.book_id, b.name having ifnull(sum(quantity),0) <10
SELECT b.book_id, b.name FROM Orders o RIGHT JOIN Books b ON o.book_id = b.book_id WHERE b.available_from < DATE_SUB('2019-06-23', interval '1' month) GROUP BY b.book_id HAVING SUM(CASE WHEN o.dispatch_date BETWEEN DATE_SUB('2019-06-23', interval '1' year) AND '2019-06-23' THEN o.quantity ELSE 0 END) < 10
SELECT b.book_id, b.name FROM books AS b LEFT JOIN Orders AS o ON b.book_id=o.book_id and DATEDIFF('2019-6-23', o.dispatch_date)<=365 WHERE b.available_from<'2019-5-23' GROUP BY b.book_id HAVING COALESCE(SUM(quantity),0)<10
SELECT b.book_id, b.name FROM books AS b LEFT JOIN orders AS o ON o.book_id = b.book_id AND (o.dispatch_date) BETWEEN '2018-06-23' AND '2019-06-23' WHERE DATEDIFF('2019-06-23', b.available_from) >= 31 GROUP BY 1 HAVING SUM(COALESCE(o.quantity, 0)) < 10
SELECT b.book_id, name FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id AND dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' WHERE DATEDIFF('2019-06-23', available_from) > 30 GROUP BY 1, 2 HAVING IFNULL(SUM(quantity), 0) < 10
SELECT b.book_id, name FROM books b LEFT JOIN Orders o ON o.book_id = b.book_id AND o.dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' WHERE DATEDIFF('2019-06-23', available_from) > 30 GROUP BY 1, 2 HAVING IFNULL(SUM(quantity), 0) < 10
SELECT b.book_id, name from Books b left join (SELECT * from Orders where dispatch_date between '2018-06-23' and '2019-06-23')o on b.book_id=o.book_id where available_from <'2019-05-23' group by b.book_id having sum(ifnull(quantity,0))<10
SELECT b.book_id,b.name FROM Books b JOIN ( SELECT b.book_id, b.name , IFNULL(SUM(o.quantity), 0) AS quantity FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id AND o.dispatch_date >= '2018-06-23' GROUP BY b.book_id) temp ON b.book_id = temp.book_id AND b.available_from <= '2019-05-23' AND temp.quantity < 10
SELECT b.book_id,name FROM books b LEFT JOIN (SELECT book_id, sum(quantity) AS total FROM ORDERS o WHERE dispatch_date BETWEEN '2018-06-23' and '2019-06-23' GROUP BY book_id) a USING (book_id) WHERE available_from < '2019-05-23' AND (total < 10 OR TOTAL IS NULL)
SELECT book_id, name FROM Books LEFT JOIN Orders USING(book_id) WHERE available_from < '2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>=DATE_SUB('2019-06-23',INTERVAL 1 year) THEN quantity ELSE 0 END) < 10
SELECT book_id, name FROM Books LEFT JOIN Orders USING(book_id) WHERE available_from < '2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>=DATE_SUB('2019-06-23',interval 1 year) THEN quantity ELSE 0 END) < 10
SELECT book_id, name FROM Books LEFT JOIN Orders USING(book_id) WHERE available_from < '2019-05-23' GROUP BY book_id HAVING SUM(IF(dispatch_date>=DATE_SUB('2019-06-23',INTERVAL 1 year), quantity, 0)) < 10
SELECT book_id, name FROM Books WHERE DATEDIFF("2019-06-23", available_from)> 30 AND book_id NOT IN(SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10)
SELECT book_id, name FROM Books WHERE DATEDIFF('2019-06-23', available_from)>=30 AND book_id NOT IN (SELECT book_id FROM Orders WHERE DATEDIFF('2019-06-23', dispatch_date)<=365 GROUP BY book_id HAVING SUM(quantity)>=10)
SELECT book_id, name FROM Books WHERE available_from < '2019-05-23' AND book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10)
SELECT book_id, name FROM Books WHERE available_from < '2019-05-23' AND book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id Having sum(quantity) >= 10)
SELECT book_id, name FROM Books WHERE available_from < '2019-05-23' AND book_id not IN (SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id Having sum(quantity) >=10)
SELECT book_id, name FROM Books WHERE available_from < '2019-05-23' and book_id NOT IN ( SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10 )
SELECT book_id, name FROM Books WHERE available_from <= DATE_ADD('2019-06-23', INTERVAL -30 DAY) AND book_id NOT IN ( SELECT book_id FROM Orders WHERE dispatch_date > '2018-06-23' GROUP BY 1 HAVING SUM(quantity) >= 10 )
SELECT book_id, name FROM Books WHERE available_from NOT BETWEEN '2019-05-23' AND '2019-06-23' AND book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10)
SELECT book_id, name FROM Books WHERE available_from<"2019-05-23" AND book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date between"2018-06-23" and "2019-06-23" GROUP BY book_id HAVING SUM(quantity)>=10)
SELECT book_id, name FROM Books WHERE book_id NOT IN ( SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10 ) AND book_id NOT IN ( SELECT book_id FROM Books WHERE DATEDIFF('2019-06-23',available_from) <= 30 )
SELECT book_id, name FROM Books WHERE book_id NOT IN (SELECT Books.book_id FROM Orders JOIN Books ON Orders.book_id = Books.book_id where dispatch_date between '2018-06-23' and '2019-06-23' GROUP BY books.book_id HAVING SUM(quantity) >= 10) AND available_from < '2019-05-23'
SELECT book_id, name FROM Books WHERE book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10) AND available_from < '2019-05-23'
SELECT book_id, name FROM Books WHERE book_id not in (SELECT t.book_id FROM (SELECT b.book_id, IFNULL(SUM(o.quantity), 0) AS sales FROM Books b LEFT JOIN Orders o ON b.book_id = o.book_id WHERE b.available_from <= '2019-05-23' AND o.dispatch_date >= '2018-06-23' GROUP BY b.book_id HAVING SUM(o.quantity) >= 10) t) AND available_from <= '2019-05-23'
SELECT book_id, name FROM Books WHERE datediff('2019-06-23', available_from) > 30 AND book_id NOT IN (SELECT book_id FROM Orders WHERE datediff('2019-06-23', dispatch_date) <= 365 GROUP BY book_id HAVING SUM(quantity) >= 10)
SELECT book_id, name FROM Books b WHERE available_from < '2019-05-23' AND book_id NOT IN (SELECT book_id FROM Orders o WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10)
SELECT book_id, name FROM books WHERE book_id NOT IN (SELECT book_id FROM orders WHERE dispatch_date BETWEEN DATE_SUB("2019-06-23",INTERVAL 1 YEAR) AND "2019-06-23" GROUP BY book_id HAVING SUM(quantity) >= 10) AND available_from < DATE_SUB("2019-06-23",INTERVAL 1 MONTH)
SELECT book_id,name FROM Books WHERE available_from<"2019-05-23" AND book_id NOT IN (SELECT book_id FROM Orders WHERE dispatch_date>"2018-06-23" GROUP BY book_id HAVING SUM(quantity)>=10)
SELECT distinct b.book_id, b.name FROM Books as b LEFT JOIN Orders as o on b.book_id = o.book_id WHERE b.available_from < '2019-05-23' and b.book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >=10)
SELECT distinct book_id, name FROM (SELECT b.book_id, name, available_from FROM Books b LEFT JOIN Orders o ON b.book_id=o.book_id AND datediff('2019-06-23', dispatch_date)<=364 GROUP BY 1 HAVING sum(ifnull(quantity,0))<10) t WHERE datediff('2019-06-23', available_from)>30
SELECT sub.book_id, sub.name FROM ( SELECT b.* FROM Books b WHERE available_from < DATE_SUB(CAST('2019-06-23' AS DATE), INTERVAL 1 month) ) sub LEFT JOIN (SELECT * FROM Orders o WHERE o.dispatch_date BETWEEN DATE_SUB(CAST('2019-06-23' AS DATE), INTERVAL 1 year) AND CAST('2019-06-23' AS DATE) ) sub2 ON sub2.book_id = sub.book_id GROUP BY sub.book_id HAVING IFNULL(SUM(sub2.quantity), 0) < 10
SELECT sub_older_books.book_id, name FROM ( SELECT book_id, name FROM Books WHERE available_from <= date_sub("2019-06-23", INTERVAL 1 MONTH)) sub_older_books LEFT JOIN (SELECT book_id, sum(quantity) count_books FROM orders WHERE dispatch_date >= date_sub("2019-06-23", INTERVAL 1 YEAR) GROUP BY 1) sub_count_sold ON sub_older_books.book_id=sub_count_sold.book_id where count_books is null or count_books<10
SELECT sub_older_books.book_id, name FROM (SELECT book_id, name FROM Books WHERE available_from <= date_sub("2019-06-23", INTERVAL 1 MONTH)) sub_older_books LEFT JOIN (SELECT book_id, sum(quantity) count_books FROM orders WHERE dispatch_date >= date_sub("2019-06-23", INTERVAL 1 YEAR) GROUP BY 1) sub_count_sold ON sub_older_books.book_id=sub_count_sold.book_id where count_books is null or count_books<10
SELECT t1.book_id, t1.name FROM books AS t1 LEFT JOIN (SELECT book_id, SUM(quantity) AS book_sold FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id) AS t2 ON t1.book_id = t2.book_id WHERE available_from < '2019-05-23' AND (book_sold IS NULL OR book_sold <10) ORDER BY t1.book_id
Select Books.book_id, name from Books left join Orders on Books.book_id = Orders.book_id Where Books.available_from <= date_sub('2019-06-23', interval 1 Month) Group by Books.book_id, Books.name Having sum( case when(Orders.dispatch_date >= date_sub("2019-06-23",INTERVAL 1 YEAR)) then(coalesce(Orders.quantity,0)) else 0 end )<10
Select b.book_id,b.name from books b left join (Select book_id, sum(quantity) as book_sold from orders where dispatch_date between "2018-06-23" and "2019-06-23" group by book_id) t on b.book_id=t.book_id where available_from < "2019-05-23" and (book_sold is null or book_sold <10) order by b.book_id
Select book_id, name From Books Where book_id not in (Select book_id From Orders Where dispatch_date between '2018-06-24'and '2019-06-23' Group by book_id Having sum(quantity)>=10) And available_from < '2019-05-23'
Select book_id, name from ( Select b.book_id, b.name, ifnull(o.total_quantity,0) as quant from ( Select book_id, name from Books where available_from <= date_sub("2019-06-23", Interval 30 DAY)) b Left Join ( Select book_id, ifnull(sum(quantity),0) as total_quantity, dispatch_date from Orders where dispatch_date >= date_sub("2019-06-23", Interval 365 DAY) group by book_id ) o on b.book_id = o.book_id ) result where quant < 10
Select book_id, name from books where (book_id in (Select book_id from books where available_from < "2019-05-23")) and (book_id not in(Select book_id from orders where dispatch_date between "2018-06-23" and "2019-06-23" group by book_id having sum(quantity)>=10))
WITH BOOKS_ELEGIBLE AS ( SELECT BOOK_ID, NAME FROM BOOKS WHERE AVAILABLE_FROM < '2019-05-23' ) SELECT BOOKS_ELEGIBLE.BOOK_ID, BOOKS_ELEGIBLE.NAME FROM BOOKS_ELEGIBLE LEFT JOIN ORDERS ON BOOKS_ELEGIBLE.BOOK_ID = ORDERS.BOOK_ID GROUP BY 1,2 HAVING SUM( CASE WHEN DISPATCH_DATE > '2018-06-23' THEN QUANTITY ELSE 0 END) < 10
WITH CTE AS ( SELECT d1.book_id, d1.name, SUM(CASE WHEN dispatch_date >= DATE("2018-06-24") AND dispatch_date <= DATE("2019-06-23") THEN quantity ELSE 0 END) AS total_quantity FROM Books as d1 LEFT JOIN Orders as d2 ON d1.book_id = d2.book_id GROUP BY d1.book_id, d1.name HAVING SUM(CASE WHEN dispatch_date >= DATE("2018-06-24") AND dispatch_date <= DATE("2019-06-23") THEN quantity ELSE 0 END) < 10 ) SELECT book_id, name FROM CTE WHERE book_id NOT IN ( SELECT book_id FROM Books WHERE available_from BETWEEN DATE_ADD("2019-06-23", INTERVAL -1 MONTH) AND DATE("2019-06-23") )
WITH CTE1 AS ( SELECT book_id, SUM(quantity) AS total FROM Orders WHERE dispatch_date<='2019-06-23' AND dispatch_date>DATE_ADD('2019-06-23', INTERVAL -1 YEAR) GROUP BY book_id HAVING total>=10) SELECT book_id, name FROM Books WHERE available_from<=DATE_ADD('2019-06-23', INTERVAL -1 MONTH) AND book_id NOT IN (SELECT book_id FROM CTE1)
WITH S0 AS (SELECT book_id, SUM(quantity) AS quantity FROM Orders WHERE dispatch_date >= '2018-06-23' AND dispatch_date <= '2019-06-23' GROUP BY book_id), S1 AS (SELECT Books.book_id, IFNULL(quantity,0) AS quantity FROM S0 RIGHT JOIN Books ON S0.book_id = Books.book_id), S2 AS (SELECT book_id FROM Books WHERE available_from >= '2019-05-23'), S3 AS (SELECT book_id FROM S1 WHERE quantity < 10 AND book_id NOT IN (SELECT * FROM S2)) SELECT S3.book_id, name FROM S3 INNER JOIN Books ON Books.book_id = S3.book_id
WITH T1 AS ( SELECT book_id, name, available_from FROM Books WHERE DATEDIFF('2019-06-23', available_from) >30 ), T2 AS ( SELECT T1.book_id, T1.name, SUM(CASE WHEN O.dispatch_date between '2018-06-23' AND '2019-06-23' THEN O.quantity ELSE 0 END) as NUM FROM T1 LEFT JOIN Orders O ON T1.book_id = O.book_id GROUP BY T1.book_id, T1.name ) SELECT book_id, name FROM T2 WHERE NUM < 10
WITH T1 AS( SELECT * FROM Books WHERE '2019-06-23' > available_from+ INTERVAL 1 MONTH) SELECT book_id,name FROM T1 WHERE book_id NOT IN( SELECT book_id FROM Orders WHERE dispatch_date+ INTERVAL 1 YEAR >= '2019-06-23' GROUP BY book_id HAVING SUM(quantity) >= 10) ORDER BY book_id
WITH adj_books AS( SELECT book_id, name FROM Books WHERE available_from < DATE_SUB('2019-06-23', INTERVAL 1 MONTH) ), orders_book AS( SELECT book_id, quantity FROM Orders WHERE dispatch_date BETWEEN DATE_SUB('2019-06-23', INTERVAL 1 YEAR) AND '2019-06-23' ) SELECT b.book_id, b.name FROM adj_books b LEFT JOIN orders_book o USING(book_id) GROUP BY book_id HAVING SUM(IFNULL(quantity,0)) < 10
WITH available AS ( SELECT book_id, name FROM books WHERE available_from < date_sub('2019-06-23', INTERVAL 1 MONTH)), sold AS ( SELECT book_id, SUM(quantity) as total FROM orders WHERE dispatch_date >= date_sub('2019-06-23', INTERVAL 1 YEAR) GROUP BY book_id ) SELECT a.book_id, a.name FROM available as a LEFT JOIN sold as s ON a.book_id = s.book_id WHERE COALESCE(total, 0) < 10
WITH cte AS (SELECT book_id, name FROM books WHERE datediff("2019-06-23", available_from) >= 30), cte2 AS (SELECT book_id, sum(quantity) as quantity FROM orders WHERE datediff("2019-06-23", dispatch_date) <= 365 GROUP BY book_id) SELECT a.book_id, name FROM cte a LEFT JOIN cte2 b USING (book_id) WHERE quantity < 10 OR quantity IS NULL
WITH cte AS( SELECT book_id,name, available_from FROM Books WHERE available_from < Date_sub('2019-06-23', interval 1 month) ), cte1 AS( Select book_id,quantity FROM Orders WHERE dispatch_date <='2019-06-23' AND dispatch_date>='2019-06-23' - interval 1 year ) SELECT book_id,name FROM(SELECT cte.book_id as book_id, cte.name as name,ifnull(cte1.quantity,0) as quantity FROM cte LEFT JOIN cte1 ON cte.book_id = cte1.book_id)a GROUP BY book_id, name having sum(quantity) <10
WITH cte1 AS (SELECT book_id, SUM(quantity) as k1 FROM Orders WHERE DATEDIFF('2019-06-23',dispatch_date)<=365 GROUP BY book_id) ,cte2 AS (SELECT DISTINCT o.book_id, b.name FROM Orders as o LEFT JOIN Books as b ON b.book_id=o.book_id WHERE o.book_id NOT in (SELECT book_id FROM cte1 WHERE k1>=10)) ,cte4 AS (SELECT DISTINCT b.book_id, b.name FROM Books as B WHERE DATEDIFF('2019-06-23',available_from)>30) SELECT cte4.book_id, cte4.name FROM cte4 LEFT JOIN cte2 ON cte2.book_id=cte4.book_id WHERE cte2.book_id IS NOT NULL OR cte4.book_id NOT IN (SELECT DISTINCT book_id FROM orders)
WITH eligible_books AS( SELECT book_id, name, available_from FROM Books WHERE available_from <= DATE_SUB('2019-06-23', INTERVAL 1 MONTH) ), eligible_orders AS( SELECT book_id, quantity, dispatch_date FROM Orders WHERE dispatch_date BETWEEN DATE_SUB('2019-06-23', INTERVAL 1 YEAR) AND '2019-06-23' ) SELECT temp.book_id AS book_id, temp.name AS name FROM( SELECT eb.book_id AS book_id, eb.name AS name, eo.quantity AS quantity, eo.dispatch_date AS dispatch_date FROM eligible_books eb LEFT JOIN eligible_orders eo ON eb.book_id = eo.book_id ) temp GROUP BY 1 HAVING SUM(CASE WHEN temp.quantity IS NOT NULL THEN temp.quantity ELSE 0 END) < 10
WITH quantity AS ( SELECT book_id, sum(date_ck) as ttl FROM ( SELECT book_id, CASE WHEN dispatch_date > '2018-06-23' THEN quantity ELSE 0 END as date_ck FROM orders )t1 GROUP BY book_id) SELECT b.book_id, b.name FROM books b LEFT JOIN quantity q ON b. book_id = q.book_id WHERE IFnull(q.ttl,0) <10 AND b.book_id NOT IN ( SELECT book_id FROM books WHERE available_from > '2019-05-23' )
WITH t_avail as (SELECT book_id, name FROM Books WHERE available_from < "2019-05-23"), t_qty AS (SELECT book_id, SUM(quantity) as quantity FROM Orders WHERE dispatch_date >= "2018-06-23" GROUP BY book_id), t_final as (SELECT t_avail.book_id, t_avail.name, COALESCE(t_qty.quantity, 0) as QTY from t_avail left join t_qty ON t_qty.book_id = t_avail.book_id) SELECT book_id, name from t_final where QTY < 10
WITH table1 AS( SELECT * FROM Orders WHERE dispatch_date >= DATE_SUB('2019-06-23', INTERVAL 1 YEAR) ) SELECT b.book_id, name FROM Books b LEFT JOIN table1 USING(book_id) WHERE available_from < DATE_SUB('2019-06-23', INTERVAL 1 MONTH) GROUP BY book_id HAVING SUM(COALESCE(quantity,0)) < 10
WITH temp_book AS( SELECT * FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23') SELECT b.book_id, b.name FROM Books b LEFT JOIN temp_book t ON b.book_id = t.book_id WHERE datediff('2019-06-23',b.available_from) > 30 GROUP BY 1 HAVING IFNULL(SUM(quantity),0) <10
With T1 As ( select a.book_id, a.name, sum(quantity) as count1 from books a left join orders b on a.book_id = b.book_id where datediff('2019-06-23', b.dispatch_date) <= 365 group by a.book_id) select a.book_id, a.name from books a left join T1 b on a.book_id = b.book_id where datediff('2019-06-23', a.available_from) >= 30 and b.count1 < 10 or b.count1 is null
With book as (Select book_id, name From Books Where available_from <= subdate('2019-06-23',interval 1 month)) Select b.book_id, b.name From Orders as a Right Join book as b On a.book_id = b.book_id And a.dispatch_date between subdate('2019-06-23',interval 1 year) And '2019-06-23' Group By b.book_id, b.name Having sum(a.quantity) < 10 Or sum(a.quantity) is Null
With book_fliter as(Select book_id, name From Books Where available_from <"2019-05-23"), order_count as(Select book_id, sum(quantity) as num_buy From Orders Where dispatch_date between "2018-06-23" and "2019-06-23" Group by book_id) Select f.book_id, name From book_fliter f Left join order_count o On f.book_id = o.book_id Where ifnull(num_buy,0)<10
With book_sales as ( select book_id, sum(quantity) as qty from Orders where dispatch_date between date_add('2019-06-23',interval -1 year) and '2019-06-23' group by 1) select b.book_id, b.name from Books b left join book_sales bs on b.book_id=bs.book_id where (qty<10 or qty is null) and available_from < date_add('2019-06-23',interval -1 month)
With exclude as ( select book_id from Books where available_from>=DATE_ADD(date('2019-06-23'), INTERVAL -1 MONTH) union select two.book_id from (select * from Orders where dispatch_date between date('2018-06-23') and date('2019-06-23')) as two group by two.book_id having sum(two.quantity) >= 10 ) select book_id, name from Books where book_id not in (select book_id from exclude)
select B.book_id , B.name from Books B left join Orders O on B.book_id = O.book_id and datediff('2019-06-23', dispatch_date)<=365 where datediff('2019-06-23', available_from ) > 30 group by B.book_id having ifnull(sum(quantity),0) < 10
select B.book_id , B.name from Books B left join Orders O on B.book_id = O.book_id where datediff('2019-06-23', available_from ) > 30 group by B.book_id having ifnull(sum(if(datediff('2019-06-23', dispatch_date)<=365, quantity,0)),0) < 10
select B.book_id, B.name From Books B LEFT join Orders O on O.book_id = B.book_id and O.dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' WHERE DATEDIFF('2019-06-23',B.available_from) >= 30 group by B.book_id, B.name having coalesce(sum(quantity),0) < 10 order by 1
select B.book_id, B.name from Books B where B.book_id not in ( select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by 1 having sum(quantity) >=10 ) and available_from < '2019-05-23'
select Books.book_id, Books.name from Books left join Orders on Books.book_id= Orders.book_id and Orders.dispatch_date between "2018-06-23" and "2019-06-23" where Books.available_from< "2019-05-23" group by Books.book_id having ifnull(sum(Orders.quantity),0) <10
select Books.book_id, name from Books left join ( select book_id, sum(quantity) as num_total from Orders where dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' group by 1 ) l on l.book_id = Books.book_id where (l.num_total < 10 or l.num_total is null) and Books.available_from <= '2019-05-23'
select a.book_id ,a.name from Books a left join Orders b on a.book_id = b.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where available_from<='2019-05-23' group by 1,2 having sum(coalesce(b.quantity,0)) <10
select a.book_id, a.name from Books a left join Orders b on a.book_id = b.book_id where a.book_id not in (select book_id from Books where available_from > '2019_05-23') and a.book_id not in (select book_id from Orders where dispatch_date > '2018_06_23' group by 1 having sum(quantity) >= 10 ) group by 1,2
select a.book_id, a.name from Books a left join Orders b on a.book_id=b.book_id and b.dispatch_date between "2018-06-24" and "2019-06-23" where a.available_from <"2019-05-23" group by a.book_id having coalesce(sum(b.quantity),0)<10
select a.book_id, a.name from Books a where available_from <= date_add('2019-06-23', interval -1 month) and a.book_id not in (select book_id from Orders where dispatch_date > date_add('2019-06-23', interval -1 year) group by book_id having sum(quantity)>=10 )
select a.book_id, a.name from books a left join orders b on a.book_id = b.book_id AND dispatch_date >= date_sub('2019-06-23', INTERVAL 1 YEAR) where b.book_id is null OR a.available_from <= date_sub('2019-06-23', INTERVAL 1 MONTH) group by 1,2 having sum(quantity) <10 or sum(quantity) is null
select a.book_id, name from (select * from Books where available_from < '2019-05-23') a left join (select * from Orders where dispatch_date between '2018-06-24' and '2019-06-23') b on a.book_id = b.book_id group by 1 having sum(quantity) < 10 or sum(quantity) is null
select a.book_id, name from Books a left join (select book_id, sum(quantity) as s from Orders where dispatch_date>= date_sub('2019-06-23',INTERVAL 1 YEAR) group by 1) b on a.book_id = b.book_id where available_from < date_sub('2019-06-23',INTERVAL 1 MONTH) and (s is null or s<10)
select a.book_id,a.name from books a left join orders b on a.book_id=b.book_id and b.dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by 1,2 having ifnull(sum(b.quantity),0)<10
select b.book_id , b.name from Books b left join ( select book_id, sum(quantity) as 'total_sold' from Orders where dispatch_date between '2018-06-24' and '2019-06-23' group by book_id ) as o on b.book_id = o.book_id where b.available_from < '2019-05-23' and ifnull(o.total_sold,0) < 10 order by b.book_id
select b.book_id , b.name from books as b join ( select b.book_id, b.name, o.dispatch_date, o.quantity from books as b left join orders as o on o.book_id = b.book_id where b.available_from < date_add('2019-06-23', interval -1 month) ) as tmp on tmp.book_id = b.book_id group by book_id having sum(case when tmp.dispatch_date >= date_add('2019-06-23', interval -1 year) then tmp.quantity else 0 end) < 10
select b.book_id , b.name from books b left join orders o on b.book_id = o.book_id and dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' where available_from < date_sub('2019-06-23', interval 1 month) group by b.book_id, b.name having ifnull(sum(quantity),0) <10
select b.book_id , b.name from books b left join orders o on b.book_id = o.book_id and dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by b.book_id, b.name having ifnull(sum(quantity),0) <10
select b.book_id as book_id, b.name as name from Books as b left join Orders o on o.book_id = b.book_id where b.available_from <= date_sub("2019-06-23",INTERVAL 1 MONTH) group by b.book_id, b.name having sum( case when (o.dispatch_date >= date_sub("2019-06-23",INTERVAL 1 YEAR)) then(coalesce(o.quantity,0)) else 0 end )<10
select b.book_id book_id, name from books b left join (select book_id, sum(quantity) quantity from orders where dispatch_date>="2018-06-23" group by book_id) o on b.book_id = o.book_id where available_from<="2019-05-23" and coalesce(quantity,0)<10
select b.book_id, b.name from ( select * from books where available_from < date_sub('2019-06-23', interval 1 month) ) b left join ( select book_id, sum(quantity) sales from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id ) s on b.book_id = s.book_id where coalesce(sales, 0) < 10
select b.book_id, b.name from (select * from Books where available_from<"2019-05-23") b left join Orders o on b.book_id=o.book_id and o.dispatch_date>=date_sub("2019-06-23", interval 1 year) group by b.book_id having sum(o.quantity)<10 or sum(o.quantity) is null
select b.book_id, b.name from (select * from books where available_from < '2019-05-23') b left join (select * from Orders where dispatch_date > '2018-06-23') o on b.book_id = o.book_id group by b.book_id, b.name having sum(o.quantity) is null or sum(o.quantity) <10
select b.book_id, b.name from (select * from books where available_from <= "2019-05-23") b left join (select * from orders where dispatch_date >= "2018-06-23") o on b.book_id=o.book_id group by b.book_id,b.name having sum(o.quantity) is null or sum(quantity)<10
select b.book_id, b.name from (select * from books where available_from <= '2019-05-23') as b left join (select book_id, sum(quantity) as q from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) as o using (book_id) where o.q< 10 or o.q is null
select b.book_id, b.name from (select * from books where available_from<='2019-05-23') b left join (select * from orders where dispatch_date >= '2018-06-23') o using(book_id) group by b.book_id having coalesce(sum(quantity),0)<10
select b.book_id, b.name from (select * from books where available_from<='2019-05-23') b left join (select * from orders where dispatch_date between '2018-06-23' and '2019-06-23') o using(book_id) group by b.book_id having coalesce(sum(quantity),0)<10
select b.book_id, b.name from (select book_id, name from books where available_from <= '2019-05-23') b left join (select * from orders where dispatch_date >= '2018-06-23' and dispatch_date <= '2019-06-23' group by book_id having sum(quantity) >= 10 ) o on b.book_id = o.book_id where o.book_id is null
select b.book_id, b.name from Books as b left join Orders as o on b.book_id = o.book_id and (DATEDIFF('2019-06-23', O.dispatch_date) < 365) where DATEDIFF('2019-06-23', B.available_from) > 30 group by b.book_id having ifnull(sum(o.quantity), 0) <10
select b.book_id, b.name from Books as b left join Orders as o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', interval 1 year) and o.dispatch_date <= '2019-06-23' where available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', interval 1 month) group by 1, 2 having sum(coalesce(o.quantity, 0)) < 10
select b.book_id, b.name from Books as b left join Orders as o on b.book_id=o.book_id and dispatch_date between '2018-06-23' and '2019-6-23' where datediff('2019-06-23',b.available_from)>30 group by book_id having sum(IFNULL(o.quantity, 0)) <10
select b.book_id, b.name from Books b LEFT JOIN (select * from Orders where dispatch_date BETWEEN '2018-06-23' AND '2019-06-23') o on b.book_id = o.book_id where b.available_from < '2019-05-23' group by b.book_id, b.name having sum(quantity) IS NULL or sum(quantity) < 10
select b.book_id, b.name from Books b LEFT JOIN Orders o on o.book_id = b.book_id and o.dispatch_date between '2018-06-23' and '2019-06-23' where DATEDIFF('2019-06-23', b.available_from) > 30 group by b.book_id, b.name Having IFNULL(sum(o.quantity), 0) < 10
select b.book_id, b.name from Books b left join ( select book_id, sum(quantity) as 'total_orders' from Orders where dispatch_date between '2018-06-24' and '2019-06-23' group by book_id ) as o on b.book_id = o.book_id where b.available_from <= '2019-05-23' and ifnull(o.total_orders,0) < 10 order by b.book_id
select b.book_id, b.name from Books b left join ( select book_id, sum(quantity) as 'total_sold' from Orders where dispatch_date between '2018-06-24' and '2019-06-23' group by book_id ) as o on b.book_id = o.book_id where b.available_from < '2019-05-23' and ifnull(o.total_sold,0) < 10 order by b.book_id
select b.book_id, b.name from Books b left join (select *, (case when dispatch_date between date('2018-06-23') and date('2019-06-23') then quantity else 0 end) as quant from Orders) o on b.book_id = o.book_id where datediff(date('2019-06-23'), b.available_from) > 30 group by b.book_id having sum(ifnull(o.quant, 0)) < 10
select b.book_id, b.name from Books b left join (select book_id, sum(quantity) as nsold from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) o on b.book_id = o.book_id where (o.nsold < 10 or o.nsold is null) and datediff('2019-06-23', b.available_from)>30
select b.book_id, b.name from Books b left join (select book_id, sum(quantity) as total from Orders where dispatch_date > "2018-06-23" group by book_id) ctp on b.book_id = ctp.book_id where DATEDIFF("2019-06-23", available_from) > 30 and total < 10 or total is null
select b.book_id, b.name from Books b left join (select book_id, sum(quantity) as total from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) as t on b.book_id=t.book_id where b.available_from < '2019-05-23' and (t.total < 10 or t.total is null)
select b.book_id, b.name from Books b left join Orders a on a.book_id=b.book_id and a.dispatch_date>=date_add('2019-06-23',interval -1 year) where b.available_from<=date_add('2019-06-23',interval -1 month) group by b.book_id, b.name having sum(ifnull(quantity,0))<10
select b.book_id, b.name from Books b left join Orders o on (o.book_id = b.book_id and (o.dispatch_date between '2018-06-23' and '2019-06-23')) where DATE_ADD(b.available_from,INTERVAL 1 MONTH) <= STR_TO_DATE('2019-06-23','%Y-%m-%d') group by b.book_id, b.name having 10 > sum(o.quantity) or sum(o.quantity) is null
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id and dispatch_date >= DATE_SUB('2019-06-23', INTERVAL 1 year) where available_from < DATE_SUB('2019-06-23', INTERVAL 1 MONTH) group by b.book_id, b.name having coalesce(sum(quantity),0) < 10
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23',available_from) >30 group by b.book_id having ifnull(sum(quantity),0)<10
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id and dispatch_date between date_add('2019-06-23', interval -1 YEAR) and '2019-06-23' WHERE available_from < date_add('2019-06-23', interval -1 MONTH) group by b.book_id, b.name having (sum(quantity) <10 or sum(quantity) is null)
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id and o.dispatch_date >= '2018-06-23' where b.available_from <= '2019-05-23' group by 1,2 having ifnull(sum(o.quantity),0) < 10
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id where b.available_from <= DATE_ADD('2019-06-23', INTERVAL -1 MONTH) group by b.book_id having sum(if(o.dispatch_date > DATE_ADD('2019-06-23', INTERVAL -1 YEAR), o.quantity, 0)) < 10
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id where b.available_from <= date_sub("2019-06-23",INTERVAL 1 MONTH) group by 1,2 having sum( case when (o.dispatch_date >= date_sub("2019-06-23", INTERVAL 1 YEAR)) then (coalesce(o.quantity,0) )else 0 end)<10
select b.book_id, b.name from Books b left join Orders o on b.book_id = o.book_id where b.available_from <= date_sub("2019-06-23",INTERVAL 1 MONTH) group by b.book_id , b.name having sum( case when (o.dispatch_date >= date_sub("2019-06-23",INTERVAL 1 YEAR)) then(coalesce(o.quantity,0)) else 0 end )<10
select b.book_id, b.name from Books b left join Orders o on b.book_id=o.book_id and o.dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by b.book_id, b.name having ifnull(sum(quantity),0)<10
select b.book_id, b.name from Books b left join Orders o on b.book_id=o.book_id and o.dispatch_date>=date_sub("2019-06-23", interval 1 year) where b.available_from<"2019-05-23" group by b.book_id having sum(o.quantity)<10 or sum(o.quantity) is null
select b.book_id, b.name from Books b left join Orders o on o.book_id=b.book_id and o.dispatch_date between '2018-06-23' and '2019-06-23' where b.available_from < '2019-05-23' group by b.book_id, b.name having sum(coalesce(o.quantity,0))<10
select b.book_id, b.name from Books b left join Orders o using (book_id) where available_from<= "2019-05-23" and dispatch_date between "2018-06-23" and "2019-06-23" group by b.book_id having sum(quantity) < 10 union select b.book_id, b.name from Books b left join Orders o using (book_id) where quantity is null union select b.book_id, b.name from Books b left join Orders o using (book_id) where dispatch_date < "2018-06-23" and b.book_id not in (select book_id from orders where dispatch_date >= "2018-06-23")
select b.book_id, b.name from Books b where available_from < '2019-05-23' and book_id not in ( select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10 )
select b.book_id, b.name from Orders o right join Books b on o.book_id = b.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', b.available_from) > 30 group by b.book_id , b.name having ifnull(sum(quantity),0) < 10
select b.book_id, b.name from books as b join (select b.book_id, name, ifnull(sum(quantity),0) as quantity from books as b left join orders as o on b.book_id = o.book_id and o.dispatch_date >= "2018-06-23" group by book_id, name) as n on b.book_id = n.book_id and b.available_from <= "2019-05-23" and quantity < 10
select b.book_id, b.name from books as b left join orders as o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', INTERVAL 1 year) WHERE available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', Interval 1 month) group by book_id having sum(coalesce(o.quantity,0)) < 10
select b.book_id, b.name from books b left join (select book_id, quantity from orders where dispatch_date > '2018-06-23') t on b.book_id = t.book_id where b.available_from not between date_sub('2019-06-23', interval 29 day) and '2019-06-23' group by b.book_id having ifnull(sum(t.quantity),0) < 10
select b.book_id, b.name from books b left join (select book_id, sum(quantity) as book_sold from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) t on b.book_id = t.book_id where available_from < '2019-05-23' and (book_sold is null or book_sold <10) order by b.book_id
select b.book_id, b.name from books b left join (select book_id, sum(quantity) as num_sold from Orders o where dispatch_date between date_add('2019-06-23', interval -1 year) and '2019-06-23' group by book_id) o1 on b.book_id = o1.book_id where available_from < date_add('2019-06-23', interval -1 month) and (num_sold <10 or num_sold is null)
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and dispatch_date >='2018-06-23' and dispatch_date <= '2019-06-23' where available_from < '2019-05-23' group by b.book_id, b.name having sum(quantity) < 10 or sum(quantity) is null
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by b.book_id, b.name having ifnull(sum(quantity),0) < 10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by b.book_id, b.name having ifnull(sum(quantity),0) <10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and ifnull(datediff('2019-06-23', dispatch_date),0) <365 where available_from < '2019-05-23' group by b.book_id, b.name having ifnull(sum(o.quantity),0) < 10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and o.dispatch_date between '2018-06-23' and '2019-06-23' where b.available_from <= '2019-05-23' group by 1 having coalesce(sum(quantity), 0) < 10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id where available_from <= date_sub('2019-06-23', interval 1 month) group by b.book_id having sum(case when dispatch_date >= date_sub('2019-06-23', interval 1 year) then quantity else 0 end) <10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id where b.available_from < "2019-05-23" group by b.book_id, b.name having sum( case when (o.dispatch_date >= date_sub("2019-06-23",INTERVAL 1 YEAR)) then(coalesce(o.quantity,0)) else 0 end )<10
select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id where b.available_from <= date_sub("2019-06-23", interval 1 month) group by b.book_id, b.name having sum(case when (o.dispatch_date >= date_sub("2019-06-23", interval 1 year)) then (coalesce(o.quantity, 0)) else 0 end) < 10
select b.book_id, b.name from books b left join orders o on b.book_id=o.book_id and datediff('2019-06-23',o.dispatch_date)<=365 where datediff('2019-06-23',b.available_from)>=30 group by 1,2 having sum(o.quantity)<10 or sum(o.quantity) is null
select b.book_id, b.name from books b left join orders o on b.book_id=o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by 1,2 having ifnull(sum(quantity),0)<10
select b.book_id, name from Books b left join Orders o on b.book_id = o.book_id and ifnull(datediff('2019-06-23', dispatch_date),0) <= 365 where ifnull(datediff('2019-06-23', available_from),0) > 30 group by 1 having ifnull(sum(quantity),0) < 10
select b.book_id, name from Books b left join Orders o on o.book_id = b.book_id where available_from < '2019-05-23' group by b.book_id, name having sum(case when dispatch_date>'2018-06-23' then coalesce(quantity,0) else 0 end)<10
select b.book_id, name from Books b where available_from <= date_sub('2019-06-23', interval 1 month) and book_id not in ( select distinct b.book_id from Books b left join Orders o on b.book_id=o.book_id where dispatch_date between '2018-06-23' and '2019-06-23' group by b.book_id having sum(quantity) >= 10 )
select b.book_id, name from books as b where available_from <'2019-05-23' and book_id NOT IN (select book_id from Orders where dispatch_date>'2018-06-23' and dispatch_date<'2019-06-23' group by book_id having sum(quantity)>=10)
select b.book_id, name from books b left join (select book_id, sum(quantity) as sold from orders where dispatch_date >= date_sub('2019-06-23', interval 1 year) group by book_id) t on b.book_id = t.book_id where available_from <= date_sub('2019-06-23', interval 1 month) and sold < 10 or sold is null
select b.book_id, name from books b left join (select book_id, sum(quantity) as total_sold from orders where dispatch_date >= '2018-06-24' and dispatch_date<='2019-06-23' group by book_id) t on b.book_id=t.book_id where (total_sold<10 or total_sold is null) and available_from<='2019-05-23'
select b.book_id, name from books b left join orders o on b.book_id = o.book_id and IfNull(Datediff('2019-06-23', O.dispatch_date),0) < 365 where Datediff('2019-06-23', available_from) > 30 group by 1 having IfNull(sum(quantity),0) < 10
select b.book_id, name from books b left join orders o on b.book_id = o.book_id and dispatch_date between "2018-06-23" and "2019-06-23" where datediff('2019-06-23', available_from) > 30 group by b.book_id having ifnull(sum(quantity),0)<10
select b.book_id, name from books b left join orders o on b.book_id = o.book_id and dispatch_date between "2018-06-23" and "2019-06-23" where datediff('2019-06-23', available_from) > 30 group by b.book_id,name having ifnull(sum(quantity),0)<10
select b.book_id, name from books b left join orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where b.available_from < '2019-05-23' group by b.book_id,name having coalesce(sum(quantity),0) < 10
select b.book_id, name from books b left join orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where datediff('2019-06-23', available_from) > 30 group by b.book_id having ifnull(sum(quantity),0) <10
select b.book_id, name from books b left join orders o on b.book_id = o.book_id where TIMESTAMPDIFF(MONTH, available_from, '2019-06-23') > 1 group by b.book_id having SUM(case when TIMESTAMPDIFF(YEAR,dispatch_date,'2019-06-23') = 0 then quantity else 0 end) < 10
select b.book_id, name from books b where b.book_id not in ( select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by 1 having sum(quantity) >= 10) and b.available_from <= '2019-05-23' group by 1, 2
select b.book_id,b.name from (select book_id,name from Books where datediff('2019-06-23',available_from)>=30) b left join (select book_id from Orders where datediff('2019-06-23',dispatch_date)<=365 group by book_id having sum(quantity)>=10) a on a.book_id=b.book_id where a.book_id is null
select b.book_id,b.name from books b join (select b.book_id,b.name, IFNULL(sum(o.quantity),0) as items_sold from books b left join orders o on b.book_id = o.book_id and o.dispatch_date >= '2018-06-23' group by b.book_id) as ab ON b.book_id = ab.book_id and b.available_from <= '2019-05-23' and ab.items_sold < 10
select b.book_id,b.name from books b left join (select book_id,sum(quantity) as book_sold from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) t on b.book_id = t.book_id where (book_sold is null or book_sold < 10) and b.available_from < '2019-05-23'
select b.book_id,b.name from books b left join orders o on b.book_id=o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' where b.book_id not in (select distinct book_id from books where available_from>=date_add('2019-06-23',interval -1 month)) group by b.book_id,b.name having ifnull(sum(quantity),0) <10
select b.book_id,b.name from books b left join orders o on b.book_id=o.book_id and o.dispatch_date between "2018-06-23" and '2019-06-23' where b.available_from<'2019-05-23' group by 1,2 having ifnull(sum(o.quantity),0)<10
select b.book_id,b.name from books b left join orders o on b.book_id=o.book_id where b.book_id not in (select distinct book_id from books where available_from>=date_add('2019-06-23',interval -1 month)) group by b.book_id,b.name having sum(case when dispatch_date between "2019-06-23"- interval 1 year and "2019-06-23" then quantity else 0 end)<10
select b.book_id,b.name from books b left join orders o on o.book_id = b.book_id where b.book_id in ( select book_id from books where available_from < date_add('2019-06-23', interval -1 month) ) group by b.book_id,b.name having sum(case when dispatch_date between date_add('2019-06-23',interval -1 year) and '2019-06-23' then quantity else 0 end) < 10
select b.book_id,name from books b left join (select book_id,sum(quantity) as sum_copies from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) o on o.book_id = b.book_id where available_from < '2019-05-23' and (sum_copies < 10 or sum_copies is null)
select book_id , name from books where available_from < '2019-06-23' - interval 1 month and book_id not in (select book_id from orders where dispatch_date >= '2019-06-23' - interval 1 year group by 1 having sum(quantity) >= 10)
select book_id , name from books where available_from <= date_sub('2019-06-23', interval 1 month) and book_id not in (select book_id from orders where dispatch_date >= date_sub('2019-06-23', interval 1 year) group by book_id having sum(quantity) >= 10 )
select book_id, name from (select b.book_id, b.name, sum(if(o.dispatch_date between date_sub('2019-06-23',interval 1 year) and date('2019-06-23'),quantity,0)) as sold from Books as b left join Orders as o on b.book_id = o.book_id where b.available_from not between date_sub('2019-06-23',interval 1 month) and date('2019-06-23') group by b.book_id)t where sold <10
select book_id, name from (select b.book_id, name, ifnull(SUm(quantity),0) as num from books b left join orders o on b.book_id = o.book_id and dispatch_date > date_sub('2019-06-23', interval 365 day) where available_from < date_sub('2019-06-23', interval 30 day) group by book_id, name) a where num < 10
select book_id, name from Books b where book_id not in ( select book_id from Orders o where dispatch_date >= '2018-06-23' and dispatch_date <= '2019-06-22' group by book_id having sum(quantity) >= 10) and available_from < '2019-05-23'
select book_id, name from Books where available_from < '2019-05-23' and book_id not in ( select book_id from Orders where dispatch_date > '2018-06-23' group by book_id having sum(quantity) >= 10 )
select book_id, name from Books where available_from < '2019-05-23' and book_id not in (select book_id from Orders where dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' group by 1 having sum(quantity) >= 10)
select book_id, name from Books where available_from < '2019-05-23' and book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by 1 having sum(quantity) >= 10)
select book_id, name from Books where available_from < '2019-05-23' and book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10)
select book_id, name from Books where available_from < '2019-05-23' and book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >=10 )
select book_id, name from Books where available_from < cast("2019-05-23" as date) and book_id NOT IN ( select book_id from Orders where dispatch_date >= cast("2018-06-23" as date) group by book_id having sum(quantity) >= 10 )
select book_id, name from Books where available_from <'2019-05-23' and book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-22' group by book_id having sum(quantity)>=10)
select book_id, name from Books where available_from <= date_sub('2019-06-23', interval 1 month) and book_id not in (select book_id from Orders where dispatch_date >= date_sub('2019-06-23', interval 1 year) group by 1 having sum(quantity) >= 10)
select book_id, name from Books where available_from<='2019-05-23' and book_id not in (select book_id from Orders where dispatch_date>="2018-06-23" and dispatch_date<='2019-06-23' group by book_id having sum(quantity)>=10)
select book_id, name from Books where book_id not in ( select book_id from Orders where dispatch_date >= '2018-06-23' and dispatch_date<= '2019-06-22' group by book_id having sum(quantity) >= 10) and available_from < '2019-05-23'
select book_id, name from Books where book_id not in ( select book_id from( select book_id, sum(quantity) as sold_qty_2018 from Orders where TIMESTAMPDIFF(day,dispatch_date,'2019-06-23') <= 365 group by book_id ) O1 where O1.sold_qty_2018 >= 10 union all (select book_id from Books where available_from >= '2019-05-23') )
select book_id, name from Books where book_id not in ( select book_id from( select book_id, sum(quantity) as sold_qty_last_year from Orders where TIMESTAMPDIFF(day,dispatch_date,'2019-06-23') <= 365 group by book_id ) O1 where O1.sold_qty_last_year >= 10 union all (select book_id from Books where available_from >= '2019-05-23') )
select book_id, name from Books where book_id not in (select book_id from (select * from Orders where datediff(dispatch_date, '2018-06-23') > 0) as o group by book_id having sum(quantity) >= 10) and datediff('2019-05-23', available_from) > 0
select book_id, name from Books where book_id not in (select book_id from Orders where dispatch_date > "2018-06-23" group by book_id having sum(quantity)>=10) and available_from < "2019-05-23"
select book_id, name from Books where datediff('2019-06-23', available_from) > 30 and book_id not in (select book_id from Orders where datediff('2019-06-23', dispatch_date) <= 365 group by book_id having sum(quantity) >= 10)
select book_id, name from Books where datediff('2019-06-23', available_from) > 30 and book_id not in (select book_id from Orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10)
select book_id, name from Books where datediff('2019-06-23', available_from) >= 31 and book_id not in (select book_id from Orders where dispatch_date > '2018-06-23' group by book_id having sum(quantity) >= 10 )
select book_id, name from books b where available_from < '2019-06-23' - interval 1 month and book_id not in ( select book_id from orders where dispatch_date > '2019-06-23'- interval 1 year group by book_id having sum(quantity)>=10 )
select book_id, name from books where available_from < "2019-05-23" and book_id not in ( select book_id from orders where dispatch_date between "2018-06-23" and "2019-06-23" group by book_id having sum(quantity) >= 10 )
select book_id, name from books where available_from < "2019-05-23" and book_id not in (select book_id from orders where dispatch_date between "2018-6-23" and "2019-06-23" group by book_id having sum(quantity) >= 10 )
select book_id, name from books where available_from < '2019-05-23' and book_id not in (select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10)
select book_id, name from books where available_from < date_sub('2019-06-23', interval 1 month) and book_id not in (select book_id from orders where dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' group by book_id having sum(quantity)>=10 )
select book_id, name from books where available_from <= '2019-06-23' - INTERVAL 1 MONTH AND book_id not in ( select book_id from orders where dispatch_date >= '2019-06-23' - INTERVAL 1 YEAR group by book_id having sum(quantity) >= 10)
select book_id, name from books where available_from <= '2019-06-23' - INTERVAL 1 MONTH and book_id not in ( select book_id from orders where dispatch_date >= '2019-06-23'- INTERVAL 1 YEAR group by book_id having sum(quantity)>=10)
select book_id, name from books where available_from <= ('2019-06-23' - interval 1 month) and book_id not in ( select book_id from orders where dispatch_date >= ('2019-06-23' - interval 1 year) group by book_id having sum(quantity) >= 10)
select book_id, name from books where available_from <= date_sub('2019-06-23', interval 1 month) and book_id not in (select book_id from orders where dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' group by book_id having sum(quantity) >= 10)
select book_id, name from books where available_from<date_add("2019-06-23", interval -1 month) and book_id not in (select distinct book_id from orders where dispatch_date between date_add("2019-06-23", interval -1 year) and "2019-06-23" group by book_id having sum(quantity)>=10)
select book_id, name from books where book_id not in ( select book_id from orders where datediff('2019-06-23', dispatch_date) < 365 group by 1 having sum(quantity) > 9 ) and datediff('2019-06-23', available_from) > 30
select book_id, name from books where book_id not in ( select book_id from orders where dispatch_date >= date_sub('2019-06-23', interval 1 year) group by 1 having sum(quantity) >=10 ) and available_from < date_sub('2019-06-23', interval 1 month)
select book_id, name from books where book_id not in (select book_id from orders o where datediff('2019-06-23', dispatch_date) < 365 group by book_id having sum(quantity) >=10) and datediff("2019-06-23", available_from) > 30
select book_id, name from books where book_id not in (select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10 ) and book_id not in (select book_id from books where available_from > '2019-05-23')
select book_id, name from books where book_id not in (select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >=10 ) and available_from <= '2019-05-23'
select book_id, name from books where book_id not in( select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10) and book_id not in (select book_id from books where available_from>'2019-05-23' )
select book_id, name from books where book_id not in( select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10) and book_id not in( select book_id from books where available_from>'2019-05-23')
select book_id, name from books where date_add('2019-06-23', interval -1 month) >= available_from and book_id not in ( select book_id from orders where dispatch_date >= date_add('2019-06-23', interval -1 year) group by book_id having sum(quantity) >= 10 )
select book_id, name from books where datediff('2019-06-23', available_from) > 30 and book_id not in ( select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10 )
select book_id, name from books where datediff('2019-06-23', available_from) >31 and book_id not in (select book_id from orders where datediff('2019-06-23',dispatch_date) <365 group by 1 having sum(quantity) >=10 )
select book_id, name from books where datediff('2019-06-23',available_from)>30 and book_id not in (select book_id from orders where datediff('2019-06-23',dispatch_date )<=365 group by book_id having sum(quantity)>=10)
select book_id, name from books where datediff('2019-06-23',available_from)>30 and book_id not in (select book_id from orders where datediff('2019-06-23',dispatch_date)<=365 group by book_id having sum(quantity)>=10)
select book_id, name from( select b.book_id, b.name, sum(case when dispatch_date between date_sub(str_to_date('2019-06-23','%Y-%m-%d'), interval 1 year) and str_to_date('2019-06-23','%Y-%m-%d') then quantity else 0 end) as qty from books b left join orders a on a.book_id=b.book_id where available_from<=date_sub(str_to_date('2019-06-23','%Y-%m-%d'), interval 1 month) group by 1,2) t where qty<10
select book_id,name from (select books.book_id, name, ifnull(sum(quantity),0) as b from books left join orders t on books.book_id=t.book_id and dispatch_date > '2018-06-23' where available_from <'2019-05-23' group by books.book_id having b<10 )m
select book_id,name from Books where book_id not in(select book_id from (select book_id,sum(quantity) as q from Orders where dispatch_date between "2018-06-24" and "2019-06-24" group by book_id having q>=10) as t1) and book_id in (select book_id from Books where available_from<"2019-05-23")
select book_id,name from books where available_from < '2019-05-23' and book_id not in (select book_id from orders where dispatch_date >'2018-06-23' group by 1 having sum(quantity) >=10)
select books.book_id, books.name from books left join orders on books.book_id = orders.book_id where available_from < date_sub('2019-06-23', interval 1 month) group by books.book_id, books.name having sum( case when orders.dispatch_date > date_sub('2019-06-23', interval 1 year) then(coalesce(orders.quantity,0)) else 0 end ) < 10
select books.book_id, name from books left join (select * from orders where dispatch_date >= '2019-06-23' - interval 1 YEAR) as o1 on books.book_id = o1.book_id where available_from <= '2019-06-23' - interval 1 MONTH group by books.book_id having sum(ifnull(quantity,0)) < 10
select books.book_id,books.name from Books left join Orders o on Books.book_id = o.book_id and ifnull(datediff('2019-06-23',dispatch_date),0) < 365 where datediff('2019-06-23',available_from) > 30 group by books.book_id having ifnull(sum(quantity),0) < 10
select books.book_id,books.name from books left join (select* from orders where dispatch_date>'2018-06-23') s on books.book_id=s.book_id where available_from<'2019-05-23' group by books.book_id,name having sum(coalesce(quantity,0))<10
select books.book_id,name from books left join (select book_id, sum(quantity) sold from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) orders on books.book_id = orders.book_id where available_from < '2019-05-23' and (sold is null or sold <10 )
select c.book_id, c.name from (select a.book_id, a.name, ifnull(sum(b.quantity),0) as total from (select * from books where datediff('2019-06-23',available_from)>=30)a left join (select * from orders where datediff('2019-06-23',dispatch_date)<=365) b on a.book_id=b.book_id group by 1,2) c where c.total<10
select distinct B.book_id, B.name from Books B left join Orders O on B.book_id = O.book_id where B.available_from <='2019-05-23' group by B.book_id having sum(case when O.dispatch_date is null then 0 when O.dispatch_date >= '2018-06-23' then O.quantity else 0 end) < 10
select distinct Books.book_id, name from Books left join Orders on Orders.book_id = Books.book_id and dispatch_date > date_add('2019-06-23', interval -1 year) where available_from <= date_add('2019-06-23', interval -1 month) group by 1, 2 having ifnull(sum(quantity),0)<10
select distinct b.book_id as book_id, b.name as name from books b left join orders o on b.book_id = o.book_id where available_from < '2019-06-23' - INTERVAL 1 MONTH and b.book_id not in ( select book_id from orders where dispatch_date > ('2019-06-23' - INTERVAL 1 YEAR) group by book_id having sum(quantity) >= 10 )
select distinct b.book_id, b.name from (select book_id, name from Books where available_from < cast('2019-06-23' as date) - interval 1 month) b left join (select book_id, sum(quantity) as order_counts from Orders where dispatch_date between cast('2018-06-23' as date) and cast('2019-06-23' as date) group by book_id) o on b.book_id = o.book_id where ifnull(order_counts, 0) < 10
select distinct b.book_id, b.name from books b left join orders o on b.book_id = o.book_id where b.book_id not in (SELECT book_id FROM Books WHERE DATEDIFF('2019-06-23',available_from) <= 30) group by b.book_id, b.name having sum(case when DATEDIFF('2019-06-23', O.dispatch_date) <= 365 then quantity else 0 end) < 10
select distinct b.book_id, b.name from books b left join orders o on o.book_id = b.book_id and o.dispatch_date >= '2018-06-23' where b.book_id not in (select book_id from books where available_from > '2019-05-23') group by b.book_id having sum(o.quantity) is null or sum(o.quantity) < 10
select distinct b.book_id, name from Books b left join Orders o using(book_id) where b.book_id not in ( select book_id from Orders where dispatch_date between '2018-06-24' and '2019-06-23' group by book_id having sum(quantity) >= 10) and available_from < '2019-05-23'
select distinct b.book_id,b.name from Books b left join Orders using(book_id) where available_from < '2019-05-23' GROUP BY book_id HAVING SUM(CASE WHEN dispatch_date>=DATE_SUB('2019-06-23',interval 1 year) THEN quantity ELSE 0 END)<10
select distinct book_id, name from books where book_id not in (select distinct book_id from books where available_from > '2019-05-23') and book_id not in (select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by 1 having sum(quantity) >= 10 )
select name, book_id from Books where available_from < '2019-05-23' and book_id not in (SELECT book_id from Orders where dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' group by book_id having sum(quantity) >= 10)
select t.book_id, t.name from (Select * from books where available_from <= date_sub('2019-06-23',interval 1 month)) as t left join (select * from orders where dispatch_date>=date_sub('2019-06-23',interval 1 year) ) as orders on t.book_id = orders.book_id group by book_id having coalesce(sum(quantity),0) < 10
select t1.book_id,t1.name from books t1 left join orders t2 on t1.book_id=t2.book_id and DATEDIFF('2019-06-23',t2.dispatch_date) <=365 where abs(DATEDIFF( '2019-06-23',t1.available_from )) > 30 group by t1.book_id having coalesce(sum(quantity),0) < 10
select tempt1.book_id , tempt1.name from (select * from Books where available_from < '2019-05-23') as tempt1 left join (select * from Orders where timestampdiff(day, dispatch_date, '2019-06-23') < 365) as tempt2 on tempt1.book_id = tempt2.book_id group by 1 having sum(tempt2.quantity) < 10 or sum(tempt2.quantity) IS NULL
with E as ( select book_id, name from Books where datediff('2019-06-23',available_from)>30 ), O1 as ( select book_id from Orders where datediff('2019-06-23',dispatch_date)<365 group by book_id having sum(quantity)>=10 ) select book_id, name from E where book_id not in (select book_id from O1)
with a as ( select * from Books where available_from < '2019-05-23'), b as ( select * from Orders where dispatch_date > date_sub('2019-06-23', interval 1 year) ) select a.book_id, name from a left join b using (book_id) group by 1, 2 having ifnull(sum(quantity), 0) < 10
with a as ( select * from books where available_from < '2019-05-23' ) , b as ( select book_id, sum(quantity) as sales from orders where dispatch_date <= '2019-06-23' and dispatch_date >= '2018-06-23' group by book_id ) select a.book_id, name from a left join b on a.book_id = b.book_id where sales < 10 or sales is null
with a as ( select book_id, name from books where book_id not in (select book_id from books where available_from between '2019-05-23' and '2019-06-23')), b as (select book_id, quantity from orders where dispatch_date between '2018-06-23' and '2019-06-23') select a.book_id, a.name from a left join b on a.book_id = b.book_id group by 1 having sum(ifnull(quantity,0))<10
with a as( select * from Books where available_from <= '2019-5-23'), b as(select a.book_id, a.name, case when o.dispatch_date between '2018-06-23' and '2019-6-23' then quantity else 0 end as q from Orders o right join a on o.book_id = a.book_id) select book_id, name from b group by book_id having sum(q) < 10
with avail as ( select book_id, name from books where available_from < date_add('2019-06-23', interval -1 month) ), sold as ( select book_id, sum(quantity) as total from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id ) select a.book_id, a.name from avail a left join sold s on a.book_id= s.book_id where coalesce(s.total,0)<10
with avail as ( select book_id,name from books where available_from <date_sub("2019-06-23",interval 1 month)) select avail.book_id,name from avail left join (select * from orders where dispatch_Date between date_sub("2019-06-23",interval 1 year) and "2019-06-23") o on avail.book_id=o.book_id group by 1 having sum(quantity)<10 or sum(quantity) is null
with base as ( select book_id, name from books where available_From < '2019-05-23' ) select b.book_id, b.name from base b left join orders o on b.book_id = o.book_id and dispatch_date between '2018-06-23' and '2019-06-23' group by b.book_id, b.name having coalesce(sum(quantity),0) <10
with book2 as ( select * from books where available_from not between '2019-05-23' and '2019-06-23'), order2 as ( select book_id, sum(quantity) as total_quantity from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id) select b.book_id, b.name from book2 b left join order2 o on o.book_id = b.book_id where coalesce(o.total_quantity,0) < 10
with book_recent as (select * from Books where available_from < '2019-05-23') select b.book_id, b.name from (select * from Orders where DATEDIFF('2019-06-23', dispatch_date) < 365 ) o right join book_recent b on o.book_id = b.book_id group by 1,2 having sum(case when o.quantity is not null then o.quantity else 0 end) < 10
with books_avail as ( select book_id, name from books where available_from < date_add('2019-06-23', interval -1 month) ), books_sold as ( select book_id, sum(quantity) as ttl from orders where dispatch_date between date_add('2019-06-23', interval -12 month) and '2019-06-23' group by book_id ) select ba.book_id, ba.name from books_avail ba left join books_sold as bs on ba.book_id = bs.book_id where coalesce(ttl,0) <10
with bookst as ( select * from books where (available_from <= str_to_date('2019-05-23','%Y-%m-%d')) ), orderst as ( select book_id, sum(quantity)as quantity from Orders where dispatch_date between str_to_date('2018-06-23','%Y-%m-%d') and str_to_date('2019-06-23','%Y-%m-%d') group by book_id ) select b.book_id,b.name from orderst o right join bookst b on o.book_id = b.book_id where o.quantity < 10 or o.quantity is null
with consider_books as ( select book_id, name from Books where available_from < '2019-05-23' ) select book_id, name from ( select a.book_id, a.name, sum(case when b.dispatch_date > '2018-06-23' then b.quantity else 0 end) as number_of_orders from consider_books as a left join Orders as b using (book_id) group by a.book_id, a.name ) sub where sub.number_of_orders < 10
with cte as ( SELECT book_id, sum(quantity) as qty FROM Orders WHERE dispatch_date >= '2018-06-23' GROUP BY 1) SELECT book_id, name FROM ( SELECT b.book_id, name, ifnull(qty,0) as qty FROM Books b LEFT JOIN cte using (book_id) WHERE available_from <= '2019-05-24')t WHERE qty < 10
with cte as ( select b.book_id, b.name, sum(quantity) from books b join orders o on o.book_id=b.book_id where datediff('2019-06-23',dispatch_date)<=365 group by b.book_id having sum(quantity)>=10 ) select book_id, name from books where book_id not in (select book_id from cte) and available_from <= '2019-05-23'
with cte as ( select book_id, name from books where available_from < date_sub('2019-06-23', interval 1 month) ), cte1 as ( select order_id, book_id, quantity from orders where dispatch_date > date_sub('2019-06-23', interval 1 year) and dispatch_date < '2019-06-23' ) select cte.book_id, cte.name from cte1 right join cte on cte1.book_id = cte.book_id group by 1, 2 having sum(ifnull(cte1.quantity, 0)) < 10
with cte as (select book_id, name from books where available_from not between date_sub('2019-06-23', interval 31 day) and '2019-06-23') select book_id, name from cte c left join orders o using(book_id) group by book_id having sum(if(dispatch_date between'2018-06-23' and '2019-06-23', quantity, 0)) < 10
with cte as (select book_id, sum(quantity) ct from Orders where dispatch_date > date_sub('2019-06-23', interval 1 year) group by 1 ) select book_id,name from (select b.book_id, b.name,ifnull(cte.ct,0) from (select * from Books where available_from < date_sub('2019-06-23', interval 1 month))b left join cte using(book_id) where ifnull(cte.ct,0) <10) c
with cte as (select book_id,sum(quantity) as num from orders where dispatch_date > '2018-06-23' group by book_id having num >=10) select a.book_id,a.name from books a where a.book_id not in (select book_id from cte) and available_from < '2019-05-23'
with cte as( select b.book_id bi,b.name n,quantity q,dispatch_date from Books b left join Orders o on b.book_id=o.book_id where b.available_from <'2019-05-23' ) select bi book_id,n name from cte group by bi having sum(case when dispatch_date>'2018-06-23' then q else 0 end)<10
with cte as( select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', interval 1 year) and o.dispatch_date <= '2019-06-23' where available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', interval 1 month ) group by 1,2 having sum(coalesce(o.quantity, 0)) < 10 ) select * from cte
with cte as( select book_id, name from books where available_from < '2019-05-23' ) select cte.book_id, cte.name from cte left join orders on orders.book_id = cte.book_id and (orders.dispatch_date < '2019-06-23' and orders.dispatch_date >'2018-06-23') group by 1 having sum(ifnull(orders.quantity,0)) <10
with cte as( select book_id, sum(quantity) ct from orders where dispatch_date > date_sub('2019-06-23', interval 1 year) group by 1) select book_id,name from (select b.book_id,b.name,ifnull(cte.ct,0) from (select * from Books where available_from < date_sub('2019-06-23', interval 1 month))b left join cte using(book_id) where ifnull(cte.ct,0)<10)c
with cte as(select b.book_id, b.name from books b left join orders o on b.book_id = o.book_id and o.dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' where available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', interval 1 month) group by 1,2 having sum(ifnull(o.quantity,0)) < 10) select * from cte
with cte as(select b.book_id, b.name, sum(ifnull(t.quantity, 0)) as total_quantity from Books b left join(select * from Orders where timestampdiff(year, dispatch_date, '2019-06-23') < 1) t on t.book_id = b.book_id group by b.book_id, b.name) select book_id, name from cte where book_id not in (select book_id from Books where timestampdiff(month, available_from,'2019-06-23') < 1) and total_quantity < 10
with cte as(select book_id, name from Books where available_from <= date_add('2019-06-23', interval -1 month)), cte1 as ( select book_id from Orders where dispatch_date between date_add('2019-06-23', interval -1 year) and '2019-06-23' group by 1 having sum(quantity) >= 10 ) select * from cte where book_id not in (select * from cte1)
with cte1 as ( select book_id, name from books where book_id not in (select book_id from books where available_from>'2019-05-23') group by 1), cte2 as ( select c.book_id, c.name, sum(o.quantity) as sales from cte1 c left join orders o on c.book_id=o.book_id where dispatch_date between '2018-06-23' and '2019-06-23' group by 1,2) select c1.book_id, c1.name from cte1 c1 left join cte2 c2 on c1.book_id=c2.book_id where c1.book_id not in (select book_id from cte2 where sales>=10)
with cte_final as ( select b.book_id, b.name from Books as b left join Orders as o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', interval 1 year) and o.dispatch_date <= '2019-06-23' where available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', interval 1 month) group by 1, 2 having sum(coalesce(o.quantity, 0)) < 10 ) select * from cte_final
with cte_final as ( select b.book_id, b.name from Books as b left join Orders as o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', interval 1 year) and o.dispatch_date <= '2019-06-23' where available_from <= date_sub('2019-06-23', interval 1 month) group by 1, 2 having sum(coalesce(o.quantity, 0)) < 10 ) select * from cte_final
with cte_final as ( select b.book_id, b.name from Books as b left join Orders as o on b.book_id = o.book_id and o.dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' where available_from <= '2019-06-23' and not (available_from > date_sub('2019-06-23', interval 1 month)) group by 1, 2 having sum(coalesce(o.quantity, 0)) < 10 ) select * from cte_final
with cte_final as ( select b.book_id, b.name from books as b left join orders as o on b.book_id = o.book_id and o.dispatch_date > date_sub('2019-06-23', interval 1 year) and o.dispatch_date <= '2019-06-23' where available_from <= '2019-06-23' and not available_from > date_sub('2019-06-23', interval 1 month) group by 1, 2 having sum(coalesce(o.quantity, 0)) < 10 ) select * from cte_final
with filtered_books as ( Select book_id, name, available_from from Books where available_from < DATE_ADD('2019-06-23', INTERVAL -1 MONTH) ) Select fb.book_id, fb.name from filtered_books fb left outer join Orders od on fb.book_id = od.book_id and dispatch_date >= DATE_ADD('2019-06-23', INTERVAL -1 YEAR) group by fb.book_id, fb.name having coalesce(sum(quantity), 0) < 10
with final as ( with updated as ( with not_latest as ( Select * from Books where book_id not in (Select b.book_id from Books b where datediff("2019-06-23",available_from) < 30 ) ) Select n.book_id,n.name,o.quantity,o.dispatch_date from not_latest n left join Orders o on n.book_id = o.book_id ) Select book_id,name,dispatch_date, case when datediff("2019-06-23",dispatch_date) > 365 then 0 when dispatch_date is null then 0 else quantity end as 'updated_quantity' from updated ) Select book_id,name from final group by book_id having sum(updated_quantity) <= 9
with o as ( select book_id, sum(quantity) as 'total' from Orders where dispatch_date > date_sub('2019-06-23', interval 1 year) group by 1), b as( select * from Books where available_from < date_sub('2019-06-23', interval 1 month)) select book_id, name from( select b.book_id, name, ifnull(total,0) as 'total' from b left join o on b.book_id = o.book_id) temp where total < 10
with old_books as ( select * from books where available_from < date_sub('2019-06-23', INTERVAL 1 Month) ), sold as( select a.book_id, a.name, ifnull((quantity),0) as quantity from old_books a left join orders b on a.book_id = b.book_id AND b.dispatch_date between date_sub('2019-06-23', INTERVAL 1 YEAR) AND '2019-06-23' ) select book_id, name from sold group by 1,2 having sum(quantity)<10
with old_books as ( select * from books where available_from < date_sub('2019-06-23', INTERVAL 1 Month) ), sold as( select a.book_id, a.name, ifnull((quantity),0) as quantity from old_books a left join orders b on a.book_id = b.book_id AND b.dispatch_date between date_sub('2019-06-23', INTERVAL 1 YEAR) AND '2019-06-23' OR b.dispatch_date is null ) select book_id, name from sold group by 1,2 having sum(quantity)<10
with qty as ( select book_id, sum(quantity) as quantity from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id ) select b.book_id, name from books b left join qty on b.book_id = qty.book_id where available_from < '2019-05-23' and ifnull(quantity, 0) < 10
with s as ( select book_id, sum(quantity) as copies from orders where datediff(cast('2019-06-23' as date),dispatch_date) <= 365 group by 1 ) select b.book_id,b.name from s right join books b on b.book_id = s.book_id where ( copies < 10 or copies is null) and datediff(cast('2019-06-23' as date),available_from) >= 31
with sold as ( select book_id, sum(quantity) as q from orders where dispatch_date >= '2018-06-23' group by book_id having sum(quantity) < 10 ), sold_10 as (select book_id, sum(quantity) as q from orders where dispatch_date >= '2018-06-23' group by book_id having sum(quantity) >= 10), b as ( select book_id, name, available_from from books where available_from <= '2019-05-23' ) select b.book_id as book_id, b.name as name from sold inner join b on sold.book_id = b.book_id union select b1.book_id as book_id, b1.name from b as b1 where b1.book_id not in (select distinct book_id from sold_10)
with t as ( select book_id,sum(quantity) as nc from orders where dispatch_date > '2018-06-23' group by 1 ) select b.book_id, b.name from books b left join t on b.book_id = t.book_id where ( nc is null or nc < 10 ) and datediff(cast('2019-06-23' as date),available_from) >= 31
with t as (select book_id, sum(quantity) as total from orders where dispatch_date > date_sub('2019-06-23', interval 1 year) group by book_id) select b.book_id, b.name from books b left join t using (book_id) where b.available_from < date_sub('2019-06-23', interval 1 month) and (t.total<10 or t.total is null)
with t1 as ( select book_id, sum(quantity) as sold from orders where dispatch_date >= '2018-06-23' group by book_id having sum(quantity) >= 10 ), t2 as ( select book_id, name from books where available_from < '2019-05-23' ) select book_id, name from t2 where book_id not in (select distinct book_id from t1) order by book_id
with t1 as (select book_id from orders where dispatch_date between date_sub('2019-06-23', interval 1 year) and '2019-06-23' group by 1 having sum(quantity) >= 10), t2 as (select book_id, name, available_from from books where book_id not in (select * from t1)) select book_id, name from t2 where available_from <= date_sub('2019-06-23', interval 1 month)
with temp as (select book_id, quantity, sum(quantity) as tt from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by 1), temp2 as (select book_id, name from books where available_from < '2019-05-23') select a.book_id, a.name from temp2 a left join temp b on a.book_id=b.book_id where ifnull(tt,0)<10
with temp as( select b.book_id, b.name, ifnull(o.quantity,0) as quantity, case when o.dispatch_date between "2018-06-23" and "2019-06-23" then 1 else 0 end as lastyear from books b left join Orders o on b.book_id=o.book_id where b.available_from < "2019-05-23" ), t1 as(select distinct book_id, name, sum(quantity*lastyear)as sold from temp group by book_id) select book_id, name from t1 where sold <10
with temp as(SELECT book_id FROM Orders WHERE dispatch_date BETWEEN '2018-06-23' AND '2019-06-23' GROUP BY book_id Having sum(quantity) >= 10) SELECT books.book_id, name FROM Books left join temp on books.book_id=temp.book_id WHERE available_from < '2019-05-23' and temp.book_id is null
with tmp as (select a.book_id, name, sum(ifnull(quantity, 0)) as total from books a left join orders b on a.book_id = b.book_id and date_add(dispatch_date, interval 1 year) >= date('2019-06-23') group by a.book_id, name) select book_id, name from tmp where total < 10 and book_id not in (select b.book_id from books b where date_add(available_from, interval 1 month) > date('2019-06-23'))
with valid_books as ( select book_id, name from books where abs(datediff(available_from, "2019-06-23")) > 30 ) ,valid_orders as( select * from orders where dispatch_date between DATE_ADD("2019-06-23", INTERVAL -1 YEAR) and "2019-06-23" ) select b.book_id, b.name from valid_books b left join valid_orders o on b.book_id = o.book_id group by b.book_id, b.name having sum(coalesce(o.quantity,0)) < 10
with x as ( select book_id from orders where dispatch_date between '2018-06-23' and '2019-06-23' group by book_id having sum(quantity) >= 10 ) select book_id,name from books where available_from < '2019-05-23' and book_id not in (select * from x)
with x as ( select book_id, sum(quantity) as quantity_sold from orders where dispatch_date between date_add('2019-06-23', interval -1 year) and '2019-06-23' group by book_id ) select b.book_id, b.name from x a right join books b using(book_id) where IFNULL(a.quantity_sold, 0) < 10 and b.available_from < date_add('2019-06-23', interval -1 month)
