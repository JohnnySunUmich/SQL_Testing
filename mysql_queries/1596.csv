SELECT A.customer_id, A.product_id, A.product_name FROM (SELECT customer_id, Orders.product_id, product_name, COUNT(*) product_counts FROM Orders INNER JOIN Products ON Orders.product_id = Products.product_id GROUP BY customer_id, Orders.product_id) A INNER JOIN (SELECT A.customer_id, MAX(A.product_counts) max_counts FROM (SELECT customer_id, product_id, COUNT(*) product_counts FROM Orders GROUP BY customer_id, product_id) A GROUP BY A.customer_id) B ON A.customer_id = B.customer_id WHERE product_counts = max_counts
SELECT A.customer_id, Products.product_id, Products.product_name FROM ( SELECT A.customer_id, A.product_id FROM ( SELECT customer_id, product_id, COUNT(*) as num FROM Orders GROUP BY customer_id, product_id ) AS A INNER JOIN ( SELECT customer_id, MAX(num) AS counts FROM ( SELECT customer_id, product_id, COUNT(*) as num FROM Orders GROUP BY customer_id, product_id ) AS B GROUP BY customer_id ) AS B ON A.customer_id = B.customer_id WHERE num = counts ) AS A INNER JOIN Products ON A.product_id = Products.product_id
SELECT C.CUSTOMER_ID, C.PRODUCT_ID, P.PRODUCT_NAME FROM ( SELECT O.CUSTOMER_ID, O.PRODUCT_ID, DENSE_RANK() OVER(PARTITION BY O.CUSTOMER_ID ORDER BY COUNT(O.PRODUCT_ID) DESC) AS CNT FROM ORDERS O GROUP BY O.CUSTOMER_ID, O.PRODUCT_ID ) C JOIN PRODUCTS P ON C.PRODUCT_ID = P.PRODUCT_ID WHERE CNT = 1
SELECT C.CUSTOMER_ID, C.PRODUCT_ID, P.PRODUCT_NAME FROM ( SELECT O.CUSTOMER_ID, O.PRODUCT_ID, DENSE_RANK() OVER(PARTITION BY O.CUSTOMER_ID ORDER BY COUNT(PRODUCT_ID) DESC) AS CNT FROM ORDERS O GROUP BY O.CUSTOMER_ID, PRODUCT_ID ) C JOIN PRODUCTS P ON C.PRODUCT_ID = P.PRODUCT_ID WHERE CNT = 1
SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME FROM ( SELECT C.CUSTOMER_ID AS CUSTOMER_ID , P.PRODUCT_ID AS PRODUCT_ID , P.PRODUCT_NAME AS PRODUCT_NAME, COUNT(ORDER_ID), DENSE_RANK() OVER(PARTITION BY C.CUSTOMER_ID ORDER BY C.CUSTOMER_ID, COUNT(ORDER_ID) DESC) AS RANKS FROM CUSTOMERS C JOIN ORDERS O USING(CUSTOMER_ID) JOIN PRODUCTS P USING(PRODUCT_ID) GROUP BY C.CUSTOMER_ID,P.PRODUCT_ID) AS X WHERE RANKS = 1
SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME FROM ( SELECT customer_id,o.product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY count(*) desc )as rnk FROM Products p JOIN Orders o on p.product_id = o.product_id GROUP BY 1,2 )rnked where rnk=1
SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME from( SELECT O.CUSTOMER_ID, O.PRODUCT_ID, P.PRODUCT_NAME, FREQ, RANK() OVER(PARTITION BY O.CUSTOMER_id ORDER BY O.CUSTOMER_id, FREQ DESC) AS RNK FROM ( SELECT O.CUSTOMER_ID, O.PRODUCT_ID, COUNT(*) AS FREQ FROM ORDERS O GROUP BY O.CUSTOMER_id, O.PRODUCT_ID ) AS O LEFT JOIN PRODUCTS P ON O.PRODUCT_ID = P.PRODUCT_ID ) AS RES WHERE RNK = 1
SELECT DISTINCT o.customer_id, o.product_id, p.product_name FROM ( SELECT customer_id, product_id, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS rnk FROM orders GROUP BY customer_id, product_id ) o JOIN products p ON o.product_id=p.product_id WHERE rnk=1
SELECT O.CUSTOMER_ID, P.PRODUCT_ID, P.PRODUCT_NAME FROM (SELECT CUSTOMER_ID, PRODUCT_ID, DENSE_RANK() OVER(PARTITION BY CUSTOMER_ID ORDER BY COUNT(PRODUCT_ID) DESC) ORDER_RANK FROM ORDERS GROUP BY CUSTOMER_ID, PRODUCT_ID) O JOIN PRODUCTS P ON P.PRODUCT_ID = O.PRODUCT_ID WHERE ORDER_RANK = 1
SELECT O.customer_id AS customer_id, O.product_id AS product_id, P.product_name AS product_name FROM Orders O JOIN Products P ON O.product_id=P.product_id GROUP BY 1, 2 HAVING (O.customer_id,COUNT(O.product_id)) IN (SELECT customer_id, MAX(counter) FROM (SELECT customer_id, product_id, count(product_id) AS counter FROM Orders GROUP BY 1,2)a GROUP BY customer_id)
SELECT R.customer_id, R.product_id, R.product_name FROM ( SELECT O.customer_id, P.product_id, P.product_name, RANK() OVER (PARTITION BY O.customer_id ORDER BY COUNT(*) DESC) AS ranks FROM Orders O INNER JOIN Products P ON O.product_id = P.product_id GROUP BY 1, 2 ) R WHERE R.ranks = 1
SELECT RNK.customer_id, RNK.product_id, p.product_name FROM (SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT( product_id) DESC ) as rk FROM Orders GROUP BY 1, 2 ORDER BY 1) RNK JOIN Products p ON RNK.product_id = p.product_id WHERE rk = 1 ORDER BY 1
SELECT RT.customer_id, RT.product_id, P.product_name FROM (SELECT customer_id, product_id, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY num_order DESC) AS RNK FROM (SELECT customer_id, product_id, COUNT(*) as num_order FROM Orders GROUP BY customer_id, product_id) AS T ) AS RT JOIN Products AS P ON RT.product_id = P.product_id WHERE RNK = 1
SELECT T.customer_id, P.product_id, P.product_name FROM Products P, (SELECT O.customer_id, O.product_id, RANK() OVER (PARTITION BY O.customer_id ORDER BY COUNT(O.product_id) DESC) AS Rnk FROM Orders O GROUP BY O.customer_id, O.product_id) AS T WHERE T.product_id = P.product_id AND T.Rnk = 1
SELECT T2.customer_id, T2.product_id, P.product_name FROM ( SELECT customer_id, product_id, RANK() OVER( partition by customer_id order by counts DESC) AS count_rank FROM( SELECT customer_id, product_id, count(*) as counts FROM Orders GROUP BY customer_id, product_id ) AS T ) AS T2 , Products P, Customers C WHERE count_rank = 1 AND T2.customer_id = C.customer_id AND T2.product_id = P.product_id ORDER BY T2.customer_id, T2.product_id
SELECT T3.customer_id, T3.product_id, p.product_name FROM (SELECT c.customer_id, o.product_id, count(o.product_id) as 'proCount' FROM Customers c INNER JOIN Orders o ON c.customer_id = o.customer_id GROUP BY c.customer_id, o.product_id ORDER BY COUNT(o.product_id) DESC) T3, Products p, (SELECT T1.customer_id, MAX(T1.proCount) as 'proMax' FROM (SELECT c.customer_id, o.product_id, count(o.product_id) as 'proCount' FROM Customers c INNER JOIN Orders o ON c.customer_id = o.customer_id GROUP BY c.customer_id, o.product_id ORDER BY COUNT(o.product_id) DESC) T1 GROUP BY T1.customer_id) T2 WHERE T2.customer_id = T3.customer_id AND T2.proMAX = T3.proCount AND p.product_id = T3.product_id
SELECT TT.customer_id,TT.product_id,P.product_name from (SELECT customer_id,product_id,rank() over(partition by customer_id order by count(product_id)desc )as rnk FROM Orders group by customer_id, product_id )TT left join Products as P on TT.product_id=P.product_id Where rnk=1
SELECT a.customer_id , a.product_id , p.product_name FROM (SELECT customer_id , product_id , Dense_Rank() Over (Partition by customer_id Order by count(order_id) DESC) as ranking FROM Orders GROUP BY 1, 2 ) a JOIN Products p ON p.product_id = a.product_id WHERE a.ranking = 1 Order by a.customer_id
SELECT a.customer_id, a.product_id, a.product_name FROM ( SELECT O.customer_id, O.product_id, P.product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk FROM Customers c JOIN Orders o ON c.customer_id = o.customer_id JOIN Products p ON o.product_id = p.product_id GROUP BY customer_id, product_id )a WHERE rnk = 1 ORDER BY 1, 2
SELECT a.customer_id, a.product_id, a.product_name FROM ( SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER (Partition by customer_id ORDER BY COUNT(o.product_id) DESC ) as rnk FROM Orders o JOIN Products p ON o.product_id=p.product_id GROUP BY customer_id, product_id) a WHERE rnk=1 ORDER BY customer_id, product_id
SELECT a.customer_id, a.product_id, a.product_name FROM(SELECT O.customer_id, P.product_id, P.product_name, RANK() OVER(PARTITION BY O.customer_id ORDER BY COUNT(P.product_id) DESC) AS rk FROM Orders AS O JOIN Products AS P ON O.product_id = P.product_id GROUP BY O.customer_id, P.product_name ) AS a WHERE a.rk = 1
SELECT a.customer_id, a.product_id, b.product_name FROM ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rnk FROM Orders GROUP BY customer_id, product_id ) a, Products b WHERE a.rnk = 1 AND a.product_id = b.product_id ORDER BY a.customer_id, a.product_id
SELECT a.customer_id, a.product_id, p.product_name FROM (SELECT customer_id, o.product_id, RANK()OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) as rnk FROM Orders o GROUP BY 1, 2) a JOIN Products p ON a.product_id=p.product_id WHERE a.rnk=1
SELECT a.customer_id, a.product_id, p.product_name FROM (SELECT customer_id, product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) RANKING FROM Orders GROUP BY 1,2) a, Products p WHERE a.product_id = p.product_id AND a.RANKING = 1
SELECT a.customer_id,a.product_id,p.product_name FROM (SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY count(product_id) DESC) AS product_rank FROM Orders GROUP BY customer_id,product_id ) a LEFT JOIN Products p ON a.product_id = p.product_id WHERE a.product_rank = 1
SELECT b.customer_id , b.product_id , c.product_name FROM ( SELECT a.customer_id , a.product_id , DENSE_RANK() OVER (PARTITION BY a.customer_id ORDER BY order_cnt DESC) AS prod_rank FROM ( SELECT a.customer_id , b.product_id , COUNT(*) AS order_cnt FROM Customers AS a LEFT JOIN Orders AS b ON a.customer_id = b.customer_id GROUP BY 1,2 ) AS a WHERE order_cnt >= 1 ) AS b JOIN Products AS c ON b.product_id = c.product_id WHERE b.prod_rank = 1
SELECT b.customer_id, c.product_id, d.product_name FROM Customers b LEFT JOIN ( SELECT customer_id, product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY num_orders DESC) as rank_num FROM ( SELECT customer_id, product_id, COUNT(order_id) as num_orders FROM Orders GROUP BY customer_id, product_id ORDER BY COUNT(order_id) DESC ) a ) c ON b.customer_id = c.customer_id LEFT JOIN Products d ON c.product_id = d.product_id WHERE rank_num =1
SELECT c.customer_id, a.product_id, p.product_name FROM customers c JOIN (SELECT o.customer_id, o.product_id, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.order_id) DESC ) AS ranking FROM orders o GROUP BY o.customer_id, o.product_id ) AS a ON c.customer_id=a.customer_id JOIN products p ON a.product_id=p.product_id WHERE a.ranking=1
SELECT c.customer_id, c.product_id, c.product_name FROM ( SELECT customer_id, MAX(ct) AS max_ct FROM ( SELECT customer_id, product_id, COUNT(order_id) AS ct FROM orders GROUP BY customer_id, product_id ) a GROUP BY customer_id ) m INNER JOIN ( SELECT customer_id, p.product_id, product_name, COUNT(order_id) AS ct FROM orders o INNER JOIN products p ON o.product_id = p.product_id GROUP BY customer_id, p.product_id, product_name ) c ON m.customer_id = c.customeR_id AND max_ct = ct
SELECT c.customer_id, c.product_id,d.product_name FROM (SELECT * FROM (SELECT customer_id, product_id, prdt_cnt, RANK() OVER(PARTITION BY customer_id ORDER BY prdt_cnt DESC) rnk FROM (SELECT customer_id, product_id, count(*) as prdt_cnt FROM orders group by customer_id, product_id order by customer_id) a ) b where b.rnk = 1) c LEFT JOIN products d ON c.product_id=d.product_id ORDER BY customer_id
SELECT c.customer_id,d.product_id,d.product_name FROM (SELECT a.customer_id,b.product_name,a.product_id,RANK() OVER (PARTITION BY a.customer_id ORDER BY COUNT(a.product_id) DESC) as rnk FROM Orders AS a INNER JOIN Products AS b ON a.product_id = b.product_id GROUP BY a.customer_id,b.product_name) d INNER JOIN Customers AS c ON d.customer_id = c.customer_id WHERE d.rnk=1
SELECT customer_id, Products.product_id as product_id, product_name FROM (select customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY order_count DESC ) r FROM (SELECT customer_id, product_id, count(DISTINCT order_id) AS order_count From Orders GROUP BY customer_id, product_id) order_counts) order_counts_ranked JOIN Products ON order_counts_ranked.product_id = Products.product_id WHERE r = 1
SELECT customer_id, Products.product_id, product_name from (SELECT customer_id, product_id, order_count, RANK() OVER (PARTITION BY customer_id ORDER BY order_count DESC) AS r FROM (SELECT customer_id, product_id, COUNT(DISTINCT(order_id)) AS order_count FROM Orders GROUP BY customer_id, product_id) AS customer_order_counts) AS customer_order_counts_rank JOIN Products ON customer_order_counts_rank.product_id = Products.product_id WHERE r = 1
SELECT customer_id, T.product_id, product_name FROM( SELECT customer_id, product_id, RANK() OVER( PARTITION BY customer_id ORDER BY COUNT(*) DESC ) AS RK FROM Orders o GROUP BY customer_id, product_id ) T LEFT JOIN Products p on p.product_id = t.product_id WHERE RK=1
SELECT customer_id, b.product_id, product_name FROM ( SELECT customer_id, product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY frequency DESC) AS rnk FROM ( SELECT customer_id, product_id, COUNT(product_id) AS frequency FROM Orders GROUP BY customer_id, product_id ) a ) b LEFT JOIN Products p ON b.product_id = p.product_id WHERE rnk = 1
SELECT customer_id, b.product_id, products.product_name FROM ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY cot DESC) rnk FROM (SELECT customer_id, product_id, COUNT(*) as cot FROM Orders GROUP BY customer_id, product_id) a) b inner join products ON b.product_id = products.product_id WHERE rnk = 1
SELECT customer_id, b.product_id,product_name FROM ( SELECT customer_id, product_id, rank() over (partition BY customer_id ORDER BY cnt desc) AS rnk FROM ( SELECT customer_id, product_id,COUNT(order_id) AS cnt FROM orders GROUP BY customer_id, product_id ORDER BY customer_id,product_id DESC )a )b INNER JOIN products p ON p.product_id = b.product_id WHERE rnk = 1
SELECT customer_id, inb.product_id, inc.product_name FROM ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY n_buy DESC) AS r_buy FROM ( SELECT customer_id, product_id, COUNT(*) AS n_buy FROM Orders GROUP BY customer_id, product_id ) AS ina ) AS inb, Products As inc WHERE inb.product_id=inc.product_id AND r_buy = 1
SELECT customer_id, product_id, product_name FROM ( SELECT A.customer_id, A.product_id, C.product_name, rank() OVER(partition by customer_id order by orders_ct DESC) as rank_N FROM (SELECT customer_id, product_id, count(order_id) as orders_ct FROM Orders GROUP BY customer_id,product_id) A LEFT JOIN Customers B ON A.customer_id=B.customer_id LEFT JOIN Products C ON A.product_id=C.product_id )Base WHERE rank_N=1
SELECT customer_id, product_id, product_name FROM ( SELECT O.customer_id, O.product_id, P.product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(O.order_id) DESC) AS rnk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id ) temp WHERE rnk = 1 ORDER BY customer_id, product_id
SELECT customer_id, product_id, product_name FROM ( SELECT O.customer_id, O.product_id, P.product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(O.product_id) DESC) AS rnk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id ) temp WHERE rnk = 1 ORDER BY customer_id, product_id
SELECT customer_id, product_id, product_name FROM ( SELECT O.customer_id,O.product_id,P.product_name, dense_rank()over(PARTITION BY customer_id ORDER BY count(O.product_id) DESC) AS num FROM Orders O JOIN Products P ON P.product_id=O.Product_id GROUP BY customer_id,product_id) tb1 where num =1
SELECT customer_id, product_id, product_name FROM ( SELECT c.customer_id AS customer_id, p.product_id AS product_id, p.product_name AS product_name, DENSE_RANK() OVER (PARTITION BY c.customer_id ORDER BY COUNT(o.product_ID) DESC) AS order_rank FROM Orders o JOIN Products p ON o.product_id = p.product_id JOIN Customers c ON o.customer_id = c.customer_id GROUP BY c.customer_id, p.product_id ) t WHERE order_rank = 1
SELECT customer_id, product_id, product_name FROM ( SELECT c.customer_id, p.product_id, p.product_name, (RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(o.product_id) DESC)) AS rnk FROM Customers c JOIN Orders o ON o.customer_id = c.customer_id JOIN Products p ON p.product_id = o.product_id GROUP BY c.customer_id, p.product_id ) AS ranked_products WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT c.customer_id, p.product_id, p.product_name, RANK() OVER(PARTITION BY c.customer_id ORDER BY COUNT(p.product_name) DESC) as highest_order FROM Customers c JOIN Orders o USING (customer_id) JOIN Products p USING (product_id) GROUP BY 1,2 ) as derived_table WHERE highest_order = 1
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, O.product_id, product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(O.product_id) DESC) AS rnk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id ) temp WHERE rnk = 1 ORDER BY customer_id, product_id
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, O.product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(O.product_id) DESC) AS rk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, O.product_id ) AS temp WHERE rk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, p.product_id, product_name, RANK() OVER (PARTITION BY customer_id ORDER BY count(order_id) DESC) AS rnk FROM orders o INNER JOIN products p ON o.product_id = p.product_id GROUP BY customer_id, p.product_id, product_name ) a WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, product_id , COUNT(1) AS cnt , MAX(COUNT(1)) OVER(PARTITION BY customer_id) AS maxcnt FROM Orders GROUP BY customer_id, product_id) temp INNER JOIN Products USING(product_id) WHERE cnt = maxcnt
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, product_id, product_name, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rnk FROM Customers LEFT JOIN Orders USING (customer_id) JOIN Products USING (product_id) GROUP BY customer_id, product_id ) t WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY freq DESC) rnk FROM ( SELECT o.customer_id, o.product_id, p.product_name, COUNT(*) freq FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP by 1, 2, 3 ) a ) b WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER (PARTITION BY o.customer_id ORDER BY count(*) desc) as ranking FROM orders o INNER JOIN products p ON o.product_id = p.product_id GROUP BY o.customer_id,o.product_id, p.product_name ) ASD WHERE ranking = 1
SELECT customer_id, product_id, product_name FROM ( SELECT o.customer_id, o.product_id, p.product_name, Rank()OVER(Partition By o.customer_id ORDER BY Count(o.product_id) DESC) AS rnk FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id) sub WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT o.customer_id, o.product_id, product_name, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk FROM Orders as o JOIN Products as p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id ) sub WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( SELECT o.customer_id, p.product_id, p.product_name, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) rnk FROM Orders o JOIN Products p USING(product_id) GROUP BY 1, 2, 3 )rslt WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM ( select customer_id, product_id, product_name, DENSE_RANK() OVER ( PARTITION BY customer_id ORDER BY cnt desc) as cnt_rnk from ( select customer_id, o.product_id, product_name, count(1) as cnt from Orders o JOIN Products p ON (o.product_id = p.product_id) group by 1,2,3 ) foo ) hoo where cnt_rnk = 1
SELECT customer_id, product_id, product_name FROM (SELECT *, RANK() OVER(PARTITION BY customer_id ORDER BY CNT DESC) RNK FROM (SELECT customer_id, P1.product_id, P1.product_name, COUNT(P1.product_id) CNT FROM Orders O1 JOIN Products P1 ON O1.product_id = P1.product_id GROUP BY customer_id, P1.product_id, P1.product_name) T1) T2 WHERE RNK = 1
SELECT customer_id, product_id, product_name FROM (SELECT C.customer_id, P.product_id , P.product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS 'RANK' FROM Customers C, Orders O, Products P WHERE C.customer_id = O.customer_id AND O.product_id = P.product_id GROUP BY C.customer_id, P.product_id) AS S WHERE S.RANK = 1
SELECT customer_id, product_id, product_name FROM (SELECT O.customer_id, O.product_id, P.product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(O.product_id) DESC) AS rnk FROM Orders O LEFT JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id) AS t WHERE rnk = 1
SELECT customer_id, product_id, product_name FROM (SELECT T1.customer_id, T1.product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY num_purchase DESC) as rank_ FROM (SELECT Orders.customer_id, Orders.product_id, product_name, COUNT(*) as num_purchase FROM Orders LEFT JOIN Products ON Orders.product_id = Products.product_id GROUP BY Orders.customer_id, Orders.product_id) T1) T2 WHERE rank_ = 1
SELECT customer_id, product_id, product_name FROM (SELECT customer_id, P1.product_id, P1.product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(P1.product_id) DESC) RNK FROM Orders O1 JOIN Products P1 ON O1.product_id = P1.product_id GROUP BY 1,2) T1 WHERE RNK = 1
SELECT customer_id, product_id, product_name FROM (SELECT customer_id, product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY CNT DESC) RNK FROM (SELECT customer_id, O1.product_id,product_name, COUNT(order_id) CNT FROM Orders O1 JOIN Products P1 ON O1.product_id = P1.product_id GROUP BY 1, 2) TEMP) TEMP2 WHERE RNK = 1
SELECT customer_id, product_id, product_name FROM (SELECT customer_id, product_id, product_name, order_num, RANK() OVER(PARTITION BY customer_id ORDER BY order_num DESC) AS ranking FROM (SELECT DISTINCT c.customer_id, p.product_id, product_name, COUNT(o.order_id) OVER(PARTITION BY c.customer_id, p.product_id) AS order_num FROM Customers c JOIN Orders o ON c.customer_id = o.customer_id JOIN Products p ON p.product_id = o.product_id) a) b WHERE ranking = 1
SELECT customer_id, product_id, product_name FROM (SELECT o.customer_id, o.product_id, p.product_name, COUNT(order_date) cnt, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(order_date) DESC) rk FROM Orders o LEFT JOIN Products p ON o.product_id = p.product_id GROUP BY 1, 2) tmp WHERE rk = 1
SELECT customer_id, product_id, product_name FROM (SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER (PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS rk FROM Orders o LEFT JOIN Products p ON o.product_id=p.product_id GROUP BY o.customer_id, p.product_id) temp WHERE rk=1
SELECT customer_id, product_id, product_name FROM (SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk FROM Orders o JOIN Products p ON p.product_id = o.product_id GROUP BY 1, 2) temp WHERE rnk = 1 ORDER BY 1, 2
SELECT customer_id, product_id, product_name FROM (select customer_id, product_id, product_name, rank() over(partition by customer_id order by count_order desc) AS rank_order from (SELECT o.customer_id, p.product_id, p.product_name, count(distinct o.order_date) as count_order FROM Orders o JOIN products p ON o.product_id = p.product_id group by o.customer_id, p.product_id, p.product_name) t1 )t2 where rank_order = 1
SELECT customer_id, product_id, product_name FROM (select o.customer_id, o.product_id, p.product_name, DENSE_RANK() OVER(partition by o.customer_id order by COUNT(o.product_id) DESC) as cnt FROM orders o join products p on o.product_id = p.product_id GROUP BY customer_id, product_id ) t where t.cnt = 1
SELECT customer_id, product_id, product_name FROM (select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id, p.product_name) tmp where rnk = 1
SELECT customer_id, product_id, product_name FROM( SELECT customer_id, product_id, COUNT(product_id), RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS 'f_rank' FROM Orders GROUP BY 1, 2 ) AS t1 LEFT JOIN Products AS p USING(product_id) WHERE t1.f_rank = 1
SELECT customer_id, product_id, product_name FROM( SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY customer_id, product_id) temp WHERE rnk=1
SELECT customer_id, product_id,product_name FROM ( SELECT customer_id, O.product_id, P.product_name, rank() over(partition by customer_id order by count(O.product_id) desc) as rnk From Orders O JOIN Products P ON P.product_id = O.product_id GROUP BY customer_id, product_id ) A WHERE rnk = 1
SELECT customer_id, products.product_id, product_name FROM orders JOIN products ON orders.product_id = products.product_id GROUP BY customer_id, product_id HAVING (customer_id, COUNT(order_date)) IN ( SELECT a.customer_id, MAX(a.times) AS max_time FROM ( SELECT customer_id, product_id, COUNT(order_date) AS times FROM orders GROUP BY customer_id, product_id) AS a GROUP BY a.customer_id)
SELECT customer_id, tmp1.product_id, product_name FROM( SELECT customer_id, product_id FROM( SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS num FROM Orders GROUP BY 1, 2 ) tmp WHERE num = 1 ) tmp1 LEFT JOIN Products p ON tmp1.product_id = p.product_id
SELECT customer_id,product_id, product_name FROM ( SELECT o.customer_id, o.product_id, p.product_name, Rank() OVER(partition BY customer_id ORDER BY Count(o.product_id) DESC) AS rnk FROM orders o JOIN products p ON o.product_id = p.product_id GROUP BY customer_id, product_id) t WHERE t.rnk = 1 ORDER BY customer_id, product_id
SELECT customer_id,product_id,product_name FROM ( SELECT customer_id, products.product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(order_id) desc) as rank_count from Orders JOIN Products on Products.product_id=Orders.product_id group by customer_id,product_id ) as a where rank_count=1
SELECT customer_id,product_id,product_name FROM ( SELECT customer_id,Orders.product_id,product_name,RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) AS rk FROM Orders JOIN Products ON Orders.product_id=Products.product_id GROUP BY 1,2 ) SUB WHERE rk=1
SELECT customer_id,product_id,product_name FROM ( SELECT customer_id,products.product_id,product_name ,RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) desc) as rank_count from Orders JOIN Products on Products.product_id=Orders.product_id group by customer_id,product_id ) as a where a.rank_count=1
SELECT customer_id,product_id,product_name FROM ( SELECT o.customer_id,o.product_id, p.product_name, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC ) AS product_count FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id,o.product_id ) temp1 WHERE product_count = 1 ORDER BY customer_id, product_id
SELECT customer_id,product_id,product_name FROM (SELECT c.customer_id,p.product_id,p.product_name, RANK() OVER (PARTITION BY c.customer_id ORDER BY COUNT(o.product_id) desc ) sales_rank FROM Customers c JOIN Orders o JOIN Products p ON c.customer_id = o.customer_id AND o.product_id = p.product_id GROUP BY c.customer_id,o.product_id) s WHERE sales_rank = 1
SELECT customer_id,product_id,product_name FROM (SELECT customer_id, P1.product_id, P1.product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(P1.product_id) DESC) RNK FROM Orders O1 JOIN Products P1 ON O1.product_id = P1.product_id GROUP BY customer_id, P1.product_id, P1.product_name) T1 WHERE RNK = 1
SELECT customer_id,product_id,product_name FROM (SELECT o.customer_id,p.product_id,p.product_name, RANK() OVER (PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) desc ) sales_rank FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id,o.product_id) s WHERE sales_rank = 1
SELECT customer_id,products.product_id,product_name from Orders JOIN Products on Products.product_id=Orders.product_id group by customer_id,product_id HAVING (customer_id,COUNT(order_date)) IN (SELECT customer_id, MAX(cnt) FROM (SELECT customer_id, product_id, COUNT(order_date) cnt FROM Orders GROUP BY customer_id, product_id) a GROUP BY customer_id)
SELECT customer_id,products.product_id,product_name from Orders JOIN Products on Products.product_id=Orders.product_id group by customer_id,product_id HAVING (customer_id,COUNT(order_date)) IN( SELECT customer_id,MAX(cnt)FROM ( SELECT customer_id,product_id,COUNT(order_date) as cnt from Orders group by customer_id,product_id ) as a group by customer_id)
SELECT mf.customer_id, mf.product_id, p.product_name FROM products p JOIN ( SELECT customer_id, product_id, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY cnt DESC) AS rnk FROM ( SELECT customer_id, product_id, COUNT(1) AS cnt FROM Orders GROUP BY 1,2 ) freq ) mf ON p.product_id = mf.product_id WHERE mf.rnk = 1
SELECT most_buy_1.customer_id , most_buy_1.product_id , p.product_name FROM ( SELECT o.customer_id ,o.product_id ,RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(*) DESC ) as most_buy FROM Orders o GROUP BY 1,2 ORDER BY 1 ) most_buy_1 JOIN Products p ON most_buy_1.product_id = p.product_id WHERE most_buy = 1
SELECT o.customer_id, o.product_id, p.product_name FROM Orders o JOIN Products p USING(product_id) GROUP BY customer_id, product_id HAVING (customer_id, COUNT(product_id)) IN (SELECT customer_id, MAX(cnt) FROM (SELECT customer_id, product_id, COUNT(order_date) AS cnt FROM Orders GROUP BY customer_id, product_id) AS temp GROUP BY 1)
SELECT o.customer_id, o.product_id, p.product_name FROM Orders o, Products p WHERE o.product_id = p.product_id GROUP BY o.customer_id, o.product_id HAVING (o.customer_id, COUNT(order_id)) IN (SELECT customer_id, MAX(cnt) FROM (SELECT customer_id, product_id, COUNT(order_id) AS cnt FROM Orders GROUP BY customer_id, product_id) AS a GROUP BY customer_id)
SELECT o.customer_id, o.product_id, p.product_name FROM( SELECT o.customer_id, o.product_id, DENSE_RANK()OVER(PARTITION BY o.customer_id ORDER BY COUNT(order_id) DESC ) AS orderrank FROM Orders as o GROUP BY o.customer_id, o.product_id ) o JOIN Products as p using (product_id) WHERE o.orderrank=1 ORDER BY customer_id
SELECT o.customer_id, o.product_id,p.product_name FROM ( SELECT *, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) AS ranking FROM Orders group by customer_id, product_id) AS o JOIN Products p ON o.product_id=p.product_id WHERE ranking =1 ORDER BY customer_id
SELECT o.customer_id, p.product_id, p.product_name FROM ORDERS o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id HAVING (o.customer_id, COUNT(o.product_id)) IN (SELECT t.customer_id, MAX(cnt) cnt FROM (SELECT o.*, COUNT(o.product_id) cnt FROM Orders o GROUP BY o.customer_id, o.product_id) t GROUP BY t.customer_id)
SELECT o2.customer_id , o2.product_id , p.product_name FROM ( SELECT o1.* , DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY num_order DESC) AS order_rk FROM( SELECT customer_id , product_id , COUNT(1) AS num_order FROM Orders GROUP BY 1, 2 ) o1 ) o2 LEFT OUTER JOIN Products p ON p.product_id = o2.product_id WHERE o2.order_rk = 1
SELECT r.customer_id, r.product_id, p.product_name FROM (SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY order_count DESC) as 'rank' FROM (SELECT customer_id, product_id, COUNT(DISTINCT order_id) AS 'order_count' FROM Orders GROUP BY customer_id, product_id) a) r LEFT JOIN Products p ON r.product_id = p.product_id WHERE r.rank = 1
SELECT r.customer_id, r.product_id, p.product_name FROM (SELECT o.customer_id, o.product_id, DENSE_RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS pr FROM Orders o GROUP BY o.customer_id, o.product_id) r JOIN Products p on r.product_id = p.product_id WHERE pr = 1
SELECT sub.customer_id as customer_id, sub.product_id as product_id, p.product_name as product_name FROM ( SELECT dense_rank() OVER (PARTITION BY c.customer_id ORDER BY COUNT(o.product_id) desc) as grp_rnk, c.Customer_id as customer_id, o.product_id as product_id FROM Customers c JOIN Orders o ON c.Customer_id = o.Customer_id GROUP BY c.Customer_id, o.product_id ) sub JOIN products p ON sub.product_id = p.product_id WHERE sub.grp_rnk = 1
SELECT sub.customer_id, sub.product_id, sub.product_name FROM (SELECT o.customer_id, o.product_id, DENSE_RANK() OVER (PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS most_freq_orders, p.product_name FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id, p.product_name) sub WHERE sub.most_freq_orders = 1
SELECT sub.customer_id, sub.product_id, sub.product_name FROM (SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER (PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) AS rank_count FROM Orders o INNER JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id) sub WHERE sub.rank_count = 1 ORDER BY sub.customer_id, sub.product_id
SELECT t.customer_id, t.product_id, p.product_name FROM (SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_ID) DESC) AS rank_p FROM Orders GROUP BY customer_id, product_id ORDER BY customer_id) AS t JOIN Products AS p ON t.product_id=p.product_id WHERE rank_p=1
SELECT t.customer_id, t.product_id, p.product_name FROM (SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rnk FROM Orders GROUP BY customer_id, product_id) t LEFT JOIN Products p USING (product_id) WHERE t.rnk = 1
SELECT t.customer_id,t.product_id, t.product_name FROM (SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER ( PARTITION BY o.customer_Id ORDER BY COUNT(o.product_id) DESC) rnk FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id) t WHERE t.rnk = 1
SELECT t1.customer_id, p.product_id, p.product_name FROM Products p JOIN ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY total DESC) AS r FROM ( SELECT customer_id, product_id, COUNT(*) AS total FROM Orders GROUP BY customer_id, product_id ) t ) t1 ON t1.product_id = p.product_id WHERE r = 1
SELECT t2.customer_id, t2.product_id, p.product_name FROM (SELECT DISTINCT customer_id, product_id, COUNT(DISTINCT order_id) AS n_order FROM Orders GROUP BY customer_id, product_id) t2 LEFT JOIN Products p ON t2.product_id = p.product_id WHERE (t2.customer_id, t2.n_order) in (SELECT DISTINCT customer_id, MAX(n_order) AS max_order FROM (SELECT DISTINCT customer_id, COUNT(DISTINCT order_id) AS n_order FROM Orders GROUP BY customer_id, product_id) t GROUP BY customer_id)
SELECT t2.customer_id, t2.product_id,p.product_name FROM (select customer_id, product_id, dense_rank() OVER(Partition By customer_id order by num desc) as rankie FROM (SELECT customer_id, product_id, COUNT(order_date) as num FROM Orders o group by customer_id, product_id) t1) t2 LEFT JOIN products p USING (product_id) WHERE rankie = 1
SELECT tmp.customer_id, tmp.product_id, p.product_name FROM (SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) rnk FROM Orders GROUP BY customer_id, product_id ORDER BY customer_id) tmp LEFT JOIN Products p ON p.product_id=tmp.product_id WHERE rnk=1
SELECT tmp2.customer_id, p.product_id, p.product_name FROM( SELECT tmp.*, MAX(tmp.count) OVER(PARTITION BY tmp.customer_id) max_count FROM( SELECT customer_id, product_id, COUNT(*) `count` FROM Orders GROUP BY customer_id, product_id ) tmp ) tmp2 INNER JOIN Products p ON tmp2.product_id = p.product_id WHERE tmp2.count = tmp2.max_count
SELECT tmp2.customer_id, tmp2.product_id, p.product_name FROM (SELECT customer_id,product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY frequency DESC) AS PurchaseRank FROM ( SELECT c.customer_id, o.product_id, COUNT(*) AS frequency FROM Customers AS c JOIN Orders AS o ON c.customer_id = o.customer_id GROUP BY c.customer_id, o.product_id) AS tmp1) AS tmp2 JOIN Products AS p ON p.product_id = tmp2.product_id WHERE tmp2.PurchaseRank = 1
Select B.customer_id, B.product_id, Products.product_name FROM (Select customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY count(*) DESC) AS ranking FROM Orders GROUP BY customer_id, product_id) B INNER JOIN Products ON B.product_id = Products.product_id AND B.ranking = 1
Select Customers.customer_id, Orders_1.product_id, Products.product_name From Customers, (Select customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY count(*) DESC) AS `rank` From Orders Group By customer_id, product_id) as Orders_1, Products Where Orders_1.`rank` = 1 And Customers.customer_id = Orders_1.customer_id And Orders_1.product_id = Products.product_id
Select T.customer_id,T.product_id,P.product_name from (Select customer_id, product_id from (Select customer_id,product_id,rank() over(partition by customer_id order by count(product_id) desc) as rn from Orders O group by customer_id,product_id) as table1 where rn = 1) as T join Products P on T.product_id =P.product_id
Select a.customer_id,a.product_id,p.product_name from ( Select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) desc )rk from orders group by 1,2 )a join customers c on a.customer_id=c.customer_id join products p on a.product_id=p.product_id where rk=1 order by 1,2
Select customer_id, b.product_id, p.product_name From ( Select customer_id, product_id, dense_rank() over(partition by customer_id order by num_products_sold desc) as rank_filter From ( Select customer_id, product_id, count(*) as num_products_sold From Orders o group by 1,2 )a )b join Products p on p.product_id = b.product_id where rank_filter = 1 order by customer_id
Select customer_id, product_id, product_name From (Select customer_id, o.product_id, p.product_name ,RANK() OVER(PARTITION BY customer_id ORDER BY Count(*) DESC) as Ranking From Orders as o Left Join Products as p On o.product_id=p.product_id Group by customer_id, o.product_id) as temp where Ranking=1
Select customer_id, product_id, product_name From Orders Inner Join Products Using (product_id) Group By customer_id, product_id Having (customer_id, Count(order_id)) In ( SELECT customer_id,MAX(cnt)FROM ( SELECT customer_id,product_id,COUNT(order_date) as cnt from Orders group by customer_id,product_id ) as a group by customer_id)
Select customer_id,a.product_id,product_name from (Select customer_id,product_id,RANK() OVER (partition by customer_id order by Counts desc) as Ranks FROM(select customer_id,product_id,count(*) as Counts from orders group by customer_id,product_id)b) a inner join products as p on a.product_id=p.product_id where ranks=1
Select customer_id,product_id,product_name from (select customer_id,product_id,product_name, rank() over(partition by customer_id order by count(*) desc) rnk from orders join products using(product_id) group by customer_id,product_id)A where A.rnk=1
Select f.customer_id, f.product_id, p.product_name FROM( SELECT *, rank() OVER (PARTITION BY o.customer_id order by count(o.product_id) desc) rk FROM Orders o Group by customer_id, product_id ) AS f LEFT JOIN Products p on f.product_id = p.product_id WHERE rk = 1
Select o.customer_id, o.product_id, p.product_name from ( select product_id, customer_id, rank() over (partition by customer_id order by count(product_id) desc) as times_rank from Orders group by customer_id, product_id) o inner join Products p on o.product_id=p.product_id where o.times_rank=1 order by o.customer_id
Select ranked.customer_id, ranked.product_id, Products.product_name FROM (Select totalOrders.customer_id, totalOrders.product_id, RANK() OVER(PARTITION BY customer_id ORDER BY countOrder DESC) Ranking FROM (SELECT customer_id, product_id, count(order_id) as countOrder FROM Orders Group BY customer_id, product_id) totalOrders ) ranked join Products on ranked.product_id = Products.product_id where ranked.Ranking = 1
Select t2.customer_id, t3.product_id, t3.product_name from (Select customer_id, max(sum_num) as max_num from (Select customer_id, Orders.product_id, product_name, count(order_date) as sum_num from Orders left join Products on Orders.product_id = Products.product_id Group by customer_id, Orders.product_id, product_name) as t1 group by customer_id ) as t2 left join (Select customer_id, Orders.product_id, product_name, count(order_date) as sum_num from Orders left join Products on Orders.product_id = Products.product_id Group by customer_id, Orders.product_id, product_name) as t3 on t2.customer_id = t3.customer_id and t2.max_num = t3.sum_num
WITH A AS ( SELECT customer_id, Orders.product_id, product_name FROM Orders JOIN Products ON Orders.product_id = Products.product_id), B AS ( SELECT customer_id, product_id, product_name, COUNT(*) AS ct FROM A GROUP BY customer_id, product_id, product_name), C AS ( SELECT *, RANK() OVER (PARTITION BY customer_id ORDER BY ct DESC) as rks FROM B ) SELECT customer_id, product_id, product_name FROM C WHERE rks = 1
WITH CET AS (SELECT *, RANK () OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS SERIES FROM Orders GROUP BY customer_id, product_id HAVING COUNT(*)>0) SELECT customer_id, A.product_id, product_name FROM CET A JOIN Products B ON A.product_id = B.product_id WHERE SERIES = 1
WITH CET AS (SELECT customer_id, product_id, COUNT(*) AS NUM FROM Orders GROUP BY customer_id, product_id HAVING COUNT(*)>0) SELECT customer_id, A.product_id, product_name FROM CET A JOIN Products B ON A.product_id = B.product_id WHERE (customer_id, NUM) IN (SELECT customer_id, MAX(NUM) FROM CET GROUP BY customer_id)
WITH CTE (customer_id, product_id, num_ordered) AS ( SELECT customer_id, product_id, COUNT(order_date) FROM Orders GROUP BY customer_id, product_id ) SELECT customer_id, a.product_id, product_name FROM CTE a JOIN Products p USING (product_id) WHERE (num_ordered) IN ( SELECT MAX(num_ordered) FROM cte b WHERE a.customer_id=b.customer_id )
WITH CTE AS ( SELECT * FROM customers WHERE customer_id IN ( SELECT customer_id FROM orders ) ), CTE1 AS ( SELECT *, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rk FROM orders GROUP BY customer_id, product_id ) SELECT a.customer_id, a.product_id, b.product_name FROM CTE1 a JOIN products b USING(product_id) WHERE rk=1
WITH CTE AS ( SELECT customer_id, product_id,Num_Orders, MAX(Num_Orders) over(Partition by customer_id) as MAX_ordered FROM (Select customer_id, product_id, count(order_id) as Num_Orders From Orders Group by customer_id, product_id) AS NumberofOrdersByCust_Product Group by customer_id, product_id ) Select CTE.customer_id ,CTE.product_id ,product_name FROM CTE LEFT JOIN Products p USING(product_id) WHERE Num_Orders = MAX_ordered
WITH CTE AS ( SELECT customer_id,product_id,count(product_id) AS p_freq FROM Orders GROUP BY customer_id,product_id ORDER BY customer_id ) SELECT A.customer_id, A.product_id,B.product_name FROM (SELECT customer_id,product_id,p_freq,max(p_freq) OVER(PARTITION BY customer_id) AS "fmax" FROM CTE) AS A LEFT JOIN Products B USING(product_id) WHERE A.p_freq=A.fmax
WITH CTE AS (SELECT CUSTOMER_ID, PRODUCT_ID, COUNT(ORDER_ID) AS PRODUCT_COUNT FROM ORDERS GROUP BY CUSTOMER_ID, PRODUCT_ID) SELECT c.customer_id, c.product_id, p.product_name from CTE c JOIN (SELECT CUSTOMER_ID, MAX(PRODUCT_COUNT) AS MAX_COUNT FROM CTE GROUP BY CUSTOMER_ID) t ON c.customer_id = t.customer_id AND c.product_count = t.max_count JOIN PRODUCTS p ON c.product_id = p.product_id
WITH CTE AS (SELECT O1.*, P1.product_name, price FROM Orders O1 JOIN Products P1 ON O1.product_id = P1.product_id) SELECT customer_id, product_id,product_name FROM (SELECT customer_id, product_id,product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) RNK FROM CTE GROUP BY 1,2) T1 WHERE RNK = 1
WITH CTE AS (SELECT customer_id, product_id, RANK() OVER(PARTITION BY Customer_id ORDER BY q DESC ) as rnk FROM (SELECT customer_id, product_id, count(order_id) as q FROM Orders GROUP BY 1,2)ct GROUP BY 1,2 ORDER BY 1, 3 ) SELECT customer_id, c.product_id, product_name FROM CTE C join Products p ON c.product_id = p.product_id WHERE rnk =1
WITH CTE AS( Select * ,MAX(product_cnt) over(PARTITION BY Customer_id) as max_cnt FROM ( Select Customer_id,product_id,count(order_id) over(PARTITION BY Customer_id, product_id)as product_cnt from orders )T order by customer_id, product_id ) Select Distinct customer_id,cte.product_id, product_name from CTE LEFT JOIN Products on CTE.product_id = Products.product_id where cte.max_cnt = cte.product_cnt
WITH CTE AS(SELECT O.customer_id,P.product_id,P.product_name,COUNT(*) AS num_bought FROM Orders AS O JOIN Products AS P ON O.product_id = P.product_id GROUP BY O.customer_id,P.product_id), CTE_2 AS(SELECT customer_id,product_id,product_name,RANK()OVER(PARTITION BY customer_id ORDER BY num_bought DESC) AS ranked_products FROM CTE) SELECT customer_id,product_id,product_name FROM CTE_2 WHERE ranked_products = 1
WITH CTE AS(SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY ct DESC) AS RNK FROM( SELECT customer_id, product_id, COUNT(order_id) ct FROM Orders GROUP BY 1,2)cc ORDER BY 1, 3 ) SELECT customer_id, c.product_id, product_name FROM CTE C JOIN Products p ON c.product_id=p.product_id WHERE rnk=1
WITH CTE1 AS ( SELECT *, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rk FROM orders GROUP BY customer_id, product_id ) SELECT a.customer_id, a.product_id, b.product_name FROM CTE1 a JOIN products b USING(product_id) WHERE rk=1
WITH CTE1 AS ( SELECT customer_id, product_id, COUNT(product_id) AS cts FROM Orders o GROUP BY 1, 2) SELECT c.customer_id, c.product_id, p.product_name FROM CTE1 c JOIN Products p ON c.product_id = p.product_id WHERE (c.customer_id, c.cts) IN (SELECT customer_id, MAX(cts) FROM CTE1 GROUP BY customer_id)
WITH CTE1 AS (SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id, product_id ORDER BY order_date) cnt FROM orders), CTE2 AS (SELECT customer_id, product_id, MAX(cnt) as max_cnt FROM CTE1 GROUP BY customer_id, product_id), CTE3 AS (SELECT customer_id,product_id, max_cnt, RANK() OVER(PARTITION BY customer_id ORDER BY max_cnt desc) cnt_final FROM CTE2) SELECT customer_id, c.product_id, product_name FROM CTE3 c LEFT JOIN products p ON c.product_id=p.product_id WHERE cnt_final=1
WITH Employee_CTE (cnt ,cid,pid) AS (select count(order_id), customer_id, product_id from orders group by customer_id, product_id) select customer_id,product_id,product_name from employee_cte e join (select max(cnt) as max_count, cid from Employee_CTE group by cid) temp1 on temp1.max_count = cnt and e.cid = temp1.cid join products p on p.product_id = e.pid join customers c on c.customer_id = e.cid
WITH Freq AS( SELECT order_id, customer_id, o.product_id, product_name, COUNT(order_id) AS order_freq FROM Orders o LEFT JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id), MaxFreq AS ( SELECT customer_id, product_id, product_name, order_freq, MAX(order_freq) OVER(PARTITION BY customer_id) AS max_freq FROM Freq ) SELECT customer_id, product_id, product_name FROM MaxFreq WHERE order_freq = max_freq
WITH LOOKUP AS (SELECT o.customer_id, p.product_id, p.product_name, RANK()OVER(PARTITION BY o.customer_id ORDER BY COUNT(p.product_id) DESC) AS RNK FROM Orders o JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, p.product_id, p.product_name) SELECT customer_id, product_id, product_name FROM LOOKUP WHERE RNK = 1
WITH O as ( SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY count(product_id) DESC) AS 'rank' FROM Orders GROUP BY customer_id, product_id ) SELECT C.customer_id, P.product_id, P.product_name FROM Customers C JOIN O ON C.customer_id = O.customer_id JOIN Products P ON O.product_id = P.product_id WHERE O.rank = 1
WITH OrderFreq AS (SELECT customer_id ,product_id ,RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) AS Rk FROM Orders GROUP BY customer_id,product_id) SELECT OdF.customer_id ,OdF.product_id ,P.product_name FROM OrderFreq OdF INNER JOIN Products P ON P.product_id = OdF.product_id WHERE Rk = 1 ORDER BY 1 ASC
WITH T AS ( SELECT O.customer_id, O.product_id, COUNT(*) AS cnt FROM Orders O INNER JOIN Customers C USING(customer_id) GROUP BY O.customer_id, O.product_id ) SELECT T.customer_id, T.product_id, P.product_name FROM T INNER JOIN Products P USING(product_id) WHERE (T.customer_id, T.cnt) IN (SELECT T1.customer_id, MAX(T1.cnt) FROM T AS T1 GROUP BY T1.customer_id)
WITH T AS ( SELECT customer_id, product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS ranking FROM Orders JOIN Products USING(product_id) GROUP BY customer_id, product_id ) SELECT customer_id, product_id, product_name FROM T WHERE ranking=1
WITH T1 AS ( SELECT customer_id, product_id, COUNT(*) AS frequent, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS ranks FROM Orders GROUP BY 1, 2 ORDER BY 1), T2 AS ( SELECT customer_id, product_id FROM T1 WHERE ranks = 1) SELECT T2.*, p.product_name FROM T2 JOIN Products p ON T2.product_id = p.product_id
WITH TEMP AS ( SELECT customer_id, A.product_id, product_name, COUNT(*) AS order_count FROM Orders A LEFT JOIN Products B ON A.product_id = B.product_id GROUP BY customer_id, product_id, product_name ) SELECT customer_id, product_id, product_name FROM ( SELECT customer_id, product_id, product_name, RANK() OVER (PARTITION BY customer_id ORDER BY order_count DESC) order_rank FROM TEMP ) A WHERE order_rank = 1
WITH TEMP AS ( SELECT customer_id, product_id, COUNT(order_id) AS freq, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(order_id) DESC) AS 'rank' FROM Orders GROUP BY 1,2 ORDER BY 1,3 DESC ) SELECT TEMP.customer_id, TEMP.product_id, p.product_name FROM TEMP LEFT JOIN Products p ON TEMP.product_id=p.product_id WHERE TEMP.rank=1 ORDER BY 1,2
WITH TEMP AS (SELECT C.CUSTOMER_ID AS CUSTOMER_ID, P.PRODUCT_ID AS PRODUCT_ID, P.PRODUCT_NAME AS PRODUCT_NAME, COUNT(*) AS CNT FROM CUSTOMERS C, ORDERS O, PRODUCTS P WHERE C.CUSTOMER_ID = O.CUSTOMER_ID AND O.PRODUCT_ID = P.PRODUCT_ID GROUP BY C.CUSTOMER_ID, P.PRODUCT_ID, P.PRODUCT_NAME), TEMP2 AS (SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME, RANK() OVER (PARTITION BY CUSTOMER_ID ORDER BY CNT DESC) AS RNK FROM TEMP) SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME FROM TEMP2 WHERE RNK = 1
WITH TEMP AS (SELECT C.CUSTOMER_ID, P.PRODUCT_ID, P.PRODUCT_NAME, COUNT(*) AS CNT FROM CUSTOMERS C, ORDERS O, PRODUCTS P WHERE C.CUSTOMER_ID = O.CUSTOMER_ID AND O.PRODUCT_ID = P.PRODUCT_ID GROUP BY C.CUSTOMER_ID, P.PRODUCT_ID, P.PRODUCT_NAME), TEMP2 AS (SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME, RANK() OVER (PARTITION BY CUSTOMER_ID ORDER BY CNT DESC) AS RNK FROM TEMP) SELECT CUSTOMER_ID, PRODUCT_ID, PRODUCT_NAME FROM TEMP2 WHERE RNK = 1
WITH agg_orders as ( SELECT DISTINCT customer_id, product_id, COUNT(order_id) OVER (PARTITION BY customer_id, product_id) as total_orders FROM Orders ) SELECT customer_id, t1.product_id, product_name FROM (SELECT * FROM agg_orders WHERE (customer_id, total_orders) IN (SELECT customer_id, MAX(total_orders) FROM (SELECT * FROM agg_orders) t1 GROUP BY customer_id )) t1 LEFT JOIN Products ON t1.product_id = Products.product_id
WITH base as ( SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) rnk FROM Orders GROUP BY customer_id, product_id ) SELECT b.customer_id, p.product_id, p.product_name FROM base b JOIN Products p ON b.product_id = p.product_id AND rnk = 1
WITH c_cnt as( select customer_id, product_id, count(*)cnt from Orders group by customer_id, product_id ), c_max as( select customer_id, max(cnt) cnt from c_cnt group by 1 ) select c.customer_id, c.product_id, p.product_name from c_cnt c inner join c_max m using( customer_id, cnt) inner join products p using(product_id) order by 1
WITH cst_prod_ct AS ( SELECT customer_id, product_id, COUNT(order_id) AS num_orders FROM Orders o GROUP BY customer_id, product_id) SELECT t.customer_id, p.product_id, p.product_name FROM ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY num_orders DESC) AS rk FROM cst_prod_ct) t JOIN Products p ON t.product_id = p.product_id WHERE rk=1
WITH cte AS ( SELECT *,RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) DESC) rnk FROM Orders AS o GROUP BY o.customer_id, o.product_id ) SELECT cte.customer_id, cte.product_id, p.product_name FROM Customers AS c JOIN cte JOIN Products AS p ON cte.customer_id = c.customer_id AND cte.product_id = p.product_id WHERE cte.rnk = 1 GROUP BY cte.customer_id, cte.product_id
WITH cte AS ( SELECT customer_id, product_id, COUNT(product_id) as cnt FROM Orders GROUP BY 1,2 ) SELECT a.customer_id, a.product_id, p.product_name FROM cte a JOIN Products p USING (product_id) WHERE cnt IN ( SELECT MAX(cnt) FROM cte b WHERE a.customer_id=b.customer_id )
WITH cte AS ( SELECT o.customer_id, o.product_id, p.product_name, COUNT(*) AS count, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS rnk FROM Orders o LEFT JOIN Customers c ON o.customer_id = c.customer_id LEFT JOIN Products p ON o.product_id = p.product_id GROUP BY 1, 2) SELECT customer_id, product_id, product_name FROM cte WHERE rnk = 1
WITH cte AS (SELECT c.customer_id ,o.product_id ,p.product_name ,COUNT(*) AS order_count FROM Customers c JOIN Orders o ON c.customer_id = o.customer_id JOIN Products p ON o.product_id = p.product_id GROUP BY 1,2) SELECT customer_id ,product_id ,product_name FROM cte WHERE (customer_id,order_count) IN (SELECT customer_id,MAX(order_count) FROM cte GROUP BY 1)
WITH cte AS (SELECT customer_id, product_id, COUNT(product_id) as cnt FROM Orders GROUP BY customer_id, product_id) SELECT t1.customer_id, t1.product_id, t2.product_name FROM cte AS t1 INNER JOIN Products AS t2 USING (product_id) WHERE t1.cnt IN (SELECT MAX(cnt) FROM cte AS t3 WHERE t1.customer_id=t3.customer_id )
WITH cte AS (SELECT customer_id, product_id, COUNT(product_id) as cnt FROM Orders GROUP BY customer_id, product_id) SELECT t1.customer_id, t1.product_id, t2.product_name FROM cte AS t1 JOIN Products AS t2 USING (product_id) WHERE t1.cnt IN (SELECT MAX(cnt) FROM cte AS t3 WHERE t1.customer_id=t3.customer_id )
WITH cte AS (SELECT customer_id, product_id, RANK() OVER (partition by customer_id ORDER BY cnt DESC) AS rnk FROM (SELECT customer_id, product_id,count(*) AS cnt FROM orders group by customer_id, product_id) a) SELECT customer_id, product_id, product_name FROM cte c JOIN Products p USING (product_id) WHERE RNK= 1
WITH cte AS (SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS rnk FROM Orders GROUP BY customer_id, product_id) SELECT customer_id, product_id, product_name FROM cte JOIN Products p USING(product_id) WHERE cte.rnk = 1
WITH cte AS( SELECT customer_id, product_id, COUNT(product_id) AS frequency FROM Orders GROUP BY 1, 2) SELECT order_frequency.customer_id, order_frequency.product_id, p.product_name FROM cte AS order_frequency JOIN Products p ON p.product_id = order_frequency.product_id WHERE (order_frequency.customer_id, order_frequency.frequency) IN ( SELECT c.customer_id, MAX(c.frequency) FROM cte c GROUP BY 1)
WITH cte AS( SELECT customer_id, product_id, COUNT(product_id) OVER (PARTITION BY customer_id, product_id) AS ct FROM Orders ), cte1 AS( SELECT cte.*, RANK() OVER (PARTITION BY customer_id ORDER BY ct DESC) AS rk FROM cte GROUP BY customer_id, product_id ) SELECT cte1.customer_id, cte1.product_id, p.product_name FROM cte1 LEFT JOIN Products p USING(product_id) WHERE rk = 1
WITH cte AS( SELECT customer_id, product_id, product_name, COUNT(*) OVER (PARTITION BY customer_id, product_id) AS count FROM Orders AS O JOIN Products USING(product_id)) SELECT DISTINCT customer_id, product_id, product_name FROM( SELECT *, MAX(count) OVER (PARTITION BY customer_id) AS max_count FROM cte) AS T WHERE count = max_count
WITH cte as ( SELECT customer_id, product_id, COUNT(order_id) as ordcnt FROM Orders GROUP BY customer_id, product_id ) SELECT o.customer_id, o.product_id, p.product_name FROM cte as o JOIN Products as p ON o.product_id=p.product_id WHERE o.ordcnt = ( SELECT max(ordcnt) FROM cte as c WHERE c.customer_id=o.customer_id GROUP BY c.customer_id )
WITH cte as (SELECT c.customer_id, p.product_id, p.product_name, count(*) as num_bought FROM customers c JOIN orders o USING(customer_id) JOIN products p ON o.product_id = p.product_id GROUP BY 1,2,3), cte_2 as ( SELECT customer_id, product_id, product_name, RANK() OVER (PARTITION BY customer_id ORDER BY num_bought DESC) as ranked_products FROM cte ) SELECT customer_id, product_id, product_name FROM CTE_2 WHERE ranked_products=1
WITH cte as (SELECT o.customer_id, p.product_id, p.product_name, count(*) as num_bought FROM orders o JOIN products p ON o.product_id = p.product_id GROUP BY 1,2,3), cte_2 as ( SELECT customer_id, product_id, product_name, RANK() OVER (PARTITION BY customer_id ORDER BY num_bought DESC) as ranked_products FROM cte ) SELECT customer_id, product_id, product_name FROM CTE_2 WHERE ranked_products=1
WITH cte1 AS (SELECT c.customer_id customer_id, p.product_id product_id , COUNT(*) AS counts FROM customers c JOIN orders o ON c.customer_id = o.customer_id JOIN products p ON o.product_id = p.product_id GROUP BY c.customer_id, p.product_id), cte2 AS (SELECT customer_id, MAX(counts) AS max_counts FROM cte1 GROUP BY customer_id) SELECT cte1.customer_id, cte1.product_id, p.product_name FROM cte1 JOIN cte2 ON cte1.customer_id = cte2.customer_id AND cte1.counts = cte2.max_counts JOIN products p ON p.product_id = cte1.product_id
WITH cte1 AS (SELECT customer_id, product_id, COUNT(*) AS cnt FROM Orders GROUP BY customer_id, product_id), cte2 AS (SELECT customer_id, MAX(cnt) AS mcnt FROM cte1 GROUP BY customer_id), cte3 AS (SELECT c1.customer_id, c1.product_id FROM cte1 AS c1 JOIN cte2 AS c2 ON c1.customer_id=c2.customer_id AND c1.cnt = c2.mcnt) SELECT c3.customer_id, c3.product_id, p.product_name FROM cte3 AS c3 JOIN Products AS p ON c3.product_id = p.product_id
WITH cte_table AS ( SELECT customer_id, product_id, num_orders, RANK() OVER (PARTITION BY customer_id ORDER BY num_orders DESC) AS row_num FROM (SELECT customer_id, product_id, COUNT(*) AS num_orders FROM Orders GROUP BY 1, 2) sub ) SELECT c.customer_id, c.product_id, product_name FROM cte_table c LEFT JOIN Products p ON p.product_id = c.product_id WHERE row_num = 1
WITH cts AS ( SELECT customer_id, product_id, RANK() OVER (partition by customer_id ORDER BY COUNT(order_id) DESC) AS highestproduct FROM Orders GROUP BY customer_id, product_id ) SELECT Customers.customer_id, cts.product_id, Products.product_name FROM Customers LEFT OUTER JOIN cts ON Customers.customer_id = cts.customer_id AND cts.highestProduct = 1 INNER JOIN Products ON cts.product_id = Products.product_id
WITH cust_orderqty AS ( SELECT customer_id, product_id, COUNT(order_id) as qty, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(order_id) desc) as qty_rank FROM orders GROUP BY 1,2 ) SELECT x.customer_id, x.product_id, p.product_name FROM ( SELECT c.customer_id, c.product_id FROM cust_orderqty c WHERE qty_rank = 1 ) as x JOIN products p on x.product_id = p.product_id
WITH cust_orderqty AS ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(order_id) desc) as qty_rank FROM orders GROUP BY 1,2 ) SELECT x.customer_id, x.product_id, p.product_name FROM ( SELECT c.customer_id, c.product_id FROM cust_orderqty c WHERE qty_rank = 1 ) as x JOIN products p on x.product_id = p.product_id
WITH customer_product_count AS ( SELECT DISTINCT customer_id, product_id, COUNT(product_id) OVER(PARTITION BY customer_id, product_id) as prod_count FROM Orders ), prod_rank AS (SELECT customer_id, product_id, prod_count, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY prod_count DESC) as tot_rank FROM customer_product_count) SELECT sub.customer_id, sub.product_id, t.product_name FROM prod_rank sub LEFT JOIN Products t ON t.product_id = sub.product_id WHERE sub.tot_rank =1
WITH customer_product_tbl AS ( SELECT customer_id, product_id, count(product_id) prod_cnt FROm Orders GROUP BY customer_id, product_id ), customer_max_product_tbl AS ( SELECT customer_id, max(prod_cnt) max_cnt FROM customer_product_tbl GROUP BY customer_id ) SELECT A.customer_id, A.product_id, B.product_name FROm customer_product_tbl A JOIN Products B ON A.product_id = B.product_id JOIN customer_max_product_tbl C ON A.customer_id = C.customer_id AND A.prod_cnt = C.max_cnt
WITH frequency AS ( SELECT customer_id, product_id, COUNT(order_id) AS freq FROM Orders GROUP BY 1, 2 ) SELECT a.customer_id, p.product_id, p.product_name FROM Products p JOIN ( SELECT customer_id, product_id, RANK() OVER(PARTITION BY customer_id ORDER BY freq DESC) AS rk FROM frequency) a ON p.product_id = a.product_id WHERE rk = 1
WITH frequency AS (SELECT customer_id, product_id, COUNT(*) AS freq FROM Orders GROUP BY customer_id, product_id), max_frequency AS (SELECT customer_id, MAX(freq) AS max_freq FROM frequency GROUP BY customer_id), res AS (SELECT fq.customer_id, fq.product_id FROM frequency AS fq JOIN max_frequency AS mxfq ON fq.customer_id = mxfq.customer_id AND fq.freq = mxfq.max_freq) SELECT rs.customer_id, rs.product_id, pr.product_name FROM res AS rs JOIN Products AS pr ON rs.product_id = pr.product_id
WITH grouped AS ( SELECT customer_id, product_id, COUNT(*) AS num_orders FROM orders GROUP BY customer_id, product_id HAVING COUNT(*) >=1 ), grouped_ranked AS ( SELECT *, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY num_orders DESC) AS product_rank FROM grouped ), most_common_product AS ( SELECT customer_id, product_id FROM grouped_ranked WHERE product_rank = 1 ) SELECT mcp.customer_id, mcp.product_id, product_name FROM most_common_product AS mcp LEFT JOIN products ON mcp.product_id = products.product_id
WITH main AS ( SELECT customer_id, product_id, product_name, COUNT(*) AS total FROM Customers INNER JOIN Orders USING(customer_id) INNER JOIN Products USING(product_id) GROUP BY customer_id, product_id ), second AS ( SELECT customer_id, product_id, product_name, RANK() OVER(PARTITION BY customer_id ORDER BY total DESC) AS ranking FROM main ) SELECT customer_id, product_id, product_name FROM second WHERE ranking = 1
WITH most_ordered AS ( SELECT a.customer_id, a.product_id, a.order_cnt, DENSE_RANK() OVER(PARTITION BY a.customer_id ORDER BY a.order_cnt DESC) order_cnt_rank FROM ( SELECT o.customer_id, o.product_id, COUNT(1) order_cnt FROM Customers c INNER JOIN Orders o ON c.customer_id = o.customer_id INNER JOIN Products p ON p.product_id = o.product_id GROUP BY o.customer_id, o.product_id ) a ) SELECT c.customer_id, p.product_id, p.product_name FROM most_ordered mo INNER JOIN Customers c ON mo.customer_id = c.customer_id INNER JOIN Products p ON mo.product_id = p.product_id WHERE mo.order_cnt_rank = 1
WITH num_order AS ( SELECT Orders.customer_id, Orders.product_id, Products.product_name, COUNT(*) AS freq FROM Orders INNER JOIN Products ON Orders.product_id = Products.product_id GROUP BY customer_id, Orders.product_id ), max_order AS ( SELECT customer_id, product_id, product_name, freq, MAX(freq) OVER(PARTITION BY customer_id) AS max_freq FROM num_order ) SELECT customer_id, product_id, product_name FROM max_order WHERE max_freq = freq
WITH num_orders AS ( SELECT customer_id, product_id, COUNT(*) as num_orders FROM orders GROUP BY 1, 2 ) SELECT t.customer_id, t.product_id, product_name FROM ( SELECT customer_id, n.product_id, product_name, num_orders FROM num_orders n LEFT JOIN products p ON n.product_id = p.product_id ) t LEFT JOIN ( SELECT customer_id, MAX(num_orders) AS max_num_orders FROM num_orders GROUP BY 1 ) m ON t.customer_id = m.customer_id WHERE num_orders = max_num_orders
WITH o as ( SELECT Orders.product_id, Products.product_name, Orders.customer_id, count(1) cnt FROM Orders JOIN Products ON Products.product_id = Orders.product_id GROUP BY 1,2,3 ), rnk AS ( SELECT *, DENSE_RANK() OVER ( PARTITION BY customer_id ORDER BY cnt DESC ) AS rnk FROM o ) SELECT customer_id, product_id, product_name FROM rnk WHERE rnk = 1
WITH o_agg as ( SELECT o.customer_id cid, o.product_id pid , COUNT(order_id) as cnt FROM Orders o GROUP BY o.customer_id, o.product_id ), o_p_agg as ( SELECT cid, pid, cnt, p.product_name as name FROM o_agg o JOIN Products p ON o.pid = p.product_id ), ranked as ( SELECT cid, pid, name, RANK() OVER (PARTITION BY cid ORDER BY cnt DESC) as rnk FROM o_p_agg ) SELECT cid customer_id, pid product_id, name product_name FROM ranked where rnk = 1
WITH order_cnt AS ( SELECT customer_id, product_id, COUNT(*) AS cnt FROM Orders GROUP BY customer_id, product_id ), max_order_cnt AS ( SELECT customer_id, MAX(cnt) AS max_cnt FROM order_cnt GROUP BY customer_id ) SELECT order_cnt.customer_id, order_cnt.product_id, p.product_name FROM order_cnt JOIN max_order_cnt ON max_order_cnt.customer_id = order_cnt.customer_id AND max_order_cnt.max_cnt = order_cnt.cnt JOIN Products p ON p.product_id = order_cnt.product_id
WITH order_cnt as ( select customer_id, product_id, RANK() OVER( PARTITION BY customer_id ORDER BY count(*) desc) as rnk from orders group by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from order_cnt c, products p where c.product_id=p.product_id and c.rnk=1
WITH order_cnt as ( select customer_id, product_id, RANK() OVER( PARTITION BY customer_id ORDER BY count(product_id) desc) as rnk from orders group by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from order_cnt c, products p where c.product_id=p.product_id and c.rnk=1
WITH order_count AS ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) as order_rank FROM Orders GROUP BY customer_id, product_id ) SELECT a.customer_id, a.product_id, b.product_name FROM order_count a LEFT JOIN Products b ON a.product_id = b.product_id WHERE order_rank = 1
WITH order_count AS( SELECT O.customer_id, p.product_id, p.product_name, COUNT(O.product_id) AS order_count FROM Orders O INNER JOIN Products P ON O.product_id = P.product_id GROUP BY O.customer_id, p.product_id, p.product_name ) SELECT OC.customer_id, OC.product_id, OC.product_name FROM order_count OC WHERE OC.order_count = ( SELECT MAX(order_count) FROM order_count X WHERE X.customer_id = OC.customer_id )
WITH orders_cte AS ( SELECT customer_id, product_id, COUNT(product_id) as cnt FROM Orders GROUP BY customer_id, product_id ) SELECT o1.customer_id, o1.product_id, p.product_name FROM orders_cte o1, products p WHERE o1.product_id = p.product_id And o1.cnt IN ( SELECT MAX(cnt) FROM orders_cte o2 WHERE o1.customer_id=o2.customer_id )
WITH product_ranks AS ( SELECT customer_id, product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS ranking FROM Orders GROUP BY customer_id, product_id ) SELECT pr.customer_id, pr.product_id, p.product_name FROM product_ranks pr INNER JOIN Products p ON pr.product_id = p.product_id WHERE pr.ranking = 1
WITH r AS ( SELECT customer_id, product_id, rank() OVER (PARTITION BY customer_id ORDER BY count(product_id) DESC) as rnk FROM Orders GROUP BY customer_id, product_id ) SELECT r.customer_id, r.product_id, p.product_name FROM r JOIN Products p ON r.product_id = p.product_id WHERE r.rnk = 1
WITH r AS( SELECT customer_id, product_id, COUNT(*)AS product_num FROM Orders GROUP BY 1,2 ) SELECT a.customer_id, a.product_id, p.product_name FROM ( SELECT *, RANK()OVER (PARTITION BY customer_id ORDER BY product_num DESC) AS rnk FROM r )a JOIN Products p ON a.product_id = p.product_id WHERE a.rnk =1 ORDER BY 1
WITH ranking AS ( SELECT *, RANK() OVER (PARTITION BY customer_id ORDER BY order_num DESC) AS order_rank FROM (SELECT customer_id, product_id, COUNT(*) AS order_num FROM Orders GROUP BY customer_id, product_id) AS order_count ) SELECT R.customer_id, R.product_id, P.product_name FROM ranking AS R JOIN Products AS P ON R.product_id = P.product_id WHERE order_rank = 1
WITH result AS ( SELECT T1.customer_id, T1.product_id, T1.cnt, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY cnt DESC) AS R FROM ( SELECT customer_id, product_id, COUNT(product_id) AS cnt FROM Orders GROUP BY customer_id, product_id ORDER BY customer_id, cnt DESC ) AS T1 ) SELECT r.customer_id, r.product_id, p.product_name FROM result AS r JOIN products AS p ON r.product_id = p.product_id WHERE r.R = 1
WITH sales_agg AS ( SELECT o.customer_id, o.product_id, p.product_name, count(o.product_id) as 'num_of_product' FROM Orders o JOIN Products p ON p.product_id = o.product_id GROUP BY o.customer_id, o.product_id, p.product_name) SELECT sa1.customer_id, sa1.product_id, sa1.product_name FROM sales_agg sa1 INNER JOIN (SELECT customer_id, max(num_of_product) as max_count FROM sales_agg GROUP BY customer_id ) sa2 ON sa2.customer_id = sa1.customer_id AND sa1.num_of_product = sa2.max_count
WITH sub AS( SELECT customer_id, product_id, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) desc ) sales_rank FROM orders GROUP BY 1,2) SELECT sub.customer_id, sub.product_id, p.product_name FROM sub JOIN products p ON sub.product_id = p.product_id WHERE sub.sales_rank = 1
WITH t AS ( SELECT o.customer_id, o.product_id, p.product_name, RANK() OVER(PARTITION BY o.customer_id ORDER BY COUNT(o.product_id) desc) as rk FROM orders o, products p WHERE o.product_id = p.product_id GROUP BY 1,2) SELECT customer_id, product_id, product_name FROM t where rk = 1
WITH t AS (SELECT customer_id, product_id, rank() over(partition by customer_id order by count(product_id) DESC) as ranking FROM orders group by 1,2) SELECT t.customer_id, t.product_id , p.product_name FROM t INNER JOIN products p using (product_id) WHERE t.ranking = 1
WITH t AS( SELECT o.customer_id, o.product_id, p.product_name,COUNT(o.product_id) AS Freq FROM Orders o JOIN Customers c ON o.customer_id = c.customer_id JOIN Products p ON o.product_id = p.product_id GROUP BY 1,2,3 ) SELECT a.customer_id, a.product_id, a.product_name FROM( SELECT *, RANK()OVER(PARTITION BY t.customer_id ORDER BY t.Freq DESC) AS rk FROM t) a WHERE a.rk=1
WITH t0 AS ( SELECT o.customer_id, p.product_id, p.product_name, COUNT(p.product_id) as quantity FROM Orders o LEFT JOIN Products p ON o.product_id = p.product_id GROUP BY CONCAT(o.product_id, ".", o.customer_id) ), t1 AS ( SELECT customer_id, MAX(quantity) as quantity FROM t0 GROUP BY customer_id ) SELECT t0.customer_id, product_id, product_name FROM t0 LEFT JOIN t1 ON t0.customer_id = t1.customer_id WHERE t0.quantity = t1.quantity
WITH t1 AS (SELECT DISTINCT customer_id,product_id,COUNT(1) OVER (PARTITION BY customer_id, product_id) AS cnt FROM Orders) SELECT customer_id, t2.product_id,product_name FROM (SELECT customer_id ,product_id FROM t1 WHERE (customer_id,cnt) IN (SELECT customer_id,MAX(cnt) FROM t1 GROUP BY customer_id)) t2 LEFT JOIN Products ON t2.product_id = Products.product_id
WITH t1 AS (SELECT customer_id, product_id, COUNT(*) AS cust_by_product, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) num_purchase FROM orders GROUP BY customer_id, product_id) SELECT t1.customer_id as customer_id, t1.product_id as product_id, t2.product_name FROM t1 LEFT JOIN Products as t2 ON t1.product_id = t2.product_id WHERE num_purchase = 1
WITH t1 AS (SELECT customer_id, product_id, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS num_purchase FROM orders GROUP BY customer_id, product_id) SELECT t1.customer_id AS customer_id, t1.product_id AS product_id, t2.product_name FROM t1 LEFT JOIN Products AS t2 ON t1.product_id = t2.product_id WHERE num_purchase = 1
WITH t_num AS (SELECT customer_id, product_id, COUNT(product_id) as num_product FROM Orders GROUP BY customer_id, product_id) SELECT t.customer_id, t.product_id, p.product_name FROM t_num t LEFT JOIN Products p ON p.product_id = t.product_id WHERE (t.customer_id, t.num_product) IN (SELECT customer_id, MAX(num_product) as max_product FROM t_num GROUP BY customer_id)
WITH tab AS (SELECT O.customer_id, O.product_id, P.product_name, COUNT(O.order_id) AS CNT FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY 1,2,3), Frequent_ordered_product AS (SELECT t.customer_id, t.product_id, t.product_name, RANK() OVER (PARTITION BY t.customer_id ORDER BY t.CNT DESC) AS RNK FROM tab t) SELECT F.customer_id, F.product_id, F.product_name FROM Frequent_ordered_product F WHERE RNK = 1
WITH table1 AS( SELECT o.customer_id, o.product_id, p.product_name, COUNT(o.product_id)OVER(PARTITION BY o.product_id, o.customer_id) AS cnt FROM Orders o LEFT JOIN Products p USING(product_id) ORDER BY customer_id ), table2 AS( SELECT customer_id, product_id, product_name, cnt, RANK()OVER(PARTITION BY customer_id ORDER BY cnt DESC) AS rnk FROM table1 ) SELECT DISTINCT customer_id, product_id, product_name FROM table2 WHERE rnk = 1
WITH temp AS ( SELECT customer_id, product_id, COUNT(*) AS cnt, MAX(COUNT(*)) OVER(PARTITION BY customer_id) AS max_cnt FROM Orders GROUP BY customer_id, product_id ) SELECT t.customer_id, t.product_id, p.product_name FROM temp t JOIN Products p ON t.product_id = p.product_id AND t.cnt = t.max_cnt
WITH temp AS ( SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(*) DESC) AS rk FROM Orders GROUP BY customer_id, product_id ) SELECT customer_id, t.product_id, product_name FROM temp t INNER JOIN Products p ON t.product_id = p.product_id WHERE rk = 1
WITH temp AS ( SELECT customer_id, product_id, count(*) AS prod_freq FROM Orders GROUP BY 1, 2) SELECT t1.customer_id, t1.product_id, p.product_name FROM temp t1 LEFT JOIN Products p ON p.product_id=t1.product_id WHERE t1.prod_freq = ( SELECT max(t2.prod_freq) FROM temp t2 WHERE t1.customer_id = t2.customer_id)
WITH temp AS (SELECT o.customer_id, o.product_id, p.product_name, COUNT(*) AS ts FROM Orders o LEFT JOIN Products p ON o.product_id = p.product_id GROUP BY o.customer_id, o.product_id) SELECT customer_id, product_id, product_name FROM (SELECT *, RANK() OVER (PARTITION BY customer_id ORDER BY ts DESC) AS rk FROM temp) AS t WHERE rk = 1
WITH temp1 AS ( SELECT customer_id, product_id, COUNT(product_id) AS product_count FROM orders GROUP BY customer_id, product_id), temp2 AS ( SELECT customer_id, MAX(product_count) AS max_product_count FROM temp1 GROUP BY customer_id) SELECT temp1.customer_id, temp1.product_id, product_name FROM temp1 JOIN temp2 USING(customer_id) JOIN products ON temp1.product_id = products.product_id WHERE product_count = max_product_count
WITH temp1 AS (SELECT customer_id, product_id, product_name, count(*) AS num FROM Orders o JOIN Products USING (product_id) GROUP BY customer_id, product_id order by customer_id), temp2 AS (SELECT customer_id, product_id, product_name,num, dense_rank() OVER (partition by customer_id order by num DESC) AS rnk FROM temp1 GROUP BY customer_id, product_id ORDER BY customer_id) SELECT customer_id, product_id, product_name FROM temp2 WHERE rnk = 1
WITH tmp as ( SELECT t2.customer_id, t1.product_id, t3.product_name, COUNT(t1.order_id) as qty FROM Orders t1 INNER JOIN Customers t2 ON t1.customer_id = t2.customer_id INNER JOIN Products t3 ON t1.product_id = t3.product_id GROUP BY t2.customer_id,t1.product_id,t3.product_name ) ,rank_item as ( SELECT customer_id, product_id ,product_name, qty, DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY qty DESC) as rn FROM tmp ) SELECT customer_id,product_id,product_name FROM rank_item WHERE rn = 1
With CustOrders as ( select customer_id, product_id, count(*) as ordCnt, rank() over (partition by customer_id order by count(*) desc) as ranks FROM Orders GROUP by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from CustOrders as c JOIN Products as p ON c.product_id = p.product_id where c.ranks = 1
With cte as ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc)as rk from orders group by customer_id, product_id) select c.customer_id, p.product_id, p.product_name from customers c left join cte using (customer_id) left join products p using (product_id) where rk =1
With summary as ( Select a.customer_id, b.product_id, c.product_name, count(*) as ct From Customers a Join Orders b On a.customer_id = b.customer_id Join Products c on b.product_id = c.product_id Group by a.customer_id, b.product_id, c.product_name), max_counts as ( Select customer_id, max(ct) as max_ct From summary Group by customer_id) Select b.customer_id, b.product_id, b.product_name From max_counts a Join summary b on a.customer_id = b.customer_id and a.max_ct = b.ct
With t1 As (Select DISTINCT customer_id, product_id, Count(product_id) Over (Partition by customer_id, product_id) as product_count From Orders) Select t1.customer_id, t1.product_id, t3.product_name From t1 Join (Select t1.customer_id, Max(t1.product_count) as max_count From t1 Group by t1.customer_id) t2 On t2.customer_id = t1.customer_id And t1.product_count = t2.max_count Join Products t3 on t1.product_id = t3.product_id
select B.customer_id,B.product_id, Products.product_name from (select A.customer_id, A.product_id, rank() over(partition by A.customer_id order by A.num desc) as RK from (select distinct customer_id, product_id, count(order_id) as num from Orders group by 1,2) as A) as B left join Products on B.product_id=Products.product_id where B.RK=1
select B.customer_id,B.product_id,P.product_name from ( select A.customer_id,A.product_id, dense_rank() over(partition by A.customer_id order by tot desc) ranking from ( select customer_id,product_id, count(1) as tot from orders group by customer_id,product_id order by customer_id,product_id) A ) B join Products P on B.product_id=p.product_id where ranking=1
select M.customer_id, M.product_id, P.product_name from (select *, Dense_rank() over (Partition by customer_id order by order_count DESC) as Rank_count from (select customer_id, product_id, count(*) as order_count from Orders group by customer_id, product_id) A) M join Products P on M.product_id = P.product_id where Rank_count = 1
select T.customer_id, P.product_id, P.product_name from (SELECT customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) as rnk FROM Orders O group by customer_id,product_id ) T join Products P on P.product_id = T.product_id where T.rnk = 1
select T.customer_id, T.product_id, P.product_name from (select customer_id, product_id, rank() over( partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id) T join Products P on T.product_id = P.product_id where rnk =1
select TBL.customer_id, TBL.product_id, P.product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) desc) as rnk from Orders group by 1,2) TBL left join Products P on TBL.product_id = P.product_id where rnk = 1
select TBL.customer_id, TBL.product_id, P.product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by order_cnt desc) as rnk from ( select customer_id, product_id, count(order_id) as order_cnt from Orders group by 1,2) summ ) TBL left join Products P on TBL.product_id = P.product_id where rnk = 1
select a.customer_id , a.product_id, p.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) desc ) as rnk from Orders group by customer_id, product_id ) a join Products p on a.product_id=p.product_id where rnk=1
select a.customer_id, a.product_id, b.product_name from ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(order_id) desc ) r from Orders group by 1,2 ) a inner join Products b on a.product_id = b.product_id where a.r = 1
select a.customer_id, a.product_id, b.product_name from ( select customer_id, product_id, rank()over(partition by customer_id order by count(order_id) desc) as rnk from Orders group by 1,2)a left join Products b on a.product_id=b.product_id where a.rnk=1
select a.customer_id, a.product_id, b.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by count(order_id) desc) r from Orders group by 1,2) a join Products b using(product_id) where a.r = 1
select a.customer_id, a.product_id, b.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) as rank_p from Orders group by customer_id, product_id order by customer_id ) a left join Products b on a.product_id=b.product_id where rank_p=1
select a.customer_id, a.product_id, b.product_name from orders a join products b on a.product_id = b.product_id group by 1, 2 having (a.customer_id, count(product_name)) in ( select customer_id, max(ordered) from (select customer_id, product_id, count(order_date) as ordered from orders group by 1,2) a group by 1)
select a.customer_id, a.product_id, p.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id, product_id ) as a join Products as p on a.product_id = p.product_id where rnk = 1
select a.customer_id, a.product_id, p.product_name from( select customer_id, product_id, count(*) as ct, dense_rank() over(partition by customer_id order by count(*) desc) as ranking from orders group by customer_id, product_id order by customer_id asc, product_id asc ) a left join products p on a.product_id = p.product_id where ranking = 1 order by a.customer_id asc, a.product_id asc
select a.customer_id, a.product_id, product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(*) desc) as rnk from orders group by 1, 2) a join Products using(product_id) where rnk = 1
select a.customer_id, b.product_id, c.product_name from Customers a left join Orders b on a.customer_id=b.customer_id left join Products c on b.product_id=c.product_id group by 1,2 having (count(b.order_id) = (select orders from ( select customer_id,max(orders) as orders from ( select customer_id, product_id, count(order_id) as orders from Orders group by 1,2 )a group by 1 )b where b.customer_id=a.customer_id ) )
select a.customer_id,a.product_id, product_name from (select customer_id,product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id,product_id) a join Products b on a.product_id=b.product_id where rnk=1
select a.customer_id,a.product_id,b.product_name from ( select customer_id,product_id, rank() over(partition by customer_id order by count(order_id) desc) as rnk from orders group by customer_id,product_id ) a join products b on a.product_id=b.product_id where a.rnk=1
select a.customer_id,a.product_id,p.product_name from products p join (select customer_id,product_id,prdcnt,rank() over(partition by customer_id order by prdcnt desc ) crank from (select customer_id,product_id,count(*) prdcnt from orders group by 1,2)a )a on p.product_id = a.product_id where crank=1
select a.customer_id,a.product_id,products.product_name from (select customer_id,product_id, rank() over (partition by customer_id order by count(order_id) desc) as product_rank from orders group by customer_id,product_id) a join products on a.product_id = products.product_id where a.product_rank =1
select b.customer_id as customer_id , b.product_id as product_id ,c.product_name as product_name from (select customer_id ,Product_id, DENSE_RANK() OVER(PARTITION BY customer_id ORDER BY cnt DESC) AS drank from ( select customer_id,Product_id ,count(*) as cnt from Orders group by customer_id,Product_id order by Customer_id) a ) b inner join Products c on b.Product_id= c.Product_id where b.drank =1
select b.customer_id as customer_id, b.product_id as product_id, p.product_name from ( select a.customer_id, a.product_id, rank() over (partition by a.a.customer_id order by a.ordercount desc) as rk from (select customer_id, product_id, count(distinct order_id) as ordercount from Orders group by customer_id, product_id) as a ) as b join Products p on p.product_id = b. product_id where b.rk = 1
select b.customer_id, b.product_id, b.product_name from( select customer_id, a.product_id,p.product_name, rank() over(partition by customer_id order by cntt desc) as rnk from( select customer_id, product_id, count(*) 'cntt' from Orders group by customer_id, product_id order by customer_id, product_id)a join Products p on a.product_id = p.product_id)b where rnk = 1
select b.customer_id, b.product_id, c.product_name from (select customer_id, product_id, cnts, max(cnts) over (partition by customer_id) as max_cnts from (select customer_id, product_id, count(*) as cnts from orders group by 1,2) as a) as b left join products as c on b.product_id=c.product_id where b.cnts=b.max_cnts
select b.customer_id, b.product_id, p.product_name from (select a.customer_id, a.product_id, rank() over (partition by a.customer_id order by howmany desc) as rk from (select customer_id, product_id, count(distinct order_id) as howmany from Orders group by customer_id, product_id) as a ) as b join Products p on p.product_id = b.product_id where rk = 1
select b.customer_id, b.product_id, p.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by howmany desc) as rk from (select customer_id, product_id, count(distinct order_id) as howmany from Orders group by customer_id, product_id) as a ) b join Products p on p.product_id = b.product_id where rk = 1
select b.customer_id, b.product_id, products.product_name from (select * from (select customer_id, product_id, total_orders, dense_rank() over (partition by customer_id order by total_orders desc) as rnk from (select customer_id, product_id, count(order_id) as total_orders from orders group by customer_id, product_id order by customer_id, total_orders desc) tmp group by customer_id, product_id) a where rnk = 1) b inner join products on b.product_id = products.product_id
select b.customer_id, p.product_id , p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by quantity desc) as rk from (select customer_id, product_id, count(*) as quantity from Orders group by 1,2) a) b join products p on b.product_id = p.product_id where b.rk=1
select b.customer_id,b.product_id,p.product_name from ( select a.*,dense_rank() over(partition by customer_id order by ct desc) rnk from (select customer_id,product_id,count(order_id) ct from Orders group by 1,2 order by 1,2 )a )b, Products p where b.rnk=1 and p.product_id=b.product_id
select b.customer_id,b.product_id,p.product_name from ( select a.customer_id, a.product_id, dense_rank() over (partition by a.customer_id order by a.req desc) as d_rank from ( select customer_id, product_id, count(*) as req from orders o group by customer_id, product_id )a )b left join Products p on b.product_id = p.product_id where b.d_rank = 1
select c.*,d.product_name from (select distinct customer_id,product_id from (select customer_id,product_id,num_order,max(num_order) over(partition by customer_id) as max_num_order from (select customer_id,product_id, count(distinct order_date) as num_order from Orders group by customer_id,product_id)a)b where num_order=max_num_order)c left join Products d on c.product_id=d.product_id
select c.customer_id, c.product_id, e.product_name from (select b.customer_id, b.product_id from (select a.*, rank() over (partition by a.customer_id order by a.frequent desc) as rk from (select customer_id, product_id, count(*) as frequent from orders group by 1,2 order by 1,2)a )b where b.rk=1)c inner join products e on c.product_id=e.product_id
select c.customer_id, c.product_id,c.product_name from ( select b.customer_id, b.product_id, b.product_name, DENSE_RANK() OVER (partition by b.customer_id order by b.freq desc) as my_rank from ( select a.customer_id, Products.product_name, Customers.name, freq, a.product_id from (select customer_id, product_id, count(*) as freq from Orders group by customer_id, product_id) a join Customers on a.customer_id = Customers.customer_id join Products on a.product_id = Products.product_id ) b ) c where c.my_rank = 1
select c.customer_id, temp.product_id, temp.product_name from customers c inner join (select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.order_id) desc) as rnk from orders o left join products p on o.product_id=p.product_id group by 1,2,3) temp on c.customer_id=temp.customer_id where temp.rnk=1
select co.customer_id, co.product_id, p.product_name from ( select o.customer_id, o.product_id, rank() over( partition by customer_id order by count(*) desc) as rnk from Orders o group by customer_id, product_id order by customer_id, rnk desc ) as co left join Products p on co.product_id = p.product_id where co.rnk = 1
select cte.customer_id, cte.product_id, product_name from ( select customer_id, product_id, rank()over(partition by customer_id order by count(product_id) desc) as r from orders group by 1,2)cte join products p on p.product_id=cte.product_Id where cte.r=1
select cte.customer_id,cte.product_id,product_name from (select customer_id,product_id,rank()over(partition by customer_id order by count(product_id) desc) as r from orders group by 1,2)cte join products p on p.product_id=cte.product_Id where cte.r=1
select customer_id , product_id , product_name from ( select a.customer_id ,a.product_id , dense_rank() over (partition by a.customer_id order by count(a.product_id) desc) as rn ,b.product_name from orders a inner join products b using (product_id) group by 1, 2, 4 ) t where rn = 1
select customer_id ,A.product_id as product_id ,product_name from ( select customer_id ,prod.product_id ,product_name ,rank() over (partition by customer_id order by product_count desc) as prod_rank from ( select cust.customer_id as customer_id ,ord.product_id as product_id ,count(product_id) as product_count from Customers cust join Orders ord on cust.customer_id = ord.customer_id group by customer_id,product_id ) prodA join Products prod on prod.product_id = prodA.product_id ) A where prod_rank = 1
select customer_id ,prod.product_id as product_id ,product_name from ( select customer_id ,product_id ,dense_rank() over (partition by customer_id order by count(product_id) desc) as prod_rank from Orders group by customer_id,product_id ) rankorders join Products prod on prod.product_id = rankorders.product_id where rankorders.prod_rank = 1
select customer_id ,product_id ,product_name from ( select Orders.customer_id ,Products.product_id ,Products.product_name ,rank() over (partition by Orders.customer_id order by count(*) desc) count_rank from Orders left join Products on Orders.product_id = Products.product_id group by Orders.customer_id ,Products.product_id ,Products.product_name) product_ranks where product_ranks.count_rank = 1
select customer_id ,t1.product_id ,product_name from (select customer_id, product_id ,rank() over (partition by customer_id order by cnt desc) as rn from (select customer_id, product_id, count(order_date) as cnt from Orders group by 1,2) t ) t1 inner join Products p on p.product_id = t1.product_id where rn = 1
select customer_id, Products.product_id, product_name from Orders join Products on Products.product_id = Orders.product_id group by customer_id, product_id having (customer_id, count(order_id)) in ( select customer_id, max(cnt) from (select customer_id, product_id, count(order_id) as cnt from Orders group by customer_id, product_id ) a group by customer_id )
select customer_id, a.product_id, product_name from (select customer_id, a.product_id, product_name, dense_rank() over (partition by customer_id order by count(*) desc ) as num from orders a join products b on a.product_id = b.product_id group by customer_id, a.product_id) a where num = 1
select customer_id, a.product_id, product_name from (select customer_id, o.product_id, dense_rank() over (partition by customer_id order by count(*) desc) num, product_name from orders o join products p on o.product_id = p.product_id group by customer_id, product_id) a where num = 1
select customer_id, aa.product_id, bb.product_name from (select customer_id, product_id from (select customer_id, product_id, dense_rank() over(partition by customer_id order by num desc) 'rank' from (select customer_id, product_id, count(product_id) 'num' from orders group by customer_id, product_id) a)b where b.rank = 1) aa, products bb where aa.product_id = bb.product_id
select customer_id, b.product_id, p.product_name from ( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(1) desc) as rk from orders group by product_id, customer_id ) b left join products p on b.product_id = p.product_id where b.rk = 1
select customer_id, b.product_id, product_name from (select *, rank()over(partition by customer_id order by counts desc) as ranks from (select customer_id, product_id, count(*) as counts from Orders group by customer_id, product_id order by customer_id asc, counts desc) a )b left join Products p on b.product_id = p.product_id where ranks=1 order by customer_id asc, b.product_id asc
select customer_id, b.product_id, product_name from (select customer_id, product_id, rank() over (partition by customer_id order by num desc) rk from (select customer_id, product_id, count(order_id) num from Orders group by 1,2 ) a ) b join Products p on b.product_id = p.product_id where rk = 1
select customer_id, m.product_id, product_name from (select customer_id, product_id,rank()over(partition by customer_id order by order_num desc) as order_rank from (select customer_id, product_id, count(*) as order_num from Orders group by customer_id,product_id)n)m join Products p on m.product_id = p.product_id where order_rank = 1
select customer_id, m.product_id,product_name from (select *, dense_rank() over (partition by customer_id order by count(product_id) desc) drk from Orders group by customer_id,product_id) m left join Products p on p.product_id = m.product_id where drk = 1
select customer_id, p.product_id, product_name from ( select o.customer_id, o.product_id, dense_rank() over(partition by o.customer_id order by count(*) desc ) as prank from Orders o group by 1, 2 ) as tbl join Products as p on tbl.product_id = p.product_id where prank = 1
select customer_id, p.product_id, product_name from (select customer_id, product_id from (select *, rank()over(partition by customer_id order by count(product_id) desc) as ranks from orders group by customer_id, product_id)t1 where ranks = 1)t2 join products as p using (product_id)
select customer_id, p.product_id, product_name from Orders o JOIN Products p using (product_id) group by 1, 2 HAVING (customer_id, count(order_date)) in (select customer_id, MAX(prod_count) from (select customer_id, product_id, count(*) as prod_count from Orders group by 1, 2) p group by 1)
select customer_id, p.product_id, product_name from products p join (select customer_id, product_id, dense_rank() over (partition by customer_id order by count(order_id) desc) ranking from orders group by 1,2)t on p.product_id = t.product_id where ranking = 1
select customer_id, p.product_id, product_name from products p join (select customer_id, product_id, dense_rank() over (partition by customer_id order by count(product_id) desc) as cntrank from Orders group by customer_id, product_id)a on p.product_id = a.product_id where cntrank = 1
select customer_id, p.product_id, product_name from products p join (select distinct b.customer_id, product_id from (select distinct customer_id,max(count) over(partition by customer_id order by customer_id) as max from ( select customer_id,product_id, count(customer_id) over(partition by product_id, customer_id order by customer_id) as count from orders) a) b join ( select customer_id,product_id, count(customer_id) over(partition by product_id, customer_id order by customer_id) as count from orders) c on b.customer_id = c.customer_id and b.max = c.count) d on p.product_id = d.product_id
select customer_id, p.product_id,p.product_name from( select customer_id,product_id,orders_count, rank() over (partition by customer_id order by orders_count desc)r from ( select customer_id, product_id, count(distinct order_id) as orders_count from orders group by customer_id,product_id)orders_count)t join products p on p.product_id = t.product_id where r=1
select customer_id, product_id, product_name FROM (SELECT customer_id, product_id, product_name, try, RANK() over (partition by customer_id order by try desc) as try2 FROM( SELECT distinct customer_id, o.product_id, product_name, COUNT(order_id) over (partition by customer_id,o.product_id) as try FROM Orders O JOIN Products P on O.product_id=P.product_id) A)B where try2=1
select customer_id, product_id, product_name from ( select *, rank() over (partition by customer_id order by count(*) desc) as rnk from orders join products using(product_id) group by customer_id, product_id ) t where rnk = 1
select customer_id, product_id, product_name from ( select O.customer_id as customer_id, O.product_id, product_name, count(order_id), dense_rank() over(partition by customer_id order by count(order_id) desc) as RK from Orders O left join products P on O.product_id = P.Product_id group by 1,2,3 order by 1) t1 where RK =1
select customer_id, product_id, product_name from ( select a.*, dense_rank() over(partition by customer_id order by no_of_times_ordered desc) as fav_prod_rank, b.product_name from ( select customer_id, product_id, count(*) as no_of_times_ordered from Orders group by customer_id, product_id ) a join Products b on a.product_id = b.product_id ) c where fav_prod_rank = 1
select customer_id, product_id, product_name from ( select a.customer_id, a.product_id, b.product_name, a.cnt_trans, dense_rank() over (partition by a.customer_id order by a.cnt_trans desc) as rk from (select customer_id, product_id, count(product_id) as cnt_trans from Orders group by 1, 2) as a left join Products as b on a.product_id = b.product_id) as c where rk = 1
select customer_id, product_id, product_name from ( select a.customer_id, a.product_id, b.product_name, rank() over (partition by customer_id order by count(*) desc) as rnk from orders a left join products b on a.product_id = b.product_id group by 1, 2, 3 ) t1 where rnk = 1
select customer_id, product_id, product_name from ( select a.customer_id, b.product_id, product_name, rank() over (partition by a.customer_id order by count(b.product_id) desc) as product_rank from customers a join orders b on a.customer_id = b.customer_id join products c on b.product_id = c.product_id group by 1,2,3 ) d where product_rank = 1
select customer_id, product_id, product_name from ( select c.customer_id, o.product_id, p.product_name, dense_rank() over (partition by customer_id order by count(o.product_id) desc) as rn from Customers as c inner join Orders as o on c.customer_id = o.customer_id inner join Products as p on o.product_id = p.product_id group by customer_id, product_id ) as tmp where rn = 1
select customer_id, product_id, product_name from ( select c.customer_id, p.product_id, p.product_name, rank() over(partition by c.customer_id order by count(*) desc) as rnk from Customers c inner join Orders o on o.customer_id = c.customer_id inner join Products p on p.product_id = o.product_id group by 1,2,3 )x where rnk = 1
select customer_id, product_id, product_name from ( select customer_id , o.product_id , product_name , rank() over (partition by customer_id order by count(0) desc) as rk FROM Orders o JOIN Products p on p.product_id = o.product_id group by customer_id, o.product_id, product_name) t where rk = 1
select customer_id, product_id, product_name from ( select customer_id, Products.product_id, product_name, rank() over(partition by customer_id order by count(Products.product_id) desc) as order_rank from Orders join Products on Orders.product_id = Products.product_id group by customer_id, Products.product_id ) t where order_rank = 1 order by customer_id, product_id
select customer_id, product_id, product_name from ( select customer_id, o.product_id, product_name, rank() over (partition by customer_id order by count(o.product_id) desc) as rk from Orders as o left join Products as p on o.product_id = p.product_id group by customer_id, product_id ) as tmp where rk = 1
select customer_id, product_id, product_name from ( select customer_id, o.product_id, product_name, rank() over (partition by customer_id order by count(o.product_id) desc) as rk from orders o join products p on o.product_id=p.product_id group by customer_id, o.product_id) a where rk=1
select customer_id, product_id, product_name from ( select customer_id, o.product_id, product_name, rank() over (partition by customer_id order by count(o.product_id) desc) as rnk from Orders o join Products p on o.product_Id = p.product_id group by customer_id, product_id ) as tmp where rnk = 1 order by customer_id, product_id
select customer_id, product_id, product_name from ( select customer_id, p.product_id, p.product_name, rank() over (partition by customer_id order by count(o.order_id) desc) rnk from orders o join products p using(product_id) group by customer_id, p.product_id ) a where rnk=1
select customer_id, product_id, product_name from ( select customer_id, product_id, count, product_name, dense_rank() over(partition by customer_id order by count DESC) as rnk from ( select a.customer_id, a.product_id, count(a.product_id) as count, b.product_name from Orders a left join Products b on a.product_id = b.product_id group by a.customer_id, a.product_id ) t ) f where rnk = 1
select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, count(order_id) as total, rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders o join products p using(product_id) group by customer_id, product_id, product_name ) t where rnk = 1
select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, dense_rank() OVER (PARTITION BY customer_id order by count desc) as rk from ( select o.customer_id, o.product_id, count(o.product_id) as count, p.product_name from customers c JOIN orders o ON c.customer_id = o.customer_id JOIN products p ON p.product_id = o.product_id group by o.customer_id, o.product_id order by o.customer_id ) cte1 order by customer_id ) cte2 where rk = 1
select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, rank() over (partition by customer_id order by cnt desc) as rnk from ( select a.customer_id, a.product_id, b.product_name, count(*) as cnt from orders a left join products b on a.product_id = b.product_id group by 1, 2, 3 ) t ) t1 where rnk = 1
select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, rank() over (partition by customer_id order by cnt_prod desc) as rnk from ( select a.customer_id, a.product_id, b.product_name, count(*) as cnt_prod from orders a inner join Products b on a.product_id = b.product_id group by 1,2 )z)y where rnk=1
select customer_id, product_id, product_name from ( select customer_id, products.product_id, product_name, rank() over(partition by customer_id order by count(*) desc) as rk from orders join products on products.product_id = orders.product_id group by customer_id, product_id) as a where a.rk = 1
select customer_id, product_id, product_name from ( select customer_id,o.product_id,product_name, Rank() over (partition by customer_id order by count(o.product_id) desc) as rnk from orders o join products p on o.product_id = p.product_id group by customer_id,o.product_id) a where rnk =1
select customer_id, product_id, product_name from ( select o.customer_id, o.product_id, p.product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk from Orders o join Products p on o.product_id = p.product_id group by customer_id, product_id ) tmp where rnk = 1 order by customer_id, product_id
select customer_id, product_id, product_name from ( select o.customer_id, o.product_id, p.product_name, dense_rank() over(partition by customer_id order by count(product_id) desc) as r from orders o left join customers c using(customer_id) left join products p using(product_id) group by customer_id, product_id) dudu where r = 1
select customer_id, product_id, product_name from ( select o.customer_id, o.product_id, p.product_name, rank ( ) over (partition by o.customer_id order by count(o.product_id) desc) as ranking from Orders as o join Products as p using (product_id) group by o.customer_id,o.product_id ) temp where ranking =1
select customer_id, product_id, product_name from ( select order_id, order_date, customer_id, o.product_id, p.product_name, p.price, dense_rank() over(partition by customer_id order by count(o.product_id) desc) rnk from orders o join products p on o.product_id = p.product_id group by customer_id, o.product_id ) tb where rnk = 1 order by customer_id
select customer_id, product_id, product_name from ( select sub.customer_id, sub.product_id, p.product_name, rank() over ( partition by sub.customer_id order by sub.freq desc) most_rank from (select customer_id, product_id, count(order_id) as freq from Orders group by customer_id, product_id) sub left join Products p on sub.product_id = p.product_id ) final_table where most_rank = 1
select customer_id, product_id, product_name from (select *, dense_rank() over (partition by customer_id order by count(order_id) desc) rnk from orders group by customer_id, product_id) a join products b using (product_id) where rnk = 1
select customer_id, product_id, product_name from (select *, rank() over (partition by customer_id order by co desc) as ran from (select o.customer_id, o.product_id, p.product_name, count(*) as co from orders o inner join products p on o.product_id = p.product_id group by 1, 2 order by o.customer_id) as a) as b where ran = 1
select customer_id, product_id, product_name from (select O.customer_id, O.product_id, P.product_name, rank() over (partition by O.customer_id order by count(order_id) desc) as RK from Orders O left join Products P on O.product_id = P.product_id group by customer_id, product_id) temp where RK = 1
select customer_id, product_id, product_name from (select O.customer_id, O.product_id, P.product_name,rank()over(partition by O.customer_id order by product_cnt desc) as rank_cnt from (select customer_id, product_id, count(product_id) as product_cnt from Orders group by 1,2)O join Products P on O.product_id = P.product_id)tmp where rank_cnt = 1
select customer_id, product_id, product_name from (select a.customer_id, a.product_id, b.product_name, rank() over(partition by a.customer_id order by count(a.product_id) desc) as rnk from orders a inner join products b on a.product_id = b.product_id group by customer_id,product_id ) d where rnk =1 ORDER BY customer_id, product_id
select customer_id, product_id, product_name from (select c.customer_id, o.product_id, p.product_name, dense_rank() over(partition by c.customer_id order by count(o.product_id) desc) as rn from customers c inner join orders o on c.customer_id=o.customer_id inner join products p on o.product_id=p.product_id group by 1,2) as c where rn=1
select customer_id, product_id, product_name from (select c.customer_id, o.product_id, product_name, count(product_name) b, rank() over (partition by c.customer_id order by count(product_name) desc) rk from customers c left join orders o on c.customer_id = o.customer_id left join products p on o.product_id = p.product_id group by c.customer_id, o.product_id, product_name having count(product_name)>0) a where rk = 1
select customer_id, product_id, product_name from (select c.customer_id, p.product_id, p.product_name, count(*) as n_order, rank() over (partition by c.customer_id order by count(*) desc) as rk from customers c right join orders o on c.customer_id = o.customer_id left join products p on o.product_id = p.product_id group by 1,2,3) a where rk = 1
select customer_id, product_id, product_name from (select c.customer_id, p.product_id, p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) DESC) as ranking from Customers c join Orders o on c.customer_id = o.customer_id join Products p on p.product_id = o.product_id group by customer_id, product_id) as newtable where ranking =1
select customer_id, product_id, product_name from (select customer_id, a.product_id, rank()over(partition by customer_id order by cnt desc) as mf, p.product_name from (select customer_id, product_id, count(*) as cnt from Orders group by customer_id, product_id ) a inner join Products p on a.product_id = p.product_id) b where mf =1
select customer_id, product_id, product_name from (select customer_id, o.product_id, p.product_name, count(o.product_id) as total, dense_rank() over (partition by customer_id order by count(o.product_id) desc) as rnk from orders o join products p on o.product_id = p.product_id group by 1,2) tmp where rnk = 1
select customer_id, product_id, product_name from (select customer_id, o.product_id, product_name, RANK() OVER (PARTITION BY customer_id order by count(o.product_id) desc) rk from orders o join products p on o.product_id = p.product_id group by 1,2,3 ) a where rk=1
select customer_id, product_id, product_name from (select customer_id, o.product_id, product_name, rank() over (partition by customer_id order by count(o.product_id) desc) rnk from orders o join products p on o.product_Id = p.product_id group by customer_id, o.product_id) temp where rnk = 1 order by customer_id, product_id
select customer_id, product_id, product_name from (select customer_id, o.product_id, product_name, rank() over(partition by customer_id order by count(*) desc) rank_p from Orders o left join Products p on o.product_id = p.product_id group by customer_id, o.product_id) a where a.rank_p=1
select customer_id, product_id, product_name from (select customer_id, orders.product_id, product_name, rank() over (partition by customer_id order by count(*) desc) as rnk from Orders join Products on orders.product_id = products.product_id group by customer_id, product_id) as rnked where rnk = 1 order by 1,2
select customer_id, product_id, product_name from (select customer_id, product_id, product_name , rank() over (partition by customer_id order by count(*) desc ) as rnk from orders join products using(product_id) group by 1,2) as rnked where rnk =1 order by 1,2
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, dense_rank() over(partition by customer_id order by ct desc) rk from (select c.customer_id, o.product_id, p.product_name, count(*) ct from Orders o, Customers c, Products p where c.customer_id = o.customer_id and o.product_id = p.product_id group by 1, 2) t) t2 where rk = 1
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, dense_rank() over(partition by customer_id order by freq desc) rnk from (select o.customer_id customer_id, o.product_id product_id, product_name, count(*) freq from orders o left join customers c on o.customer_id = c.customer_id left join products p on o.product_id = p.product_id group by 1,2,3) a ) b where rnk = 1
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, dense_rank() over(partition by customer_id order by freq desc) rnk from (select o.customer_id customer_id, o.product_id product_id, product_name, count(*) freq from orders o left join customers c on o.customer_id = c.customer_id left join products p on o.product_id = p.product_id group by 1,2,3) a) b where rnk = 1
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over (partition by customer_id order by count(*) desc) as rnk from Orders join Products using(product_id) group by customer_id, product_id) as rnked where rnk = 1 order by 1,2
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over(partition by customer_id order by cnt desc) as rk from (select o.customer_id, o.product_id, p.product_name, count(distinct o.order_id) as cnt from Orders o join Products p on o.product_id=p.product_id group by 1,2) t1 ) t2 where rk=1
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over(partition by customer_id order by count(product_id) desc) as n from Orders join Products using(product_id) group by customer_id, product_id ) t where t.n = 1 order by customer_id, product_id
select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank()over(partition by customer_id order by cnt desc) as rnk from (select o.customer_id, o.product_id, p.product_name, count(*) as cnt from Orders o inner join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id, p.product_name) a ) b where rnk =1
select customer_id, product_id, product_name from (select customer_id, product_id, rank() over (partition by customer_id order by qty desc) `rank` from (select customer_id, product_id, count(*) qty from orders group by customer_id, product_id) as total_qty) as ranked inner join products using (product_id) where `rank` = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, count(o.order_id) as ords, dense_rank() over(partition by o.customer_id order by count(o.product_id) desc) as rk, p.product_name from orders o left join products p on p.product_id = o.product_id group by o.customer_id, o.product_id, p.product_name ) a where rk = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, dense_rank() over (partition by o.customer_id order by count(*) desc) "order_rank" from orders o join products p on o.product_id = p.product_id group by 1, 2 ) tbl where order_rank = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, dense_rank() over (partition by o.customer_id order by count(o.order_id) desc) "order_rank" from orders o join products p on o.product_id = p.product_id group by 1, 2 ) tbl where order_rank = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank() over (partition by customer_id order by count(*) desc) as rnk from Orders o left join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id) as rnked where rnk = 1 order by 1,2
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.product_id) desc) as ranking from Orders o join Products p on o.product_id = p.product_id group by 1, 2, 3) b where ranking = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(distinct o.order_id) desc) as rk from Orders o join Products p on o.product_id=p.product_id group by 1,2) tmp where rk=1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) DESC) as rnk from Orders as o left join Products as p on o.product_id = p.product_id group by o.customer_id, o.product_id) as temp where rnk = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) desc) rnk from Orders o join Products p using (product_id) group by 1, 2) s where rnk = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, p.product_name, rank()over(partition by customer_id order by count(p.product_id) desc) as rnk from Orders o join Products p on o.product_id=p.product_id group by customer_id,product_id ) temp where rnk=1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id, rank() over(partition by o.customer_id order by count(o.product_id) desc) as order_ranking, p.product_name from Orders o join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id) ranking_tmp where order_ranking = 1
select customer_id, product_id, product_name from (select o.customer_id, o.product_id,p.product_name, dense_rank() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders as o join products as p using(product_id) join Customers as c using(customer_id) group by 1,2) a where a.rnk = 1
select customer_id, product_id, product_name from orders as o join products as p using (product_id) group by customer_id, product_id having (customer_id, count(order_id)) in (select customer_id, max(cnt) as maxi from (select customer_id, product_id, count(order_id) as cnt from orders group by customer_id, product_id) as temp group by customer_id)
select customer_id, product_id, product_name from orders o inner join Products p using (product_id) group by 1, 2 HAVING (customer_id, count(order_date)) IN ( Select customer_id, MAX(cnt) from ( select customer_id, product_id, count(*) as cnt from Orders group by 1, 2 ) as p group by 1 )
select customer_id, product_id, product_name from( select *, max(cnt) over(partition by customer_id) as mx from( select a.customer_id, b.name, a.product_id, c.product_name, count(a.product_id) as cnt from orders a join customers b on a.customer_id = b.customer_id join products c on c.product_id = a.product_id group by 1,2,3,4) temp) x where mx = cnt
select customer_id, product_id, product_name from( select *, rank() over (partition by customer_id order by num_product desc) as rk from (select o.*, p.product_name, count(*) as num_product from Orders as o left join Products as p on o.product_id = p.product_id Group by o.customer_id, o.product_id) t ) tm where rk = 1
select customer_id, product_id, product_name from( select customer_id, o.product_id, product_name, rank() over(partition by customer_id order by count(*) desc ) as rk from orders o join products p on o.product_id = p.product_id group by customer_id, product_id )a where rk = 1
select customer_id, product_id, product_name from( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) DESC) as 'rank' from Orders group by customer_id, product_id) temp join products using(product_id) where temp.rank = 1
select customer_id, product_id, product_name from( select customer_id, product_id, product_name, DENSE_RANK() OVER(partition by customer_id order by prd_count desc) final_rank from ( select customer_id, product_id, product_name,count(a.ord_rank) as prd_count from( select cust.customer_id, pro.product_id, pro.product_name, DENSE_RANK() OVER(partition by ord.customer_id,ord.product_id) ord_rank from Customers cust inner join Orders ord on cust.customer_id = ord.customer_id inner join Products pro on pro.product_id = ord.product_id )a group by 1,2,3 )b )c where c.final_rank = 1
select customer_id, product_id, product_name from( select customer_id, product_id, product_name, c, rank() over(partition by customer_id order by c DESC) rnk from( select o.customer_id, o.product_id, p.product_name, count(*) c from Orders o left join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id) x) y where rnk = 1
select customer_id, product_id, product_name from( select o.customer_id, o.product_id, p.product_name, count(*) c, rank() over(partition by customer_id order by count(*) DESC) rnk from Orders o left join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id ) x where rnk = 1
select customer_id, product_id, product_name from( select t.customer_id, t.product_id, p.product_name, rank() over(partition by customer_id order by cnt desc) as rnk from( select customer_id, product_id, count(*) as cnt from orders group by 1,2 order by 1,3 desc) t left join products p on t.product_id = p.product_id) t2 where rnk = 1
select customer_id, product_id, product_name from( select t1.customer_id, t1.product_id, t2.product_name, rank () over (partition by customer_id order by count(order_date) desc) as rnk from Orders as t1 inner join Products as t2 on t1.product_id = t2.product_id group by 1, 2, 3) as sub where rnk = 1
select customer_id, product_id,product_name from ( SELECT customer_id, product_id,product_name, rank() OVER(PARTITION BY CUSTOMER_ID ORDER BY CNT DESC) AS RNK FROM ( SELECT b.customer_id, c.product_id,product_name, count(1) AS CNT FROM ORDERS a JOIN Customers b on a.customer_id=b.customer_id join products c on a.product_id=c.product_id group by customer_id, product_id ) A ) b WHERE RNK=1
select customer_id, product_id,product_name from ( select customer_id,o.product_id,p.product_name, rank() over( PARTITION BY customer_id order by count(o.product_id) desc) as num from orders o join products p on o.product_id = p.product_id group by customer_id,product_id ) s where num = 1
select customer_id, product_id,product_name from( select customer_id, o.product_id ,rank() over(partition by customer_id order by count(o.product_id) desc) as rank_p,product_name from orders o left join products p on o.product_id=p.product_id group by customer_id,o.product_id order by customer_id )t where rank_p = 1
select customer_id, products.product_id, product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by product_count desc) as r from ( select customer_id, product_id, count(*) as product_count from Orders group by 1,2 ) tmp ) tmp2 join Products on tmp2.product_id = products.product_id where r = 1
select customer_id, products.product_id, product_name from Orders join Products on Products.product_id = Orders.product_id group by customer_id, product_id having (customer_id, count(order_date)) in (select customer_id, max(cnt) from (select customer_id,product_id,COUNT(order_date) as cnt from Orders group by customer_id,product_id) as a group by customer_id)
select customer_id, products.product_id, products.product_name from orders join products on products.product_id = orders.product_id group by customer_id, product_id having (customer_id, count(order_id)) in (select customer_id, max(cnt) from( select customer_id, product_id, count(order_id) as cnt from orders group by customer_id, product_id) as a group by customer_id)
select customer_id, s1.product_id, product_name from (select customer_id, product_id, total, MAX(total) over (partition by customer_id) as max_total from (select customer_id, product_id, count(*) as total from orders group by 1,2)s)s1 left join products p on s1.product_id = p.product_id where s1.total = s1.max_total
select customer_id, sub2.product_id, product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by cnt desc) rnk from ( select customer_id, product_id, count(*) as cnt from Orders group by 1, 2) sub)sub2 left join Products p on sub2.product_id = p.product_id where rnk = 1
select customer_id, t.product_id, p.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as r_rank from orders group by 1,2) t join products p on t.product_id = p.product_id where r_rank = 1
select customer_id, t.product_id, product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by cnt desc) as ranking from (select customer_id, product_id, count(distinct order_id) as cnt from orders group by customer_id, product_id) as s ) as t join products on products.product_id= t.product_id where ranking =1
select customer_id, t.product_id, product_name from( select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) desc) as rnk from orders group by 1,2) t inner join products b on t.product_id=b.product_id where rnk=1
select customer_id, t2.product_id, p.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by product_count desc) as r_rank from ( select customer_id, product_id, count(*) as product_count from orders group by 1,2) t1) t2 join products p on t2.product_id = p.product_id where t2.r_rank = 1
select customer_id, t2.product_id, product_name from (select customer_id, product_id from (select customer_id, product_id, RANK() OVER ( PARTITION BY customer_id ORDER BY count_id desc ) as my_rank from (select customer_id, product_id, count(order_id) as count_id from Orders group by customer_id, product_id) as t) as t1 where my_rank = 1) as t2 join Products on Products.product_id = t2.product_id
select customer_id, t2.product_id, product_name from (select customer_id, product_id, rank() over (partition by customer_id order by order_times desc) as order_rank from (select customer_id, product_id, count(1) as order_times from orders group by 1,2) t1) t2 join products p on t2.product_id = p.product_id where order_rank = 1
select customer_id, temp.product_id, p.product_name from (select customer_id, product_id, count(product_id) ct from orders o group by customer_id, product_id) temp, Products p where p.product_id=temp.product_id and (customer_id, ct) in (select customer_id, max(ct) as max_ct from (select customer_id, product_id, count(product_id) ct from orders o group by customer_id, product_id) cte group by customer_id )
select customer_id, tmp.product_id, p.product_name from ( select customer_id, product_id , rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by 1,2 ) tmp left join products p on p.product_id=tmp.product_id where tmp.rnk=1
select customer_id, tmp.product_id, p.product_name from( select o.customer_id, o.product_id, count(product_id) as sn, rank() over(partition by o.customer_id order by count(product_id) desc) as rnk from customers c join orders o on c.customer_id = o.customer_id group by 1,2 order by 1,3 desc ) tmp join products p on tmp.product_id = p.product_id where rnk = 1 order by customer_id, product_id
select customer_id, tmp.product_id, p.product_name from( select o.customer_id, o.product_id, rank() over(partition by o.customer_id order by count(product_id) desc) as rnk from customers c join orders o on c.customer_id = o.customer_id group by 1,2 ) tmp join products p on tmp.product_id = p.product_id where rnk = 1 order by customer_id, product_id
select customer_id, y.product_id, product_name from (select customer_id, product_id, rank() over(partition by customer_id order by cnt desc) as rn from (select customer_id, product_id, count(*) as cnt from Orders group by 1,2) x)y join Products z on y.product_id = z.product_id where rn = 1
select customer_id,Products.product_id,product_name from (select customer_id,product_id,rank()over(partition by customer_id order by order_count desc) as r from (select customer_id,product_id,count(distinct order_id) as order_count from orders group by customer_id,product_id) temp)temp2 join Products on temp2.product_id=Products.product_id where r=1
select customer_id,T2.product_id, P.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by counts desc) as rnk FROM( SELECT customer_id, product_id, count(*) as counts from Orders group by customer_id,product_id ) T ) T2 join Products P on T2.product_id = P.product_id where rnk = 1
select customer_id,a.product_id, p.product_name from( select customer_id,product_id, dense_rank() over(partition by customer_id order by cnt desc) rnk from ( select customer_id,product_id, count(order_id) as cnt from orders group by customer_id,product_id) o ) a inner join products p on p.product_id=a.product_id where rnk=1
select customer_id,a.product_id,b.product_name from ( select customer_id,product_id, rank() over (partition by customer_id order by count(*) desc) as rank_freq from orders group by customer_id,product_id ) a join products b on a.product_id=b.product_id where rank_freq=1
select customer_id,p.product_id,product_name from (select customer_id,product_id,dense_rank() over(partition by customer_id order by count(*) desc) c from orders o group by 1,2)t join products p on t.product_id=p.product_id where c =1
select customer_id,p.product_id,product_name from (select customer_id,product_id,rank()over(partition by customer_id order by count(product_id)desc)rk from orders group by customer_id,product_id)e join products p on p.product_id=e.product_id where rk=1
select customer_id,product_id, product_name from ( select o.customer_id,o.product_id, p.product_name, RANK() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o join Products p on o.product_id =p.product_id group by customer_id, product_id ) t where rnk =1 order by customer_id, product_id
select customer_id,product_id,product_name from ( select a.product_id ,a.customer_id ,b.product_name ,rank()over(partition by a.customer_id order by count(a.product_id) desc) as rank_id from Orders a left join Products b on a.product_id = b.product_id group by a.customer_id,a.product_id ) cte where rank_id = 1 order by customer_id,product_id
select customer_id,product_id,product_name from (select c.customer_id,p.product_id,p.product_name, dense_rank() over (partition by c.customer_id order by count(o.product_id) desc)as rnk from customers c join products p join orders o on c.customer_id=o.customer_id and p.product_id=o.product_id group by c.customer_id,p.product_id )tmp where tmp.rnk=1
select customer_id,product_id,product_name from (select customer_id, products.product_id,product_name, rank() over(partition by customer_id order by count(*) desc) rnk_n from orders join products on orders.product_id=products.product_id group by customer_id,product_id) temp where temp.rnk_n=1
select customer_id,products.product_id,products.product_name from (select customer_id, product_id, order_count, RANK() over (partition by customer_id order by order_count desc ) r from (select customer_id, product_id, count(order_id) order_count from orders group by customer_id, product_id) order_counts) order_counts_ranked join products on order_counts_ranked.product_id=products.product_id where r=1
select customer_id,t2.product_id,product_name from (select *, max(c) over (partition by customer_id) as 'm' from (select customer_id, product_id,count(*) c from orders group by customer_id, product_id) t1)t2 left join products on products.product_id = t2.product_id where c = m
select customer_id,t2.product_id,product_name from (select customer_id,product_id from ( select customer_id, product_id, count(distinct order_id) as cnt, rank() over(partition by customer_id order by count(distinct order_id) desc) as rk from Orders group by 1,2 ) t1 where rk = 1 ) t2 left join Products on t2.product_id = Products.product_id
select distinct customer_id, C.product_id, product_name from ( select customer_id, product_id from ( select customer_id, product_id, dense_rank() over(partition by customer_id order by c_order desc) as d_r from ( select customer_id, product_id, count(order_id) over(partition by customer_id, product_id) as c_order from orders) A ) B where d_r = 1 ) C join products p on C.product_id = p.product_id order by customer_id, C.product_id
select distinct customer_id, product_id, product_name from ( select *, rank() over(partition by customer_id order by ct desc) rk from ( select customer_id, product_id, product_name, count(product_id) over(partition by customer_id, product_id) ct from ( select c.customer_id, o.order_date, o.product_id, p.product_name from Customers c left join Orders o on c.customer_id = o.customer_id left join Products p on o.product_id = p.product_id ) T ) T1 ) T2 where rk = 1 and product_name is not null
select distinct customer_id, product_id, product_name from ( select customer_id, product_id, product_name, rank() over(partition by customer_id order by freq desc) rnk from ( select customer_id, p.product_id, product_name, count(o.product_id) over(partition by customer_id,o.product_id) freq from orders o join products p on o.product_id = p.product_id )tmp )tmp2 where rnk = 1
select distinct customer_id, product_id, product_name from( select *, max(c) over (partition by customer_id) as max_c from( select C.customer_id, P.product_id, P.product_name, count(O.order_id) over (partition by C.customer_id, P.product_id) as c from Customers as C inner join Orders as O on C.customer_id = O.customer_id inner join Products as P on P.product_id = O.product_id) as TMP1) as TMP2 where max_c = c
select distinct customer_id,p.product_id, product_name from products p join ( select customer_id,product_id,cnt,max(cnt) over (partition by customer_id) mx from ( select customer_id,product_id, count(*) over (partition by customer_id,product_id ) cnt from orders ) o ) oo on oo.product_id=p.product_id where cnt=mx order by 1,2
select f.customer_id, f.product_id, g.product_name from ( select customer_id, product_id, count(*) as freq, max(count(*)) over (partition by customer_id) as max_freq from orders group by customer_id, product_id ) f left join products g on f.product_id = g.product_id where f.freq=f.max_freq
select f.customer_id, f.product_id, p.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by quantity desc) as ranking from (select customer_id, product_id, count(product_id) as quantity from Orders group by customer_id, product_id) as t) as f join Products as p on (f.product_id = p.product_id) where f.ranking = 1
select g.customer_id, g.product_id, p.product_name from (select customer_id, product_id, count(order_id) countorder, rank() over (partition by customer_id order by count(product_id) desc) rnk from orders group by customer_id, product_id) g join products p on g.product_id = p.product_id where rnk = 1
select o.customer_id, o.product_id, Products.product_name from Products join (select customer_id,product_id, rank() over (partition by customer_id order by count(product_id) desc) as rank_num from Orders group by customer_id, product_id) as o where o.rank_num=1 and o.product_id= Products.product_id
select o.customer_id, o.product_id, p.product_name from ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id ) as o left outer join Products as p on o.product_id = p.product_id where o.rnk = 1 order by o.customer_id, o.product_id
select o.customer_id, o.product_id, p.product_name from ( select customer_id,product_id,count(order_date), dense_rank() over( partition by customer_id order by count(order_date) desc) as r1 from orders group by 1,2) o inner join products p on o.product_id = p.product_id where o.r1 = 1
select o.customer_id, o.product_id, p.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) as my_rank from Orders group by customer_id, product_id) o left join Products p on o.product_id = p.product_id where o.my_rank = 1
select o.customer_id, o.product_id, p.product_name from Orders o join Products p on o.product_id = p.product_id group by customer_id,product_id having (customer_id, count(*)) IN ( select sub.customer_id, max(sub.cnt) from ( select customer_id,product_id,count(*) as cnt from Orders group by customer_id,product_id ) sub group by customer_id )
select o.customer_id, o.product_id, p.product_name from orders o join products p using(product_id) group by o.customer_id, o.product_id having (o.customer_id, count(*)) in ( select customer_id, max(freq) from ( select customer_id, count(*) freq from orders group by customer_id, product_id ) a group by customer_id )
select o.customer_id, o.product_id, p.product_name from( select customer_id, product_id, dense_rank()over(partition by customer_id order by count(order_id) desc) as prdrank from orders group by customer_id, product_id )o join products as p using (product_id) where prdrank=1
select o.customer_id, p.product_id, p.product_name FROM (SELECT customer_id, product_id, rank()over(partition by customer_id order by count(product_id) desc) order_rank FROM Orders GROUP BY 1,2) o join Products p ON o.product_id = p.product_id where o.order_rank = 1
select o.customer_id, p.product_id, p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) order_rank from Orders group by customer_id, product_id) o join Products p on p.product_id=o.product_id where o.order_rank = 1
select o.customer_id, p.product_id, p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) order_rank from Orders group by customer_id, product_id) o join Products p using(product_id) where o.order_rank = 1
select o.customer_id, p.product_id,p.product_name from orders o join products p on o.product_id=p.product_id group by o.customer_id,p.product_id having (o.customer_id,count(o.order_id)) in( select customer_id,max(order_n) from (select customer_id, product_id, count(order_id) order_n from orders group by customer_id,product_id) sub_x group by customer_id)
select o.customer_id,o.product_id, p.product_name from Orders as o join Products as p on o.product_id=p.product_id group by o.customer_id,o.product_id having (o.customer_id,count(o.order_date)) in (select customer_id,max(cnt) from (select customer_id,product_id, count(order_date) as cnt from Orders group by customer_id,product_id) as t group by customer_id)
select o.customer_id,o.product_id, p.product_name from( select customer_id,product_id, dense_rank()OVER(partition by customer_id order by count(product_id) desc) as prdrank from orders group by customer_id,product_id )o JOIN products as p using (product_id) where o.prdrank=1
select orders.customer_id, orders.product_id, products.product_name from orders left join products on orders.product_id = products.product_id group by customer_id, product_id having (customer_id, count(orders.product_id)) IN (select customer_id, max(num_prod) from( select customer_id, product_id, count(product_id) as num_prod from Orders group by customer_id, product_id) t group by customer_id)
select p.customer_id, p.product_id, n.product_name from (select o.customer_id, o.product_id, dense_rank() over(partition by o.customer_id order by count(o.product_id) desc) dn from orders o group by o.customer_id, o.product_id)p, products n where p.product_id = n.product_id and p.dn = 1
select p1.customer_id, p1.product_id, p2.product_name from ( select c.customer_id, o.product_id, rank() over (partition by c.customer_id order by count(*) desc) as rnk from customers c join orders o on c.customer_id = o.customer_id group by 1, 2) p1 join products p2 on p1.product_id = p2.product_id where p1.rnk = 1
select product_id, product_name, customer_id from ( select *, rank() over (partition by customer_id order by p_count desc) as o_rank from ( select o.product_id, p.product_name, o.customer_id, count(order_id) as p_count from Orders o join Products p using(product_id) group by 1,2,3 ) t1 ) t2 where o_rank = 1
select r.customer_id, r.product_id, p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by freq desc) as freq_rank, freq from( select customer_id, product_id, count(product_id) as freq from Orders group by customer_id, product_id ) frequent_order ) r join Products p on r.product_id = p.product_id where r.freq_rank = 1
select ranked.customer_id, ranked.product_id, p.product_name from (select cpo.customer_id, cpo.product_id, dense_rank() over( partition by cpo.customer_id order by cpo.orders desc) 'order_rank' from (select customer_id, product_id, count(distinct order_id) 'orders' from Orders group by customer_id,product_id) cpo) ranked join Products p on p.product_id = ranked.product_id where ranked.order_rank = 1
select ranking_tab.customer_id, ranking_tab.product_id, Products.product_name from ( select customer_id, product_id, num_bought, rank() over (partition by customer_id order by num_bought desc) ranking from ( select customer_id, product_id, count(product_id) num_bought from Orders group by customer_id, product_id) temp)ranking_tab join Products on ranking_tab.product_id = Products.product_id where ranking = 1
select res.customer_id, res.product_id, product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(orders.customer_id) desc) prank from orders group by customer_id, orders.product_id)res join products p on p.product_id = res.product_id where prank = 1
select s.customer_id, s.product_id, s.product_name from (select o.customer_id, o.product_id, p.product_name , rank() over(partition by o.customer_id order by count(o.product_id) desc) rnk from customers c join orders o on c.customer_id = o.customer_id join products p on o.product_id = p.product_id group by o.customer_id,o.product_id ) s where s.rnk = 1
select sq.customer_id, p.product_id, p.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) order_rank from Orders group by customer_id, product_id) sq join Products p using(product_id) where sq.order_rank = 1
select sq.customer_id, p.product_id, p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) order_rank from Orders group by customer_id, product_id) sq join Products p using(product_id) where sq.order_rank = 1
select sq.customer_id, sq.product_id, p.product_name from products p join (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id) sq on p.product_id = sq.product_id where rnk = 1
select sub.customer_id , sub.product_id , p.product_name from (select customer_id , product_id , rank() over (partition by customer_id order by count(product_id) desc) rnk from orders group by 1,2 ) sub join products p on sub.product_id = p.product_id where sub.rnk = 1 order by sub.customer_id, sub.product_id
select sub.customer_id, sub.product_id, sub.product_name from (select o.customer_id, o.product_id, p.product_name, dense_rank() over (partition by o.customer_id order by count(o.product_id) DESC) as `rank` from Orders o join Products p on o.product_id = p.product_id group by 1,2,3 )sub where `rank` = 1
select sub.customer_id,sub.product_id,sub.product_name from (select customer_id,product_id,product_name,Count(product_id), rank() OVER(PARTITION BY customer_id order by COUNT(product_id) DESC) as rnk from Orders LEFT JOIN Products using(product_id) group by customer_id,product_id )sub where sub.rnk = 1
select sub2.customer_id, sub2.product_id, sub2.product_name from (select sub.customer_id, sub.product_id, sub.product_name, sub.frequence, rank() over (partition by sub.customer_id order by sub.frequence desc) as ranked from (select o.customer_id, o.product_id, p.product_name, count(*) as frequence from Orders o left join Products p on o.product_id = p.product_id group by 1,2,3 order by 1) as sub) as sub2 where sub2.ranked=1
select t.customer_id, t.product_id , p.product_name from (select customer_id , product_id , dense_rank() over(partition by customer_id order by count(product_id) desc) as rn from orders group by 1,2 ) t inner join products p using(product_id) where t.rn =1
select t.customer_id, t.product_id, p.product_name from ( select customer_id, product_id, dense_rank() over (partition by customer_id order by times desc) as ranking from ( select customer_id, product_id, count(product_id) as times from Orders group by customer_id, product_id ) purchase_records ) as t join Products p on p.product_id = t.product_id where t.ranking = 1
select t.customer_id, t.product_id, p.product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by count(*) desc) as p_rank from orders group by customer_id, product_id ) t join products p on p.product_id = t.product_id where t.p_rank = 1
select t.customer_id, t.product_id, p.product_name from ( select customer_id,product_id , rank() over(partition by customer_id order by count(product_id) desc) as rank_p from orders group by customer_id, product_id order by customer_id) as t left join products p on t.product_id = p.product_id where rank_p =1
select t.customer_id, t.product_id, p.product_name from (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc)as rank_p from Orders group by customer_id, product_id) as t left join Products p on p.product_id=t.product_id where rank_p=1
select t.customer_id, t.product_id, p.product_name from products p inner join ( select customer_id, product_id, rank() over(partition by customer_id order by count(*) desc) as prank from Orders group by customer_id, product_id ) t on t.product_id = p.product_id where t.prank = 1
select t.customer_id, t.product_id, p.product_name from( select customer_id, product_id, rank() over(partition by customer_id order by count(*) desc) as rnk1 from orders group by 1,2 ) t join products p using(product_id) where rnk1 = 1
select t.customer_id, t.product_id, p.product_name from( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rank_p from orders group by customer_id,product_id order by customer_id) as t left join products p on t.product_id = p.product_id where rank_p = 1
select t.customer_id, t.product_id, p.product_name from(select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rank_p from orders group by customer_id, product_id order by customer_id ) t left join products p on p.product_id = t.product_id where t.rank_p = 1
select t.customer_id, t.product_id, product_name from( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(*) desc) prank from orders group by 1,2) t join Products p on p.product_id = t.product_id where prank = 1
select t.customer_id, t.product_id, t.product_name from ( select c.customer_id, o.product_id, p.product_name, count(*), rank() over (partition by c.customer_id order by count(*) desc) as r from customers c inner join orders o on o.customer_id = c.customer_id inner join products p on p.product_id = o.product_id group by c.customer_id, o.product_id ) t where t.r=1
select t.customer_id, t.product_id, t.product_name from ( select o.customer_id, o.product_id, p.product_name, count(o.order_id) as counts, dense_rank() over (partition by o.customer_id order by count(o.order_id) desc) as r from orders o left join products p on p.product_id = o.product_id group by o.customer_id, o.product_id) as t where t.r=1
select t.customer_id, t.product_id, t.product_name from ( select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(*) desc) as r from Orders o inner join Products as p on o.product_id = p.product_id group by o.customer_id, o.product_id )t where t.r = 1
select t.customer_id, t.product_id, t.product_name from (select o.customer_id as customer_id, p.product_id as product_id, p.product_name as product_name, rank() over (partition by o.customer_id order by count(p.product_id) desc) cnt from orders o join products p on o.product_id=p.product_id GROUP BY o.customer_id, p.product_id ) t where t.cnt =1 order BY t.customer_id, t.product_id
select t.customer_id,t.product_id, t.product_name from (select a.customer_id,a.product_id,b.product_name, rank() over(partition by a.customer_id order by count(a.product_id) desc ) as rnk from Orders a left join Products b on a.product_id=b.product_id group by customer_id, product_id ) t where t.rnk=1 ORDER BY customer_id, product_id
select t1.customer_id, t1.product_id, product_name from ( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(product_id) desc) as r from orders group by customer_id, product_id ) t1 left join products on products.product_id = t1.product_id where t1.r = 1
select t1.customer_id, t1.product_id, product_name from ( select customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) as r from orders group by customer_id, product_id ) t1 left join products on products.product_id = t1.product_id where t1.r = 1
select t1.customer_id, t1.product_id, t2.product_name from (with temp as (select customer_id, product_id, count(order_date) as order_sum from Orders group by customer_id, product_id) select customer_id, product_id from temp where (temp.customer_id, temp.order_sum) in (select customer_id, max(order_sum) from temp group by customer_id ))t1 join Products t2 on t1.product_id = t2.product_id
select t1.customer_id,t1.product_id,p.product_name from (select customer_id,product_id,rank() over (partition by customer_id order by ord_cnt desc) as rnk from (select customer_id,product_id,count(order_id) ord_cnt from orders group by customer_id,product_id)t )t1 inner join products p on t1.product_id=p.product_id where t1.rnk=1
select t2.*, product_name from (select customer_id, product_id from (select *, rank() over(partition by customer_id order by count_product desc) as rank_product from (select customer_id, product_id, count(distinct order_id) as count_product from Orders group by customer_id, product_id) t) t1 where rank_product = 1) t2 left join Products p on t2.product_id = p.product_id
select t2.aa customer_id,t2.bb product_id,t2.cc product_name from (select t1.a aa,t1.b bb,t1.c cc, t1.cc d,dense_rank() over(partition by t1.a order by t1.cc desc) as rnk from (select c.customer_id a,o.product_id b,p.product_name c, count(product_name) cc from customers c join orders o on c.customer_id=o.customer_id join products p on o.product_id=p.product_id group by 1,2,3)t1)t2 where t2.rnk=1
select t2.customer_id as customer_id,t2.product_id as product_id, p.product_name as product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by ct desc) as ranking from (select customer_id, product_id, count(product_id) as ct from orders group by customer_id, product_id) as t1) as t2 left join products p on t2.product_id=p.product_id where t2.ranking=1
select t2.customer_id, t2.product_id, p.product_name from ( select customer_id, product_id, dense_rank() over (partition by customer_id order by purchase_times desc) as ranking from (select customer_id, product_id, count(order_id) as purchase_times from orders group by customer_id, product_id) as t1 ) as t2 join products as p on t2.product_id = p.product_id where t2.ranking=1
select t2.customer_id, t2.product_id, p.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by cnt desc)as rnk from ( select customer_id , product_id, count(order_id)as cnt from Orders group by 1,2 )t )t2 join products p on p.product_id = t2.product_id and t2.rnk=1
select t3.customer_id, t3.product_id, R.product_name from(select t1.id1 as 'customer_id', t1.id2 as 'product_id', t1.mycount from (select o1.customer_id as id1, o1.product_id as id2, COUNT(o1.order_id) as mycount from Orders o1 group by o1.customer_id, o1.product_id) as t1, Customers C where t1.id1= C.customer_id having t1.mycount = ( select max(t2.mycount1) from (select o2.customer_id as id3, o2.product_id as id4, COUNT(o2.order_id) as mycount1 from Orders o2 group by o2.customer_id, o2.product_id) as t2 where t2.id3 = t1.id1 )) as t3, Products R where t3.product_id = R.product_id
select t3.customer_id, t3.product_id, p.product_name from (select t1.customer_id, max(t1.ct_order) as max_num from (select customer_id, product_id, count(order_id) as ct_order from orders group by customer_id, product_id) t1 group by t1.customer_id) t2 join (select customer_id, product_id, count(order_id) as ct_order from orders group by customer_id, product_id) t3 on t2.customer_id = t3.customer_id and t2.max_num = t3.ct_order join products p on t3.product_id = p.product_id
select t3.customer_id, t3.product_id, p.product_name from (select t2.customer_id, t2.product_id from (select t.customer_id, t.product_id, dense_rank() over(partition by t.customer_id order by t.purchase desc) as `rank` from ( select customer_id, product_id, count(*) as purchase from Orders group by 1, 2 order by count(*) desc) as t) as t2 where `rank` = 1) as t3 join Products as p on p.product_id = t3.product_id
select t3.customer_id,t3.product_id,t3.product_name from (select customer_id,t2.product_id,product_name from (select customer_id,product_id from ( select customer_id, product_id, count(distinct order_id) as cnt, rank() over(partition by customer_id order by count(distinct order_id) desc) as rk from Orders group by 1,2 ) t1 where rk = 1 ) t2 left join Products on t2.product_id = Products.product_id) t3 join Customers on t3.customer_id = Customers.customer_id
select t4.product_name, t3.* from ( select customer_id, product_id from ( select *, rank() over (partition by customer_id order by num_orders desc) as rank_order from ( select customer_id, product_id, count(distinct(order_id)) as num_orders from Orders group by customer_id, product_id ) t1 ) t2 where rank_order = 1 ) t3 join Products t4 on t3.product_id = t4.product_id
select tab.customer_id, tab.product_id, p.product_name from (select t.customer_id, t.product_id, dense_rank() over(partition by t.customer_id order by t.Freq desc) 'Rank' from (select O.customer_id, O.product_id, count(*) Freq from Orders O group by O.customer_id, O.product_id) t) tab left join Products p on p.product_id = tab.product_id where tab.Rank = 1
select tab2.customer_id as customer_id, tab3.product_id as product_id,tab3.product_name as product_name from (select customer_id, max(fre) as frequency from ( select customer_id,count(*) as fre from Orders group by customer_id,product_id having count(product_id) >0 ) as tab1 group by customer_id) as tab2 left join (select customer_id,a.product_id,product_name, count(*) as time from Orders as a left join Products as b on a.product_id = b.product_id group by customer_id,a.product_id) as tab3 on tab2.frequency = tab3.time and tab2.customer_id= tab3.customer_id group by tab2.customer_id , tab3.product_id ,tab3.product_name
select tb2.customer_id,tb2.product_id,p.product_name from ( select customer_id,product_id,rank() over(partition by customer_id order by num_orders desc) as 'rank' from( select customer_id,product_id,count(product_id) as num_orders from Orders group by 1,2 having num_orders>=1 order by 1) tb) tb2 join Products p on tb2.product_id=p.product_id where tb2.rank=1
select tbl1.customer_id, tbl1.product_id, tbl2.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) order_rank from Orders group by customer_id, product_id ) tbl1 inner join Products tbl2 on tbl1.product_id = tbl2.product_id where tbl1.order_rank = 1 order by tbl1.customer_id
select tbl1.customer_id, tbl1.product_id, tbl2.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) order_rank from orders group by customer_id, product_id ) tbl1 inner join Products tbl2 on tbl1.product_id = tbl2.product_id where tbl1.order_rank = 1 order by tbl1.customer_id
select temp.customer_id, temp.product_id, Products.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) DESC) as rnk from Orders group by 1, 2) temp join Products on temp.product_id=Products.product_id where temp.rnk=1
select temp.customer_id, temp.product_id, p.product_name from (select customer_id, product_id, count(product_id) as product_count, rank() over(partition by customer_id order by count(product_id) desc) as rk from Orders group by customer_id, product_id) temp left join Products p using(product_id) where rk=1
select temp.customer_id, temp.product_id, p.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by count(distinct order_id) desc) as RK from Orders group by customer_id, product_id ) temp left join Products p on temp.product_id = p.product_id where temp.RK = 1
select temp.customer_id, temp.product_id, temp.product_name from (Select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id ) temp where rnk = 1 order by customer_id, product_id
select temp.customer_id, temp.product_id, temp.product_name from (select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o join Products p on o.product_id = p.product_id group by o.customer_id, o.product_id) temp where temp.rnk = 1
select temp1.customer_id,temp1.product_id,temp1.product_name from (select temp.customer_id,temp.product_id,temp.product_name,DENSE_RANK() OVER(PARTITION BY temp.customer_id ORDER BY temp.total desc) as rk from (select C.customer_id,O.product_id,P.product_name,count(*) as total from Customers C join Orders O on C.customer_id=O.customer_id join Products P on O.product_id=P.product_id group by C.customer_id,O.product_id,P.product_name) temp) temp1 where temp1.rk=1
select temp2.customer_id, temp2.product_id, product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by count(order_id) desc) as rk from Orders group by customer_id,product_id ) as temp2 left join Products on temp2.product_id = Products.product_id where rk=1
select temp2.customer_id, temp2.product_id, product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by sum_prod desc) as rk from ( select customer_id,product_id, count(order_id) as sum_prod from Orders group by customer_id,product_id ) as temp ) as temp2 left join Products on temp2.product_id = Products.product_id where rk=1
select tmp.customer_id,tmp.product_id,product_name from ( select customer_id,product_id,dense_rank() over (partition by customer_id order by count(product_id) desc) as most_frequent from orders group by customer_id,product_id )tmp inner join products on tmp.product_id = products.product_id where most_frequent = 1 order by tmp.customer_id
select tmp.customer_id,tmp.product_id,product_name from ( select customer_id,product_id,dense_rank() over (partition by customer_id order by count(product_id) desc) as rank_frequent from orders group by customer_id,product_id )tmp inner join products on tmp.product_id = products.product_id where rank_frequent = 1 order by tmp.customer_id
select x.*,p.product_name from (select customer_id,product_id from (select customer_id,product_id,rank() over(partition by customer_id order by cnt desc) as r from (select customer_id,product_id, sum(cnt) as cnt from (select order_date,customer_id,product_id, count(1) as cnt from Orders group by order_date,customer_id,product_id) x group by customer_id,product_id) x) x where x.r=1) x left join Products p on x.product_id=p.product_id order by customer_id
select z.customer_id, z.product_id,p.product_name from (select customer_id,product_id, dense_rank() over(partition by customer_id order by count(product_id) desc ) rnk from orders group by product_id,customer_id)z join Products p on p.product_id=z.product_id where z.rnk=1
select z.customer_id, z.product_id,p.product_name from (select customer_id,product_id, dense_rank() over(partition by customer_id order by count1 desc ) rnk from (select *, count(product_id) as count1 from orders group by product_id,customer_id )t)z join Products p on p.product_id=z.product_id where z.rnk=1
with CTE AS ( Select customer_id, product_id, count(*) as ct from Orders o group by customer_id, product_id ), CTE2 as ( Select c.*, DENSE_RANK() over(partition by c.customer_id order by ct DESC) as rk, p.product_name from CTE c left join Products p on c.product_id = p.product_id ) Select customer_id, product_id, product_name from CTE2 where rk = 1
with CTE as ( select *, rank() over(partition by customer_id order by n_purchase desc) as n_rank from (select o.customer_id, p.product_id, p.product_name, count(*) as n_purchase from orders o join products p on o.product_id = p.product_id group by 1, 2) a ) select customer_id, product_id, product_name from cte where n_rank=1
with CTE as ( select customer_id,product_id, rank() over (partition by customer_id order by quantity desc) as qty_rank from (select customer_id,product_id, count(order_id) as quantity from Orders group by 1,2) as a order by 1,3) select CTE.customer_id,CTE.product_id,product_name from CTE join Products on CTE.product_id = Products.product_id where qty_rank = 1
with CTE as ( select customer_id,product_id,cnt_product, max(cnt_product) over (partition by customer_id ) as max_product from (select customer_id, product_id,count(product_id) as cnt_product from Orders group by 1,2) a ) select c.customer_id,c.product_id,product_name from CTE c join Products p on c.product_id = p.product_id where cnt_product = max_product
with CTE as (select customer_id,product_id, count(product_id) as cnt from orders group by customer_id,product_id), cte2 as (select customer_id , product_id,cnt, rank() over(partition by customer_id order by cnt desc) as rnk from cte ) select cte2.customer_id , p.product_id, p.product_name from cte2 join products p on cte2.product_id = p.product_id where rnk =1
with CTE as (select o.customer_id, p.product_id,product_name, count(p.product_id) as counting, rank() over(partition by o.customer_id order by count(p.product_id) desc) as order_freq from orders o inner join products p on o.product_id=p.product_id group by o.customer_id,p.product_id) select customer_id,product_id,product_name from CTe where order_freq=1
with CTE as (select o.customer_id,o.product_id,p.product_name, count(*) as order_count from Orders o left join Products p on o.product_id=p.product_id group by 1,2 order by 1,2) select customer_id,product_id,product_name from CTE WHERE (customer_id,order_count) in (select customer_id,max(order_count) as order_count from cte group by customer_id)
with CTE1 as( select customer_id , product_id, dense_rank() over( partition by customer_id order by cnt_product desc ) as rnk from (select customer_id , product_id, count(*) as cnt_product from orders group by customer_id , product_id) a group by customer_id , product_id) select c1.customer_id, c1.product_id, product_name as product_name from CTE1 c1 join Products p on p.product_id = c1.product_id where rnk = 1
with O as (select customer_id, product_id, rank () over ( partition by customer_id order by count(*) desc) r from Orders group by customer_id, product_id ) select O.customer_id, O.product_id, P.product_name from O join Products P on O.product_id = P.product_id where O.r<2
with O as (select customer_id, product_id,count(*) c, rank () over ( partition by customer_id order by count(*) desc) r from Orders group by customer_id, product_id ) select O.customer_id, O.product_id, P.product_name from O join Products P on O.product_id = P.product_id where O.r<2
with OC as (select customer_id, product_id, count(*) as count_product from Orders O1 group by customer_id, product_id) select OC3.customer_id, OC3.product_id, P.product_name from ( select OC.customer_id, Oc.product_id from OC left join (select max(count_product) as max_count_product, customer_id, product_id from OC group by customer_id) as OC2 on OC.customer_id = OC2.customer_id where OC.count_product = OC2.max_count_product ) OC3 left join products P on OC3.product_id = P.product_id
with a as ( select customer_id, product_id, count(order_date) as order_times from orders group by 1,2), b as ( select a.customer_id, a.product_id, p.product_name, rank() over(partition by a.customer_id order by a.order_times desc) as rnk_num from a left join products p on a.product_id = p.product_id) select customer_id, product_id, product_name from b where rnk_num = 1
with a as ( select customer_id, product_id, count(product_id) as cnt from orders group by customer_id, product_id ), b as ( select customer_id, max(cnt) as m from a group by customer_id ) select a2.customer_id, a2.product_id, c2.product_name from a as a2 join b as b2 on a2.customer_id=b2.customer_id and a2.cnt = b2.m join Products as c2 on a2.product_id=c2.product_id
with a as (Select customer_id,product_id,count(*) as c from Orders group by customer_id,product_id ) select customer_id,p.product_id,product_name from (select customer_id,product_id,rank()over(partition by customer_id order by c desc) as r from a) x left join Products p on p.product_id=x.product_id where x.r=1
with a as (Select customer_id,product_id,count(order_id) as c from Orders group by customer_id,product_id) Select customer_id , b.product_id , product_name from (select customer_id,product_id,rank()over(partition by customer_id order by c desc) as r from a) as b join Products on b.product_id=Products.product_id where b.r=1
with a as (select c.customer_id, o.product_id, count(*) as quantity from customers c join orders o on o.customer_id = c.customer_id group by 1, 2) select customer_id, b.product_id, product_name from (select a.*, rank() over(partition by customer_id order by quantity desc) prod_rank from a) b join products p on p.product_id = b.product_id where b.prod_rank = 1
with a as (select c.customer_id, o.product_id, count(*) as quantity from customers c join orders o on o.customer_id = c.customer_id group by 1, 2), b as (select a.*, dense_rank() over(partition by customer_id order by quantity desc) prod_rank from a) select customer_id, b.product_id, product_name from b join products p on p.product_id = b.product_id where b.prod_rank = 1
with a as (select c.customer_id, o.product_id, count(o.product_id) as cnt from customers c inner join orders o on c.customer_id = o.customer_id group by c.customer_id, o.product_id) select tmp.customer_id, a.product_id, p.product_name from (select customer_id, max(cnt) as cnt from a group by customer_id) tmp inner join a on tmp.customer_id = a.customer_id and tmp.cnt = a.cnt inner join products p on a.product_id = p.product_id
with a as (select customer_id, product_id, count(product_id) num_orders from orders group by customer_id, product_id), b as (select customer_id, max(num_orders) max_num_orders from a group by customer_id) select a.customer_id, a.product_id, c.product_name from a join b on a.customer_id = b.customer_id and a.num_orders = b.max_num_orders join products c on a.product_id = c.product_id
with a as( select * from ( select customer_id, product_id, count(*) as total_order, rank() over (partition by customer_id order by count(*) desc) as rn_ from orders group by 1,2 order by 1, total_order desc) as a where rn_=1) select a.customer_id, a.product_id, c.product_name from a left join products c on a.product_id=c.product_id
with a as( select *, rank() over (partition by customer_id order by num_orders desc) as rk from ( select customer_id , product_id , count(order_id) as num_orders from orders group by customer_id, product_id) as t) select customer_id, product_id, (select product_name from products where product_id=a.product_id) as product_name from a where rk=1
with a as( select o.customer_id, o.product_id, p.product_name from Orders o join Products p on o.product_id = p.product_id), b as( select count(*) as c, customer_id, product_id from Orders group by customer_id, product_id), c as( select *, rank() over(partition by customer_id order by c desc) as r from b) select distinct a.* from a join c on a.customer_id = c.customer_id and a.product_id = c.product_id where r = 1 order by a.customer_id
with a as(select *,count(product_name) over(partition by customer_id,product_id) as c from Orders left join Products using(product_id)) select distinct customer_id,product_id,product_name from (select customer_id,product_id,product_name,rank() over(partition by customer_id order by c desc) as r from a) as t1 where r=1
with a1 as (Select customer_id,product_id, count(product_id) as cnt from orders group by customer_id,product_id), a2 as (Select customer_id,product_id, rank() over (partition by customer_id order by cnt desc) as rnk from a1), a3 as (Select a2.customer_id,a2.product_id,c.product_name from a2 left join products c on a2.product_id=c.product_id where rnk=1 ) Select * from a3
with abs as ( SELECT O.customer_id, O.product_id, P.product_name, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(O.product_id) DESC) AS rnk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id ) select customer_id, product_id, product_name from abs where rnk = 1
with amount_purchased as (select customer_id, product_id, count(product_id), rank() over(partition by customer_id order by count(product_id) desc) as ordered_rank from orders group by 1,2) select a.customer_id, a.product_id, p.product_name from amount_purchased a left join products p on a.product_id = p.product_id where a.ordered_rank = 1
with b as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from Orders group by 1, 2) select b.customer_id, b.product_id, a.product_name from Products a join b using (product_id) where rnk = 1
with base as ( select customer_id, product_id, count(order_id) as n_orders from Orders group by 1,2 ), most_order_customer as ( select customer_id, max(n_orders) as maxOrderCnt from base group by 1), productsls as ( select b.customer_id, b.product_id from base b inner join most_order_customer m on b.customer_id = m.customer_id and b.n_orders = m.maxOrderCnt) select p.customer_id, p.product_id, p2.product_name from productsls p inner join products p2 on p.product_id = p2.product_id
with base as ( select o.customer_id, o.product_id, p.product_name, count(*) as num_orders from orders o left join products p on o.product_id = p.product_id group by 1,2,3 ) select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, dense_rank() over( partition by customer_id order by num_orders desc ) as num_order_rank from base ) t where num_order_rank = 1
with base as( select customer_id, product_id, num_order, rank() over(partition by customer_id order by num_order desc) as rank0 from( select customer_id, product_id, count(order_id) as num_order from orders group by 1,2 ) sub ) select customer_id, b.product_id, product_name from (select * from base where rank0=1) b join products p on b.product_id = p.product_id
with c as ( select customer_id , product_id , count(product_id) as pc, rank() over (partition by customer_id order by count(product_id) desc) as cr from Orders group by customer_id , product_id ) select customer_id, c.product_id , p.product_name from c inner join Products p on c.product_id = p.product_id where cr = 1 order by 1,2
with c as ( select o.customer_id, o.product_id, rank() over(partition by o.customer_id order by count(product_id) desc) dn from orders o inner join customers c on c.customer_id = o.customer_id group by o.customer_id, o.product_id) select c.customer_id, c.product_id, p.product_name from c inner join products p on c.product_id = p.product_id where c.dn = 1
with cet as (select customer_id, product_id, dense_rank() over (partition by customer_id order by count(*) desc ) as rnk from orders group by customer_id, product_id) select c.customer_id, c.product_id , p.product_name from cet c, products p where c.product_id=p.product_id and rnk=1
with cnt_prod AS (select customer_id, product_id, count(product_id)as cnt from Orders group by customer_id, product_id) select a.customer_id, a.product_id, p.product_name from Products p join cnt_prod a on a.product_id = p.product_id where cnt IN( select max(cnt) from cnt_prod b where a.customer_id = b.customer_id )
with count_cte as ( SELECT customer_id,product_id,count(product_id) as counts FROM Orders GROUP BY customer_id, product_id ORDER BY customer_id), rank_cte as (SELECT customer_id, product_id, RANK() OVER (PARTITION BY customer_id ORDER BY counts DESC) r FROM count_cte) SELECT customer_id, Products.product_id, Products.product_name FROM rank_cte JOIN Products ON rank_cte.product_id = Products.product_id WHERE r = 1
with count_cte as ( Select * ,count(*) as total_num From Orders group by customer_id, product_id ), rnk_cte as ( Select *, DENSE_RANK() over(partition by customer_id order by total_num desc) as rnk from count_cte ) Select c.customer_id, c.product_id, p.product_name From rnk_cte c left join Products p on c.product_id = p.product_id where c.rnk=1
with count_max as ( select c.customer_id, c.product_id FROM ( SELECT customer_id, max(count) as max_count FROM (SELECT customer_id, product_id, count(order_id) as count FROM Orders GROUP BY customer_id, product_id) a GROUP BY customer_id ) b JOIN ( SELECT customer_id, product_id, count(order_id) as count FROM Orders GROUP BY customer_id, product_id ) c on b.customer_id = c.customer_id and b.max_count = c.count order by c.customer_id ) select m.customer_id, m.product_id, product_name from count_max m join products p on m.product_id = p.product_id
with count_product as (select customer_id, product_id, count(order_date) as cnt from orders group by 1,2) select a.customer_id, a.product_id, b.product_name from (select customer_id, product_id, dense_rank() over(partition by customer_id order by cnt desc) as rnk from count_product) a left join products as b on a.product_id=b.product_id where rnk=1
with count_products as (select customer_id, product_id, count(product_id) as cp from Orders group by customer_id, product_id) select x.customer_id, x.product_id, x.product_name from (select c.customer_id, cp.product_id, p.product_name, rank() over (partition by cp.customer_id order by cp.cp desc) as rank_count from count_products as cp join Customers as c on c.customer_id = cp.customer_id join Products as p on p.product_id = cp.product_id) as x where x.rank_count = 1
with count_products as (select customer_id, product_id, count(product_id) as cp from Orders group by customer_id, product_id) select x.customer_id, x.product_id, x.product_name from (select cp.customer_id, cp.product_id, p.product_name, rank() over (partition by cp.customer_id order by cp.cp desc) as rank_count from count_products as cp join Products as p on p.product_id = cp.product_id) as x where x.rank_count = 1
with counter as(select customer_id, product_id, count(*) as cnt from orders group by 1,2 ), popular as (select customer_id, max(cnt) as pop from counter group by 1) select a.customer_id, a.product_id, c.product_name from counter a inner join popular b on a.customer_id = b.customer_id and a.cnt = b.pop inner join products c on a.product_id = c.product_id
with counter as(select customer_id, product_id, count(*) as cnt from orders group by 1,2 ), popular as (select customer_id, max(cnt) as pop from counter group by 1) select a.customer_id, a.product_id, c.product_name from counter a inner join popular b on a.customer_id = b.customer_id inner join products c on a.product_id = c.product_id where a.cnt = b.pop
with ct as ( select customer_id,product_id, count(product_id) as freq from orders group by customer_id,product_id ), ct2 as ( select customer_id,product_id from ( select customer_id,product_id,freq , dense_rank() over(partition by customer_id order by freq desc) as rnk from ct ) tmp where rnk = 1 ) select ct2.customer_id,ct2.product_id, prd.product_name from ct2 join Products as prd on prd.product_id = ct2.product_id
with ct as (select customer_id, product_id, count(*) as freq from orders group by customer_id, product_id) select ct.customer_id, ct.product_id, product_name from ct join (select customer_id, max(freq) as freq from ct group by customer_id ) max_ct on ct.customer_id = max_ct.customer_id and ct.freq = max_ct.freq join Products on Products.product_id = ct.product_id
with ct as (select customer_id, product_id, rank()over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id) select c.customer_id, c.product_id, p.product_name from ct c left join products p on c.product_id = p.product_id where c.rnk = 1
with ct as (select customer_id, product_id,rank() over (partition by customer_id order by count(product_id) desc ) as rnk from orders group by customer_id,product_id) select c.customer_id,c.product_id, p.product_name from ct c left join products p on c.product_id=p.product_id where c.rnk=1
with ct as (select customer_id,product_id,rank() over (partition by customer_id order by count(product_id)desc)as rnk from orders group by customer_id, product_id) select c.customer_id,c.product_id,p.product_name from ct c left join products p on c.product_id=p.product_id where c.rnk=1
with cte as ( SELECT *, DENSE_RANK()OVER(PARTITION BY customer_id ORDER BY count(*) DESC) as 'RNK' FROM Orders GROUP BY customer_id, product_id) SELECT customer_id, product_id, product_name FROM cte JOIN Products USING(product_id) WHERE RNK=1
with cte as ( SELECT *, DENSE_RANK()OVER(PARTITION BY customer_id ORDER BY count(o.product_id) DESC) as 'RNK' FROM Orders o LEFT JOIN Products p USING(product_id) GROUP BY customer_id, product_id) SELECT customer_id, product_id ,product_name FROM cte WHERE RNK=1
with cte as ( SELECT C.customer_id, O.product_id, P.product_name, RANK() OVER (PARTITION BY c.customer_id ORDER BY COUNT(o.product_id) desc) as product_rank from Orders O left join Customers C on C.customer_id = O.customer_id left join Products P on P.product_id = O.product_id GROUP BY C.customer_id, O.product_id ) Select distinct customer_id, product_id, product_name from cte where product_rank = 1
with cte as ( SELECT Customers.customer_id, Products.product_id, Products.product_name, RANK() OVER(PARTITION BY Customers.customer_id ORDER BY COUNT(PRoducts.product_id) DESC) as rnk FROM Customers inner join Orders on Customers.customer_id = Orders.customer_id inner join products on Orders.product_id = Products.product_id GROUP BY Customers.customer_id, Products.product_id ) SELECT customer_id, product_id, product_name FROM cte WHERE rnk = 1
with cte as ( select *, dense_rank() over (partition by customer_id order by cnt_prod desc) as rnk from ( select customer_id, product_id, count(product_id) as cnt_prod from Orders group by customer_id, product_id order by customer_id asc, cnt_prod desc ) abc ) select customer_id, cte.product_id, p.product_name from cte join Products p on cte.product_id = p.product_id where rnk = 1
with cte as ( select c.customer_id, p.product_id, p.product_name, count(1) as cnt from customers c inner join orders o on c.customer_id = o.customer_id inner join products p on o.product_id = p.product_id group by c.customer_id, p.product_id, p.product_name ) select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, rank() over(partition by customer_id order by cnt desc) rnk from cte) t where rnk = 1
with cte as ( select customer_id , product_id , dense_rank() over(partition by customer_id order by count(product_id) desc) as ranking from orders group by 1,2 ) select distinct customer_id , product_id , product_name from cte left join Products using (product_id) where ranking = 1
with cte as ( select customer_id, count(product_id) num, product_id from orders group by customer_id,product_id) select tbl.customer_id, tbl.product_id, p.product_name from ( select customer_id, product_id, rank()over(partition by customer_id order by num desc) rk from cte) tbl join Products p on tbl.product_id = p.product_id where tbl.rk = 1
with cte as ( select customer_id, product_id, count(*) as cnt from Orders group by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from cte c join Products p on c.product_id = p.product_id where cnt in (select max(cnt) from cte b where b.customer_id = c.customer_id)
with cte as ( select customer_id, product_id, count(*) as cnt, rank() over (partition by customer_id order by count(*) desc) as rnk from orders group by 1,2 ) select a.customer_id, a.product_id, products.product_name from cte as a left join products on products.product_id = a.product_id where a.rnk = 1
with cte as ( select customer_id, product_id, count(*) as frequency from orders group by customer_id, product_id), cte1 as ( select customer_id, product_id, frequency, rank() over (partition by customer_id order by frequency desc) as r from cte) select t1.customer_id, t1.product_id, t2.product_name from cte1 as t1 left join products as t2 on t1.product_id = t2.product_id where r = 1 order by t1.customer_id, t1.product_id
with cte as ( select customer_id, product_id, count(*) as num from Orders group by 1,2 ) select cte.customer_id,p.product_id,p.product_name from cte join products p on cte.product_id=p.product_id where (cte.customer_id,cte.num) in( select customer_id, max(num) from cte group by 1 )
with cte as ( select customer_id, product_id, count(*) as num_purch from orders group by 1, 2 ) select a.customer_id, a.product_id, p.product_name from cte a join products p on a.product_id=p.product_id where num_purch in (select max(num_purch) from cte b where b.customer_id=a.customer_id)
with cte as ( select customer_id, product_id, count(order_date) ct from orders group by customer_id, product_id) select customer_id, temp.product_id, product_name from products p, ( select customer_id, product_id, ct, dense_rank() over(partition by customer_id order by ct desc) as rk from cte) temp where temp.product_id=p.product_id and rk=1
with cte as ( select customer_id, product_id, count(order_id) 'f' from orders group by 1,2 ) select customer_id, agg.product_id, p.product_name from ( select customer_id, product_id, rank() over(partition by customer_id order by f desc) 'r' from cte ) agg join products p on agg.product_id = p.product_id where agg.r=1
with cte as ( select customer_id, product_id, count(order_id) as cnt from orders group by 1,2 ) select c.customer_id, c.product_id, products.product_name from cte c, products where c.product_id = products.product_id and c.cnt = (select max(cnt) from cte where c.customer_id = customer_id) order by c.customer_id
with cte as ( select customer_id, product_id, count(product_id) as cnt from orders group by customer_id, product_id), cte2 as ( select *, dense_rank() over(partition by customer_id order by cnt desc) as rnk from cte) select customer_id, cte2.product_id, product_name from cte2 left join products p on cte2.product_id= p.product_id where rnk=1
with cte as ( select customer_id, product_id, count(product_id) as ct from orders group by customer_id, product_id ), cte_rk as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by ct desc) as rk from cte ) select c.customer_id, c.product_id, p.product_name from cte_rk as c join products as p on c.product_id = p.product_id where c.rk = 1
with cte as ( select customer_id, product_id, count(product_id) as product_freq from orders group by customer_id, product_id ), max_freq as ( select customer_id, max(product_freq) as max_product_freq from cte group by customer_id ), best_pdt as ( select cte.customer_id, cte.product_id from cte JOIN max_freq on cte.customer_id = max_freq.customer_id where product_freq = max_product_freq ) select best_pdt.customer_id, best_pdt.product_id, p.product_name from best_pdt JOIN products p ON best_pdt.product_id = p.product_id
with cte as ( select customer_id, product_id, count(product_id), dense_rank() over (partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id, product_id ) select cte.customer_id, cte.product_id, Products.product_name from cte left join Products on cte.product_id=Products.product_id where cte.rnk=1
with cte as ( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(order_id) desc) as rnk from orders group by customer_id, product_id ) select customer_id, cte.product_id, p.product_name from cte left join products p on cte.product_id = p.product_id where rnk = 1
with cte as ( select customer_id, product_id, dense_rank() over (partition by customer_id order by ct desc) rk from ( select customer_id, product_id,count(*) as ct from orders group by customer_id, product_id ) a) select cte.customer_id, cte.product_id, p.product_name from cte left join products p on p.product_id=cte.product_id where rk=1
with cte as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(order_id) desc) as sales_rnk from orders group by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from cte c join products p on c.product_id = p.product_id where c.sales_rnk = 1
with cte as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) as rn from Orders group by customer_id, product_id ) select customer_id, p.product_id, product_name from Products p join cte c on p.product_id = c.product_id where rn = 1
with cte as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id ) select customer_id, cte.product_id, product_name from cte left join products p on cte.product_id= p.product_id where rnk=1
with cte as ( select customer_id, product_id, rank() over(partition by customer_id order by cnt desc) as rnk from( select customer_id, product_id, count(order_date) as cnt from Orders group by 1, 2 )t ) select customer_id, c.product_id, p.product_name from cte c left join Products p on c.product_id = p.product_id where rnk = 1
with cte as ( select customer_id, product_id, rank() over(partition by customer_id order by count(1) DESC) AS RK from orders group by customer_id, product_id ) select customer_id, o.product_id, product_name from cte o join products p on o.product_id = p.product_Id where rk = 1
with cte as ( select customer_id, product_id, rank() over(partition by customer_id order by count(order_id) desc) as rank_prod from Orders group by 1,2 ) select customer_id, P.product_id, P.product_name from cte join Products P on cte.product_id = P.product_id where rank_prod = 1
with cte as ( select customer_id, product_id, rank() over(partition by customer_id order by count(order_id) desc) as rnk from Orders group by customer_id, product_id) select C.customer_id, C.product_id, P.product_name from cte C join Products P on C.product_id = P.product_id where rnk = 1
with cte as ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id ) select cte.customer_id, cte.product_id, p.product_name from cte join products p using(product_id) where cte.rnk = 1
with cte as ( select customer_id,product_id, count(product_id) as cnt from orders group by customer_id, product_id ) select c.customer_id, c.product_id, p.product_name from cte c left join products p on c.product_id = p.product_id where (customer_id, cnt) in (select customer_id,max(cnt) from cte group by customer_id)
with cte as ( select customer_id,product_id,count(*) as c,rank() over( partition by customer_id order by count(*) desc) as rn from Orders group by customer_id,product_id ) select cte.customer_id,cte.product_id,product_name from cte join Products on Products.product_id = cte.product_id where rn = 1
with cte as ( select customer_id,product_id,count(*) as count from orders group by customer_id,product_id ), demo as ( select customer_id,product_id,count, rank() over (partition by customer_id order by count desc) as rnk from cte ) select d.customer_id,d.product_id,p.product_name from demo as d join products as p on d.product_id=p.product_id where rnk=1
with cte as ( select customer_id,product_id,product_name,rank() over(partition by customer_id order by count(orders.product_id)desc)rnk from orders join products using (product_id) group by 1,2 ) select customer_id,product_id,product_name from cte where rnk=1 order by 1,2
with cte as ( select customer_id,product_id,rank()over(partition by customer_id order by unit desc) as r from ( select customer_id,product_id,count(product_id) as unit from orders group by 1,2)o) select cte.customer_id,cte.product_id,product_name from cte join products p on p.product_id=cte.product_Id where cte.r=1
with cte as ( select o.customer_id , o.product_id , p.product_name , count(o.order_id) as n , rank() over (partition by customer_id order by count(o.order_id) desc) as ranking from orders o, products p where o.product_id = p.product_id group by 1,2,3 order by 1) select customer_id , product_id , product_name from cte where ranking = 1
with cte as ( select o.customer_id, o.product_id, dense_rank() over(partition by o.customer_id order by count(product_id) desc) dn from orders o group by o.customer_id, o.product_id ) select c1.customer_id, c1.product_id, p.product_name from cte c1 inner join products p on p.product_id = c1.product_id where c1.dn = 1
with cte as ( select o.product_id, p.product_name, c.customer_id, c.name, p.price from Customers c join Orders o on c.customer_id = o.customer_id join Products p on o.product_id = p.product_id order by c.customer_id ), cnt as ( select customer_id, product_id, product_name, count(*) as cnt, max(price) as price from cte group by 1,2 order by 1 ), rnk as ( select customer_id, product_id, product_name, dense_rank() over(partition by customer_id order by cnt desc) as rnk from cnt ) select customer_id,product_id,product_name from rnk where rnk=1 order by 1
with cte as ( select product_id , customer_Id, count(distinct order_date) as cnt from orders group by 1,2 ) ,cte2 as ( select * from (select customer_Id,product_id, cnt, rank()over (partition by customer_id order by cnt desc) as rnk from cte ) cte where rnk = 1 ) select cte2.customer_id,cte2.product_id, Products.product_name from cte2 left join Products on products.product_id = cte2.product_id
with cte as ( select product_id, customer_id, count(order_date) as total from orders group by 1,2 ) , cte2 as ( select product_id,customer_id, rank() over (partition by customer_id order by total desc) as total_rank from cte ) select a.product_id, a.customer_id, product_name from cte2 a left join products b on a.product_id = b.product_id where total_rank =1
with cte as ( with cte as ( Select distinct c.customer_id,p.product_id,p.product_name,c.name, count(o.order_id) over(partition by p.product_id,c.customer_id) as 'cnt' from Customers c inner join Orders o on c.customer_id = o.customer_id inner join Products p on o.product_id = p.product_id order by customer_id ) Select * , rank() over(partition by customer_id order by cnt desc) as 'rnk' from cte ) Select customer_id,product_id,product_name from cte where rnk = 1
with cte as (SELECT customer_id , product_id, count(product_id) product_count FROM Orders GROUP BY customer_id , product_id), cte2 as ( SELECT customer_id , product_id, rank() over (partition by customer_id order by product_count desc) cust_prod_rank FROM cte ) select customer_id,cte2.product_id,p.product_name from cte2 join Products as p on p.product_id = cte2.product_id where cte2.cust_prod_rank=1
with cte as (SELECT o.customer_id ,o.product_id ,p.product_name ,count(o.product_id) as num FROM Orders o LEFT JOIN Products p on o.product_id = p.product_id group by o.customer_id ,p.product_name) SELECT customer_id ,product_id ,product_name FROM (SELECT customer_id ,product_id ,product_name ,dense_rank()over(partition by customer_id order by num desc) as rn from cte ) t where rn = 1
with cte as (select *, rank()over(partition by customer_id order by count(product_id) desc) as ranks from orders group by customer_id, product_id) select customer_id, p.product_id, product_name from (select customer_id, product_id from cte where ranks = 1)t join products as p using (product_id)
with cte as (select C.customer_id , P.product_id , P.product_name , count(distinct O.order_id) as oct from Customers C join Orders O on C.customer_id=O.customer_id join Products P on O.product_id=P.product_id group by 1,2,3 order by 4 desc ), cte2 as (select *, rank() over(partition by customer_id order by oct desc)as rownum from cte) select customer_id, product_id, product_name from cte2 where rownum=1
with cte as (select a.customer_id, b.product_id, product_name, count(*) as p_count from customers a join orders b on a.customer_id = b.customer_id join products c on b.product_id = c.product_id group by 1,2,3 ) select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over(partition by customer_id order by p_count desc) as p_rank from cte ) as c where p_rank = 1
with cte as (select c.customer_id, p.product_id, p.product_name, COUNT(*) as counts FROM Customers c JOIN Orders o on c.customer_id = o.customer_id JOIN Products p ON o.product_id = p.product_id GROUP BY 1,2,3) select customer_id,product_id,product_name FROM (select customer_id,product_id,product_name,DENSE_RANK() OVER(PARTITION By customer_id ORDER BY counts DESC) as rnk from cte) temp where temp.rnk = 1
with cte as (select customer_id, o.product_id, product_name, count(o.product_id) as cnt from Orders o join Products p on o.product_id = p.product_id group by customer_id, o.product_id) select customer_id, product_id, product_name from (select customer_id, product_id, product_name, cnt from cte where (customer_id, cnt) in (select customer_id, max(cnt) from cte group by customer_id)) tmp
with cte as (select customer_id, o.product_id,product_name, rank() over( partition by customer_id order by count(o.product_id) desc) as rn from orders o inner join products p on p.product_id = o.product_id group by customer_id,product_id) select customer_id, product_id,product_name from cte where rn = 1
with cte as (select customer_id, product_id, count(*) as cnt from Orders group by customer_id, product_id) select a.customer_id,cte.product_id, p.product_name from (select customer_id, max(cnt) as mf from cte group by customer_id) a inner join cte on a.customer_id = cte.customer_id and a.mf =cte.cnt inner join Products p on p.product_id = cte.product_id
with cte as (select customer_id, product_id, count(*) as number from orders group by 1,2), cte_1 as (select *, dense_rank()over(partition by customer_id order by number desc) as 'rank' from cte) select customer_id, product_id, product_name from cte_1 join products using (product_id) where cte_1.rank = 1
with cte as (select customer_id, product_id, count(*) as times from orders group by customer_id, product_id), b as (select customer_id, max(times) as max_time from cte group by customer_id) select b.customer_id, p.product_id, p.product_name from b join cte as c on b.customer_id = c.customer_id and b.max_time = c.times join products as p on c.product_id = p.product_id
with cte as (select customer_id, product_id, count(product_id) as ct from Orders group by customer_id, product_id), cte2 as (select *, dense_rank() over(partition by customer_id order by ct desc) as rn from cte) select a.customer_id,p.product_id, p.product_name from cte2 a join products p on a.product_id = p.product_id where a.rn =1
with cte as (select customer_id, product_id, rank() over (partition by customer_id order by order_total desc) as rnk from (select customer_id, product_id, count(*) as order_total from Orders group by 1, 2 order by 1, 2) as a) select cte.customer_id, cte.product_id, p.product_name from cte join Products p on cte.product_id = p.product_id where cte.rnk = 1
with cte as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id, product_id) select customer_id, c.product_id, product_name from cte c join Products p on rnk =1 and c.product_id = p.product_id
with cte as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) rk from orders o group by 1,2) select c.customer_id, c.product_id, p.product_name from cte c join products p on c.product_id = p.product_id where rk = 1 order by 1,2
with cte as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) rnk from orders group by customer_id, product_id ) select customer_id, p.product_id, product_name from cte, products p where cte.product_id = p.product_id and rnk = 1 order by customer_id, p.product_id
with cte as (select customer_id,product_id,count(*) as CNT from orders group by customer_id,product_id order by customer_id,CNT desc), cte1 as (select customer_id,product_id,CNT, rank() over(partition by customer_id order by CNT desc) as ranking from cte) select customer_id,a.product_id,product_name from cte1 a join products b on a.product_id=b.product_id where ranking=1
with cte as (select o.customer_id, o.product_id, p.product_name, dense_rank() over (partition by o.customer_id order by count(o.product_id) desc ) as r from orders o left join customers c on o.customer_id = c.customer_id left join products p on p.product_id = o.product_id group by 1,2,3) select customer_id, product_id, product_name from cte where r = 1
with cte as (select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o, Products p where o.product_id = p.product_id group by o.customer_id, o.product_id) select customer_id, product_id, product_name from cte where rnk =1
with cte as (select o.customer_id, o.product_id, p.product_name, rank()over(partition by o.customer_id order by count(o.product_id) desc) as rnk from orders o, products p where o.product_id = p.product_id group by 1,2) select customer_id, product_id, product_name from cte where rnk = 1
with cte as (select o.customer_id, o.product_id,p.product_name, count(o.product_id) as tot from Orders as o left join products as p using(product_id) group by o.customer_id, o.product_id,p.product_name ) ,cte2 as (select customer_id, product_id, product_name , dense_rank() over (partition by customer_id order by tot desc) as rnk from cte) select customer_id, product_id, product_name from cte2 where rnk=1
with cte as (select o.order_id,o.customer_id,p.product_id, p.product_name,dense_rank()over(partition by customer_id order by count(order_id)desc) as rnk from Orders o join Products p using (product_id) group by p.product_id,o.customer_id) select customer_id, product_id, product_name from cte where rnk=1
with cte as( select c.customer_id,o.product_id, p.product_name, count(o.product_id) as p_count from customers c inner join orders o on c.customer_id=o.customer_id inner join products p on o.product_id= p.product_id group by 1,2,3) select customer_id, product_id,product_name from ( select customer_id, product_id,product_name, rank() over (partition by customer_id order by p_count desc) as rn from cte) t where rn=1
with cte as( select customer_id, product_id, count(*) as purchasing_time from orders group by customer_id, product_id ), w1 as( select customer_id, product_id, purchasing_time, dense_rank() over(partition by customer_id order by purchasing_time desc) as rankings from cte ) select w1.customer_id, w1.product_id, p.product_name from w1 join products p on w1.product_id=p.product_id where w1.rankings=1
with cte as( select customer_id, product_id, count(order_id) as cnt from Orders group by customer_id, product_id), cte2 as( select customer_id, product_id, rank() over (partition by customer_id order by cnt desc) as rnk from cte) select customer_id, a.product_id, product_name from cte2 a left join Products b on a.product_id = b.product_id where rnk = 1
with cte as( select customer_id, product_id, count(order_id) as prdcnt from orders group by customer_id, product_id ) select o.customer_id,o.product_id, p.product_name from( select customer_id,product_id, dense_rank()OVER(partition by customer_id order by prdcnt desc) as prdrank from cte )o JOIN products as p using (product_id) where o.prdrank=1
with cte as( select customer_id, product_id, dense_rank () over (partition by customer_id order by count(product_id) desc) as rnk from orders group by 1,2) select customer_id, product_id, product_name from cte join products p using(product_id) where rnk = 1
with cte as( select customer_id, product_id, dense_rank()over(partition by customer_id order by count(order_id) desc) as frequency from Orders group by 1,2 ) select c.customer_id, o.product_id, p.product_name from Customers c join ( select customer_id, product_id from cte where frequency = 1) o on c.customer_id = o.customer_id join Products p on o.product_id = p.product_id
with cte as( select customer_id,orders.product_id,product_name, count(*) as num from orders left join products on orders.product_id=products.product_id group by customer_id,orders.product_id ) , cte_1 as ( select customer_id,product_id,product_name,num,dense_rank() over(partition by customer_id order by num desc) as rnk from cte ) select customer_id,product_id,product_name from cte_1 where rnk=1
with cte as( select customer_id,product_id,dense_rank()over(partition by customer_id order by count(order_id) desc)as freq from Orders group by customer_id,product_id ) select c.customer_id,c.product_id,p.product_name from cte c left join products p on c.product_id = p.product_id where freq = 1
with cte as( select o.customer_id, o.product_id, count(*) over(partition by o.product_id,o.customer_id) as Product_count from orders o join customers c on o.customer_id = c.customer_id ) select distinct c.customer_id, c.product_id, p.product_name from cte c join products p on c.product_id=p.product_id where c.Product_count= (select max(cc.Product_count) from cte cc where cc.customer_id=c.customer_id) order by c.customer_id, p.product_name
with cte as( select o.customer_id,o.product_id,p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from orders o join products p on o.product_id = p.product_id group by 1,2) select customer_id,product_id,product_name from cte where rnk = 1
with cte as(select customer_id, product_id, count(product_id) as cnt from orders group by customer_id, product_id) select a.customer_id, a.product_id, p.product_name from cte a join products p on a.product_id=p.product_id where cnt in (select max(cnt) from cte b where a.customer_id=b.customer_id)
with cte as(select o.customer_id, p.product_id, p.product_name, count(o.order_id) as order_count from orders o join products p on p.product_id = o.product_id group by o.customer_id, p.product_name, o.product_id) select customer_id, product_id, product_name from cte where order_count in (select max(order_count) from cte x where x.customer_id = cte.customer_id)
with cte1 as ( select c.customer_id , o.product_id , p.product_name , count(distinct o.order_date) as order_cnt from customers as c inner join orders as o using (customer_id) inner join products as p using (product_id) group by 1, 2, 3 ), cte2 as ( select customer_id , max(order_cnt) as max_order_cnt from cte1 group by 1 ) select customer_id , product_id , product_name from cte1 where (customer_id, order_cnt) in (select * from cte2)
with cte1 as ( select customer_id , product_id , count(order_id) as no_orders , rank() over(partition by customer_id order by count(order_id) desc) as req_rank from orders group by 1,2 ) select cte1.customer_id , cte1.product_id , p.product_name from cte1 inner join products p on cte1.product_id = p.product_id where cte1.req_rank =1 order by 1
with cte1 as ( select customer_id, product_id, count(*) as cnt from Orders group by customer_id, product_id ) , cte2 as ( select customer_id, max(cnt) as cnt from cte1 group by customer_id ) select c1.customer_id, c1.product_id, p.product_name from cte1 c1 join cte2 c2 on c1.customer_id = c2.customer_id and c1.cnt = c2.cnt join Products p on c1.product_id = p.product_id
with cte1 as ( select customer_id, product_id, count(*) freq from Orders group by customer_id, product_id), cte2 as (select customer_id, max(freq) highest_freq from cte1 group by 1) select c1.customer_id, c1.product_id, p.product_name from cte1 c1 join cte2 c2 on c1.customer_id = c2.customer_id and c1.freq = c2.highest_freq join Products p on c1.product_id = p.product_id
with cte1 as ( select customer_id, product_id, count(order_id) as count from Orders group by customer_id , product_id ), cte2 as ( select customer_id, max(count) as max_count from cte1 group by customer_id ), result as ( select A.customer_id, A.product_id, C.product_name from cte1 as A join cte2 as B on A.customer_id = B.customer_id and A.count = B.max_count join Products C on A.product_id = C.product_id ) select * from result
with cte1 as (select customer_id , product_id, count(1) as nb from orders group by 1, 2 order by 1), cte2 as (select *, max(nb) over(partition by customer_id) as max from cte1) select a.customer_id , a.product_id, b.product_name from cte2 a left join products b on a.product_id=b.product_id where a.nb = a.max
with cte1 as (select customer_id ,product_id,count(product_id) as total from Orders group by customer_id,product_id), cte2 as ( select *,dense_rank() over (partition by customer_id order by total desc) as rnk from cte1) select a.customer_id , b.product_id , b.product_name from cte2 a join products b ON a.product_id=b.product_id where a.rnk=1
with cte1 as (select customer_id ,product_id,count(product_id) as total from Orders group by customer_id,product_id), cte2 as ( select customer_id,product_id,dense_rank() over (partition by customer_id order by total desc) as rnk from cte1) select a.customer_id , b.product_id , b.product_name from cte2 a inner join products b ON a.product_id=b.product_id and a.rnk=1
with cte1 as (select customer_id, product_id, count(*) as counts from Orders group by customer_id, product_id), cte2 as (select *, max(counts) over (partition by customer_id) as max_counts from cte1) select customer_id, cte2.product_id, product_name from cte2 inner join Products on cte2.product_id = Products.product_id where max_counts = counts
with cte2 as ( select customer_id, product_id, rank()over(partition by customer_id order by product_count desc) as rank_p from ( select customer_id, product_id, count(product_id) as product_count from orders group by customer_id,product_id) cte1 ) select a.customer_id, a.product_id, b.product_name from cte2 a left join products b on a.product_id = b.product_id where a.rank_p =1
with cte_1 as ( select a.customer_id, product_id, count(order_id) as order_cnt from Customers a join Orders b on a.customer_id = b.customer_id group by a.customer_id, product_id ), cte_2 as ( select customer_id, product_id, rank()over(partition by customer_id order by order_cnt desc) as rnk from cte_1 ) select a.customer_id, a.product_id, product_name from cte_2 a join Products b on a.product_id = b.product_id where rnk =1
with ctes as(select customer_id,product_id,count(product_id) as cnt from orders group by customer_id,product_id) SELECT t.customer_id,t.product_id,product_name from (select *,rank() over(partition by customer_id order by cnt desc ) as rnk from ctes) t inner join customers c on c.customer_id = t.customer_id inner join products p on p.product_id = t.product_id where t.rnk =1
with cust_prod_count as (select customer_id, product_id, count(product_id) pcount from Orders group by customer_id, product_id order by customer_id), cust_maxbuy as(select customer_id, max(pcount)as mcount from cust_prod_count group by customer_id) select p.customer_id, p.product_id, n.product_name from (select c.customer_id, c.product_id, c.pcount from cust_prod_count c, cust_maxbuy d where c.customer_id = d.customer_id and c.pcount = d.mcount)p, products n where p.product_id = n.product_id
with customer_product as ( select o.customer_id , o.product_id , p.product_name , count(1) order_cnt , rank() over(partition by o.customer_id order by count(o.product_id) desc) as ranking from Orders o left join Products p on p.product_id = o.product_id group by o.customer_id, o.product_id, p.product_name ) select customer_id , product_id , product_name from customer_product where ranking = 1
with customer_products_count as (select count(product_id) as product_count, customer_id, product_id from Orders group by 2,3 ) select O.customer_id, O.product_id,P.product_name from (select customer_id, product_id, rank() over (partition by customer_id order by product_count desc) as product_rank from customer_products_count ) as O join Products as P on O.product_id = P.product_id where product_rank = 1
with customer_totals as ( select count(o.order_id) as item_count, o.customer_id, o.product_id, p.product_name from Orders o inner join Products p on p.product_id = o.product_id group by product_id, customer_id ), rank_products as ( select item_count, customer_id, product_id, product_name, RANK() OVER ( PARTITION BY customer_id ORDER BY item_count DESC ) order_value_rank from customer_totals ) select customer_id, product_id, product_name from rank_products where order_value_rank = 1
with data_needed as (select customer_id, product_id, product_name, rank()over(partition by customer_id order by num_orders desc) as ranking from (select customer_id, o.product_id, p.product_name, count(o.product_id) as num_orders from orders o join products p on o.product_id = p.product_id group by 1,2) t group by 1,2) select customer_id, product_id, product_name from data_needed where ranking =1
with ds as ( select a.customer_id, a.product_id, rank() over (partition by a.customer_id order by a.cnt desc) rnk from ( select customer_id, product_id, count(order_id) cnt from Orders group by customer_id, product_id ) a ) select ds.customer_id customer_id, p.product_id product_id, p.product_name product_name from ds inner join products p where ds.product_id = p.product_id and ds.rnk = 1
with f AS (SELECT c.customer_id, p.product_id, p.product_name, COUNT(*) AS freq FROM Customers c JOIN Orders o ON c.customer_id = o.customer_id JOIN Products p ON o.product_id = p.product_id GROUP BY 1,2), most AS (SELECT *, RANK() OVER (PARTITION BY customer_ID ORDER BY freq DESC) AS rnk FROM f) SELECT customer_id, product_id, product_name FROM most WHERE rnk = 1
with freq as( select product_id, customer_id, count(customer_id) as cnt, rank() over(partition by customer_id order by count(customer_id) desc) as r_num from orders group by 1,2 ) select customer_id, freq.product_id, product_name from freq join products p on freq.product_id = p.product_id where r_num = 1 group by 1,2 order by 1
with frequency as ( select customer_id , product_id , count(distinct order_id) as num_orders , rank() over (partition by customer_id order by count(distinct order_id) desc) as rnk from orders group by 1,2 ) , most_freq as ( select customer_id , product_id from frequency where 1=1 and rnk = 1 ) select mf.* , p.product_name from most_freq mf join products p on p.product_id = mf.product_id
with frequency as (Select customer_id, product_id, rank() over (partition by customer_id order by count(order_id) desc) as rk From Orders Group by customer_id, product_id) Select f.customer_id, f.product_id, p.product_name From frequency as f Join Products as p on f.product_id = p.product_id where f.rk = 1
with frequency as( select customer_id,product_id,count(*) as total_times from orders group by customer_id,product_id), temp_table as( select o.customer_id,o.product_id,rank() over(partition by customer_id order by o.total_times desc) as d_rank,p.product_name from frequency o join products p on o.product_id=p.product_id) select customer_id,product_id,product_name from temp_table where d_rank=1
with grouped_cnt as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id) SELECT TT.customer_id,TT.product_id,P.product_name from (SELECT customer_id,product_id,rank() over(partition by customer_id order by cnt desc )as rnk FROM grouped_cnt ) TT left join Products as P on TT.product_id=P.product_id where TT.rnk=1
with grouped_cnt as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id) select c.customer_id, e.product_id, e.product_name from (select customer_id, product_id from ( select customer_id, product_id, dense_rank() over (partition by customer_id order by cnt desc) as rn from grouped_cnt a)b where b.rn = 1)c left join products e on e.product_id = c.product_id
with grouped_cnt as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id) select customer_id, a.product_id, product_name from grouped_cnt a join products p on p.product_id = a.product_id where cnt in (select max(cnt) as cnt from grouped_cnt b where a.customer_id = b.customer_id)
with joined_source as ( select o.customer_id, p.product_id, p.product_name, count(*) as num_orders from Orders o join Products p on o.product_id = p.product_id group by customer_id,product_id ), ranked_table as ( select customer_id, product_id, product_name, rank() over(partition by customer_id order by num_orders desc) as sales_rank from joined_source ) select customer_id, product_id, product_name from ranked_table where sales_rank = 1
with main as ( select customer_id,product_id from (select customer_id, product_id, dense_rank() over (partition by customer_id order by cnt desc) as rnk from (select customer_id, product_id, count(product_id) cnt from orders group by customer_id,product_id) t) fin where rnk = 1 ) select main.customer_id, main.product_id, p.product_name from main join products p on main.product_id = p.product_id
with max_prod as( select o.customer_id,o.product_id,count(o.product_id) prod_cnt,p.product_name from orders o inner join products p on o.product_id = p.product_id group by o.customer_id,o.product_id,p.product_name order by o.customer_id), s1 as (select customer_id,product_id,product_name, rank() over(partition by customer_id order by prod_cnt desc) as rnk from max_prod ) select customer_id,product_id,product_name from s1 where rnk = 1
with n_orders as ( select customer_id, product_id, count(distinct order_id) as orders from orders o group by 1,2 ) , cust_max as ( select customer_id, max(orders) as orders from n_orders group by 1 ) select n.customer_id, n.product_id, p.product_name from n_orders n left join products p on p.product_id = n.product_id inner join cust_max c on c.customer_id = n.customer_id and c.orders = n.orders
with new as( select customer_id, product_id from( select customer_id, product_id, dense_rank() over(partition by customer_id order by cnt desc) as ranks from ( select customer_id, product_id, count(product_id) as cnt from orders group by customer_id, product_id order by customer_id) as a) as b where ranks = 1) select customer_id, new.product_id, product_name from new join products as p on new.product_id = p.product_id
with new as( select customer_id, product_id, count(product_id) as cnt from orders group by customer_id, product_id) select b.customer_id, p.product_id, p.product_name from( select customer_id, product_id from (select customer_id, product_id, dense_rank() over(partition by customer_id order by cnt desc) as ranks from new) as a where ranks = 1) as b left join products as p on p.product_id = b.product_Id
with odr as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as product_count from orders group by customer_id,product_id) select c.customer_id, p.product_id, p.product_name from customers c, odr, products p where c.customer_id=odr.customer_id and odr.product_id = p.product_id and odr.product_count=1
with odr as (select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as product_count from orders group by customer_id,product_id) select odr.customer_id, p.product_id, p.product_name from odr, products p where odr.product_id = p.product_id and odr.product_count=1
with order_count as (select customer_id, product_id, count(*) as nums from Orders group by 1,2 order by customer_id) ,max_order as (select customer_id,product_id, nums from order_count where (customer_id,nums) in (select customer_id,max(nums) from order_count group by customer_id)) select max_order.customer_id, max_order.product_id, Products.product_name from max_order join Products on max_order.product_id=Products.product_id
with order_counts as ( SELECT o.customer_id, p.product_name, p.product_id, count(o.order_id) as order_count FROM orders o INNER JOIN products p ON p.product_id = o.product_id GROUP BY 1,2,3) select oc.customer_id, oc.product_id, oc.product_name from order_counts oc WHERE oc.order_count = (select MAX(order_count) from order_counts x where x.customer_id = oc.customer_id)
with order_counts as ( SELECT o.customer_id, p.product_name, p.product_id, count(o.order_id) as order_count FROM orders o INNER JOIN products p ON p.product_id = o.product_id GROUP BY 1,3) select oc.customer_id, oc.product_id, oc.product_name from order_counts oc WHERE oc.order_count = (select MAX(order_count) from order_counts x where x.customer_id = oc.customer_id)
with order_counts as ( select c.customer_id, p.product_id, p.product_name, count(*) as count_of_orders from Customers c inner join Orders o on c.customer_id = o.customer_id inner join Products p on p.product_id = o.product_id group by c.customer_id, p.product_name ) , order_counts_ranked as ( select customer_id, product_id, product_name, count_of_orders, rank() over (partition by customer_id order by count_of_orders desc) order_count_rank from order_counts ) select customer_id, product_id, product_name from order_counts_ranked where order_count_rank = 1
with order_cte as ( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(1) desc) as drank from orders group by 1, 2 ) select o.customer_id, o.product_id, p.product_name from order_cte o join products p on o.product_id = p.product_id where drank = 1
with ordercount as ( select c.customer_id, p.product_id , product_name, count(order_id) as order_count from customers c inner join orders o on c.customer_id = o.customer_id inner join products p on o.product_id = p.product_id group by c.customer_id, p.product_id , product_name ) select customer_id, product_id, product_name from ( select customer_id, product_id, product_name, dense_rank() over (partition by customer_id order by order_count desc) as order_rank from ordercount ) a where order_rank=1
with orderr as (select customer_id,product_id,count(*) cnt from orders group by customer_id,product_id), final_order as (select customer_id,product_id from (select customer_id,product_id,rank() over (partition by customer_id order by cnt desc)rnk from orderr GROUP BY customer_id, product_id ORDER BY customer_id, product_id)t where rnk=1) select o.customer_id,o.product_id,p.product_name from final_order o join products p on o.product_id=p.product_id
with orders_cte as (select customer_id, product_id, count(*) as no_of_orders from orders group by customer_id,product_id), max_cte as (select customer_id,product_id,no_of_orders, dense_rank() over (partition by customer_id order by no_of_orders desc) as rn from orders_cte ) select m.customer_id, p.product_id, p.product_name from max_cte m join products p on m.product_id=p.product_id where rn=1
with ordertimes as (select customer_id, product_id, count(*) as order_times from Orders group by customer_id, product_id), maxordertimes as (select customer_id, max(order_times) max_order_times from ordertimes group by customer_id) select o.customer_id, o.product_id, p.product_name from ordertimes o left join maxordertimes m on o.customer_id = m.customer_id left join Products p on o.product_id = p.product_id where order_times = max_order_times
with ords as (select a.customer_id,b.product_id,c.product_name, COUNT(*) as cnt from customers a LEFT JOIN orders b on a.customer_id = b.customer_id LEFT JOIN products c On b.product_id = c.product_id where b.product_id is not null group by 1,2,3 having count(*) >= 1 ), rn as ( select customer_id,product_id,product_name,cnt, rank() OVER (PARTITION BY customer_id ORDER BY cnt DESC) as rnk from ords a ) select customer_id,product_id,product_name from rn where rnk = 1
with pc as ( select customer_id, o.product_id, p.product_name, count(*) as freq from Orders o inner join Products p on o.product_id = p.product_id group by 1,2), pmax as ( select customer_id, max(freq) as mfreq from pc group by customer_id ) select pc.customer_id, product_id, product_name from pc inner join pmax on pc.customer_id = pmax.customer_id and pc.freq = pmax.mfreq
with prnk as (select customer_id, product_id, rank() over(partition by customer_id order by count(*) desc) as rnk from Orders group by customer_id, product_id) select p.customer_id, p.product_id, Pr.product_name from prnk p join Products pr on p.product_id = Pr.product_id where p.rnk = 1
with prod as( select customer_id, product_id, count(order_id) as times from orders group by customer_id, product_id), t as( select customer_id, product_id, dense_rank() over(partition by customer_id order by times desc) as rnk from prod ) select t.customer_id, t.product_id, p.product_name from t left join products as p on t.product_id = p.product_id where t.rnk =1
with prod_count as (select customer_id, product_id, COUNT(product_id) as product_count from Orders group by customer_id, product_id), den_rank as (select customer_id, product_id, DENSE_RANK() over (partition by customer_id order by product_count desc) as max_prod from prod_count) select sub.customer_id, sub.product_id, p.product_name from (select * from den_rank where max_prod = 1) sub left join Products p on sub.product_id = p.product_id
with product_cnts as ( select o.customer_id, o.product_id, p.product_name, count(*) as purchases from Orders o inner join products p on o.product_id = p.product_id group by 1,2,3 ) select customer_id, product_id, product_name from ( select *, rank() over (partition by customer_id order by purchases desc) as ranking from product_cnts )_ where ranking = 1
with product_orders_cnt as ( SELECT customer_id , product_id , count(0) as ordered FROM Orders o GROUP BY customer_id, product_id) SELECT p1.customer_id , p1.product_id , p.product_name FROM product_orders_cnt p1 JOIN Products p on p1.product_id = p.product_id WHERE ordered = (SELECT max(ordered) from product_orders_cnt p2 where p1.customer_id = p2.customer_id)
with product_ranks AS ( SELECT o.customer_id, o.product_id, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(o.product_id) DESC) AS rnk FROM orders o GROUP BY customer_id, product_id ), top as ( SELECT * FROM product_ranks WHERE rnk = 1 ) SELECT t.customer_id, t.product_id, product_name FROM top as t JOIN products p ON p.product_id = t.product_id
with qry1 as ( SELECT customer_id, product_id, count(*) as cnt FROM Orders GROUP BY customer_id, product_id ) SELECT a.customer_id, a.product_id, c.product_name FROM qry1 a, (SELECT customer_id, max(cnt) as mcnt FROM qry1 GROUP BY customer_id) b, Products c WHERE a.customer_id = b.customer_id and a.cnt = b.mcnt and a.product_id = c.product_id
with r1 as ( select customer_id,product_id,rank() over(partition by customer_id order by count(*) desc) as rnk from orders group by 1,2 ) select r1.customer_id,r1.product_id,p.product_name from r1 left join products p on r1.product_id = p.product_id where r1.rnk = 1
with ranked as ( select customer_id, product_id, dense_rank() over (partition by customer_id order by count(*) desc) as rk from Orders group by customer_id, product_id ) select c.customer_id, p.product_id, p.product_name from ranked join Products p on ranked.product_id = p.product_id join Customers c on ranked.customer_id = c.customer_id where rk = 1
with ranks as ( select n.customer_id, n.product_id, n.num, dense_rank() over(partition by n.customer_id order by n.num desc) as rnk from (select customer_id, product_id, count(*) as num from Orders group by 1,2) n ) select r.customer_id, p.product_id, p.product_name from ranks r join Products p on r.product_id = p.product_id where r.rnk = 1
with resultcte as ( select customer_id, product_id, cnt, dense_rank() over (partition by customer_id order by cnt desc) as rnk from ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id order by customer_id, count(*) desc ) sub ) select r.customer_id, r.product_id, p.product_name from resultcte as r join products p on r.product_id = p.product_id where r.rnk = 1
with rnk as( select customer_id, product_id, rank() over(partition by customer_id order by count(*) desc) r from orders group by customer_id, product_id ) select customer_id, product_id, (select product_name from products p where p.product_id = rnk.product_id) product_name from rnk where r = 1
with s as (select customer_id, product_id, rank() over(partition by customer_id order by tmp.count desc) as 'rank' from (select customer_id, product_id, count(*) as 'count' from orders group by 1, 2 order by 1, 3 desc) as tmp) select s.customer_id, s.product_id, p.product_name from s join Products p on s.product_id = p.product_id and s.rank = 1 order by 1,2
with subtable as (select customer_id, product_id, count(*) as counts from orders group by customer_id, product_id) select customer_id, temp.product_id, p.product_name from (select *, rank() over(partition by customer_id order by counts desc) as ranking from subtable) as temp left join products as p on temp.product_id = p.product_id where ranking = 1 order by customer_id, product_id
with summary as( select o.customer_id, o.product_id, count(o.order_id) as ords, dense_rank() over(partition by o.customer_id order by count(o.product_id) desc) as rk, p.product_name from orders o left join products p on p.product_id = o.product_id group by o.customer_id, o.product_id, p.product_name ) select customer_id, product_id, product_name from summary where rk = 1
with t as ( select count(*) as cnt, customer_id, product_id from orders group by customer_id, product_id ) select customer_id, p.product_id, product_name from t left join products p on t.product_id = p.product_id where ( select count(distinct t1.cnt) from t t1 where t1.customer_id=t.customer_id and t1.cnt >= t.cnt )=1
with t as ( select count(*) as cnt, customer_id, product_id from orders group by customer_id, product_id ) select t.customer_id, p.product_id, product_name from t left join t t1 on t.customer_id = t1.customer_id and t.cnt <=t1.cnt left join products p on t.product_id = p.product_id group by t.customer_id,p.product_id, t.cnt having count(distinct t1.cnt)=1
with t as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id ) select customer_id, product_id, product_name from t t1 join products using(product_id) where cnt = (select max(cnt) from t t2 where t2.customer_id = t1.customer_id)
with t as ( select customer_id, product_id, count(order_id) as num_orders from Orders group by customer_id, product_id order by num_orders desc) select customer_id, product_id, product_name from ( select customer_id, t.product_id, p.product_name, rank() over (partition by customer_id order by num_orders desc) rank_product from t left join Products p on t.product_id = p.product_id) t2 where t2.rank_product = 1
with t as ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) ranks from orders group by customer_id, product_id order by customer_id, ranks ) select t.customer_id, t.product_id, products.product_name from t, products where t.product_id = products.product_id and ranks =1
with t as ( select o.customer_id, o.product_id, p.product_name ,rank() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders o LEFT JOIN Products p on o.product_id = p.product_id group by o.customer_id, o.product_id ) select customer_id, product_id, product_name from t where rnk = 1 order by customer_id, product_id
with t as ( select o.customer_id, o.product_id, p.product_name, rank() over (partition by o.customer_id order by count(o.product_id) desc) as product_rank from customers c join orders o on c.customer_id = o.customer_id join products p on o.product_id = p.product_id group by o.customer_id, o.product_id ) select customer_id, product_id, product_name from t where product_rank = 1
with t as ( select o.customer_id, o.product_id, p.product_name, row_number() over(partition by o.customer_id, o.product_id order by o.order_date) as rn from Orders o LEFT JOIN Products p on o.product_id = p.product_id ) select customer_id, product_id, product_name from t where rn = (select max(rn) from t as t2 where t2.customer_id = t.customer_id)
with t as (select customer_id, orders.product_id, products.product_name, count(*) as product_count from orders left join products on orders.product_id = products.product_id group by customer_id, orders.product_id) select t1.customer_id, t1.product_id, t1.product_name from t t1 left join t t2 on t1.customer_id = t2.customer_id and t1.product_count < t2.product_count where t2.product_count is null
with t as (select customer_id, product_id, count(product_id) as ct from orders group by 1,2) select t1.customer_id, t1.product_id, p.product_name from t t1 join products p on t1.product_id= p.product_id and t1.ct in (select max(ct) from t t2 where t1.customer_id=t2.customer_id)
with t as( select customer_id,product_id, count(product_id) over (partition by customer_id, product_id) as temp from Orders) select distinct customer_id, t.product_id, product_name from t join Products P on t.product_id = P.product_id where (customer_id, temp) in (select distinct customer_id, max(temp) over (partition by customer_id) from t)
with t as( select o.customer_id, o.product_id, (select product_name from Products where product_id =o.product_id) as product_name, dense_rank() over (partition by o.customer_id order by count(*) desc) as rank_ from Orders o group by 1, 2 ) select customer_id, product_id, product_name from t where rank_=1
with t as( select o.customer_id, o.product_id, p.product_name, count(*) as count from orders o left join products p on o.product_id = p.product_id left join customers c on o.customer_id = c.customer_id group by o.customer_id,o.product_id order by o.customer_id, count desc ) select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over(partition by customer_id order by count desc) as r from t ) a where r = 1
with t as(select o.customer_id, rank() over(partition by o.customer_id order by count(o.product_id) desc) rnk, o.product_id, p.product_name from customers c join orders o on o.customer_id=c.customer_id join products p on p.product_id=o.product_id group by o.customer_id, o.product_id) select customer_id, product_id, product_name from t where rnk = 1 order by customer_id, product_id
with t1 AS (SELECT customer_id, product_id, COUNT(product_id) AS `count`, RANK() OVER (PARTITION BY customer_id ORDER BY COUNT(product_id) DESC) AS `Rank` FROM Orders GROUP BY customer_id, product_id) SELECT c.customer_id, p.product_id, product_name FROM Customers c JOIN t1 USING (customer_id) JOIN Products p USING (product_id) WHERE `Rank` = 1
with t1 as ( select customer_id, orders.product_id, product_name, count(orders.product_id), rank() over (partition by customer_id order by count(orders.product_id) desc) as product_rank from orders left join products on orders.product_id = products.product_id group by product_id, customer_id ) select customer_id, product_id, product_name from t1 where product_rank=1
with t1 as ( select customer_id, product_id, count(order_id) as count_product from Orders group by customer_id, product_id ), t2 as ( select *, dense_rank() over (partition by customer_id order by count_product desc) as rank_product from t1 ) select t2.customer_id, t2.product_id, Products.product_name from t2 left join Products on t2.product_id = Products.product_id where t2.rank_product = 1
with t1 as ( select customer_id, product_id, count(order_id) as count_product from Orders group by customer_id, product_id ), t2 as ( select *, rank() over (partition by customer_id order by count_product desc) as rank_product from t1 ) select t2.customer_id, t2.product_id, Products.product_name from t2 left join Products on t2.product_id = Products.product_id where t2.rank_product = 1
with t1 as ( select customer_id, product_id, count(order_id) as frequency from Orders o group by 1, 2), t2 as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by frequency desc) as rnk from t1) select t2.customer_id, t2.product_id, p.product_name from t2 left join Products p on t2.product_id = p.product_id where rnk = 1
with t1 as ( select customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id ) select customer_id, t1.product_id, p.product_name from t1 join products p on t1.product_id = p.product_id and rnk = 1
with t1 as ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as rnk from orders group by customer_id, product_id) select customer_id, t1.product_id, p.product_name from t1 join products p on t1.product_id = p.product_id where rnk = 1
with t1 as (select customer_id, b.product_id, product_name, rank()over(partition by customer_id order by count(order_id) desc) as rnk from orders a left join products b using(product_id) group by 1,2) select customer_id, product_id, product_name from t1 where rnk=1
with t1 as (select customer_id, product_id, count(order_id) as c from Orders group by customer_id, product_id) select customer_id, product_id, product_name from( select customer_id, t1.product_id, product_name, dense_rank()over(partition by customer_id order by c desc)rk from t1 inner join Products p on t1.product_id = p.product_id)T where rk =1
with t1 as (select customer_id, product_id, count(product_id) as 'cnt' from orders group by customer_id, product_id order by 1) select customer_id, t2.product_id, product_name from (select customer_id, product_id, cnt, rank() over (partition by customer_id order by cnt desc) as rnk from t1) t2 left join products p on (p.product_id = t2.product_id) where t2.rnk = 1
with t1 as( select o.customer_id, o.product_id, p.product_name, rank() over(partition by o.customer_id order by count(o.product_id) desc) as rnk from Orders as o join Products as p using(product_id) group by o.customer_id, o.product_id ) select customer_id, product_id, product_name from t1 where rnk = 1
with t_count as ( select c.customer_id, p.product_id, p.product_name, rank() over(partition by c.customer_id order by count(o.product_id) desc) as rk from customers c join orders o on c.customer_id = o.customer_id join products p on o.product_id = p.product_id group by 1,2,3) select customer_id, product_id, product_name from t_count where rk = 1
with tab as (select c.customer_id, p.product_id, p.product_name, count(p.product_name) over(partition by c.customer_id, p.product_id) as mk from Customers c join Orders o on c.customer_id = o.customer_id join Products P on P.product_id = o.product_id ) select distinct customer_id, product_id, product_name from tab x where x.mk >= all(select y.mk from tab y where x.customer_id = y.customer_id)
with tb as ( select t.customer_id, t.product_id, t.counts from ( select customer_id, product_id, count(order_id) as counts, dense_rank() over (partition by customer_id order by count(order_id) desc) as r from orders group by customer_id, product_id) as t where t.r=1) select tb.customer_id, tb.product_id, p.product_name from tb left join products p on p.product_id = tb.product_id
with tbl1 as (select customer_id, product_id, count(product_id) as cnt from Orders group by customer_id, product_id), tbl2 as (select customer_id,max(cnt) as mcnt from tbl1 group by customer_id), tbl3 as (select customer_id,product_id,cnt from tbl1 where (customer_id,cnt) in (select tbl2.customer_id,tbl2.mcnt from tbl2)) select o.customer_id,o.product_id, product_name from tbl3 o left join Products p on o.product_id = p.product_id
with tbl2 as ( with tbl1 as ( select customer_id as c, product_id as p, count(product_id) as num from Orders group by customer_id, product_id) select *, max(tbl1.num) over (partition by tbl1.c) as maxi from tbl1) select tbl2.c as customer_id, tbl2.p as product_id, p.product_name from tbl2 join products as p on tbl2.p = p.product_id where tbl2.maxi = tbl2.num order by tbl2.c
with temp as ( Select distinct customer_id, product_id, Dense_rank() over(partition by customer_id order by count(product_id) DESC)as cnt from orders group by customer_id, product_id) select distinct t.customer_id, t.product_id, p.product_name from temp t join products p on t.product_id = p.product_id where cnt = 1
with temp as ( Select o.customer_id, o.product_id, P.product_name, rank() over (partition by customer_id order by count(o.product_id) desc) as rnk FROM Orders O JOIN Products P ON O.product_id = P.product_id GROUP BY customer_id, product_id ) Select customer_id, product_id, product_name from temp where rnk =1
with temp as ( select c.customer_id, o.product_id, rank() over (partition by c.customer_id order by count(o.order_id) DESC) as rk from Orders o left join Customers c on o.customer_id = c.customer_id group by 1,2 ) select t.customer_id, t.product_id, p.product_name from temp t left join Products p on t.product_id = p.product_id where t.rk = 1
with temp as ( select customer_id, o.product_id, p.product_name, dense_rank() over (partition by customer_id order by count(order_id) desc) as ranking from Orders as o join Products as p on o.product_id = p.product_id group by customer_id, o.product_id ) select customer_id, product_id, product_name from temp where ranking = 1
with temp as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id ) select customer_id, p.product_id, product_name from temp t1 join products p on t1.product_id = p.product_id where cnt>= (select max(cnt) from temp t2 where t1.customer_id = t2.customer_id )
with temp as ( select customer_id, product_id, count(*) as cnt from orders group by customer_id, product_id ) select customer_id, p.product_id, product_name from temp t1 join products p on t1.product_id = p.product_id where cnt>= (select max(cnt) from temp t2 where t1.customer_id = t2.customer_id group by t2.customer_id)
with temp as ( select customer_id, product_id, count(order_id) as num_order from orders group by customer_id, product_id order by customer_id, product_id ), max_order as ( select customer_id, max(num_order) as max_order from temp group by customer_id order by customer_id ) select a.customer_id, a.product_id, p.product_name from temp a inner join max_order b on a.customer_id = b.customer_id and a.num_order = b.max_order left join products p on a.product_id = p.product_id
with temp as ( select customer_id,product_id, count(*) as num_times from Orders group by 1,2 order by 1 ), temp2 as ( select customer_id,product_id from temp A where num_times = (select max(num_times) from temp B where B.customer_id=A.customer_id group by customer_id) ) select temp2.customer_id,temp2.product_id,product_name from temp2 inner join Products on temp2.product_id=Products.product_id
with temp as (select a.customer_id, a.product_id, product_name,count(*) as cnt from Orders a left join products b on a.product_id=b.product_id group by customer_id, product_id, product_name) select customer_id, product_id, product_name from (select customer_id, product_id, product_name, rank() over (partition by customer_id order by cnt desc) as rnk from temp) x where rnk=1
with temp as (select customer_id , product_id , dense_rank() over(partition by customer_id order by count(product_id) desc) as d from orders group by customer_id, product_id) select customer_id , temp.product_id , product_name from temp join products on temp.product_id = products.product_id where d =1
with temp as (select customer_id, product_id from (select customer_id, product_id, rank() over (partition by customer_id order by cnt desc) as customer_rk from (select customer_id, product_id, count(*) as cnt from Orders group by customer_id, product_id) A ) B where customer_rk=1) select T.customer_id, T.product_id, P.product_name from temp T join Products P on T.product_id = P.product_id
with temp as (select customer_id, product_id, count(order_id) as num_order from Orders group by 1, 2 ), temp2 as (select c.customer_id, c.product_id, p.product_name, num_order, max(num_order) over (partition by c.customer_id) as max_num_order from temp c left join Products p on c.product_id = p.product_id) select customer_id, product_id, product_name from temp2 where num_order = max_num_order
with temp as (select customer_id, product_id, rank() over (partition by customer_id order by count(product_id) desc) rk from orders group by 1,2) select customer_id, t.product_id, p.product_name from temp t join products p on t.product_id=p.product_id where rk =1
with temp as (select customer_id, product_id, rank() over (partition by customer_id order by counts desc) as cts_rank from (select customer_id,product_id, count(product_id) as counts from Orders group by 1,2) as a order by 1,3) SELECT temp.customer_id, temp.product_id, Products.product_name FROM temp LEFT JOIN Products ON temp.product_id = Products.product_id WHERE temp.cts_rank = 1 ORDER BY temp.customer_id, temp.product_id
with temp as (select customer_id,product_id, rank() over (partition by customer_id order by count(product_id) desc) rank_p from orders group by customer_id,product_id order by customer_id) select t.customer_id, t.product_id, p.product_name from temp as t INNER JOIN Products as p on t.product_id = p. product_id where t.rank_p =1
with temp as (select product_id ,customer_id,count(customer_id) as cnt, rank() over (partition by customer_id order by count(customer_id) desc) as rnum from orders group by 1,2) select customer_id,temp.product_id,product_name from products p join temp on p.product_id = temp.product_id where rnum = 1 group by 1,2 order by 1
with temp as (select product_id, customer_id, count(customer_id) as cnt, rank() over(partition by customer_id order by count(customer_id) desc) as r_num from orders group by 1,2) select customer_id, temp.product_id, product_name from products p join temp on p.product_id = temp.product_id where r_num = 1 group by 1,2 order by 1
with temp as (select product_id, customer_id, rank() over(partition by customer_id order by count(*) desc) as r_num from orders group by 1,2) select customer_id, temp.product_id, product_name from products p join temp on p.product_id = temp.product_id where r_num = 1 group by 1,2
with temp as (select product_id, customer_id, rank() over(partition by customer_id order by count(customer_id) desc) as r_num from orders group by 1,2) select customer_id, temp.product_id, product_name from products p join temp on p.product_id = temp.product_id where r_num = 1 group by 1,2 order by 1
with temp as(select customer_id, product_id, count(product_id) as counts from Orders group by 1,2) select T.customer_id, T.product_id, P.product_name from Products P right JOIN (select customer_id, product_id from temp where (customer_id, counts) in (select customer_id, max(counts) from temp group by 1)) T ON P.product_id = T.product_id
with temp1 as ( select customer_id, product_id, count(*) cnt from orders group by customer_id, product_id ), temp2 as ( select customer_id, max(cnt) max_c from temp1 group by customer_id ) select t2.customer_id, t1.product_id, p.product_name from temp2 t2 left join temp1 t1 on t2.customer_id = t1.customer_id and t2.max_c = t1.cnt left join products p on t1.product_id = p.product_id
with temp1 as ( select customer_id, product_id, count(product_id) as ct from orders group by customer_id, product_id), temp2 as ( select customer_id,max(ct) as ct1 from temp1 group by customer_id), temp3 as ( select a.customer_id, a.ct1, b.product_id from temp2 as a left join temp1 as b on a.customer_id=b.customer_id and a.ct1=b.ct ) select a.customer_id,a.product_id, b.product_name from temp3 as a left join products as b on a.product_id = b.product_id
with temp_rank as ( select customer_id, product_id, count(product_id) as cnt, dense_rank() over(partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id, product_id ) select tr.customer_id, tr.product_id, p.product_name from temp_rank tr inner join products p on tr.product_id = p.product_id where rnk = 1
with temp_rank as ( select customer_id, product_id, dense_rank() over(partition by customer_id order by count(product_id) desc) as rnk from Orders group by customer_id, product_id ) select tr.customer_id, tr.product_id, p.product_name from temp_rank tr inner join products p on tr.product_id = p.product_id where rnk = 1
with tmp as ( select a.customer_id , a.product_id , b.product_name , rank() OVER (partition by customer_id order by count(*) DESC ) as topOrder from orders a inner join products b on a.product_id = b.product_id group by 1,2,3 ) select customer_id , product_id , product_name from tmp where toporder = 1
with tmp as ( select customer_id, product_id, count(*) as ct from orders group by 1, 2 ) select customer_id, product_id, product_name from tmp natural join products where (customer_id, ct) in ( select customer_id, max(ct) from tmp group by 1 )
with tmp as ( select customer_id, product_id, count(*) as qty from orders group by customer_id, product_id ), tmp2 as ( select customer_id, product_id, qty, max(qty) over(partition by customer_id) as max_qty from tmp ) select customer_id, tmp2.product_id, product_name from tmp2 join products p on tmp2.product_id = p.product_id where qty = max_qty
with tmp as ( select customer_id, product_id, count(order_id) as order_count from Orders group by customer_id, product_id ), tmp2 as ( select customer_id, product_id, rank() over (partition by customer_id order by order_count desc) as rank_no from tmp ) select c.customer_id, t.product_id, p.product_name from Customers c join tmp2 t on c.customer_id = t.customer_id join Products p on t.product_id = p.product_id where t.rank_no = 1
with tmp as (select customer_id, product_id, product_name, count(distinct order_id) as orders from (select t1.customer_id, t1.product_id, t3.product_name, t1.order_id from Orders t1 left join Products t3 on t1.product_id = t3.product_id) t4 group by 1,2,3), prep as (select customer_id, product_id, product_name, rank() over(partition by customer_id order by orders desc) as ranks from tmp) select customer_id, product_id, product_name from prep where ranks = 1
with tmp_table as ( select customer_id, product_id, dense_rank() over (partition by customer_id order by cnt desc) as rn from ( select customer_id, product_id, count(*) as cnt from Orders group by 1,2 order by 1,2 ) drv ) select drv.customer_id, prod.product_id, prod.product_name from tmp_table drv left join Products prod on drv.product_id = prod.product_id where drv.rn = 1
with x as ( select c.customer_id, p.product_name, p.product_id, count(p.product_id) as cnt from orders as o inner join customers as c on o.customer_id = c.customer_id inner join products as p on o.product_id = p.product_id group by 1,2,3 ), y as ( select *, rank() over (partition by customer_id order by cnt desc) as rnk from x ) select customer_id, product_id, product_name from y where rnk = 1
with x as ( select customer_id, product_id from (select customer_id, product_id, rank() over (partition by customer_id order by num_of_orders desc) as rn from (select customer_id, product_id, count(*) as num_of_orders from orders o group by customer_id, product_id) as a) as b where rn = 1) select a.*, p.product_name from x a inner join products p using(product_id)
with x as (select customer_id,product_id from ( select customer_id, product_id, rank() over(partition by customer_id order by count(product_id) desc) as "Rank" from orders group by customer_id,product_id )c where c.Rank=1 ) select x.customer_id, x.product_id, p.product_name from x inner join products p on p.product_id=x.product_id
